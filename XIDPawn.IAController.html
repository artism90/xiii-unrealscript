<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Frameset//EN""http://www.w3.org/TR/REC-html40/frameset.dtd">
<HTML>
<HEAD>
<!--Generated by UnDox 1.0.3 Copyright (c) 2000 Epic Games. UnDox created and mainteained by Bruce Shankle - bruce@epicgames.com -->
<TITLE>
XIDPawn.IAController
</TITLE>
<LINK REL ="stylesheet" TYPE="text/css" HREF="stylesheet.css" TITLE="Style">
</HEAD>
<BODY BGCOLOR="white" vlink="#0000FF" alink="#0000FF">
<H2>
<FONT SIZE="-1">
XIDPawn</FONT>
<BR>
Class  IAController</H2>
<FONT SIZE="-1">source: C:\XIII\XIDPawn\Classes\IAController.uc</FONT>
<PRE>
<a href="Core.Object.html">Core.Object</a>
   |
   +--<a href="Engine.Actor.html">Engine.Actor</a>
      |
      +--<a href="Engine.Controller.html">Engine.Controller</a>
         |
         +--<a href="Engine.AIController.html">Engine.AIController</a>
            |
            +--<b>XIDPawn.IAController</b>
</PRE>
<TABLE><TR><TD><B>Direct Known Subclasses:</B><a href="XIDPawn.FBi_Helico01_Controller.html">FBi_Helico01_Controller</a></TD></TR></TABLE>
<hr/>class <b>IAController</b><br>
extends <a href="Engine.AIController.html">Engine.AIController</a>
<p/>
<xmp>//=============================================================================
// IAController.
//=============================================================================
</xmp><br><TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>Variables</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L91">Angle_Visee </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  vitesse de deplacements en strafe </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;enum</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L22">AttitudeInfo</A></B></CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIDPawn.BaseSoldier.html">BaseSoldier</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L39">BaseS </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaque= pote qui me bloque le chemin </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L119">CHARGE_LES_LOGS </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Pour voir mes logs </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIDPawn.BaseSoldier.html">BaseSoldier</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L41">CadavreWithPickup </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   pour aller chercher pickups sur cadavre </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L104">CompteurRecalage </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  utilise dans charge,attaque et TM pour savoir si se recale </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L105">CompteurTrame </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  optimisation du Tick </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L87">DefaultHearingThreshold </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  distance de tdetection des murs </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L85">DefaultPeripheralVision </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  distance de tdetection des murs </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L86">DefaultSightRadius </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  distance de tdetection des murs </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="Engine.NavigationPoint.html">NavigationPoint</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L46">DestNavPoint </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =patrouille= point de destination </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;vector</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L71">DirectionTir </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  direction du tir </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L83">DistNearWall </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  distance de tdetection des murs </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L82">DistanceDeplacement </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   distance de test de deplacement dans errance et fuite </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="Engine.NavigationPoint.html">NavigationPoint</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L45">DoorP </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =ouvreporte= pour verifier qu'il y a des doorpoints </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;vector</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L69">EnemyTargetPos </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  derniere position connue de l'enemy </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;vector</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L70">EnemyTargetVelocity </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  derniere position connue de l'enemy </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;name</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L57">EtatNeutre </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   etat neutre (tenir, patrouille ou tenir) </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L95">FireTimerRefresh </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  temps de refresh du tir en auto </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIII.GrenadFlying.html">GrenadFlying</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L54">Grenade </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  une grenade est lancee </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;vector</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L74">HidingSpot </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =tacticalmove= </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="Engine.Actor.html">Actor</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L34">Interrogation </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   effet interrogation ou exclamation </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIDPawn.AttackPoint.html">AttackPoint</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L49">LastAttackPoint </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Point d'attaque courant </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIII.XIIIPorte.html">XIIIPorte</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L44">LastBumpedDoor </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  last bumped door to avoid to be blocked </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIDPawn.PatrolPoint.html">PatrolPoint</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L48">LastPatrolPoint </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =patrouille= dernier patrolpoint utilise </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIDPawn.StrategicPoint.html">StrategicPoint</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L53">LastStrP </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =chasse= Dernier Safe Point </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="Engine.Actor.html">Actor</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L17">MoveActor </A></B></CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="Engine.Actor.html">Actor</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L17">MoveActor </A></B></CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;vector</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L11">MovePoint </A></B></CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;vector</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L11">MovePoint </A></B></CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L103">NbCoupsRiposte </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  utilise dans timer pour savoir combien de coups ne sont pas bloques </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L106">NbPointChemin </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   nb de point dans pathfinding </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L112">NextRouteCachePoint </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaqueScriptee= pour reprendre vers point suivant apres ouverture de porte </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L101">NiveauALerte </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  niveau d'alerte </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L102">NiveauALerteEnAS </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  niveau d'alerte </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L110">NombreDePointsSkippes </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaqueScriptee= pour calcul du prochain AP </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L109">NumeroProchainPoint </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaqueScriptee= choix entre differents AP </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIDPawn.AttackPoint.html">AttackPoint</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L50">OldAttackPoint </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Dernier Point d'attaque </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIDPawn.SafePoint.html">SafePoint</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L51">OldSafePoint </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =chasse= Dernier Safe Point </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;name</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L60">PatrolAnim </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  type d'anim de patrouille </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="Engine.Pawn.html">Pawn</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L36">PeeredEnemy </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =investigation= </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="Engine.Actor.html">Actor</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L33">PointChemin[16] </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  points intermediaire du pathfinding </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;vector</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L77">PointDestination </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaque=  pour calculer destination </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="Engine.NavigationPoint.html">NavigationPoint</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L47">PointIntermediaire </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaque=  point intermediaire de deplacement </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;vector</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L75">PointTenirPos </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =tenir= position de point de retour en tenir </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;rotator</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L66">PointTenirRot </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =tenir= direction point de retour en tenir </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="Engine.Actor.html">Actor</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L35">PointsInvestigation[3] </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =investigation= </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIII.XIIIPorte.html">XIIIPorte</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L43">PorteOuverte </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  porte a ouvrir </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIDPawn.BaseSoldier.html">BaseSoldier</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L40">Pote </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   ben c'est un pote qu'il faut eviter de toucher. MAJ dans fonction native LineOfFireObstacle() </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIII.XIIIPawn.html">XIIIPawn</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L38">PoteQuiMeBloque </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaque= pote qui me bloque le chemin </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;vector</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L76">PoteQuiMeBloquePos </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaque= pos du pote qui me bloque la porte </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIDPawn.SafePoint.html">SafePoint</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L52">SafePointOccupe </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =chasse= Dernier Safe Point </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;vector</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L73">Temp_Vect </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  point de depart de la balle de l'arme mise a jour dans le moteur </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L94">Temp_float </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  utilise partout </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L99">TempsDeclencheAlarme </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  delai avant qu'il declenche l'alarme </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L93">Temps_Ref2 </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  timer </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L84">Temps_RefreshEnemyPos </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  distance de tdetection des murs </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L81">Temps_errance </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  temps d'errance entre patrouille et errance </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L92">Temps_ref </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  timer </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L89">Timer_VaRecharger </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  vitesse de deplacements en strafe </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;name</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L62">TurnLPatrolAnim </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  type d'anim de demi-tour en patrouille vers gauche </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;name</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L63">TurnRPatrolAnim </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  type d'anim de demi-tour en patrouille vers droite </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;vector</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L78">VecteurRecalage </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaque= </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L88">VitesseDeplacements </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  vitesse de deplacements en strafe </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L97">VitesseHorizontaleSaut </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaqueScriptee= utilise pour saut </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;name</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L61">WaitPatrolAnim </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  type d'anim d'attente en patrouille </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="Engine.Weapon.html">Weapon</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L42">WeaponOnGround </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  arme recuperee sur cadavre </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;vector</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L72">WeaponStartTrace </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  point de depart de la balle de l'arme mise a jour dans le moteur </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIII.XIIIPlayerPawn.html">XIIIPlayerPawn</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L37">XIII </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =investigation= </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L155">bARienVu </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   je suis passe en point d'interro </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L144">bAVuQuelquechose </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   =acquisition= pour sortie interro et exclamation </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L148">bAccroupiSurAP </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaqueScriptee= util. pour tir en rafale </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L138">bAlarmeInstigator </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   vrai pawn si declencheur de l'alarme </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L140">bBloqueFuiteGrenades </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   vrai pawn si declencheur de l'alarme </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L133">bCadavreVu </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  pour faire une retraite </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L128">bCampeVersSafePoint </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  pour faire une retraite </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L121">bChercheStrategicPoint </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Pour voir mes logs </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L135">bDejaVu </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  pour faire une retraite </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L149">bDeplacementsRoulade </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaqueScriptee= </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L118">bDisableDamageattitudeto </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaque= etat = 0 inactif, etat=1 va a un point intermediaire,etat=2 va a un StrP et etat=3 reste sur un STrP </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L150">bDontSeeAnyMore </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaqueScriptee= pour desactivation musique attaque </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L152">bEnCouverture </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaque= </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L126">bEtatAlerte </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  en etat d'alerte  donc attaque direct </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L154">bFuitPourreloader </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaque= </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L131">bImpactNoise </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  pour faire une retraite </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L157">bInWaitMode </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   en attaque H2H pour savoir que je suis en train d'attendre </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L158">bInterruptStateToOpenDoor </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   en attaque H2H pour savoir que je suis en train d'attendre </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L153">bLanceGrenade </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaque= </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L156">bLookAtEnemy </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  regarde si voit enemy pour recommencer a lui tirer dessus </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L134">bPaffe </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  pour faire une retraite </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L136">bPotePaffe </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  pour faire une retraite </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L124">bPrecedentTirBloque </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  utilise dans timer vers timer pour savoir si le precedent tir a ete bloque lors de prise d'otage </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L141">bPremiereRafale </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   vrai pawn si declencheur de l'alarme </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L123">bPrisonnier </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  utilise dans timer vers timer pour savoir si pote otage </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L18">bReachable </A></B></CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L127">bRetraiteVersSafePoint </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  pour faire une retraite </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L146">bSaut </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaqueScriptee=  je suis en train de sauter </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L130">bStepNoise </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  pour faire une retraite </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L145">bSwitchMusicInWaitState </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  //=attaqueScriptee= a fixe l'etat de musique en attente apres delai de pas vu. </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L151">bTemp_Bool </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaqueScriptee= pour desactivation musique attaque </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L142">bTirSurConeMax </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   vrai pawn si declencheur de l'alarme </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L120">bTire </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   Pour voir mes logs </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L12">bTraceable </A></B></CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L159">bTriggerBuffered </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   en attaque H2H pour savoir que je suis en train d'attendre </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L143">bUTurnMove </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =patrouille= deplacement pour les retournement en patrouille </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L137">bVaVersAlarme </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  car pote l'a declenchee </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L125">bVigilant </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  vigilant ou pas  <-> setvigilant </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L122">bWaitForMover </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  utilise dans notifybump vers ouvreporte </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L132">bWeaponNoise </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  pour faire une retraite </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L98">fTimerAttackMusic </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaqueScriptee= pour faire repasser la musique en attente apres certain temps </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIDPawn.GenAlerte.html">GenAlerte</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L55">genalerte </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  une grenade est lancee </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L107">iCompteur </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  compteur utilise dans les boucle sur routecache </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L115">iEtatVaVersSTrp </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaque= etat = 0 inactif, etat=1 va a un point intermediaire,etat=2 va a un StrP et etat=3 reste sur un STrP </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L111">iNumEtat </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaqueScriptee= numero de l'etat (grenadage,...) </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;name</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L58">nextstate </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   prochain etat apres vavers </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L113">numHuntPaths </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =chasse= nombre de points dans chasse </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;name</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L59">prevstate </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;   dernier etat avant ouvreporte </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L147">result </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =attaqueScriptee= pour savoir si change de branche  et pour grenade - utilise aussi dans opendoor </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L96">sleeptime </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  =patrouille= temps de pause sur patrolpoint </TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L108">temp_int </A></B></CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  compteur utilise dans les boucle sur routecache </TD></TR>
</TD></TR><TABLE><br>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>States</B></FONT></TD>
</TR>
<TR><TD><a href="#STATE_AttaqueScriptee">AttaqueScriptee</a>, <a href="#STATE_OuvrePorte">OuvrePorte</a>, <a href="#STATE_VaVers">VaVers</a>, <a href="#STATE_Investigation">Investigation</a>, <a href="#STATE_FuiteGrenade">FuiteGrenade</a>, <a href="#STATE_Fuite">Fuite</a>, <a href="#STATE_temporise">temporise</a>, <a href="#STATE_Chasse">Chasse</a>, <a href="#STATE_TacticalMove">TacticalMove</a>, <a href="#STATE_Attaque">Attaque</a>, <a href="#STATE_AttaqueH2H">AttaqueH2H</a>, <a href="#STATE_Acquisition">Acquisition</a>, <a href="#STATE_ResteSurPlace">ResteSurPlace</a>, <a href="#STATE_Tenir">Tenir</a>, <a href="#STATE_Errance">Errance</a>, <a href="#STATE_Patrouille">Patrouille</a>, <a href="#STATE_init">init</a>, <a href="#STATE_faction">faction</a>, <a href="#STATE_Mort">Mort</a>, <a href="#STATE_Otage">Otage</a></TD></TR><TABLE>
<A NAME="function_summary"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>Function Summary</B></FONT></TD>
</TR>
<br><TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;rotator</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1393">AdjustAim</A></B>(<a href="Engine.Ammunition.html">Ammunition</a> FiredAmmunition, vector projStart, int aimerror)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// Adjust Aim
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L685">AllianceLevel</A></B>(<a href="Engine.Pawn.html">Pawn</a> Newenemy)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// AllianceLevel()
//
// renvoi -1 (enemy) 0 (neutre) ou 1 (ami)suivant alliance
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;AttitudeInfo</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L735">AttitudeToNMI</A></B>(<a href="Engine.Pawn.html">Pawn</a> other)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// FearAttitude()
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L883">ChangeEtat</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// ChangeEtat : retour vers etat neutre
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L919">ChangeToBestWeapon</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// ChangeToBestWeapon()
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1424">CheckLineOfFire</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
//  CheckLineOfFire()           //pote MAJ
//
//declenche pas sur le cote si pote devant
//et passe en chasse si peut pas tirer
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L577">ChercheAlarme</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// ChercheAlarme
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIDPawn.AttackPoint.html">AttackPoint</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L518">ChercheAttackPoint</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// ChercheAttackPoint
//
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L166">ChercheBonMatos</A></B>(<a href="Engine.Pawn.html">Pawn</a> other)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// ChercheBonMatos
//
//si oui ressort l'arme correspondante
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIII.XIIIPawn.html">XIIIPawn</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L554">ChercheNMIPlusProche</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
//
//ChercheNMIPlusProche
//
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L188">CherchePlanqueGrenade</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// CherchePlanqueGrenade
//
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L465">CherchePointPourCamper</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// CherchePointPourCamper  // pour camper
//
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L395">CherchePointReload</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// CherchePointReload      //priorite au dernier safepoint
//
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L326">CherchePointRetraite</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// CherchePointRetraite      //priorite au dernier safepoint
//
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L260">CherchePointSafe</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// CherchePointSafe
//
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L642">ChercheReseauAttaque</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// ChercheReseauAttaque
//
//retourne vrai si a trouve une grenade differente
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1070">DamageAttitudeTo</A></B>(<a href="Engine.Pawn.html">Pawn</a> Other, float Damage)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// DamageAttitudeTo
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;vector</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1471">DirectionDuTir</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// DirectionDuTir()  //avant dispersion
//  Mise a jour de AnleDispersion et point de depart du tir (WeaponStartTrace)
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L864">FindBestPathTo</A></B>(vector desti)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// FindBestPathTo()
//
//
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L843">FindBestPathToward</A></B>(<a href="Engine.Actor.html">Actor</a> desired, optional float, optional float)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// FindBestPathToward()
//
// assumes the desired destination is not directly reachable.
// It tries to set Destination to the location of the
// best waypoint, and returns true if successful
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1556">FindNewStakeOutDir</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// FindNewStakeOutDir
//
// trouve point de visee dans temporise
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1490">FireEnemy</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// FireEnemy
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1583">GetFacingDirection</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// GetFacingDirection
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1529">HalteAuFeu</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// HalteAuFeu
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1478">LigneVisee</A></B>(vector TraceEnd, vector TraceStart)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// LigneVisee()
// ----------------------------------------------------------------------
//permet de savoir si je peut tirer sur le perso (pour eviter de tirer dans les murs)
//collisionne avec level, levelgeometrie et mover
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1415">LineOfFireObstacle</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
//  LineOfFireObstacle()
//
//retourne type de perso
//=0 ligne de mire libre (rien, enemy ou breakable avec bcanseethrought)
//=1 un pote (la var pote est actualisee)
//=2 il y autre chose devant
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1598">MoverFinished</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// MoverFinished
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L803">NearWall</A></B>(float walldist)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>/* NearWall() returns true if there is a nearby barrier at eyeheight, and
changes FocalPoint to a suggested place to look
*/</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L755">NombrePotesPresents</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
//  NombrePotesPresents()
//
//  Nombre de potes dans rayon de 12m
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1534">NotifyFiring</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// NotifyFiring
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1607">PawnDied</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIDPawn.PatrolPoint.html">PatrolPoint</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1549">PickStartPoint</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// PickStartPoint
//
// prend point de depart pour patrouille
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;vector</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1541">PseudoSteering</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// PseudoSteering
// pseudo steering pour les deplacements en combat
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1276">ReceiveWarning</A></B>(<a href="Engine.Pawn.html">Pawn</a> shooter, float projSpeed, vector FireDir)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// ReceiveWarning
//
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;float</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L701">RelativeStrength</A></B>(<a href="Engine.Pawn.html">Pawn</a> Other)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
//
// RelativeStrength()
//
//returns a value indicating the relative strength of other
//0.0 = equal to controlled pawn
//> 0 stronger than controlled pawn
//< 0 weaker than controlled pawn
//
//Since the result will be compared to the creature's aggressiveness, it should be
//on the same order of magnitude (-1 to 1)
//Estimation en fonction de la vie, des armes et des positions en hauteur.
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1006">SeeEnemy</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L775">SetEnemy</A></B>(<a href="Engine.Pawn.html">Pawn</a> NewEnemy)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// SetEnemy
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1028">SetVigilant</A></B>(bool bEnAlerte)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>//SightRadius augmente de 50%
//HearingThreshold augmente de 50%
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L780">SwitchToEnemy</A></B>(<a href="Engine.Pawn.html">Pawn</a> newEnemy)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// SwitchToEnemy: fait passer soldier neutre en ennemi
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1485">TestDirection</A></B>(float mindist, float dist, vector dir, out vector)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// TestDirection()
// ----------------------------------------------------------------------
//test le deplacement dans une direction (en collisionnant tout),suggere une position intermediaire
// sica passe pas et renvoi vrai si le deplacement suggere est superieur a une distance minimal e
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L950">TestSonEntendu</A></B>(<a href="Engine.Actor.html">Actor</a> Son)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ----------------------------------------------------------------------
// TestSonEntendu
// ----------------------------------------------------------------------
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1622">s_decalerte</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>//[****] a virer
</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1634">s_decattaque</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1646">s_decattente</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1628">s_incalerte</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1640">s_incattaque</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1652">s_incattente</A></B>()</CODE></TD></TR>
</table>

<br><br><center>
<a name="STATE_AttaqueScriptee">
<A NAME="State AttaqueScriptee"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State AttaqueScriptee Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L7341">GetAttackPointProperties</A></B>(<a href="XIDPawn.AttackPoint.html">AttackPoint</a> PointAttaque, out float)</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L6831">EndState</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L6767">BeginState</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L6741">CheckLineOfFire</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L6731">PasseEtatAlerteEnAttente</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L6722">PasseEtatAlerteEnAttaque</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;rotator</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L6715">AdjustAim</A></B>(<a href="Engine.Ammunition.html">Ammunition</a> FiredAmmunition, vector projStart, int aimerror)</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L6707">NotifyFiring</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L6659">SeeEnemy</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L6644">DamageAttitudeto</A></B>(<a href="Engine.Pawn.html">Pawn</a> Other, float Damage)</CODE></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_OuvrePorte">
<A NAME="State OuvrePorte"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State OuvrePorte Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L6348">Endstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L6322">beginstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L6312">DamageAttitudeTo</A></B>(<a href="Engine.Pawn.html">Pawn</a> Other, float Damage)</CODE></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_VaVers">
<A NAME="State VaVers"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State VaVers Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L6095">endstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L6043">beginstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L6020">ActualiseSon</A></B>(<a href="Engine.Actor.html">Actor</a> son)</CODE></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_Investigation">
<A NAME="State Investigation"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State Investigation Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L5855">endstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L5834">beginstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L5783">EnregistrePointsVersEnemy</A></B>()</CODE></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_FuiteGrenade">
<A NAME="State FuiteGrenade"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State FuiteGrenade Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L5627">EndState</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L5580">BeginState</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L5522">PickDestination</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L5438">CheckNearestGrenad</A></B>()</CODE></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_Fuite">
<A NAME="State Fuite"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State Fuite Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L5369">EndState</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L5348">BeginState</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L5278">PickDestination</A></B>()</CODE></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_temporise">
<A NAME="State temporise"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State temporise Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L5196">EndState</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L5174">BeginState</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L5166">CanStakeOut</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L5153">ContinueStakeOut</A></B>()</CODE></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_Chasse">
<A NAME="State Chasse"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State Chasse Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L5079">EndState</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L5063">BeginState</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L5038">FindViewSpot</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L4933">PickDestination</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>//if (NewEnemy==XIII) TriggerEvent('XIIIVu', Self, pawn);  //trigger vu
        focus=enemy;
        gotostate('attaque');
    }
    </pre></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_TacticalMove">
<A NAME="State TacticalMove"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State TacticalMove Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L4776">EndState</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>
    {
        if (CHARGE_LES_LOGS) log(pawn@"Tactical Move");
        if (NiveauAlerte==0)
        {
            s_decAttente();
            s_incAttaque();
        }
        else if (NiveauAlerte==1)
        {
            s_decAlerte();
            s_incAttaque();
        }
        NiveauAlerte=2;
        bDisableDamageattitudeto=false;
        Temps_Ref=Level.timeseconds-2;
        settimer3(Temps_RefreshEnemyPos,true);
    }

    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L4757">BeginState</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>
    {
        local vector pick, pickdir;


        pickdir=(Enemy.location-pawn.location) cross vect(0,0,-1);
        pickdir.Z = 0;
        pickdir=normal(pickdir);

        if (TestDirectionAvoidingAlly(pickdir, pick,PoteAEviter))
        {
            Destination = pick;
            return true;
        }
        return false;
    }
    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L4741">TestPasSurLaDroite</A></B>(<a href="XIDPawn.BaseSoldier.html">BaseSoldier</a> PoteAEviter)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>
    {
        local vector pick, pickdir;

        pickdir=(Enemy.location-pawn.location) cross vect(0,0,1);
        pickdir.Z = 0;
        pickdir=normal(pickdir);

        if (TestDirectionAvoidingAlly(pickdir, pick,PoteAEviter))
        {
            Destination = pick;
            return true;
        }
        return false;
    }

    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L4725">TestPasSurLaGauche</A></B>(<a href="XIDPawn.BaseSoldier.html">BaseSoldier</a> PoteAEviter)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// pour partir a 80 degres si charge

        MoveDist=200;
        return TestDirection(110,MoveDist,pickdir, pick);
    }
    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L4713">TestDirectionAvoidingAlly</A></B>(vector pickdir, out vector, <a href="XIDPawn.BaseSoldier.html">BaseSoldier</a> PoteAEviter)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>//test both right and left
    {
        local vector pick, pickdir;
        local bool success;
        local float MoveDist;

        pickdir=(Enemy.location-pawn.location) cross vect(0,0,1);
        pickdir.Z = 0;
        pickdir=normal(pickdir);
        if (Frand()>0.5)
            pickdir *= -1;

        MoveDist = 150+50* FRand();
        success = TestDirection(100,MoveDist,pickdir, pick);
        if (!success)
        {
            MoveDist = 270;
            success = TestDirection(100,MoveDist,-1*pickdir, pick);
            if (!success)
                return false;
        }
        Destination = pick;
        return success;
    }

    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L4688">StrafeDestination</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>//son
        bases.PlaySndPNJOno(pnjono'Onomatopees.hPNJHurt',bases.CodeMesh,bases.NumeroTimbre);

        if (bDisableDamageattitudeto)
            return;
        If (xiii.bPrisonner && XIII.LHand.pOnShoulder!=none && AllianceLevel(XIII.LHand.pOnShoulder)==1 && other==xiii)
        {
            if (CHARGE_LES_LOGS) log(pawn$"je riposte");
            NbCoupsRiposte=(2+bases.agressivite)*1.9;
            NbCoupsRiposte=Min(5,NbCoupsRiposte);
            NbCoupsRiposte=Max(1,NbCoupsRiposte);
        }
    }
    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L4673">DamageAttitudeto</A></B>(<a href="Engine.Pawn.html">Pawn</a> Other, float Damage)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>//decalage par rapport a l'arme
        CheckLineOfFire();
    }
    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L4665">NotifyFiring</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>//CadavreWithPickup affecte a other dans Cherchebonmatos
        {
                    HalteAufeu();
            bDisableEventSeeDeadPawn=true;
            CadavreWithPickup.bDejaFouille=true;
            gotostate('tacticalmove','chercheobjet');
        }
    }
    event EnemyNotVisible()
    {
        if (LigneVisee(enemy.location, LastSeeingPos))
        {
            GotoState('TacticalMove','RecoverEnemy');
            return;
        }
        else
        {
            gotostate('temporise');
            return;
        }
    }
    </pre></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_Attaque">
<A NAME="State Attaque"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State Attaque Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L4278">EndState</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>//temp_int=0; //utilise pour boucle sur pointchemin
        LastStrP=none;

    }
    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L4246">BeginState</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>//log("tente grenadage "@FastTrace(enemy.location+vect(0,0,80),enemy.location));
                if (Vsize(enemy.location-pawn.location)<1200 && Vsize(enemy.location-pawn.location)>200 && FastTrace(enemy.location+vect(0,0,80),enemy.location) && FastTrace(enemy.location+vect(0,0,80),pawn.eyeposition()+pawn.location))
                    return true;
        }
        return false;
    }

    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L4203">TenteGrenadage</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>
    {
        local GrenadeTarget GrenT;
        local int i;

        For(i=0;i<level.game.GrenadeTargetList.Length;i++)
        {
            grent=GrenadeTarget(level.game.GrenadeTargetList[i]);
            if (GrenT.bActive)
                return GrenT;
        }
        return none;
    }
    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;<a href="XIDPawn.GrenadeTarget.html">GrenadeTarget</a></CODE></FONT></TD>
<TD><CODE><B><A HREF="#L4190">ActiveGrenadeTarget</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// ELR End
        if (pawn.pendingweapon==none || !pawn.pendingweapon.HasAmmo())
        {
            log(pawn$"          BEN J'AI PAS DE GRENADE  $$$$$$$");
            return false;
        }
        else
        {
            Pawn.Weapon.PutDown();
            return true;
        }
    }
    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L4169">SwitchSurGrenade</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>// AI controlled creatures may duck if not falling
        if (bases.order=='garder' || bEnCouverture || iEtatVaVersStrp>0 || (Enemy == None)
            || (Pawn.Physics == PHYS_Falling) || (Pawn.Physics == PHYS_Swimming) )
            return;

        if (FRand() > 0.02 * skill)
            return;

        if (shooter==xiii)
        {
            if (!XIIIWeapon(shooter.weapon).AmmoType.bInstantHit)
            {
                enemyDist = VSize(shooter.Location - Pawn.Location);
                if (enemyDist/projSpeed > 0.11 + 0.15 * FRand())
                {
                    gotostate('TacticalMove','strafe');
                    return;
                }
            }
            else
					gotostate('TacticalMove','strafe');
        }
    }

    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L4140">ReceiveWarning</A></B>(<a href="Engine.Pawn.html">Pawn</a> shooter, float projspeed, vector firedir)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>//son
        bases.PlaySndPNJOno(pnjono'Onomatopees.hPNJHurt',bases.CodeMesh,bases.NumeroTimbre);

	     If (xiii.bPrisonner && XIII.LHand.pOnShoulder!=none && AllianceLevel(XIII.LHand.pOnShoulder)==1 && other==xiii)
        {
           if (CHARGE_LES_LOGS) log(pawn$"je riposte");
           NbCoupsRiposte=(2+bases.agressivite)*1.9;
           NbCoupsRiposte=Min(5,NbCoupsRiposte);
           NbCoupsRiposte=Max(1,NbCoupsRiposte);
        }
    }

    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L4124">DamageAttitudeto</A></B>(<a href="Engine.Pawn.html">Pawn</a> Other, float Damage)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>//log("pawn.weapon"@pawn.weapon.hasammo()@XIIIWeapon(pawn.weapon).reloadcount@(1.6-vsize(enemy.location-pawn.location)*0.002)>frand()@(1.6-vsize(enemy.location-pawn.location)*0.002));
            if (pawn.weapon.reloadcount==1 && pawn.weapon.default.reloadcount>1)
            {
                if (bases.order!='garder' && (1.6-vsize(enemy.location-pawn.location)*0.002)>frand())
                {
                    bFuitPourreloader=true;
                    Timer_VaRecharger=level.timeseconds;
                    CherchePointReload();
                }
            }
        }

    }
    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L4097">NotifyFiring</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>//va vers point interdemediaire
                    {
                        PointIntermediaire.bAlreadyTargeted=false;
                        if (cansee(enemy)) fireenemy();
                    }
                    gotostate('attaque','vaversStrP');
                }
                else if (FindBestPathToward(LastStrP))
                {
                    LastStrP.Occupe();
                    if (bjump)
                    {
                        LastStrP.FinishJumpPoint.occupe();
                    }
                    for (i=0;i<16;i++)
                    {
                        if (routecache[i]==none)
                            break;
                        PointChemin[i]=routecache[i];
                    }
                    NbPointChemin=i;
                    gotostate('attaque','vaversStrP');
                }
            }
        }
    }

    </pre></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_AttaqueH2H">
<A NAME="State AttaqueH2H"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State AttaqueH2H Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L3680">EndState</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>//temp_int=0; //utilise pour boucle sur pointchemin

    }
    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L3648">BeginState</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>//			log(nav@vsize(nav.location-enemy.location)<300@Vsize(nav.location-pawn.location)>=(pawn.collisionradius*1.2)@(bestnav==none || vsize(nav.location-enemy.location)<vsize(bestnav.location-enemy.location)));
			if (DistanceNMI<300)
			{
				if (Vsize(nav.location-pawn.location)<(pawn.collisionradius*2) && rand(3)<2)
				{
					 nav = nav.nextNavigationPoint;
					continue;
				}
				if (DistanceNMI<DistancePoint)
				{
					DistancePoint=DistanceNMI;
					Bestnav=nav;
				}
			}
         nav = nav.nextNavigationPoint;
		}
		if (BestNav==none)
			return false;
		if (actorreachable(BestNav))
		{
			btemp_bool=true;
			movetarget=BestNav;
			return true;
		}
		else if (findBestPathToward(BestNav))
		{
			btemp_bool=false;
			movetarget=BestNav;
			return true;
		}
		return false;
	 }
    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L3601">LookForNearestPoint</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>
    {
    }

	</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L3597">ReceiveWarning</A></B>(<a href="Engine.Pawn.html">Pawn</a> shooter, float projspeed, vector firedir)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>//son
        bases.PlaySndPNJOno(pnjono'Onomatopees.hPNJHurt',bases.CodeMesh,bases.NumeroTimbre);
        If (xiii.bPrisonner && XIII.LHand.pOnShoulder!=none && AllianceLevel(XIII.LHand.pOnShoulder)==1 && other==xiii)
        {
           if (CHARGE_LES_LOGS) log(pawn$"je riposte");
           NbCoupsRiposte=(2+bases.agressivite)*1.9;
           NbCoupsRiposte=Min(5,NbCoupsRiposte);
           NbCoupsRiposte=Max(1,NbCoupsRiposte);
        }
    }

    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L3582">DamageAttitudeto</A></B>(<a href="Engine.Pawn.html">Pawn</a> Other, float Damage)</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>//recupere direction du tir avant dispersion
        CheckLineOfFire();
    }
    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L3574">NotifyFiring</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>//CadavreWithPickup affecte a other dans Cherchebonmatos
        {
            HalteAufeu();
            bDisableEventSeeDeadPawn=true;
            CadavreWithPickup.bDejaFouille=true;
            gotostate('tacticalmove','chercheobjet');
        }
    }
    event UpdateTactics()
    {
        if (Vsize(enemy.location-temp_vect)>50)
        {
            badvancedtactics=false;
            gotostate('AttaqueH2H','charge');
        }
    }

    </pre></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_Acquisition">
<A NAME="State Acquisition"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State Acquisition Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L3253">Endstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L3234">beginstate</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>
    {
    local NavigationPoint N, Best;
    local vector Dir, EnemyDir;
    local float Dist, BestVal, Val;

      EnemyDir = Normal(Enemy.Location - Pawn.Location);
      for ( N=Level.NavigationPointList; N!=None; N=N.NextNavigationPoint )
      {
      Dir = N.Location - LAstSeenPos;
      Dist = VSize(Dir);
      if (Dist<200)
      {
      Val = (EnemyDir Dot Dir/Dist);
      if ((Val > BestVal) && LineOfSightTo(N))
      {
      BestVal = Val;
      Best = N;
      }
      }
      }
      if ( Best != None )
      LastSeenPos = Best.Location + 0.5 * Pawn.CollisionHeight * vect(0,0,1);
     }  */</pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L3210">CherchePointPresDernierePos</A></B>()</CODE><BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<pre>    /* [****] integrer si le positionnnement n'est pas bon
    A REVOIR ENTIEREMENT
    </pre></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L3186">InitReactions</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L3174">ChercheNMIDuRegard</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L3140">ActualiseSon</A></B>(<a href="Engine.Actor.html">Actor</a> son)</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L3118">DamageAttitudeTo</A></B>(<a href="Engine.Pawn.html">Pawn</a> Other, float Damage)</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2992">SeeEnemy</A></B>()</CODE></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_ResteSurPlace">
<A NAME="State ResteSurPlace"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State ResteSurPlace Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2901">Endstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2867">beginstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2851">TestPasSurCote</A></B>(<a href="XIDPawn.BaseSoldier.html">BaseSoldier</a> PoteAEviter)</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2835">TestDirectionAvoidingAlly</A></B>(vector pickdir, out vector, <a href="XIDPawn.BaseSoldier.html">BaseSoldier</a> PoteAEviter)</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2822">DamageAttitudeTo</A></B>(<a href="Engine.Pawn.html">Pawn</a> Other, float Damage)</CODE></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_Tenir">
<A NAME="State Tenir"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State Tenir Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2705">Endstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2689">beginstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2679">DamageAttitudeTo</A></B>(<a href="Engine.Pawn.html">Pawn</a> Other, float Damage)</CODE></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_Errance">
<A NAME="State Errance"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State Errance Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2581">Endstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2559">beginstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2550">IsInWanderingVolume</A></B>(<a href="XIDPawn.WanderingVolume.html">WanderingVolume</a> aVolume)</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2484">PickDestination</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2474">DamageAttitudeTo</A></B>(<a href="Engine.Pawn.html">Pawn</a> Other, float Damage)</CODE></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_Patrouille">
<A NAME="State Patrouille"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State Patrouille Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2247">Endstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2121">beginstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2102">IsPointInCylinder</A></B>(<a href="Engine.Actor.html">Actor</a> cylinder, Vector point, optional float, optional float)</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2088">PickDestination</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L2077">DamageAttitudeTo</A></B>(<a href="Engine.Pawn.html">Pawn</a> Other, float Damage)</CODE></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_init">
<A NAME="State init"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State init Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1852">EndState</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1847">BeginState</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1834">BufferTrigger</A></B>()</CODE></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_faction">
<A NAME="State faction"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State faction Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1801">endstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1773">Beginstate</A></B>()</CODE></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_Mort">
<A NAME="State Mort"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State Mort Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1753">Endstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1741">BeginState</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1738">Trigger</A></B>(<a href="Engine.Actor.html">Actor</a> Other, <a href="Engine.Pawn.html">Pawn</a> EventInstigator)</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1735">DamageAttitudeTo</A></B>(<a href="Engine.Pawn.html">Pawn</a> Other, float Damage)</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1728">NearWall</A></B>(float walldist)</CODE></TD></TR>
</table>

<br/><br/><center>
<a name="STATE_Otage">
<A NAME="State Otage"/>
<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" WIDTH="100%">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TD COLSPAN=2><FONT SIZE="+2">
<B>State Otage Function Summary</B></FONT></TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1709">Endstate</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1679">BeginState</A></B>()</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1676">Trigger</A></B>(<a href="Engine.Actor.html">Actor</a> Other, <a href="Engine.Pawn.html">Pawn</a> EventInstigator)</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1671">DamageAttitudeTo</A></B>(<a href="Engine.Pawn.html">Pawn</a> Other, float Damage)</CODE></TD></TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;bool</CODE></FONT></TD>
<TD><CODE><B><A HREF="#L1663">NearWall</A></B>(float walldist)</CODE></TD></TR>
</table>

<br/><br/><center>
<hr/><center><FONT SIZE="-1">
Source Code</FONT>
</center><hr/>
<table width="90%" bgcolor="#000000"><tr><td><font color="#00FF00"><pre><code>
<a name="L1"><font color="white">00001</font>	//=============================================================================
<a name="L2"><font color="white">00002</font>	// IAController.
<a name="L3"><font color="white">00003</font>	//=============================================================================
<a name="L4"><font color="white">00004</font>	class IAController extends AIController native;
<a name="L5"><font color="white">00005</font>	//#exec OBJ LOAD FILE=XIIISound.uax PACKAGE=XIIISound
<a name="L6"><font color="white">00006</font>	#exec OBJ LOAD FILE=&quot;Onomatopees.uax&quot; PACKAGE=Onomatopees
<a name="L7"><font color="white">00007</font>	
<a name="L8"><font color="white">00008</font>	//Structures
<a name="L9"><font color="white">00009</font>	
<a name="L10"><font color="white">00010</font>	Struct MovePointInfo
<a name="L11"><font color="white">00011</font>	{
<a name="L12"><font color="white">00012</font>	    var vector MovePoint;
<a name="L13"><font color="white">00013</font>	    var bool bTraceable;
<a name="L14"><font color="white">00014</font>	};
<a name="L15"><font color="white">00015</font>	var MovePointInfo MovePoint;
<a name="L16"><font color="white">00016</font>	Struct MoveActorInfo
<a name="L17"><font color="white">00017</font>	{
<a name="L18"><font color="white">00018</font>	    var actor MoveActor;
<a name="L19"><font color="white">00019</font>	    var bool bReachable;
<a name="L20"><font color="white">00020</font>	};
<a name="L21"><font color="white">00021</font>	var MoveActorInfo MoveActor;
<a name="L22"><font color="white">00022</font>	
<a name="L23"><font color="white">00023</font>	var enum AttitudeInfo
<a name="L24"><font color="white">00024</font>	{
<a name="L25"><font color="white">00025</font>	    ATTITUDE_Fear,
<a name="L26"><font color="white">00026</font>	        ATTITUDE_Impressed,
<a name="L27"><font color="white">00027</font>	        ATTITUDE_Charge
<a name="L28"><font color="white">00028</font>	} AttitudeTOInfo;
<a name="L29"><font color="white">00029</font>	
<a name="L30"><font color="white">00030</font>	
<a name="L31"><font color="white">00031</font>	//---------------------------------------------------
<a name="L32"><font color="white">00032</font>	// Variables
<a name="L33"><font color="white">00033</font>	//---------------------------------------------------
<a name="L34"><font color="white">00034</font>	var actor PointChemin[16];//points intermediaire du pathfinding
<a name="L35"><font color="white">00035</font>	var actor Interrogation; // effet interrogation ou exclamation
<a name="L36"><font color="white">00036</font>	var actor PointsInvestigation[3]; //=investigation=
<a name="L37"><font color="white">00037</font>	var pawn PeeredEnemy;
<a name="L38"><font color="white">00038</font>	var XiiiPlayerPawn XIII;
<a name="L39"><font color="white">00039</font>	var xiiipawn PoteQuiMeBloque;   //=attaque= pote qui me bloque le chemin
<a name="L40"><font color="white">00040</font>	var BaseSoldier BaseS;
<a name="L41"><font color="white">00041</font>	var basesoldier Pote; // ben c'est un pote qu'il faut eviter de toucher. MAJ dans fonction native LineOfFireObstacle()
<a name="L42"><font color="white">00042</font>	var basesoldier CadavreWithPickup; // pour aller chercher pickups sur cadavre
<a name="L43"><font color="white">00043</font>	var weapon WeaponOnGround; //arme recuperee sur cadavre
<a name="L44"><font color="white">00044</font>	var XIIIporte PorteOuverte;        //porte a ouvrir
<a name="L45"><font color="white">00045</font>	var XIIIporte LastBumpedDoor; //last bumped door to avoid to be blocked
<a name="L46"><font color="white">00046</font>	var navigationpoint DoorP;  //=ouvreporte= pour verifier qu'il y a des doorpoints
<a name="L47"><font color="white">00047</font>	var NavigationPoint DestNavPoint; //=patrouille= point de destination
<a name="L48"><font color="white">00048</font>	var navigationPoint PointIntermediaire; //=attaque=  point intermediaire de deplacement
<a name="L49"><font color="white">00049</font>	var patrolpoint LastPatrolPoint; //=patrouille= dernier patrolpoint utilise
<a name="L50"><font color="white">00050</font>	var AttackPoint LastAttackPoint; //Point d'attaque courant
<a name="L51"><font color="white">00051</font>	var AttackPoint OldAttackPoint; //Dernier Point d'attaque
<a name="L52"><font color="white">00052</font>	var SafePoint OldSafePoint; //=chasse= Dernier Safe Point
<a name="L53"><font color="white">00053</font>	var SafePoint SafePointOccupe;
<a name="L54"><font color="white">00054</font>	var StrategicPoint LastStrP;
<a name="L55"><font color="white">00055</font>	var grenadflying Grenade;  //une grenade est lancee
<a name="L56"><font color="white">00056</font>	var genalerte genalerte;
<a name="L57"><font color="white">00057</font>	
<a name="L58"><font color="white">00058</font>	var name EtatNeutre; // etat neutre (tenir, patrouille ou tenir)
<a name="L59"><font color="white">00059</font>	var name nextstate;  // prochain etat apres vavers
<a name="L60"><font color="white">00060</font>	var name prevstate;  // dernier etat avant ouvreporte
<a name="L61"><font color="white">00061</font>	var name PatrolAnim; //type d'anim de patrouille
<a name="L62"><font color="white">00062</font>	var name WaitPatrolAnim;//type d'anim d'attente en patrouille
<a name="L63"><font color="white">00063</font>	var name TurnLPatrolAnim;//type d'anim de demi-tour en patrouille vers gauche
<a name="L64"><font color="white">00064</font>	var name TurnRPatrolAnim;//type d'anim de demi-tour en patrouille vers droite
<a name="L65"><font color="white">00065</font>	
<a name="L66"><font color="white">00066</font>	
<a name="L67"><font color="white">00067</font>	var rotator PointTenirRot; //=tenir= direction point de retour en tenir
<a name="L68"><font color="white">00068</font>	
<a name="L69"><font color="white">00069</font>	
<a name="L70"><font color="white">00070</font>	var vector EnemyTargetPos; //derniere position connue de l'enemy
<a name="L71"><font color="white">00071</font>	var vector EnemyTargetVelocity;
<a name="L72"><font color="white">00072</font>	var vector DirectionTir;   //direction du tir
<a name="L73"><font color="white">00073</font>	var vector WeaponStartTrace; //point de depart de la balle de l'arme mise a jour dans le moteur
<a name="L74"><font color="white">00074</font>	var vector Temp_Vect;
<a name="L75"><font color="white">00075</font>	var vector HidingSpot;   //=tacticalmove=
<a name="L76"><font color="white">00076</font>	var vector PointTenirPos; //=tenir= position de point de retour en tenir
<a name="L77"><font color="white">00077</font>	var vector PoteQuiMeBloquePos; //=attaque= pos du pote qui me bloque la porte
<a name="L78"><font color="white">00078</font>	var vector PointDestination;     //=attaque=  pour calculer destination
<a name="L79"><font color="white">00079</font>	var vector VecteurRecalage; //=attaque=
<a name="L80"><font color="white">00080</font>	
<a name="L81"><font color="white">00081</font>	
<a name="L82"><font color="white">00082</font>	var float Temps_errance; //temps d'errance entre patrouille et errance
<a name="L83"><font color="white">00083</font>	var float DistanceDeplacement; // distance de test de deplacement dans errance et fuite
<a name="L84"><font color="white">00084</font>	var float DistNearWall;        //distance de tdetection des murs
<a name="L85"><font color="white">00085</font>	var float Temps_RefreshEnemyPos;
<a name="L86"><font color="white">00086</font>	var float DefaultPeripheralVision;
<a name="L87"><font color="white">00087</font>	var float DefaultSightRadius;
<a name="L88"><font color="white">00088</font>	var float DefaultHearingThreshold;
<a name="L89"><font color="white">00089</font>	var float VitesseDeplacements; //vitesse de deplacements en strafe
<a name="L90"><font color="white">00090</font>	var float Timer_VaRecharger;
<a name="L91"><font color="white">00091</font>	// cone de visee
<a name="L92"><font color="white">00092</font>	var float Angle_Visee;
<a name="L93"><font color="white">00093</font>	var float Temps_ref;  //timer
<a name="L94"><font color="white">00094</font>	var float Temps_Ref2; //timer
<a name="L95"><font color="white">00095</font>	var float Temp_float; //utilise partout
<a name="L96"><font color="white">00096</font>	var float FireTimerRefresh; //temps de refresh du tir en auto
<a name="L97"><font color="white">00097</font>	var float sleeptime; //=patrouille= temps de pause sur patrolpoint
<a name="L98"><font color="white">00098</font>	var float VitesseHorizontaleSaut; //=attaqueScriptee= utilise pour saut
<a name="L99"><font color="white">00099</font>	var float fTimerAttackMusic; //=attaqueScriptee= pour faire repasser la musique en attente apres certain temps
<a name="L100"><font color="white">00100</font>	var float TempsDeclencheAlarme; //delai avant qu'il declenche l'alarme
<a name="L101"><font color="white">00101</font>	
<a name="L102"><font color="white">00102</font>	var int NiveauALerte; //niveau d'alerte
<a name="L103"><font color="white">00103</font>	var int NiveauALerteEnAS; //niveau d'alerte
<a name="L104"><font color="white">00104</font>	var int NbCoupsRiposte; //utilise dans timer pour savoir combien de coups ne sont pas bloques
<a name="L105"><font color="white">00105</font>	var int CompteurRecalage;//utilise dans charge,attaque et TM pour savoir si se recale
<a name="L106"><font color="white">00106</font>	var int CompteurTrame; //optimisation du Tick
<a name="L107"><font color="white">00107</font>	var int NbPointChemin; // nb de point dans pathfinding
<a name="L108"><font color="white">00108</font>	var int iCompteur; //compteur utilise dans les boucle sur routecache
<a name="L109"><font color="white">00109</font>	var int temp_int;
<a name="L110"><font color="white">00110</font>	var int NumeroProchainPoint; //=attaqueScriptee= choix entre differents AP
<a name="L111"><font color="white">00111</font>	var int NombreDePointsSkippes;//=attaqueScriptee= pour calcul du prochain AP
<a name="L112"><font color="white">00112</font>	var int iNumEtat; //=attaqueScriptee= numero de l'etat (grenadage,...)
<a name="L113"><font color="white">00113</font>	var int NextRouteCachePoint; //=attaqueScriptee= pour reprendre vers point suivant apres ouverture de porte
<a name="L114"><font color="white">00114</font>	var int numHuntPaths; //=chasse= nombre de points dans chasse
<a name="L115"><font color="white">00115</font>	//var int NbTentativesDecrampage;  //=attaque=  pour tester crampage en melee
<a name="L116"><font color="white">00116</font>	var int iEtatVaVersSTrp;  //=attaque= etat = 0 inactif, etat=1 va a un point intermediaire,etat=2 va a un StrP et etat=3 reste sur un STrP
<a name="L117"><font color="white">00117</font>	
<a name="L118"><font color="white">00118</font>	
<a name="L119"><font color="white">00119</font>	var bool bDisableDamageattitudeto;
<a name="L120"><font color="white">00120</font>	var bool CHARGE_LES_LOGS; // Pour voir mes logs
<a name="L121"><font color="white">00121</font>	var bool bTire;
<a name="L122"><font color="white">00122</font>	var bool bChercheStrategicPoint;
<a name="L123"><font color="white">00123</font>	var bool bWaitForMover;  //utilise dans notifybump vers ouvreporte
<a name="L124"><font color="white">00124</font>	var bool bPrisonnier; //utilise dans timer vers timer pour savoir si pote otage
<a name="L125"><font color="white">00125</font>	var bool bPrecedentTirBloque; //utilise dans timer vers timer pour savoir si le precedent tir a ete bloque lors de prise d'otage
<a name="L126"><font color="white">00126</font>	var bool bVigilant; //vigilant ou pas  &lt;-&gt; setvigilant
<a name="L127"><font color="white">00127</font>	var bool bEtatAlerte; //en etat d'alerte  donc attaque direct
<a name="L128"><font color="white">00128</font>	var bool bRetraiteVersSafePoint; //pour faire une retraite
<a name="L129"><font color="white">00129</font>	var bool bCampeVersSafePoint;
<a name="L130"><font color="white">00130</font>	//reactions
<a name="L131"><font color="white">00131</font>	var bool bStepNoise;
<a name="L132"><font color="white">00132</font>	var bool bImpactNoise;
<a name="L133"><font color="white">00133</font>	var bool bWeaponNoise;
<a name="L134"><font color="white">00134</font>	var bool bCadavreVu;
<a name="L135"><font color="white">00135</font>	var bool bPaffe;
<a name="L136"><font color="white">00136</font>	var bool bDejaVu;
<a name="L137"><font color="white">00137</font>	var bool bPotePaffe;
<a name="L138"><font color="white">00138</font>	var bool bVaVersAlarme; //car pote l'a declenchee
<a name="L139"><font color="white">00139</font>	var bool bAlarmeInstigator; // vrai pawn si declencheur de l'alarme
<a name="L140"><font color="white">00140</font>	//var bool bADejaCrie;
<a name="L141"><font color="white">00141</font>	var bool bBloqueFuiteGrenades;
<a name="L142"><font color="white">00142</font>	var bool bPremiereRafale;
<a name="L143"><font color="white">00143</font>	var bool bTirSurConeMax;
<a name="L144"><font color="white">00144</font>	var bool bUTurnMove; //=patrouille= deplacement pour les retournement en patrouille
<a name="L145"><font color="white">00145</font>	var bool bAVuQuelquechose; // =acquisition= pour sortie interro et exclamation
<a name="L146"><font color="white">00146</font>	var bool bSwitchMusicInWaitState; ////=attaqueScriptee= a fixe l'etat de musique en attente apres delai de pas vu.
<a name="L147"><font color="white">00147</font>	var bool bSaut; //=attaqueScriptee=  je suis en train de sauter
<a name="L148"><font color="white">00148</font>	var bool result;       //=attaqueScriptee= pour savoir si change de branche  et pour grenade - utilise aussi dans opendoor
<a name="L149"><font color="white">00149</font>	var bool bAccroupiSurAP; //=attaqueScriptee= util. pour tir en rafale
<a name="L150"><font color="white">00150</font>	var bool bDeplacementsRoulade; //=attaqueScriptee=
<a name="L151"><font color="white">00151</font>	var bool bDontSeeAnyMore; //=attaqueScriptee= pour desactivation musique attaque
<a name="L152"><font color="white">00152</font>	var bool bTemp_Bool;
<a name="L153"><font color="white">00153</font>	var bool bEnCouverture;    //=attaque=
<a name="L154"><font color="white">00154</font>	var bool bLanceGrenade;  //=attaque=
<a name="L155"><font color="white">00155</font>	var bool bFuitPourreloader; //=attaque=
<a name="L156"><font color="white">00156</font>	var bool bARienVu; // je suis passe en point d'interro
<a name="L157"><font color="white">00157</font>	var bool bLookAtEnemy;//regarde si voit enemy pour recommencer a lui tirer dessus
<a name="L158"><font color="white">00158</font>	var bool bInWaitMode; // en attaque H2H pour savoir que je suis en train d'attendre
<a name="L159"><font color="white">00159</font>	var bool bInterruptStateToOpenDoor;
<a name="L160"><font color="white">00160</font>	var bool bTriggerBuffered;
<a name="L161"><font color="white">00161</font>	
<a name="L162"><font color="white">00162</font>	// ----------------------------------------------------------------------
<a name="L163"><font color="white">00163</font>	// ChercheBonMatos
<a name="L164"><font color="white">00164</font>	//
<a name="L165"><font color="white">00165</font>	//si oui ressort l'arme correspondante
<a name="L166"><font color="white">00166</font>	// ----------------------------------------------------------------------
<a name="L167"><font color="white">00167</font>	function bool ChercheBonMatos(pawn other)
<a name="L168"><font color="white">00168</font>	{
<a name="L169"><font color="white">00169</font>		CadavreWithPickup=basesoldier(other);
<a name="L170"><font color="white">00170</font>	   if (!bases.bFouilleCadavres || CadavreWithPickup==none || CadavreWithPickup.bDejaFouille || (enemy!=none &amp;&amp; Vsize(enemy.location-pawn.location)&lt;390))
<a name="L171"><font color="white">00171</font>	      return false;
<a name="L172"><font color="white">00172</font>	    if (other.weapon==none || !other.weapon.hasammo() || other.isa('cine2'))
<a name="L173"><font color="white">00173</font>		 {
<a name="L174"><font color="white">00174</font>			  CadavreWithPickup.bDejaFouille=true;
<a name="L175"><font color="white">00175</font>	        return false;
<a name="L176"><font color="white">00176</font>		 }
<a name="L177"><font color="white">00177</font>	 	 if (Vsize(other.location-pawn.location)&gt;1000 || !actorreachable(other))
<a name="L178"><font color="white">00178</font>			   return false;
<a name="L179"><font color="white">00179</font>	
<a name="L180"><font color="white">00180</font>	    if (!pawn.weapon.hasammo() || other.weapon.airating&gt;pawn.weapon.airating)  //meilleure arme ou meme arme si j'ai plus de muns
<a name="L181"><font color="white">00181</font>	        return true;
<a name="L182"><font color="white">00182</font>	    return false;
<a name="L183"><font color="white">00183</font>	}
<a name="L184"><font color="white">00184</font>	
<a name="L185"><font color="white">00185</font>	// ----------------------------------------------------------------------
<a name="L186"><font color="white">00186</font>	// CherchePlanqueGrenade
<a name="L187"><font color="white">00187</font>	//
<a name="L188"><font color="white">00188</font>	// ----------------------------------------------------------------------
<a name="L189"><font color="white">00189</font>	function CherchePlanqueGrenade()  //cherche safepoint le plus pres et a moins de 55m
<a name="L190"><font color="white">00190</font>	{                                   //GRENADE DOIT IMPRATIVEMENT NE PAS ETRE EGAL A none
<a name="L191"><font color="white">00191</font>	    local SafePoint Safe,BestSafe,secondsafe;
<a name="L192"><font color="white">00192</font>	    local int i;
<a name="L193"><font color="white">00193</font>		 local float DistOfSafeToGrenad;
<a name="L194"><font color="white">00194</font>	
<a name="L195"><font color="white">00195</font>	    if (grenade==none)
<a name="L196"><font color="white">00196</font>	    {
<a name="L197"><font color="white">00197</font>	        log(pawn@&quot;WWWWWWAAAAAARRRRNNNNNNIIIIIIINNNNNGGGGGGG pas de grenade!!!&quot;);
<a name="L198"><font color="white">00198</font>	        return;
<a name="L199"><font color="white">00199</font>	    }
<a name="L200"><font color="white">00200</font>	 	 if (SafePointOccupe!=none)
<a name="L201"><font color="white">00201</font>			SafePointOccupe.timer(); //libere point
<a name="L202"><font color="white">00202</font>	    For(i=0;i&lt;level.game.SafePointList.Length;i++)
<a name="L203"><font color="white">00203</font>	    {
<a name="L204"><font color="white">00204</font>	        safe=safepoint(level.game.SafePointList[i]);
<a name="L205"><font color="white">00205</font>	        //log(&quot;safe&quot;@safe@!Safe.bAlreadyTargeted@VSize(safe.location-pawn.location)&lt;4000);
<a name="L206"><font color="white">00206</font>	        if (!Safe.bAlreadyTargeted &amp;&amp; VSize(safe.location-pawn.location)&lt;4000 &amp;&amp; VSize(safe.location-pawn.location)&gt;pawn.collisionradius*2)
<a name="L207"><font color="white">00207</font>	        {
<a name="L208"><font color="white">00208</font>					DistOfSafeToGrenad=Vsize(safe.location-grenade.location);
<a name="L209"><font color="white">00209</font>	            if ((!FastTrace(Safe.location,grenade.location) || DistOfSafeToGrenad&gt;1300) &amp;&amp; (actorreachable(safe) || FindBestPathToward(safe)))
<a name="L210"><font color="white">00210</font>	            {
<a name="L211"><font color="white">00211</font>	                if (bestsafe== none || Vsize(bestsafe.location-grenade.location)&gt;DistOfSafeToGrenad)
<a name="L212"><font color="white">00212</font>	                {
<a name="L213"><font color="white">00213</font>								secondsafe=bestsafe;
<a name="L214"><font color="white">00214</font>	                     bestsafe=safe;
<a name="L215"><font color="white">00215</font>	                }
<a name="L216"><font color="white">00216</font>	        		}
<a name="L217"><font color="white">00217</font>			  }
<a name="L218"><font color="white">00218</font>	    }
<a name="L219"><font color="white">00219</font>		 if (bestsafe==none)
<a name="L220"><font color="white">00220</font>				return;
<a name="L221"><font color="white">00221</font>		 else if (secondsafe!=none)
<a name="L222"><font color="white">00222</font>		 {
<a name="L223"><font color="white">00223</font>			 if (Vsize(bestsafe.location-pawn.location)&gt;600 &amp;&amp; (secondsafe.location-pawn.location) dot (grenade.location-pawn.location)&lt;(bestsafe.location-pawn.location) dot (grenade.location-pawn.location))
<a name="L224"><font color="white">00224</font>				bestsafe=secondsafe;
<a name="L225"><font color="white">00225</font>		 }
<a name="L226"><font color="white">00226</font>		 //log(&quot;a trouve planque grenade&quot;@bestsafe@actorreachable(bestsafe)@FindBestPathToward(bestSafe));
<a name="L227"><font color="white">00227</font>	    Movetarget=none;
<a name="L228"><font color="white">00228</font>	    if (actorreachable(bestsafe))
<a name="L229"><font color="white">00229</font>	    {
<a name="L230"><font color="white">00230</font>	        OldSafePoint=bestsafe;
<a name="L231"><font color="white">00231</font>	        MoveActor.MoveActor=bestsafe;
<a name="L232"><font color="white">00232</font>	        MoveActor.bReachable=true;
<a name="L233"><font color="white">00233</font>	        bestsafe.Occupe();
<a name="L234"><font color="white">00234</font>			  SafePointOccupe=bestsafe;
<a name="L235"><font color="white">00235</font>			  HalteAufeu();
<a name="L236"><font color="white">00236</font>	        gotostate('fuitegrenade','vaverssafepoint');
<a name="L237"><font color="white">00237</font>	    }
<a name="L238"><font color="white">00238</font>	    else if (FindBestPathToward(bestSafe))
<a name="L239"><font color="white">00239</font>	    {
<a name="L240"><font color="white">00240</font>	        OldSafePoint=bestsafe;
<a name="L241"><font color="white">00241</font>	        MoveActor.MoveActor=bestsafe;
<a name="L242"><font color="white">00242</font>	        MoveActor.bReachable=false;
<a name="L243"><font color="white">00243</font>	        for (i=0;i&lt;16;i++)
<a name="L244"><font color="white">00244</font>	        {
<a name="L245"><font color="white">00245</font>	            if (routecache[i]==none)
<a name="L246"><font color="white">00246</font>	                break;
<a name="L247"><font color="white">00247</font>	            PointChemin[i]=routecache[i];
<a name="L248"><font color="white">00248</font>	        }
<a name="L249"><font color="white">00249</font>	        NbPointChemin=i;
<a name="L250"><font color="white">00250</font>				HalteAufeu();
<a name="L251"><font color="white">00251</font>	  		  SafePointOccupe=bestsafe;
<a name="L252"><font color="white">00252</font>	        bestsafe.Occupe();
<a name="L253"><font color="white">00253</font>	        gotostate('fuitegrenade','vaverssafepoint');
<a name="L254"><font color="white">00254</font>	    }
<a name="L255"><font color="white">00255</font>	}
<a name="L256"><font color="white">00256</font>	
<a name="L257"><font color="white">00257</font>	// ----------------------------------------------------------------------
<a name="L258"><font color="white">00258</font>	// CherchePointSafe
<a name="L259"><font color="white">00259</font>	//
<a name="L260"><font color="white">00260</font>	// ----------------------------------------------------------------------
<a name="L261"><font color="white">00261</font>	function CherchePointSafe()  //cherche safepoint le plus loin, pas visible par l'enemy et a moins de 55m
<a name="L262"><font color="white">00262</font>	{                                   //ENEMY DOIT IMPRATIVEMENT NE PAS ETRE EGAL A NONE
<a name="L263"><font color="white">00263</font>	    local SafePoint Safe,BestSafe;
<a name="L264"><font color="white">00264</font>	    local bool bFirstInPlace;
<a name="L265"><font color="white">00265</font>	    local bool bAngleDeVUe;
<a name="L266"><font color="white">00266</font>	    local int i;
<a name="L267"><font color="white">00267</font>	
<a name="L268"><font color="white">00268</font>	    if (enemy==none)
<a name="L269"><font color="white">00269</font>	    {
<a name="L270"><font color="white">00270</font>	        log(pawn@&quot;WWWWWWWWWWWWWWAAAAAAAAAARRRRRRRRRRNNNNNNNNNIIIIIIIIIIIIIIIIINNNNNNNNNGGGGGGGGGGG !!!&quot;);
<a name="L271"><font color="white">00271</font>	        return;
<a name="L272"><font color="white">00272</font>	    }
<a name="L273"><font color="white">00273</font>	
<a name="L274"><font color="white">00274</font>	    For(i=0;i&lt;level.game.SafePointList.Length;i++)
<a name="L275"><font color="white">00275</font>	    {
<a name="L276"><font color="white">00276</font>	        safe=safepoint(level.game.SafePointList[i]);
<a name="L277"><font color="white">00277</font>	        if (OldSafePoint!=safe &amp;&amp; !Safe.bAlreadyTargeted &amp;&amp; VSize(safe.location-pawn.location)&lt;4000)
<a name="L278"><font color="white">00278</font>	        {
<a name="L279"><font color="white">00279</font>	            bFirstInPlace= 0.01+Vsize(Safe.location -pawn.location)/pawn.groundspeed&lt;Vsize(Safe.location - enemy.location)/enemy.groundspeed;
<a name="L280"><font color="white">00280</font>	            if (Safe.baccroupi)
<a name="L281"><font color="white">00281</font>	                bAngleDeVUe=FastTrace(Safe.location+vect(0,0,8.4),enemy.location + enemy.eyeposition());
<a name="L282"><font color="white">00282</font>	            else
<a name="L283"><font color="white">00283</font>	                bAngleDeVUe=FastTrace(Safe.location+enemy.eyeposition(),enemy.location + enemy.eyeposition());
<a name="L284"><font color="white">00284</font>	            if (!bAngleDeVUe &amp;&amp; bFirstInPlace)
<a name="L285"><font color="white">00285</font>	                if (bestsafe!=none)
<a name="L286"><font color="white">00286</font>	                {
<a name="L287"><font color="white">00287</font>	                    if (Vsize(bestsafe.location-pawn.location)&lt;Vsize(safe.location- pawn.location))
<a name="L288"><font color="white">00288</font>	                        bestsafe=safe;
<a name="L289"><font color="white">00289</font>	                }
<a name="L290"><font color="white">00290</font>	                else
<a name="L291"><font color="white">00291</font>	                    bestsafe=Safe;
<a name="L292"><font color="white">00292</font>	        }
<a name="L293"><font color="white">00293</font>	    }
<a name="L294"><font color="white">00294</font>	    if (bestsafe==none)
<a name="L295"><font color="white">00295</font>	        return;
<a name="L296"><font color="white">00296</font>	    Movetarget=none;
<a name="L297"><font color="white">00297</font>	    if (actorreachable(bestsafe))
<a name="L298"><font color="white">00298</font>	    {
<a name="L299"><font color="white">00299</font>	        OldSafePoint=bestsafe;
<a name="L300"><font color="white">00300</font>	        MoveActor.MoveActor=bestsafe;
<a name="L301"><font color="white">00301</font>	        MoveActor.bReachable=true;
<a name="L302"><font color="white">00302</font>	        Nextstate='ResteSurPlace';
<a name="L303"><font color="white">00303</font>	        bestsafe.Occupe();
<a name="L304"><font color="white">00304</font>	        gotostate('vavers');
<a name="L305"><font color="white">00305</font>	    }
<a name="L306"><font color="white">00306</font>	    else if (FindBestPathToward(bestSafe))
<a name="L307"><font color="white">00307</font>	    {
<a name="L308"><font color="white">00308</font>	        OldSafePoint=bestsafe;
<a name="L309"><font color="white">00309</font>	        MoveActor.MoveActor=bestsafe;
<a name="L310"><font color="white">00310</font>	        MoveActor.bReachable=false;
<a name="L311"><font color="white">00311</font>	        for (i=0;i&lt;16;i++)
<a name="L312"><font color="white">00312</font>	        {
<a name="L313"><font color="white">00313</font>	            if (routecache[i]==none)
<a name="L314"><font color="white">00314</font>	                break;
<a name="L315"><font color="white">00315</font>	            PointChemin[i]=routecache[i];
<a name="L316"><font color="white">00316</font>	        }
<a name="L317"><font color="white">00317</font>	        NbPointChemin=i;
<a name="L318"><font color="white">00318</font>	        Nextstate='ResteSurPlace';
<a name="L319"><font color="white">00319</font>	        bestsafe.Occupe();
<a name="L320"><font color="white">00320</font>	        gotostate('vavers');
<a name="L321"><font color="white">00321</font>	    }
<a name="L322"><font color="white">00322</font>	}
<a name="L323"><font color="white">00323</font>	// ----------------------------------------------------------------------
<a name="L324"><font color="white">00324</font>	// CherchePointRetraite      //priorite au dernier safepoint
<a name="L325"><font color="white">00325</font>	//
<a name="L326"><font color="white">00326</font>	// ----------------------------------------------------------------------
<a name="L327"><font color="white">00327</font>	function CherchePointRetraite()  //cherche safepoint le plus pres et pas visible par l'enemy a moins de 40m
<a name="L328"><font color="white">00328</font>	{                                   //ENEMY DOIT IMPRATIVEMENT NE PAS ETRE EGAL A NONE
<a name="L329"><font color="white">00329</font>	    local SafePoint Safe,BestSafe;
<a name="L330"><font color="white">00330</font>	    local bool bFirstInPlace;
<a name="L331"><font color="white">00331</font>	    local bool bAngleDeVUe;
<a name="L332"><font color="white">00332</font>	    local int i;
<a name="L333"><font color="white">00333</font>	
<a name="L334"><font color="white">00334</font>	    if (enemy==none)
<a name="L335"><font color="white">00335</font>	    {
<a name="L336"><font color="white">00336</font>	        log(pawn@&quot;WWWWWWWWWWWWWWAAAAAAAAAARRRRRRRRRRNNNNNNNNNIIIIIIIIIIIIIIIIINNNNNNNNNGGGGGGGGGGG !!!&quot;);
<a name="L337"><font color="white">00337</font>	        return;
<a name="L338"><font color="white">00338</font>	    }
<a name="L339"><font color="white">00339</font>	    For(i=0;i&lt;level.game.SafePointList.Length;i++)
<a name="L340"><font color="white">00340</font>	    {
<a name="L341"><font color="white">00341</font>	        safe=safepoint(level.game.SafePointList[i]);
<a name="L342"><font color="white">00342</font>	        if ((!Safe.bAlreadyTargeted || OldSafePoint==safe) &amp;&amp; VSize(safe.location-pawn.location)&lt;3200)
<a name="L343"><font color="white">00343</font>	        {
<a name="L344"><font color="white">00344</font>	            bFirstInPlace= 0.01+Vsize(Safe.location -pawn.location)/pawn.groundspeed&lt;Vsize(Safe.location - enemy.location)/enemy.groundspeed;
<a name="L345"><font color="white">00345</font>	            if (Safe.baccroupi)
<a name="L346"><font color="white">00346</font>	                bAngleDeVUe=FastTrace(Safe.location+vect(0,0,8.4),enemy.location + enemy.eyeposition());
<a name="L347"><font color="white">00347</font>	            else
<a name="L348"><font color="white">00348</font>	                bAngleDeVUe=FastTrace(Safe.location+enemy.eyeposition(),enemy.location + enemy.eyeposition());
<a name="L349"><font color="white">00349</font>	            if (!bAngleDeVUe &amp;&amp; bFirstInPlace)
<a name="L350"><font color="white">00350</font>	                if (bestsafe!=none)
<a name="L351"><font color="white">00351</font>	                {
<a name="L352"><font color="white">00352</font>	                    if (Vsize(bestsafe.location-pawn.location)&gt;Vsize(safe.location- pawn.location))
<a name="L353"><font color="white">00353</font>	                        bestsafe=safe;
<a name="L354"><font color="white">00354</font>	                }
<a name="L355"><font color="white">00355</font>	                else
<a name="L356"><font color="white">00356</font>	                    bestsafe=Safe;
<a name="L357"><font color="white">00357</font>	        }
<a name="L358"><font color="white">00358</font>	    }
<a name="L359"><font color="white">00359</font>	    if (bestsafe==none)
<a name="L360"><font color="white">00360</font>	        return;
<a name="L361"><font color="white">00361</font>	    Movetarget=none;
<a name="L362"><font color="white">00362</font>	    if (actorreachable(bestsafe))
<a name="L363"><font color="white">00363</font>	    {
<a name="L364"><font color="white">00364</font>	        OldSafePoint=bestsafe;
<a name="L365"><font color="white">00365</font>	        halteaufeu();
<a name="L366"><font color="white">00366</font>	        MoveActor.MoveActor=bestsafe;
<a name="L367"><font color="white">00367</font>	        MoveActor.bReachable=true;
<a name="L368"><font color="white">00368</font>	        Nextstate='ResteSurPlace';
<a name="L369"><font color="white">00369</font>	        bRetraiteversSafePoint=true;
<a name="L370"><font color="white">00370</font>	        bestsafe.Occupe();
<a name="L371"><font color="white">00371</font>	        gotostate('vavers');
<a name="L372"><font color="white">00372</font>	    }
<a name="L373"><font color="white">00373</font>	    else if (FindBestPathToward(bestSafe))
<a name="L374"><font color="white">00374</font>	    {
<a name="L375"><font color="white">00375</font>	        MoveActor.MoveActor=bestsafe;
<a name="L376"><font color="white">00376</font>	        halteaufeu();
<a name="L377"><font color="white">00377</font>	        MoveActor.bReachable=false;
<a name="L378"><font color="white">00378</font>	        bRetraiteversSafePoint=true;
<a name="L379"><font color="white">00379</font>	        for (i=0;i&lt;16;i++)
<a name="L380"><font color="white">00380</font>	        {
<a name="L381"><font color="white">00381</font>	            if (routecache[i]==none)
<a name="L382"><font color="white">00382</font>	                break;
<a name="L383"><font color="white">00383</font>	            PointChemin[i]=routecache[i];
<a name="L384"><font color="white">00384</font>	        }
<a name="L385"><font color="white">00385</font>	        NbPointChemin=i;
<a name="L386"><font color="white">00386</font>	        Nextstate='ResteSurPlace';
<a name="L387"><font color="white">00387</font>	        bestsafe.Occupe();
<a name="L388"><font color="white">00388</font>	        gotostate('vavers');
<a name="L389"><font color="white">00389</font>	    }
<a name="L390"><font color="white">00390</font>	}
<a name="L391"><font color="white">00391</font>	
<a name="L392"><font color="white">00392</font>	// ----------------------------------------------------------------------
<a name="L393"><font color="white">00393</font>	// CherchePointReload      //priorite au dernier safepoint
<a name="L394"><font color="white">00394</font>	//
<a name="L395"><font color="white">00395</font>	// ----------------------------------------------------------------------
<a name="L396"><font color="white">00396</font>	function CherchePointReload()  //cherche safepoint le plus pres et pas visible par l'enemy a moins de 40m
<a name="L397"><font color="white">00397</font>	{                                   //ENEMY DOIT IMPRATIVEMENT NE PAS ETRE EGAL A NONE
<a name="L398"><font color="white">00398</font>	    local SafePoint Safe,BestSafe;
<a name="L399"><font color="white">00399</font>	    local bool bFirstInPlace;
<a name="L400"><font color="white">00400</font>	    local bool bAngleDeVUe;
<a name="L401"><font color="white">00401</font>	    local int i;
<a name="L402"><font color="white">00402</font>	
<a name="L403"><font color="white">00403</font>	    if (enemy==none)
<a name="L404"><font color="white">00404</font>	    {
<a name="L405"><font color="white">00405</font>	        log(pawn@&quot;WWWWWWWWWWWWWWAAAAAAAAAARRRRRRRRRRNNNNNNNNNIIIIIIIIIIIIIIIIINNNNNNNNNGGGGGGGGGGG !!!&quot;);
<a name="L406"><font color="white">00406</font>	        return;
<a name="L407"><font color="white">00407</font>	    }
<a name="L408"><font color="white">00408</font>	    For(i=0;i&lt;level.game.SafePointList.Length;i++)
<a name="L409"><font color="white">00409</font>	    {
<a name="L410"><font color="white">00410</font>	        safe=safepoint(level.game.SafePointList[i]);
<a name="L411"><font color="white">00411</font>	        if ((OldSafePoint==safe || !Safe.bAlreadyTargeted) &amp;&amp; VSize(safe.location-pawn.location)&lt;1500)
<a name="L412"><font color="white">00412</font>	        {
<a name="L413"><font color="white">00413</font>	            bFirstInPlace= 0.01+Vsize(Safe.location -pawn.location)/pawn.groundspeed&lt;Vsize(Safe.location - enemy.location)/enemy.groundspeed;
<a name="L414"><font color="white">00414</font>	            if (Safe.baccroupi)
<a name="L415"><font color="white">00415</font>	                bAngleDeVUe=FastTrace(Safe.location+vect(0,0,8.4),enemy.location + enemy.eyeposition());
<a name="L416"><font color="white">00416</font>	            else
<a name="L417"><font color="white">00417</font>	                bAngleDeVUe=FastTrace(Safe.location+enemy.eyeposition(),enemy.location + enemy.eyeposition());
<a name="L418"><font color="white">00418</font>	            if (!bAngleDeVUe &amp;&amp; bFirstInPlace)
<a name="L419"><font color="white">00419</font>	                if (bestsafe!=none)
<a name="L420"><font color="white">00420</font>	                {
<a name="L421"><font color="white">00421</font>	                    if (Vsize(bestsafe.location-pawn.location)&gt;Vsize(safe.location- pawn.location))
<a name="L422"><font color="white">00422</font>	                        bestsafe=safe;
<a name="L423"><font color="white">00423</font>	                }
<a name="L424"><font color="white">00424</font>	                else
<a name="L425"><font color="white">00425</font>	                    bestsafe=Safe;
<a name="L426"><font color="white">00426</font>	        }
<a name="L427"><font color="white">00427</font>	    }
<a name="L428"><font color="white">00428</font>	    if (bestsafe==none)
<a name="L429"><font color="white">00429</font>	        return;
<a name="L430"><font color="white">00430</font>	    Movetarget=none;
<a name="L431"><font color="white">00431</font>	    if (actorreachable(bestsafe))
<a name="L432"><font color="white">00432</font>	    {
<a name="L433"><font color="white">00433</font>	        OldSafePoint=bestsafe;
<a name="L434"><font color="white">00434</font>	        halteaufeu();
<a name="L435"><font color="white">00435</font>	        MoveActor.MoveActor=bestsafe;
<a name="L436"><font color="white">00436</font>	        MoveActor.bReachable=true;
<a name="L437"><font color="white">00437</font>	        Nextstate='ResteSurPlace';
<a name="L438"><font color="white">00438</font>	        bFuitPourreloader=true;
<a name="L439"><font color="white">00439</font>	        bRetraiteversSafePoint=true;
<a name="L440"><font color="white">00440</font>	        bestsafe.Occupe();
<a name="L441"><font color="white">00441</font>	        gotostate('vavers');
<a name="L442"><font color="white">00442</font>	    }
<a name="L443"><font color="white">00443</font>	    else if (FindBestPathToward(bestSafe))
<a name="L444"><font color="white">00444</font>	    {
<a name="L445"><font color="white">00445</font>	        MoveActor.MoveActor=bestsafe;
<a name="L446"><font color="white">00446</font>	        halteaufeu();
<a name="L447"><font color="white">00447</font>	        MoveActor.bReachable=false;
<a name="L448"><font color="white">00448</font>	        bRetraiteversSafePoint=true;
<a name="L449"><font color="white">00449</font>	        bFuitPourreloader=true;
<a name="L450"><font color="white">00450</font>	        for (i=0;i&lt;16;i++)
<a name="L451"><font color="white">00451</font>	        {
<a name="L452"><font color="white">00452</font>	            if (routecache[i]==none)
<a name="L453"><font color="white">00453</font>	                break;
<a name="L454"><font color="white">00454</font>	            PointChemin[i]=routecache[i];
<a name="L455"><font color="white">00455</font>	        }
<a name="L456"><font color="white">00456</font>	        NbPointChemin=i;
<a name="L457"><font color="white">00457</font>	        Nextstate='ResteSurPlace';
<a name="L458"><font color="white">00458</font>	        bestsafe.Occupe();
<a name="L459"><font color="white">00459</font>	        gotostate('vavers');
<a name="L460"><font color="white">00460</font>	    }
<a name="L461"><font color="white">00461</font>	}
<a name="L462"><font color="white">00462</font>	// ----------------------------------------------------------------------
<a name="L463"><font color="white">00463</font>	// CherchePointPourCamper  // pour camper
<a name="L464"><font color="white">00464</font>	//
<a name="L465"><font color="white">00465</font>	// ----------------------------------------------------------------------
<a name="L466"><font color="white">00466</font>	function bool CherchePointPourCamper()  //cherche 2 SPs les plus proches et atteignable pour campage a moins de 10m
<a name="L467"><font color="white">00467</font>	{
<a name="L468"><font color="white">00468</font>	    local SafePoint Safe,BestSafe;
<a name="L469"><font color="white">00469</font>	    local int i;
<a name="L470"><font color="white">00470</font>	
<a name="L471"><font color="white">00471</font>	    For(i=0;i&lt;level.game.SafePointList.Length;i++)
<a name="L472"><font color="white">00472</font>	    {
<a name="L473"><font color="white">00473</font>	        safe=safepoint(level.game.SafePointList[i]);
<a name="L474"><font color="white">00474</font>	        if (!Safe.bAlreadyTargeted &amp;&amp; VSize(safe.location-pawn.location)&lt;800)
<a name="L475"><font color="white">00475</font>	            if (bestsafe!=none)
<a name="L476"><font color="white">00476</font>	            {
<a name="L477"><font color="white">00477</font>	                if (Vsize(bestsafe.location-pawn.location)&gt;Vsize(safe.location- pawn.location))
<a name="L478"><font color="white">00478</font>	                    bestsafe=safe;
<a name="L479"><font color="white">00479</font>	            }
<a name="L480"><font color="white">00480</font>	            else
<a name="L481"><font color="white">00481</font>	                bestsafe=Safe;
<a name="L482"><font color="white">00482</font>	    }
<a name="L483"><font color="white">00483</font>	    if (bestsafe==none)
<a name="L484"><font color="white">00484</font>	        return false;
<a name="L485"><font color="white">00485</font>	    MoveTarget=none;
<a name="L486"><font color="white">00486</font>	    if (actorreachable(bestsafe))
<a name="L487"><font color="white">00487</font>	    {
<a name="L488"><font color="white">00488</font>	        MoveActor.MoveActor=bestsafe;
<a name="L489"><font color="white">00489</font>	        MoveActor.bReachable=true;
<a name="L490"><font color="white">00490</font>	        Nextstate='ResteSurPlace';
<a name="L491"><font color="white">00491</font>	        bCampeversSafePoint=true;
<a name="L492"><font color="white">00492</font>	        bestsafe.Occupe();
<a name="L493"><font color="white">00493</font>	        gotostate('vavers');
<a name="L494"><font color="white">00494</font>			  return true;
<a name="L495"><font color="white">00495</font>	    }
<a name="L496"><font color="white">00496</font>	    else if (FindBestPathToward(bestSafe))
<a name="L497"><font color="white">00497</font>	    {
<a name="L498"><font color="white">00498</font>	        MoveActor.MoveActor=bestsafe;
<a name="L499"><font color="white">00499</font>	        MoveActor.bReachable=false;
<a name="L500"><font color="white">00500</font>	        bCampeversSafePoint=true;
<a name="L501"><font color="white">00501</font>	        for (i=0;i&lt;16;i++)
<a name="L502"><font color="white">00502</font>	        {
<a name="L503"><font color="white">00503</font>	            if (routecache[i]==none)
<a name="L504"><font color="white">00504</font>	                break;
<a name="L505"><font color="white">00505</font>	            PointChemin[i]=routecache[i];
<a name="L506"><font color="white">00506</font>	        }
<a name="L507"><font color="white">00507</font>	        NbPointChemin=i;
<a name="L508"><font color="white">00508</font>	        Nextstate='ResteSurPlace';
<a name="L509"><font color="white">00509</font>	        bestsafe.Occupe();
<a name="L510"><font color="white">00510</font>	        gotostate('vavers');
<a name="L511"><font color="white">00511</font>			  return true;
<a name="L512"><font color="white">00512</font>	    }
<a name="L513"><font color="white">00513</font>		 return false;
<a name="L514"><font color="white">00514</font>	}
<a name="L515"><font color="white">00515</font>	// ----------------------------------------------------------------------
<a name="L516"><font color="white">00516</font>	// ChercheAttackPoint
<a name="L517"><font color="white">00517</font>	//
<a name="L518"><font color="white">00518</font>	// ----------------------------------------------------------------------
<a name="L519"><font color="white">00519</font>	function AttackPoint ChercheAttackPoint()  //cherche AttackPoint le plus proche
<a name="L520"><font color="white">00520</font>	{
<a name="L521"><font color="white">00521</font>	    //ENEMY DOIT IMPRATIVEMENT NE PAS ETRE EGAL A NONE
<a name="L522"><font color="white">00522</font>	    local vector EnemyPos;
<a name="L523"><font color="white">00523</font>	    local AttackPoint Attack;
<a name="L524"><font color="white">00524</font>	    local AttackPoint BestAttack;
<a name="L525"><font color="white">00525</font>	    local int i;
<a name="L526"><font color="white">00526</font>	
<a name="L527"><font color="white">00527</font>	    if (enemy==none)
<a name="L528"><font color="white">00528</font>	    {
<a name="L529"><font color="white">00529</font>	        log(pawn@&quot;WWWWWWWWWWWWWWAAAAAAAAAARRRRRRRRRRNNNNNNNNNIIIIIIIIIIIIIIIIINNNNNNNNNGGGGGGGGGGG !!!&quot;);
<a name="L530"><font color="white">00530</font>	        return none;
<a name="L531"><font color="white">00531</font>	    }
<a name="L532"><font color="white">00532</font>	    EnemyPos= enemy.location-pawn.location;
<a name="L533"><font color="white">00533</font>	    For(i=0;i&lt;level.game.AttackPointList.Length;i++)
<a name="L534"><font color="white">00534</font>	    {
<a name="L535"><font color="white">00535</font>	        attack=attackpoint(level.game.AttackPointList[i]);
<a name="L536"><font color="white">00536</font>	        if (bases.NumReseauAttaque==Attack.NumReseau  &amp;&amp; !attack.bDejaPasse)
<a name="L537"><font color="white">00537</font>	            if (bestAttack!=none)
<a name="L538"><font color="white">00538</font>	            {
<a name="L539"><font color="white">00539</font>	                if (Vsize(bestAttack.location-pawn.location)&gt;Vsize(Attack.location- pawn.location))
<a name="L540"><font color="white">00540</font>	                    bestAttack=Attack;
<a name="L541"><font color="white">00541</font>	            }
<a name="L542"><font color="white">00542</font>	            else
<a name="L543"><font color="white">00543</font>	                bestAttack=Attack;
<a name="L544"><font color="white">00544</font>	    }
<a name="L545"><font color="white">00545</font>	    if (bestattack!=none &amp;&amp; bestattack.NextAttackP==none &amp;&amp; OldAttackPoint==bestattack &amp;&amp; VSize(bestAttack.location-pawn.location)&gt;450)
<a name="L546"><font color="white">00546</font>	        bestattack=none;
<a name="L547"><font color="white">00547</font>	    return bestAttack;
<a name="L548"><font color="white">00548</font>	}
<a name="L549"><font color="white">00549</font>	
<a name="L550"><font color="white">00550</font>	// ----------------------------------------------------------------------
<a name="L551"><font color="white">00551</font>	//
<a name="L552"><font color="white">00552</font>	//ChercheNMIPlusProche
<a name="L553"><font color="white">00553</font>	//
<a name="L554"><font color="white">00554</font>	// ----------------------------------------------------------------------
<a name="L555"><font color="white">00555</font>	function xiiipawn ChercheNMIPlusProche()
<a name="L556"><font color="white">00556</font>	{
<a name="L557"><font color="white">00557</font>	    local int i;
<a name="L558"><font color="white">00558</font>		 local XIIIPawn Soldier,NMIPlusProche;
<a name="L559"><font color="white">00559</font>	
<a name="L560"><font color="white">00560</font>	    NMIPlusProche=none;
<a name="L561"><font color="white">00561</font>	    For(i=0;i&lt;level.game.BaseSoldierList.Length;i++)
<a name="L562"><font color="white">00562</font>	    {
<a name="L563"><font color="white">00563</font>	        if (level.game.BaseSoldierList[i]==none || level.game.BaseSoldierList[i].bisdead || level.game.BaseSoldierList[i].controller.isinstate('faction'))
<a name="L564"><font color="white">00564</font>	            continue;
<a name="L565"><font color="white">00565</font>	        Soldier=XIIIPawn(level.game.BaseSoldierList[i]);
<a name="L566"><font color="white">00566</font>	        if (Soldier!=none &amp;&amp; soldier!=pawn &amp;&amp; AllianceLevel(Soldier)&lt;0 &amp;&amp; lineofsightto(Soldier))
<a name="L567"><font color="white">00567</font>	        {
<a name="L568"><font color="white">00568</font>	            if (NMIPlusProche==none || Vsize(NMIPlusProche.location-pawn.location)&gt;Vsize(soldier.location-pawn.location))
<a name="L569"><font color="white">00569</font>	                NMIPlusProche=soldier;
<a name="L570"><font color="white">00570</font>	        }
<a name="L571"><font color="white">00571</font>	    }
<a name="L572"><font color="white">00572</font>	    return NMIPlusProche;
<a name="L573"><font color="white">00573</font>	}
<a name="L574"><font color="white">00574</font>	
<a name="L575"><font color="white">00575</font>	// ----------------------------------------------------------------------
<a name="L576"><font color="white">00576</font>	// ChercheAlarme
<a name="L577"><font color="white">00577</font>	// ----------------------------------------------------------------------
<a name="L578"><font color="white">00578</font>	function ChercheAlarme()     //check les 2 alarmes les plus proches &lt;20m
<a name="L579"><font color="white">00579</font>	{
<a name="L580"><font color="white">00580</font>	    local int i;
<a name="L581"><font color="white">00581</font>	    local triggeralarme Alarm,BestAlarme;
<a name="L582"><font color="white">00582</font>	
<a name="L583"><font color="white">00583</font>	    if (bases.ProbaDeclencheAlarme==0)
<a name="L584"><font color="white">00584</font>	        return;
<a name="L585"><font color="white">00585</font>	    if (FRand()*100&gt;bases.ProbaDeclencheAlarme)
<a name="L586"><font color="white">00586</font>	        return;
<a name="L587"><font color="white">00587</font>	    if (level.game.AlarmList.Length&lt;=0)
<a name="L588"><font color="white">00588</font>	        return;
<a name="L589"><font color="white">00589</font>	    bestalarme=none;
<a name="L590"><font color="white">00590</font>	    For(i=0;i&lt;level.game.AlarmList.Length;i++)
<a name="L591"><font color="white">00591</font>	    {
<a name="L592"><font color="white">00592</font>	        alarm=triggeralarme(level.game.AlarmList[i]);
<a name="L593"><font color="white">00593</font>			  //log(&quot; test alarme&quot;@alarm@!alarm.bAlarmeactivated@!alarm.bAlarmeTargeted@VSize(alarm.location-pawn.location)&lt;2362@normal(pawn.location-enemy.location) dot normal(alarm.location-enemy.location)@(normal(pawn.location-enemy.location) dot normal(alarm.location-enemy.location)&gt;=-0.2@Vsize(enemy.location-alarm.location)&gt;250)@Fasttrace(alarm.location-vect(0,0,30),pawn.location-vect(0,0,30))@FindBestPathToward(alarm));
<a name="L594"><font color="white">00594</font>	        if (!alarm.bAlarmeactivated &amp;&amp; !alarm.bAlarmeTargeted &amp;&amp; VSize(alarm.location-pawn.location)&lt;2362 &amp;&amp; (enemy==none || !bDejaVu || (normal(pawn.location-enemy.location) dot normal(alarm.location-enemy.location)&gt;=-0.2 &amp;&amp; Vsize(enemy.location-alarm.location)&gt;250)) &amp;&amp; (Fasttrace(alarm.location-vect(0,0,30),pawn.location-vect(0,0,30)) || FindBestPathToward(alarm)))   //30m et pas ennemy devant
<a name="L595"><font color="white">00595</font>	            if (bestalarme!=none )
<a name="L596"><font color="white">00596</font>	            {
<a name="L597"><font color="white">00597</font>	                if (Vsize(bestalarme.location-pawn.location)&gt;Vsize(alarm.location- pawn.location))
<a name="L598"><font color="white">00598</font>	                    bestAlarme=alarm;
<a name="L599"><font color="white">00599</font>	            }
<a name="L600"><font color="white">00600</font>	            else
<a name="L601"><font color="white">00601</font>	                bestalarme=alarm;
<a name="L602"><font color="white">00602</font>	    }
<a name="L603"><font color="white">00603</font>	    if (bestalarme==none)
<a name="L604"><font color="white">00604</font>	        return;
<a name="L605"><font color="white">00605</font>	    MoveTarget=none;
<a name="L606"><font color="white">00606</font>	    If (Fasttrace(bestalarme.location-vect(0,0,30),pawn.location-vect(0,0,30)))      //vire actorreachable
<a name="L607"><font color="white">00607</font>	    {
<a name="L608"><font color="white">00608</font>	        //log(pawn@&quot;cherche alarme et trouve &quot;@bestalarme);
<a name="L609"><font color="white">00609</font>	        MoveActor.MoveActor=bestalarme;
<a name="L610"><font color="white">00610</font>	        MoveActor.bReachable=true;
<a name="L611"><font color="white">00611</font>	        Nextstate='investigation';
<a name="L612"><font color="white">00612</font>	        Halteaufeu();
<a name="L613"><font color="white">00613</font>	        bAlarmeInstigator=true;
<a name="L614"><font color="white">00614</font>	        genalerte.PoteTargetAlarme(true,bestalarme.tag);
<a name="L615"><font color="white">00615</font>	        gotostate('vavers','initalarme');
<a name="L616"><font color="white">00616</font>	    }
<a name="L617"><font color="white">00617</font>	    else if (FindBestPathToward(bestalarme))
<a name="L618"><font color="white">00618</font>	    {
<a name="L619"><font color="white">00619</font>	        //log(pawn@&quot;cherche alarme et trouve par chemin&quot;@bestalarme);
<a name="L620"><font color="white">00620</font>	        MoveActor.MoveActor=bestalarme;
<a name="L621"><font color="white">00621</font>	        MoveActor.bReachable=false;
<a name="L622"><font color="white">00622</font>	        bAlarmeInstigator=true;
<a name="L623"><font color="white">00623</font>	        Halteaufeu();
<a name="L624"><font color="white">00624</font>	        genalerte.PoteTargetAlarme(true,bestalarme.tag);
<a name="L625"><font color="white">00625</font>	        for (i=0;i&lt;16;i++)
<a name="L626"><font color="white">00626</font>	        {
<a name="L627"><font color="white">00627</font>	            if (routecache[i]==none)
<a name="L628"><font color="white">00628</font>	                break;
<a name="L629"><font color="white">00629</font>	            PointChemin[i]=routecache[i];
<a name="L630"><font color="white">00630</font>	        }
<a name="L631"><font color="white">00631</font>	        NbPointChemin=i;
<a name="L632"><font color="white">00632</font>			  PointChemin[NbPointChemin]=bestalarme;
<a name="L633"><font color="white">00633</font>			  NbPointChemin++;
<a name="L634"><font color="white">00634</font>	        Nextstate='investigation';
<a name="L635"><font color="white">00635</font>	        gotostate('vavers','initalarme');
<a name="L636"><font color="white">00636</font>	    }
<a name="L637"><font color="white">00637</font>	}
<a name="L638"><font color="white">00638</font>	// ----------------------------------------------------------------------
<a name="L639"><font color="white">00639</font>	// ChercheReseauAttaque
<a name="L640"><font color="white">00640</font>	//
<a name="L641"><font color="white">00641</font>	//retourne vrai si a trouve une grenade differente
<a name="L642"><font color="white">00642</font>	// ----------------------------------------------------------------------
<a name="L643"><font color="white">00643</font>	function ChercheReseauAttaque()
<a name="L644"><font color="white">00644</font>	{
<a name="L645"><font color="white">00645</font>	    local int i;
<a name="L646"><font color="white">00646</font>	    If (bases.NumReseauAttaque!=0)
<a name="L647"><font color="white">00647</font>	    {
<a name="L648"><font color="white">00648</font>	        LastAttackPoint=none;
<a name="L649"><font color="white">00649</font>	        LastAttackPoint=chercheAttackPoint();
<a name="L650"><font color="white">00650</font>	        if (lastAttackPoint!=none) //AttackPoint plus pres que enemy
<a name="L651"><font color="white">00651</font>	        {
<a name="L652"><font color="white">00652</font>	            MoveTarget=none;
<a name="L653"><font color="white">00653</font>	            if (ActorReachable(LastAttackPoint))
<a name="L654"><font color="white">00654</font>	            {
<a name="L655"><font color="white">00655</font>	                if (Vsize(enemy.location-pawn.location)&gt;300 || !enemy.controller.Cansee(pawn))
<a name="L656"><font color="white">00656</font>	                {
<a name="L657"><font color="white">00657</font>	                    HalteAufeu();
<a name="L658"><font color="white">00658</font>							  if (!bdejavu) bDejaVu = true;
<a name="L659"><font color="white">00659</font>	                    gotostate('attaquescriptee');
<a name="L660"><font color="white">00660</font>	                }
<a name="L661"><font color="white">00661</font>	            }
<a name="L662"><font color="white">00662</font>	            else if (FindBestPathToward(LastAttackPoint))
<a name="L663"><font color="white">00663</font>	            {
<a name="L664"><font color="white">00664</font>	                if (Vsize(enemy.location-pawn.location)&gt;300 || !enemy.controller.Cansee(pawn))
<a name="L665"><font color="white">00665</font>	                {
<a name="L666"><font color="white">00666</font>	                    HalteAufeu();
<a name="L667"><font color="white">00667</font>	                    for (i=0;i&lt;16;i++)
<a name="L668"><font color="white">00668</font>	                    {
<a name="L669"><font color="white">00669</font>	                        if (routecache[i]==none)
<a name="L670"><font color="white">00670</font>	                            break;
<a name="L671"><font color="white">00671</font>	                        PointChemin[i]=routecache[i];
<a name="L672"><font color="white">00672</font>	                    }
<a name="L673"><font color="white">00673</font>	                    NbPointChemin=i;
<a name="L674"><font color="white">00674</font>							  if (!bdejavu) bDejaVu = true;
<a name="L675"><font color="white">00675</font>	                    gotostate('attaquescriptee');
<a name="L676"><font color="white">00676</font>	                }
<a name="L677"><font color="white">00677</font>	            }
<a name="L678"><font color="white">00678</font>	        }
<a name="L679"><font color="white">00679</font>	    }
<a name="L680"><font color="white">00680</font>	}
<a name="L681"><font color="white">00681</font>	// ----------------------------------------------------------------------
<a name="L682"><font color="white">00682</font>	// AllianceLevel()
<a name="L683"><font color="white">00683</font>	//
<a name="L684"><font color="white">00684</font>	// renvoi -1 (enemy) 0 (neutre) ou 1 (ami)suivant alliance
<a name="L685"><font color="white">00685</font>	// ----------------------------------------------------------------------
<a name="L686"><font color="white">00686</font>	native function int AllianceLevel(pawn Newenemy);
<a name="L687"><font color="white">00687</font>	
<a name="L688"><font color="white">00688</font>	// ----------------------------------------------------------------------
<a name="L689"><font color="white">00689</font>	//
<a name="L690"><font color="white">00690</font>	// RelativeStrength()
<a name="L691"><font color="white">00691</font>	//
<a name="L692"><font color="white">00692</font>	//returns a value indicating the relative strength of other
<a name="L693"><font color="white">00693</font>	//0.0 = equal to controlled pawn
<a name="L694"><font color="white">00694</font>	//&gt; 0 stronger than controlled pawn
<a name="L695"><font color="white">00695</font>	//&lt; 0 weaker than controlled pawn
<a name="L696"><font color="white">00696</font>	//
<a name="L697"><font color="white">00697</font>	//Since the result will be compared to the creature's aggressiveness, it should be
<a name="L698"><font color="white">00698</font>	//on the same order of magnitude (-1 to 1)
<a name="L699"><font color="white">00699</font>	//Estimation en fonction de la vie, des armes et des positions en hauteur.
<a name="L700"><font color="white">00700</font>	// ----------------------------------------------------------------------
<a name="L701"><font color="white">00701</font>	
<a name="L702"><font color="white">00702</font>	function float RelativeStrength(Pawn Other)
<a name="L703"><font color="white">00703</font>	{
<a name="L704"><font color="white">00704</font>	    local float compare;
<a name="L705"><font color="white">00705</font>	    local int bTemp;
<a name="L706"><font color="white">00706</font>	
<a name="L707"><font color="white">00707</font>	    compare=0;
<a name="L708"><font color="white">00708</font>	    //compare vie
<a name="L709"><font color="white">00709</font>	    if (bases.HealthPercent()&lt;10)
<a name="L710"><font color="white">00710</font>	        compare+=0.3;
<a name="L711"><font color="white">00711</font>	    if (xiiipawn(other).HealthPercent()&lt;10)
<a name="L712"><font color="white">00712</font>	        compare-=0.2;
<a name="L713"><font color="white">00713</font>	    //compare armes
<a name="L714"><font color="white">00714</font>	    if (pawn.weapon != None )
<a name="L715"><font color="white">00715</font>	    {
<a name="L716"><font color="white">00716</font>	        compare -= (pawn.weapon.RateSelf() - 0.3);
<a name="L717"><font color="white">00717</font>	        if ( pawn.weapon.AIRating &lt; 0.5 )
<a name="L718"><font color="white">00718</font>	        {
<a name="L719"><font color="white">00719</font>	            compare += 0.15;
<a name="L720"><font color="white">00720</font>	            if ( (Other.Weapon != None) &amp;&amp; (Other.Weapon.AIRating &gt; 0.5) )
<a name="L721"><font color="white">00721</font>	                compare += 0.2;
<a name="L722"><font color="white">00722</font>	        }
<a name="L723"><font color="white">00723</font>	    }
<a name="L724"><font color="white">00724</font>	    if ( Other.Weapon != None )
<a name="L725"><font color="white">00725</font>	        compare += (Other.Weapon.RateSelf() - 0.3);
<a name="L726"><font color="white">00726</font>	    //compare position
<a name="L727"><font color="white">00727</font>	    if ( Other.Location.Z &gt; Pawn.Location.Z + 400 )
<a name="L728"><font color="white">00728</font>	        compare -= 0.2;
<a name="L729"><font color="white">00729</font>	    else if ( Pawn.Location.Z &gt; Other.Location.Z + 400 )
<a name="L730"><font color="white">00730</font>	        compare += 0.15;
<a name="L731"><font color="white">00731</font>	    return compare;
<a name="L732"><font color="white">00732</font>	}
<a name="L733"><font color="white">00733</font>	// ----------------------------------------------------------------------
<a name="L734"><font color="white">00734</font>	// FearAttitude()
<a name="L735"><font color="white">00735</font>	// ----------------------------------------------------------------------
<a name="L736"><font color="white">00736</font>	Function AttitudeInfo AttitudeToNMI(pawn other)
<a name="L737"><font color="white">00737</font>	{
<a name="L738"><font color="white">00738</font>	    if (RelativeStrength(Other) &gt; bases.Agressivite + 0.3 + NombrePotesPresents()*0.06)
<a name="L739"><font color="white">00739</font>	    {
<a name="L740"><font color="white">00740</font>	        if (RelativeStrength(Other) &gt; bases.Agressivite + 0.7 + NombrePotesPresents()*0.06)
<a name="L741"><font color="white">00741</font>	            return ATTITUDE_Fear;
<a name="L742"><font color="white">00742</font>	        else
<a name="L743"><font color="white">00743</font>	            return ATTITUDE_Impressed;
<a name="L744"><font color="white">00744</font>	    }
<a name="L745"><font color="white">00745</font>	    else
<a name="L746"><font color="white">00746</font>	    {
<a name="L747"><font color="white">00747</font>	        return ATTITUDE_Charge;
<a name="L748"><font color="white">00748</font>	    }
<a name="L749"><font color="white">00749</font>	}
<a name="L750"><font color="white">00750</font>	
<a name="L751"><font color="white">00751</font>	// ----------------------------------------------------------------------
<a name="L752"><font color="white">00752</font>	//  NombrePotesPresents()
<a name="L753"><font color="white">00753</font>	//
<a name="L754"><font color="white">00754</font>	//  Nombre de potes dans rayon de 12m
<a name="L755"><font color="white">00755</font>	// ----------------------------------------------------------------------
<a name="L756"><font color="white">00756</font>	function int NombrePotesPresents()
<a name="L757"><font color="white">00757</font>	{
<a name="L758"><font color="white">00758</font>	    local int i;
<a name="L759"><font color="white">00759</font>	    local int NombrePotes;
<a name="L760"><font color="white">00760</font>	    local basesoldier Soldier;
<a name="L761"><font color="white">00761</font>	
<a name="L762"><font color="white">00762</font>	    NombrePotes=0;
<a name="L763"><font color="white">00763</font>	    For(i=0;i&lt;level.game.BaseSoldierList.Length;i++)
<a name="L764"><font color="white">00764</font>	    {
<a name="L765"><font color="white">00765</font>	        Soldier=basesoldier(level.game.BaseSoldierList[i]);
<a name="L766"><font color="white">00766</font>	        if (soldier!=none &amp;&amp; Soldier!=pawn &amp;&amp; !Soldier.bisdead &amp;&amp; !soldier.controller.isinstate('faction') &amp;&amp; AllianceLevel(Soldier)&gt;0 &amp;&amp; vsize(soldier.location-pawn.location)&lt;1000)
<a name="L767"><font color="white">00767</font>	        {
<a name="L768"><font color="white">00768</font>	            NombrePotes++;
<a name="L769"><font color="white">00769</font>	        }
<a name="L770"><font color="white">00770</font>	    }
<a name="L771"><font color="white">00771</font>	    return NombrePotes;
<a name="L772"><font color="white">00772</font>	}
<a name="L773"><font color="white">00773</font>	// ----------------------------------------------------------------------
<a name="L774"><font color="white">00774</font>	// SetEnemy
<a name="L775"><font color="white">00775</font>	// ----------------------------------------------------------------------
<a name="L776"><font color="white">00776</font>	native Function bool SetEnemy(Pawn NewEnemy);
<a name="L777"><font color="white">00777</font>	
<a name="L778"><font color="white">00778</font>	// ----------------------------------------------------------------------
<a name="L779"><font color="white">00779</font>	// SwitchToEnemy: fait passer soldier neutre en ennemi
<a name="L780"><font color="white">00780</font>	// ----------------------------------------------------------------------
<a name="L781"><font color="white">00781</font>	function SwitchToEnemy(Pawn newEnemy)
<a name="L782"><font color="white">00782</font>	{
<a name="L783"><font color="white">00783</font>	    local int i;
<a name="L784"><font color="white">00784</font>	
<a name="L785"><font color="white">00785</font>	    for (i=0;i&lt;4;i++)
<a name="L786"><font color="white">00786</font>	    {
<a name="L787"><font color="white">00787</font>	        if ((bases.InitialAlliances[i].AllianceName == newEnemy.alliance) &amp;&amp; (newEnemy.alliance !=''))
<a name="L788"><font color="white">00788</font>	            break;
<a name="L789"><font color="white">00789</font>	    }
<a name="L790"><font color="white">00790</font>	    if (i&lt;4)
<a name="L791"><font color="white">00791</font>	        if (bases.InitialAlliances[i].AllianceLevel == 0)
<a name="L792"><font color="white">00792</font>	            bases.InitialAlliances[i].AllianceLevel=-1;
<a name="L793"><font color="white">00793</font>	}
<a name="L794"><font color="white">00794</font>	
<a name="L795"><font color="white">00795</font>	
<a name="L796"><font color="white">00796</font>	
<a name="L797"><font color="white">00797</font>	
<a name="L798"><font color="white">00798</font>	// ----------------------------------------------------------------------
<a name="L799"><font color="white">00799</font>	// NearWall()
<a name="L800"><font color="white">00800</font>	// ----------------------------------------------------------------------
<a name="L801"><font color="white">00801</font>	/* NearWall() returns true if there is a nearby barrier at eyeheight, and
<a name="L802"><font color="white">00802</font>	changes FocalPoint to a suggested place to look
<a name="L803"><font color="white">00803</font>	*/
<a name="L804"><font color="white">00804</font>	native function bool NearWall(float walldist);
<a name="L805"><font color="white">00805</font>	/*
<a name="L806"><font color="white">00806</font>	{
<a name="L807"><font color="white">00807</font>	local vector ViewSpot, ViewDist, LookDir,hitlocation,hitnormal;
<a name="L808"><font color="white">00808</font>	local actor hitactor;
<a name="L809"><font color="white">00809</font>	
<a name="L810"><font color="white">00810</font>	  LookDir = vector(Rotation);
<a name="L811"><font color="white">00811</font>	  ViewSpot = Pawn.Location + Pawn.BaseEyeHeight * vect(0,0,1);
<a name="L812"><font color="white">00812</font>	  ViewDist = LookDir * walldist;
<a name="L813"><font color="white">00813</font>	  HitActor = Trace(HitLocation, HitNormal, ViewSpot + ViewDist, ViewSpot, false);
<a name="L814"><font color="white">00814</font>	  if (HitActor == None)
<a name="L815"><font color="white">00815</font>	  return false;
<a name="L816"><font color="white">00816</font>	
<a name="L817"><font color="white">00817</font>	    ViewDist = Normal(HitNormal Cross vect(0,0,1)) * walldist;
<a name="L818"><font color="white">00818</font>	    if (FRand() &lt; 0.5)
<a name="L819"><font color="white">00819</font>	    ViewDist *= -1;
<a name="L820"><font color="white">00820</font>	
<a name="L821"><font color="white">00821</font>	      Focus = None;
<a name="L822"><font color="white">00822</font>	      if ( FastTrace(ViewSpot + ViewDist, ViewSpot) )
<a name="L823"><font color="white">00823</font>	      {
<a name="L824"><font color="white">00824</font>	      FocalPoint = Pawn.Location + ViewDist;
<a name="L825"><font color="white">00825</font>	      return true;
<a name="L826"><font color="white">00826</font>	      }
<a name="L827"><font color="white">00827</font>	
<a name="L828"><font color="white">00828</font>	        if ( FastTrace(ViewSpot - ViewDist, ViewSpot) )
<a name="L829"><font color="white">00829</font>	        {
<a name="L830"><font color="white">00830</font>	        FocalPoint = Pawn.Location - ViewDist;
<a name="L831"><font color="white">00831</font>	        return true;
<a name="L832"><font color="white">00832</font>	        }
<a name="L833"><font color="white">00833</font>	        FocalPoint = Pawn.Location - LookDir * 300;
<a name="L834"><font color="white">00834</font>	        return true;
<a name="L835"><font color="white">00835</font>	}    */
<a name="L836"><font color="white">00836</font>	
<a name="L837"><font color="white">00837</font>	// ----------------------------------------------------------------------
<a name="L838"><font color="white">00838</font>	// FindBestPathToward()
<a name="L839"><font color="white">00839</font>	//
<a name="L840"><font color="white">00840</font>	// assumes the desired destination is not directly reachable.
<a name="L841"><font color="white">00841</font>	// It tries to set Destination to the location of the
<a name="L842"><font color="white">00842</font>	// best waypoint, and returns true if successful
<a name="L843"><font color="white">00843</font>	// ----------------------------------------------------------------------
<a name="L844"><font color="white">00844</font>	native function bool FindBestPathToward(actor desired, optional float xyMargin, optional float heightMargin);
<a name="L845"><font color="white">00845</font>	/*{
<a name="L846"><font color="white">00846</font>	local Actor path;
<a name="L847"><font color="white">00847</font>	local bool success;
<a name="L848"><font color="white">00848</font>	local vector Desti;
<a name="L849"><font color="white">00849</font>	
<a name="L850"><font color="white">00850</font>	  desti=desired.location;
<a name="L851"><font color="white">00851</font>	  path = FindPathTo(desti,true);
<a name="L852"><font color="white">00852</font>	  success = (path != None);
<a name="L853"><font color="white">00853</font>	  if (success)
<a name="L854"><font color="white">00854</font>	  {
<a name="L855"><font color="white">00855</font>	  MoveTarget = path;
<a name="L856"><font color="white">00856</font>	  Destination = path.Location;
<a name="L857"><font color="white">00857</font>	  }
<a name="L858"><font color="white">00858</font>	  return success;
<a name="L859"><font color="white">00859</font>	}*/
<a name="L860"><font color="white">00860</font>	// ----------------------------------------------------------------------
<a name="L861"><font color="white">00861</font>	// FindBestPathTo()
<a name="L862"><font color="white">00862</font>	//
<a name="L863"><font color="white">00863</font>	//
<a name="L864"><font color="white">00864</font>	// ----------------------------------------------------------------------
<a name="L865"><font color="white">00865</font>	native function bool FindBestPathTo(vector desti);
<a name="L866"><font color="white">00866</font>	/*{
<a name="L867"><font color="white">00867</font>	local Actor path;
<a name="L868"><font color="white">00868</font>	local bool success;
<a name="L869"><font color="white">00869</font>	
<a name="L870"><font color="white">00870</font>	  path = FindPathTo(desti,true);
<a name="L871"><font color="white">00871</font>	  success = (path != None);
<a name="L872"><font color="white">00872</font>	  if (success)
<a name="L873"><font color="white">00873</font>	  {
<a name="L874"><font color="white">00874</font>	  MoveTarget = path;
<a name="L875"><font color="white">00875</font>	  Destination = path.Location;
<a name="L876"><font color="white">00876</font>	  }
<a name="L877"><font color="white">00877</font>	
<a name="L878"><font color="white">00878</font>	    return success;
<a name="L879"><font color="white">00879</font>	}   */
<a name="L880"><font color="white">00880</font>	
<a name="L881"><font color="white">00881</font>	// ----------------------------------------------------------------------
<a name="L882"><font color="white">00882</font>	// ChangeEtat : retour vers etat neutre
<a name="L883"><font color="white">00883</font>	// ----------------------------------------------------------------------
<a name="L884"><font color="white">00884</font>	function ChangeEtat()
<a name="L885"><font color="white">00885</font>	{
<a name="L886"><font color="white">00886</font>	    HalteAuFeu();
<a name="L887"><font color="white">00887</font>	    if (!bases.bAlerte)
<a name="L888"><font color="white">00888</font>	        SetVigilant(false);
<a name="L889"><font color="white">00889</font>	    OldSafepoint=none;
<a name="L890"><font color="white">00890</font>	    bWeaponNoise=false;
<a name="L891"><font color="white">00891</font>	    bImpactNoise=false;
<a name="L892"><font color="white">00892</font>	    bStepNoise=false;
<a name="L893"><font color="white">00893</font>	    bCadavreVu=false;
<a name="L894"><font color="white">00894</font>	    bDejaVu=false;
<a name="L895"><font color="white">00895</font>	    bPaffe=false;
<a name="L896"><font color="white">00896</font>	    bEtatAlerte=false;
<a name="L897"><font color="white">00897</font>	    pawn.SetAnimStatus('quiet');
<a name="L898"><font color="white">00898</font>	    pawn.rotationrate.yaw=26000;
<a name="L899"><font color="white">00899</font>	    enemy=none;
<a name="L900"><font color="white">00900</font>	    if (EtatNeutre=='')
<a name="L901"><font color="white">00901</font>	        EtatNeutre='tenir';
<a name="L902"><font color="white">00902</font>	
<a name="L903"><font color="white">00903</font>	    if (EtatNeutre=='tenir' &amp;&amp; !isinstate('tenir'))
<a name="L904"><font color="white">00904</font>	    {
<a name="L905"><font color="white">00905</font>	        gotostate('tenir','backtoformation');
<a name="L906"><font color="white">00906</font>	        return;
<a name="L907"><font color="white">00907</font>	    }
<a name="L908"><font color="white">00908</font>	    if (EtatNeutre=='patrouille' &amp;&amp; IsInState('Acquisition'))
<a name="L909"><font color="white">00909</font>	    {
<a name="L910"><font color="white">00910</font>	        gotostate('patrouille','moving');
<a name="L911"><font color="white">00911</font>	        return;
<a name="L912"><font color="white">00912</font>	    }
<a name="L913"><font color="white">00913</font>	    gotostate(EtatNeutre);
<a name="L914"><font color="white">00914</font>	}
<a name="L915"><font color="white">00915</font>	
<a name="L916"><font color="white">00916</font>	
<a name="L917"><font color="white">00917</font>	// ----------------------------------------------------------------------
<a name="L918"><font color="white">00918</font>	// ChangeToBestWeapon()
<a name="L919"><font color="white">00919</font>	// ----------------------------------------------------------------------
<a name="L920"><font color="white">00920</font>	exec function bool ChangeToBestWeapon()
<a name="L921"><font color="white">00921</font>	{
<a name="L922"><font color="white">00922</font>	    local float rating;
<a name="L923"><font color="white">00923</font>	
<a name="L924"><font color="white">00924</font>	    Pawn.PendingWeapon = Pawn.Inventory.RecommendWeapon(rating);
<a name="L925"><font color="white">00925</font>	    if (Pawn.PendingWeapon == Pawn.Weapon )
<a name="L926"><font color="white">00926</font>	        Pawn.PendingWeapon = None;
<a name="L927"><font color="white">00927</font>	    if (Pawn.PendingWeapon == None )
<a name="L928"><font color="white">00928</font>	        return false;
<a name="L929"><font color="white">00929</font>		 if ((XIIIWeapon(Pawn.pendingWeapon) != none) &amp;&amp; XIIIWeapon(Pawn.pendingWeapon).bHeavyWeapon )
<a name="L930"><font color="white">00930</font>	       XIIIPawn(Pawn).SetGroundspeed(0.666);
<a name="L931"><font color="white">00931</font>	    else
<a name="L932"><font color="white">00932</font>	       XIIIPawn(Pawn).SetGroundspeed(1.0);
<a name="L933"><font color="white">00933</font>		 if (niveaualerte==2 &amp;&amp; Pawn.pendingWeapon.bmeleeweapon)
<a name="L934"><font color="white">00934</font>			 gotostate('attaqueH2H');
<a name="L935"><font color="white">00935</font>	    if (Pawn.Weapon == None )
<a name="L936"><font color="white">00936</font>	        Pawn.ChangedWeapon();
<a name="L937"><font color="white">00937</font>	    else if ( Pawn.Weapon != Pawn.PendingWeapon )
<a name="L938"><font color="white">00938</font>	        Pawn.Weapon.PutDown();
<a name="L939"><font color="white">00939</font>	    return true;
<a name="L940"><font color="white">00940</font>	}
<a name="L941"><font color="white">00941</font>	
<a name="L942"><font color="white">00942</font>	// ----------------------------------------------------------------------
<a name="L943"><font color="white">00943</font>	// ----------------------------------------------------------------------
<a name="L944"><font color="white">00944</font>	// Fonctions de reactions aux ennemis (pour etat neutre
<a name="L945"><font color="white">00945</font>	// ----------------------------------------------------------------------
<a name="L946"><font color="white">00946</font>	// ----------------------------------------------------------------------
<a name="L947"><font color="white">00947</font>	
<a name="L948"><font color="white">00948</font>	// ----------------------------------------------------------------------
<a name="L949"><font color="white">00949</font>	// TestSonEntendu
<a name="L950"><font color="white">00950</font>	// ----------------------------------------------------------------------
<a name="L951"><font color="white">00951</font>	function bool TestSonEntendu(Actor Son)
<a name="L952"><font color="white">00952</font>	{
<a name="L953"><font color="white">00953</font>		 if (son.instigator!=none &amp;&amp; son.instigator.controller!=none &amp;&amp; son.instigator.controller.isa('CineController2'))
<a name="L954"><font color="white">00954</font>			return false;
<a name="L955"><font color="white">00955</font>	    if (weapon(son)!=none || XIIIProjectile(son)!=none)
<a name="L956"><font color="white">00956</font>	    {
<a name="L957"><font color="white">00957</font>	        bWeaponNoise=true;
<a name="L958"><font color="white">00958</font>	        if (alliancelevel(son.instigator)==1) //pote donc prend son enemy
<a name="L959"><font color="white">00959</font>	        {
<a name="L960"><font color="white">00960</font>	            enemy=son.instigator.controller.enemy;
<a name="L961"><font color="white">00961</font>	            instigator=son.instigator;
<a name="L962"><font color="white">00962</font>	        }
<a name="L963"><font color="white">00963</font>	        else
<a name="L964"><font color="white">00964</font>	        {
<a name="L965"><font color="white">00965</font>	            enemy=son.instigator;
<a name="L966"><font color="white">00966</font>	            instigator=enemy;
<a name="L967"><font color="white">00967</font>	        }
<a name="L968"><font color="white">00968</font>	    }
<a name="L969"><font color="white">00969</font>	    else if (bulletdustemitter(son)!=none &amp;&amp; son.instigator==XIII)
<a name="L970"><font color="white">00970</font>	    {
<a name="L971"><font color="white">00971</font>	        bImpactNoise=true;
<a name="L972"><font color="white">00972</font>	        enemy=xiii;
<a name="L973"><font color="white">00973</font>	    }
<a name="L974"><font color="white">00974</font>	    else if (son==xiii)
<a name="L975"><font color="white">00975</font>	    {
<a name="L976"><font color="white">00976</font>	        bStepNoise=true;
<a name="L977"><font color="white">00977</font>	        enemy=XIII;
<a name="L978"><font color="white">00978</font>	    }
<a name="L979"><font color="white">00979</font>	    if (bWeaponNoise || bImpactNoise || bStepNoise)
<a name="L980"><font color="white">00980</font>	        return true;
<a name="L981"><font color="white">00981</font>	    else
<a name="L982"><font color="white">00982</font>	        return false;
<a name="L983"><font color="white">00983</font>	}
<a name="L984"><font color="white">00984</font>	// ----------------------------------------------------------------------
<a name="L985"><font color="white">00985</font>	// Seeplayer et HeardNoise
<a name="L986"><font color="white">00986</font>	// ----------------------------------------------------------------------
<a name="L987"><font color="white">00987</font>	event Seeplayer(pawn other)
<a name="L988"><font color="white">00988</font>	{
<a name="L989"><font color="white">00989</font>	    if (enemy!=none &amp;&amp; enemy==other)
<a name="L990"><font color="white">00990</font>	        SeeEnemy();
<a name="L991"><font color="white">00991</font>		 else
<a name="L992"><font color="white">00992</font>			  setenemy(XIII);
<a name="L993"><font color="white">00993</font>	}
<a name="L994"><font color="white">00994</font>	event SeeMonster(pawn other)
<a name="L995"><font color="white">00995</font>	{
<a name="L996"><font color="white">00996</font>	    if (enemy!=none &amp;&amp; enemy==other)
<a name="L997"><font color="white">00997</font>	       SeeEnemy();
<a name="L998"><font color="white">00998</font>		 else
<a name="L999"><font color="white">00999</font>			 setenemy(other);
<a name="L1000"><font color="white">01000</font>	}
<a name="L1001"><font color="white">01001</font>	event HearNoise(float Loudness, Actor NoiseMaker)
<a name="L1002"><font color="white">01002</font>	{
<a name="L1003"><font color="white">01003</font>	}
<a name="L1004"><font color="white">01004</font>	event SeeDeadPawn(pawn other)
<a name="L1005"><font color="white">01005</font>	{
<a name="L1006"><font color="white">01006</font>	}
<a name="L1007"><font color="white">01007</font>	Function SeeEnemy()
<a name="L1008"><font color="white">01008</font>	{
<a name="L1009"><font color="white">01009</font>		LastSeenTime = Level.TimeSeconds;
<a name="L1010"><font color="white">01010</font>		LastSeeingPos = Pawn.Location;
<a name="L1011"><font color="white">01011</font>		LastSeenPos = Enemy.Location;
<a name="L1012"><font color="white">01012</font>		EnemyAcquired();
<a name="L1013"><font color="white">01013</font>	}
<a name="L1014"><font color="white">01014</font>	// ----------------------------------------------------------------------
<a name="L1015"><font color="white">01015</font>	// EnemyAcquired
<a name="L1016"><font color="white">01016</font>	// surchargee (non native) dans les etats
<a name="L1017"><font color="white">01017</font>	// ----------------------------------------------------------------------
<a name="L1018"><font color="white">01018</font>	event EnemyAcquired()
<a name="L1019"><font color="white">01019</font>	{
<a name="L1020"><font color="white">01020</font>	}
<a name="L1021"><font color="white">01021</font>	
<a name="L1022"><font color="white">01022</font>	
<a name="L1023"><font color="white">01023</font>	// ----------------------------------------------------------------------
<a name="L1024"><font color="white">01024</font>	// SetVigilant()
<a name="L1025"><font color="white">01025</font>	// ----------------------------------------------------------------------
<a name="L1026"><font color="white">01026</font>	//PeripheralVision passe  180
<a name="L1027"><font color="white">01027</font>	//SightRadius augmente de 50%
<a name="L1028"><font color="white">01028</font>	//HearingThreshold augmente de 50%
<a name="L1029"><font color="white">01029</font>	function SetVigilant(bool bEnAlerte)
<a name="L1030"><font color="white">01030</font>	{
<a name="L1031"><font color="white">01031</font>	    if (bEnAlerte &amp;&amp; bVigilant)
<a name="L1032"><font color="white">01032</font>	        return;
<a name="L1033"><font color="white">01033</font>	    else if (!bEnAlerte &amp;&amp; !bVigilant)
<a name="L1034"><font color="white">01034</font>	        return;
<a name="L1035"><font color="white">01035</font>	
<a name="L1036"><font color="white">01036</font>	    if (bEnAlerte)
<a name="L1037"><font color="white">01037</font>	    {
<a name="L1038"><font color="white">01038</font>	        Pawn.PeripheralVision=fmin(DefaultPeripheralVision,0);
<a name="L1039"><font color="white">01039</font>	        Pawn.SightRadius=1.5*DefaultSightRadius;
<a name="L1040"><font color="white">01040</font>	        Pawn.HearingThreshold=1.5*DefaultHearingThreshold;
<a name="L1041"><font color="white">01041</font>	        bVigilant=true;
<a name="L1042"><font color="white">01042</font>	    }
<a name="L1043"><font color="white">01043</font>	    else
<a name="L1044"><font color="white">01044</font>	    {
<a name="L1045"><font color="white">01045</font>	        Pawn.PeripheralVision=DefaultPeripheralVision;
<a name="L1046"><font color="white">01046</font>	        Pawn.SightRadius=DefaultSightRadius;
<a name="L1047"><font color="white">01047</font>	        Pawn.HearingThreshold=DefaultHearingThreshold;
<a name="L1048"><font color="white">01048</font>	        bVigilant=false;
<a name="L1049"><font color="white">01049</font>	    }
<a name="L1050"><font color="white">01050</font>	}
<a name="L1051"><font color="white">01051</font>	
<a name="L1052"><font color="white">01052</font>	// ----------------------------------------------------------------------
<a name="L1053"><font color="white">01053</font>	// Tick
<a name="L1054"><font color="white">01054</font>	// ----------------------------------------------------------------------
<a name="L1055"><font color="white">01055</font>	event Tick(float DeltaTime)
<a name="L1056"><font color="white">01056</font>	{
<a name="L1057"><font color="white">01057</font>	/*	local xiiiporte porte;
<a name="L1058"><font color="white">01058</font>		 foreach allactors(class'xiiiporte',porte)
<a name="L1059"><font color="white">01059</font>		    Log(porte@&quot;Timer bOpening&quot;@porte.bOpening@&quot;bOpened&quot;@porte.bOpened@&quot;bClosed&quot;@porte.bClosed);
<a name="L1060"><font color="white">01060</font>			 */
<a name="L1061"><font color="white">01061</font>	 //if (enemy!=xiii &amp;&amp; NiveauAlerte&gt;0)
<a name="L1062"><font color="white">01062</font>	      //LOG(pawn@&quot;BUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUUH&quot;@enemy);
<a name="L1063"><font color="white">01063</font>	    super.tick(DeltaTime);
<a name="L1064"><font color="white">01064</font>	/*	 if (btire &amp;&amp; bfire==0)
<a name="L1065"><font color="white">01065</font>			log(&quot;bfiiiiiiiiiiiiire = 0&quot;);  */
<a name="L1066"><font color="white">01066</font>	}
<a name="L1067"><font color="white">01067</font>	
<a name="L1068"><font color="white">01068</font>	// ----------------------------------------------------------------------
<a name="L1069"><font color="white">01069</font>	// DamageAttitudeTo
<a name="L1070"><font color="white">01070</font>	// ----------------------------------------------------------------------
<a name="L1071"><font color="white">01071</font>	singular function DamageAttitudeTo(pawn Other, float Damage)
<a name="L1072"><font color="white">01072</font>	{
<a name="L1073"><font color="white">01073</font>	    //son
<a name="L1074"><font color="white">01074</font>	    bases.PlaySndPNJOno(pnjono'Onomatopees.hPNJHurt',bases.CodeMesh,bases.NumeroTimbre);
<a name="L1075"><font color="white">01075</font>	}
<a name="L1076"><font color="white">01076</font>	
<a name="L1077"><font color="white">01077</font>	// ----------------------------------------------------------------------
<a name="L1078"><font color="white">01078</font>	// NotifyBump
<a name="L1079"><font color="white">01079</font>	// ----------------------------------------------------------------------
<a name="L1080"><font color="white">01080</font>	singular event bool NotifyBump(actor Other)
<a name="L1081"><font color="white">01081</font>	{
<a name="L1082"><font color="white">01082</font>	    if (XIIIporte(other)!=none)
<a name="L1083"><font color="white">01083</font>	    {
<a name="L1084"><font color="white">01084</font>	        prevstate=getstatename();
<a name="L1085"><font color="white">01085</font>		     if (XIIIporte(other).BumpType!=BT_PlayerBump)
<a name="L1086"><font color="white">01086</font>	        {
<a name="L1087"><font color="white">01087</font>	            if (((other.location-pawn.location) dot (vector(pawn.rotation))) &gt; 0.5)
<a name="L1088"><font color="white">01088</font>	            {
<a name="L1089"><font color="white">01089</font>	                HalteAufeu();
<a name="L1090"><font color="white">01090</font>	                PorteOuverte=xiiiporte(other);
<a name="L1091"><font color="white">01091</font>						//log(&quot;porte ouverte?&quot;@porteouverte.bopened@&quot;porte fermee?&quot;@porteouverte.bclosed);
<a name="L1092"><font color="white">01092</font>	                if (PorteOuverte.bClosed)
<a name="L1093"><font color="white">01093</font>	                {
<a name="L1094"><font color="white">01094</font>								log(&quot;porte fermee je l'ouvre&quot;);
<a name="L1095"><font color="white">01095</font>	                    //porteouverte.delaytime+=0.8;
<a name="L1096"><font color="white">01096</font>	                    DestNavPoint=LastPatrolPoint;
<a name="L1097"><font color="white">01097</font>	                    porteouverte.PlayerTrigger(self, Pawn);
<a name="L1098"><font color="white">01098</font>							  if (prevstate=='vavers')
<a name="L1099"><font color="white">01099</font>									bInterruptStateToOpenDoor=true;
<a name="L1100"><font color="white">01100</font>	                    gotostate('ouvreporte');
<a name="L1101"><font color="white">01101</font>	                    return false;
<a name="L1102"><font color="white">01102</font>	                }
<a name="L1103"><font color="white">01103</font>	                else if (!PorteOuverte.bOpened)
<a name="L1104"><font color="white">01104</font>	                {
<a name="L1105"><font color="white">01105</font>							  log(&quot;porte ni fermee ni ouverte&quot;);
<a name="L1106"><font color="white">01106</font>	                    bWaitForMover=true;
<a name="L1107"><font color="white">01107</font>	                    DestNavPoint=LastPatrolPoint;
<a name="L1108"><font color="white">01108</font>							  if (prevstate=='vavers')
<a name="L1109"><font color="white">01109</font>									bInterruptStateToOpenDoor=true;
<a name="L1110"><font color="white">01110</font>	                    gotostate('ouvreporte','PasEnArriere');
<a name="L1111"><font color="white">01111</font>	                    return false;
<a name="L1112"><font color="white">01112</font>	                }
<a name="L1113"><font color="white">01113</font>						 else if (prevstate=='attaque' &amp;&amp; LastBumpedDoor!=porteouverte)
<a name="L1114"><font color="white">01114</font>						 {
<a name="L1115"><font color="white">01115</font>							  LastBumpedDoor=porteouverte;
<a name="L1116"><font color="white">01116</font>							  log(&quot;porte est ouverte&quot;);
<a name="L1117"><font color="white">01117</font>							  if (prevstate=='vavers')
<a name="L1118"><font color="white">01118</font>									bInterruptStateToOpenDoor=true;
<a name="L1119"><font color="white">01119</font>	                    gotostate('ouvreporte','ShiftOnDoorPoint');
<a name="L1120"><font color="white">01120</font>	                    return false;
<a name="L1121"><font color="white">01121</font>	
<a name="L1122"><font color="white">01122</font>						 }
<a name="L1123"><font color="white">01123</font>	                return true;
<a name="L1124"><font color="white">01124</font>	            }
<a name="L1125"><font color="white">01125</font>	            else
<a name="L1126"><font color="white">01126</font>	                return true;
<a name="L1127"><font color="white">01127</font>	        }
<a name="L1128"><font color="white">01128</font>	        if (IsInState('patrouille') &amp;&amp; LastPatrolPoint!=none)
<a name="L1129"><font color="white">01129</font>	        {
<a name="L1130"><font color="white">01130</font>	            focus=none;
<a name="L1131"><font color="white">01131</font>	            focalpoint= LastPatrolPoint.location;
<a name="L1132"><font color="white">01132</font>	            DestNavPoint=LastPatrolPoint;
<a name="L1133"><font color="white">01133</font>	            gotostate('patrouille','patrol');
<a name="L1134"><font color="white">01134</font>	        }
<a name="L1135"><font color="white">01135</font>	        else if (IsInState('chasse'))
<a name="L1136"><font color="white">01136</font>	            gotostate('temporise','recalporte');
<a name="L1137"><font color="white">01137</font>	        else if (bFuitPourreloader)  //si en train de reacharger n'ouvre pas la porte
<a name="L1138"><font color="white">01138</font>	        {
<a name="L1139"><font color="white">01139</font>	            bFuitPourreloader=false;
<a name="L1140"><font color="white">01140</font>	            gotostate('attaque');
<a name="L1141"><font color="white">01141</font>	        }
<a name="L1142"><font color="white">01142</font>	        return false;
<a name="L1143"><font color="white">01143</font>	    }
<a name="L1144"><font color="white">01144</font>	    /*else
<a name="L1145"><font color="white">01145</font>	    {
<a name="L1146"><font color="white">01146</font>	    log(&quot;touche une caisse&quot;);
<a name="L1147"><font color="white">01147</font>	    pawn.velocity=vect(0,0,0);
<a name="L1148"><font color="white">01148</font>	    pawn.acceleration=vect(0,0,0);
<a name="L1149"><font color="white">01149</font>	    gotostate(getstatename());
<a name="L1150"><font color="white">01150</font>	}   */
<a name="L1151"><font color="white">01151</font>	
<a name="L1152"><font color="white">01152</font>	    return false;
<a name="L1153"><font color="white">01153</font>	}
<a name="L1154"><font color="white">01154</font>	
<a name="L1155"><font color="white">01155</font>	//------------------------------------------------
<a name="L1156"><font color="white">01156</font>	// TRIGGER: Fonction Trigger declenchee par detectionvolume ou trigger alarme
<a name="L1157"><font color="white">01157</font>	//------------------------------------------------
<a name="L1158"><font color="white">01158</font>	event Trigger( actor Other, pawn EventInstigator)
<a name="L1159"><font color="white">01159</font>	{
<a name="L1160"><font color="white">01160</font>	    //NB: les actorreachable ont ete remplace par des fasttrace pour probleme de physique none
<a name="L1161"><font color="white">01161</font>	    local DetectionVolume  DEtectV;
<a name="L1162"><font color="white">01162</font>	    local int i;
<a name="L1163"><font color="white">01163</font>		 local actor Path;
<a name="L1164"><font color="white">01164</font>	
<a name="L1165"><font color="white">01165</font>	   if (XIIIPorte(other)!=none &amp;&amp; XIIIPorte(other).bAlertIfSeenOpen)
<a name="L1166"><font color="white">01166</font>	    {
<a name="L1167"><font color="white">01167</font>	        //son
<a name="L1168"><font color="white">01168</font>	        pawn.PlaySndPNJOno(pnjono'Onomatopees.hPNJDetect',bases.CodeMesh,bases.NumeroTimbre);
<a name="L1169"><font color="white">01169</font>	        MoveTarget=none;
<a name="L1170"><font color="white">01170</font>	        If (fasttrace(XIIIPorte(other).PointArrivee.location))
<a name="L1171"><font color="white">01171</font>	        {
<a name="L1172"><font color="white">01172</font>	            MoveActor.MoveActor=XIIIPorte(other).PointArrivee;
<a name="L1173"><font color="white">01173</font>	            MoveActor.bReachable=true;
<a name="L1174"><font color="white">01174</font>	            enemy=xiii;
<a name="L1175"><font color="white">01175</font>	            Nextstate='investigation';
<a name="L1176"><font color="white">01176</font>	            gotostate('vavers');
<a name="L1177"><font color="white">01177</font>	            return;
<a name="L1178"><font color="white">01178</font>	        }
<a name="L1179"><font color="white">01179</font>	        else if (FindBestPathToward(XIIIPorte(other).PointArrivee))
<a name="L1180"><font color="white">01180</font>	        {
<a name="L1181"><font color="white">01181</font>	            MoveActor.MoveActor=XIIIPorte(other).PointArrivee;
<a name="L1182"><font color="white">01182</font>	            MoveActor.bReachable=false;
<a name="L1183"><font color="white">01183</font>	            for (i=0;i&lt;16;i++)
<a name="L1184"><font color="white">01184</font>	            {
<a name="L1185"><font color="white">01185</font>	                if (routecache[i]==none)
<a name="L1186"><font color="white">01186</font>	                    break;
<a name="L1187"><font color="white">01187</font>	                PointChemin[i]=routecache[i];
<a name="L1188"><font color="white">01188</font>	            }
<a name="L1189"><font color="white">01189</font>	            Nextstate='investigation';
<a name="L1190"><font color="white">01190</font>	            enemy=xiii;
<a name="L1191"><font color="white">01191</font>	            gotostate('vavers');
<a name="L1192"><font color="white">01192</font>	            return;
<a name="L1193"><font color="white">01193</font>	        }
<a name="L1194"><font color="white">01194</font>	    }
<a name="L1195"><font color="white">01195</font>	    else if (other.isa('explosif') || other.isa('VehicleDeco'))
<a name="L1196"><font color="white">01196</font>	    {
<a name="L1197"><font color="white">01197</font>	//log(pawn@&quot;1111111111111111111111111111111&quot;@fasttrace(other.location)@FindPathToward(other,true));
<a name="L1198"><font color="white">01198</font>	        MoveTarget=none;
<a name="L1199"><font color="white">01199</font>	        If (fasttrace(other.location))
<a name="L1200"><font color="white">01200</font>	        {
<a name="L1201"><font color="white">01201</font>	            MovePoint.MovePoint=other.location;
<a name="L1202"><font color="white">01202</font>	            MovePoint.bTraceable=true;
<a name="L1203"><font color="white">01203</font>	            enemy=xiii;
<a name="L1204"><font color="white">01204</font>	            Nextstate='investigation';
<a name="L1205"><font color="white">01205</font>	            gotostate('vavers');
<a name="L1206"><font color="white">01206</font>	            return;
<a name="L1207"><font color="white">01207</font>	        }
<a name="L1208"><font color="white">01208</font>	        else
<a name="L1209"><font color="white">01209</font>	        {
<a name="L1210"><font color="white">01210</font>					path=FindPathToward(other,true);
<a name="L1211"><font color="white">01211</font>	            if (path!=none)
<a name="L1212"><font color="white">01212</font>	            {
<a name="L1213"><font color="white">01213</font>		            MovePoint.MovePoint=other.location;
<a name="L1214"><font color="white">01214</font>						MovePoint.bTraceable=false;
<a name="L1215"><font color="white">01215</font>						enemy=xiii;
<a name="L1216"><font color="white">01216</font>						for (i=0;i&lt;16;i++)
<a name="L1217"><font color="white">01217</font>						{
<a name="L1218"><font color="white">01218</font>							if (routecache[i]==none)
<a name="L1219"><font color="white">01219</font>								break;
<a name="L1220"><font color="white">01220</font>							PointChemin[i]=routecache[i];
<a name="L1221"><font color="white">01221</font>						}
<a name="L1222"><font color="white">01222</font>						NbPointChemin=i;
<a name="L1223"><font color="white">01223</font>						Nextstate='investigation';
<a name="L1224"><font color="white">01224</font>						gotostate('vavers');
<a name="L1225"><font color="white">01225</font>						return;
<a name="L1226"><font color="white">01226</font>	            }
<a name="L1227"><font color="white">01227</font>	        }
<a name="L1228"><font color="white">01228</font>	    }
<a name="L1229"><font color="white">01229</font>	    else
<a name="L1230"><font color="white">01230</font>	    {
<a name="L1231"><font color="white">01231</font>	        if (Etatneutre=='tenir' || Etatneutre=='garder')
<a name="L1232"><font color="white">01232</font>	            Etatneutre='patrouille';
<a name="L1233"><font color="white">01233</font>	        DetectV=detectionvolume(other);
<a name="L1234"><font color="white">01234</font>	        if (DetectV!=none &amp;&amp; eventinstigator!=none)
<a name="L1235"><font color="white">01235</font>	            enemy=eventinstigator;
<a name="L1236"><font color="white">01236</font>	        else if (enemy==none)
<a name="L1237"><font color="white">01237</font>	        {
<a name="L1238"><font color="white">01238</font>	            enemy=cherchenmiplusproche();
<a name="L1239"><font color="white">01239</font>	            if (enemy==none)     //blindage
<a name="L1240"><font color="white">01240</font>	                enemy=xiii;
<a name="L1241"><font color="white">01241</font>	        }
<a name="L1242"><font color="white">01242</font>	        if (DetectV!=none &amp;&amp; eventinstigator!=none &amp;&amp; DetectV.bLocalizeEnemy)
<a name="L1243"><font color="white">01243</font>	        {
<a name="L1244"><font color="white">01244</font>	            pawn.sightradius= Vsize(enemy.location-pawn.location)+200;
<a name="L1245"><font color="white">01245</font>	            HalteAuFeu();
<a name="L1246"><font color="white">01246</font>	            gotostate('acquisition');
<a name="L1247"><font color="white">01247</font>	            return;
<a name="L1248"><font color="white">01248</font>	        }
<a name="L1249"><font color="white">01249</font>	        if (bases.NumReseauAttaque!=0 &amp;&amp; bases.bPasseAttScr_SiDeclenche)
<a name="L1250"><font color="white">01250</font>	        {
<a name="L1251"><font color="white">01251</font>	            LastAttackPoint=none;
<a name="L1252"><font color="white">01252</font>	            LastAttackPoint=chercheAttackPoint();
<a name="L1253"><font color="white">01253</font>	            if (lastAttackPoint!=none) //AttackPoint plus pres que enemy
<a name="L1254"><font color="white">01254</font>	            {
<a name="L1255"><font color="white">01255</font>	                MoveTarget=none;
<a name="L1256"><font color="white">01256</font>	                if (fasttrace(LastAttackPoint.location) || FindBestPathToward(LastAttackPoint))
<a name="L1257"><font color="white">01257</font>	                {
<a name="L1258"><font color="white">01258</font>	                    HalteAuFeu();
<a name="L1259"><font color="white">01259</font>							  if (!bdejavu) bDejaVu = true;
<a name="L1260"><font color="white">01260</font>	                    gotostate('AttaqueScriptee');
<a name="L1261"><font color="white">01261</font>	                    return;
<a name="L1262"><font color="white">01262</font>	                }
<a name="L1263"><font color="white">01263</font>	            }
<a name="L1264"><font color="white">01264</font>	        }
<a name="L1265"><font color="white">01265</font>	        enemy=none;
<a name="L1266"><font color="white">01266</font>	        HalteAuFeu();
<a name="L1267"><font color="white">01267</font>	        gotostate('patrouille');
<a name="L1268"><font color="white">01268</font>	        return;
<a name="L1269"><font color="white">01269</font>	    }
<a name="L1270"><font color="white">01270</font>	}
<a name="L1271"><font color="white">01271</font>	
<a name="L1272"><font color="white">01272</font>	
<a name="L1273"><font color="white">01273</font>	// ----------------------------------------------------------------------
<a name="L1274"><font color="white">01274</font>	// ReceiveWarning
<a name="L1275"><font color="white">01275</font>	//
<a name="L1276"><font color="white">01276</font>	// ----------------------------------------------------------------------
<a name="L1277"><font color="white">01277</font>	function ReceiveWarning(Pawn shooter, float projSpeed, vector FireDir)
<a name="L1278"><font color="white">01278</font>	{
<a name="L1279"><font color="white">01279</font>	}
<a name="L1280"><font color="white">01280</font>	
<a name="L1281"><font color="white">01281</font>	
<a name="L1282"><font color="white">01282</font>	
<a name="L1283"><font color="white">01283</font>	
<a name="L1284"><font color="white">01284</font>	
<a name="L1285"><font color="white">01285</font>	
<a name="L1286"><font color="white">01286</font>	// ----------------------------------------------------------------------
<a name="L1287"><font color="white">01287</font>	// Timer
<a name="L1288"><font color="white">01288</font>	// ----------------------------------------------------------------------
<a name="L1289"><font color="white">01289</font>	event Timer()
<a name="L1290"><font color="white">01290</font>	{
<a name="L1291"><font color="white">01291</font>	    local float ProduitScal;
<a name="L1292"><font color="white">01292</font>	    local bool bLigneDeVIsee;
<a name="L1293"><font color="white">01293</font>	
<a name="L1294"><font color="white">01294</font>	    if (bTire)
<a name="L1295"><font color="white">01295</font>	    {
<a name="L1296"><font color="white">01296</font>	        if ((enemy==none) || enemy.bisdead)
<a name="L1297"><font color="white">01297</font>	        {
<a name="L1298"><font color="white">01298</font>	            changeEtat();
<a name="L1299"><font color="white">01299</font>	        }
<a name="L1300"><font color="white">01300</font>			  if (bTirSurConeMax)
<a name="L1301"><font color="white">01301</font>				  bTirSurConeMax=false;
<a name="L1302"><font color="white">01302</font>	        //+++++++++++++++  Gestion otage      +++++++++++++++++++++++++
<a name="L1303"><font color="white">01303</font>	        if (enemy!=xiii || !(xiii.bPrisonner &amp;&amp; XIII.LHand.pOnShoulder!=none &amp;&amp; AllianceLevel(XIII.LHand.pOnShoulder)==1))
<a name="L1304"><font color="white">01304</font>	        {
<a name="L1305"><font color="white">01305</font>	            if (bPrisonnier)
<a name="L1306"><font color="white">01306</font>	            {
<a name="L1307"><font color="white">01307</font>	                bPrecedentTirBloque=false;
<a name="L1308"><font color="white">01308</font>	                bPrisonnier=false;
<a name="L1309"><font color="white">01309</font>	            }
<a name="L1310"><font color="white">01310</font>	            bFire=1;
<a name="L1311"><font color="white">01311</font>	            pawn.weapon.fire(1.0);
<a name="L1312"><font color="white">01312</font>	        }
<a name="L1313"><font color="white">01313</font>	        else
<a name="L1314"><font color="white">01314</font>	        {
<a name="L1315"><font color="white">01315</font>	            bLigneDeVIsee=false;
<a name="L1316"><font color="white">01316</font>	            if (!bPrisonnier)
<a name="L1317"><font color="white">01317</font>	            {
<a name="L1318"><font color="white">01318</font>	                bPrecedentTirBloque=false;
<a name="L1319"><font color="white">01319</font>	                bPrisonnier=true;
<a name="L1320"><font color="white">01320</font>	            }
<a name="L1321"><font color="white">01321</font>	  				//tir possible sans toucher pote (skill=2&amp;3)
<a name="L1322"><font color="white">01322</font>	            ProduitScal=normal(vector(enemy.rotation)) dot normal(pawn.location-enemy.location);
<a name="L1323"><font color="white">01323</font>	            if (ProduitScal &lt;0.5)
<a name="L1324"><font color="white">01324</font>	            {
<a name="L1325"><font color="white">01325</font>	                if (CHARGE_LES_LOGS) log(pawn$&quot;j'ai une ligne de visee, j'allume   *** !!!!! **** &quot;);
<a name="L1326"><font color="white">01326</font>	                bLigneDeVIsee=true;
<a name="L1327"><font color="white">01327</font>	            }
<a name="L1328"><font color="white">01328</font>	            if (NbCoupsRiposte&gt;0 || bLigneDeVIsee)
<a name="L1329"><font color="white">01329</font>	            {
<a name="L1330"><font color="white">01330</font>	                if (bPrecedentTirBloque &amp;&amp; bLigneDeVIsee)
<a name="L1331"><font color="white">01331</font>	                {
<a name="L1332"><font color="white">01332</font>	                    if (CHARGE_LES_LOGS) log(pawn$&quot;MAINTENANT LE TIR N'EST PLUS BLOQUE   !!!!!!!!!!!&quot;);
<a name="L1333"><font color="white">01333</font>	                    bPrecedentTirBloque=false;
<a name="L1334"><font color="white">01334</font>	                    settimer(0.5,false);
<a name="L1335"><font color="white">01335</font>	                    return;
<a name="L1336"><font color="white">01336</font>	                }
<a name="L1337"><font color="white">01337</font>	                bFire=1;
<a name="L1338"><font color="white">01338</font>	                pawn.weapon.fire(1.0);
<a name="L1339"><font color="white">01339</font>	                NbCoupsRiposte--;
<a name="L1340"><font color="white">01340</font>	            }
<a name="L1341"><font color="white">01341</font>	            else
<a name="L1342"><font color="white">01342</font>	            {
<a name="L1343"><font color="white">01343</font>	                if (CHARGE_LES_LOGS)  log(pawn$&quot;TIR BLOQUE             !!!!!!!!!!!!&quot;);
<a name="L1344"><font color="white">01344</font>	                bPrecedentTirBloque=true;
<a name="L1345"><font color="white">01345</font>	                bfire=0;
<a name="L1346"><font color="white">01346</font>	            }
<a name="L1347"><font color="white">01347</font>	
<a name="L1348"><font color="white">01348</font>	        }
<a name="L1349"><font color="white">01349</font>	
<a name="L1350"><font color="white">01350</font>	        //++++++++++++++++++++++++++++++++++
<a name="L1351"><font color="white">01351</font>	        if (pawn.weapon.WeaponMode==WM_Auto)
<a name="L1352"><font color="white">01352</font>	        {
<a name="L1353"><font color="white">01353</font>					if (bPremiereRafale)
<a name="L1354"><font color="white">01354</font>					{
<a name="L1355"><font color="white">01355</font>						bPremiereRafale=false;
<a name="L1356"><font color="white">01356</font>						if (!pawn.weapon.bmeleeweapon &amp;&amp; enemy==xiii &amp;&amp; ((pawn.location-xiii.location) dot (vector(XIII.rotation)))&lt;0)
<a name="L1357"><font color="white">01357</font>				   		bTirSurConeMax=true;
<a name="L1358"><font color="white">01358</font>					}
<a name="L1359"><font color="white">01359</font>	            if (bPrisonnier)
<a name="L1360"><font color="white">01360</font>	                settimer(FireTimerRefresh*0.8,false); // refresh de l'otage en ligne de mire
<a name="L1361"><font color="white">01361</font>	            else
<a name="L1362"><font color="white">01362</font>	            {
<a name="L1363"><font color="white">01363</font>	                if (bencouverture)
<a name="L1364"><font color="white">01364</font>	                {
<a name="L1365"><font color="white">01365</font>	                    settimer(0,false);
<a name="L1366"><font color="white">01366</font>	                    settimer2(0.8,false);
<a name="L1367"><font color="white">01367</font>	                }
<a name="L1368"><font color="white">01368</font>	                else
<a name="L1369"><font color="white">01369</font>	                {
<a name="L1370"><font color="white">01370</font>	                    settimer(FireTimerRefresh,false); // pour tester si reste muns
<a name="L1371"><font color="white">01371</font>	                    Settimer2(0,false);
<a name="L1372"><font color="white">01372</font>	                }
<a name="L1373"><font color="white">01373</font>	            }
<a name="L1374"><font color="white">01374</font>	        }
<a name="L1375"><font color="white">01375</font>	        else
<a name="L1376"><font color="white">01376</font>	        {
<a name="L1377"><font color="white">01377</font>	            bfire=0;
<a name="L1378"><font color="white">01378</font>					settimer(XIIIWeapon(pawn.weapon).shottime + bases.OffsetTimeBetweenShots,false);
<a name="L1379"><font color="white">01379</font>	        }
<a name="L1380"><font color="white">01380</font>	    }
<a name="L1381"><font color="white">01381</font>	}
<a name="L1382"><font color="white">01382</font>	event timer2()
<a name="L1383"><font color="white">01383</font>	{
<a name="L1384"><font color="white">01384</font>	}
<a name="L1385"><font color="white">01385</font>	
<a name="L1386"><font color="white">01386</font>	event Timer3()
<a name="L1387"><font color="white">01387</font>	{
<a name="L1388"><font color="white">01388</font>		bARienVu=false;
<a name="L1389"><font color="white">01389</font>	}
<a name="L1390"><font color="white">01390</font>	
<a name="L1391"><font color="white">01391</font>	// ----------------------------------------------------------------------
<a name="L1392"><font color="white">01392</font>	// Adjust Aim
<a name="L1393"><font color="white">01393</font>	// ----------------------------------------------------------------------
<a name="L1394"><font color="white">01394</font>	function rotator AdjustAim(Ammunition FiredAmmunition, vector projStart, int aimerror)
<a name="L1395"><font color="white">01395</font>	{
<a name="L1396"><font color="white">01396</font>	    //log(pawn$&quot;$$$$$$$$$$$$$$$$                       adjustaim&quot;$projStart);
<a name="L1397"><font color="white">01397</font>	    if (enemy!=none)
<a name="L1398"><font color="white">01398</font>	    {
<a name="L1399"><font color="white">01399</font>	        return rotator(DirectionTir-projStart);
<a name="L1400"><font color="white">01400</font>	    }
<a name="L1401"><font color="white">01401</font>	    else
<a name="L1402"><font color="white">01402</font>	    {
<a name="L1403"><font color="white">01403</font>	        return rotation;
<a name="L1404"><font color="white">01404</font>	        log(pawn$&quot; ATTENTION TIR SANS ENEMY BUGGGGGGGGGGGGGGGGGGGGGGGGGGGGG !!!!&quot;);
<a name="L1405"><font color="white">01405</font>	    }
<a name="L1406"><font color="white">01406</font>	}
<a name="L1407"><font color="white">01407</font>	
<a name="L1408"><font color="white">01408</font>	// ----------------------------------------------------------------------
<a name="L1409"><font color="white">01409</font>	//  LineOfFireObstacle()
<a name="L1410"><font color="white">01410</font>	//
<a name="L1411"><font color="white">01411</font>	//retourne type de perso
<a name="L1412"><font color="white">01412</font>	//=0 ligne de mire libre (rien, enemy ou breakable avec bcanseethrought)
<a name="L1413"><font color="white">01413</font>	//=1 un pote (la var pote est actualisee)
<a name="L1414"><font color="white">01414</font>	//=2 il y autre chose devant
<a name="L1415"><font color="white">01415</font>	// ----------------------------------------------------------------------
<a name="L1416"><font color="white">01416</font>	native function int LineOfFireObstacle();
<a name="L1417"><font color="white">01417</font>	
<a name="L1418"><font color="white">01418</font>	
<a name="L1419"><font color="white">01419</font>	// ----------------------------------------------------------------------
<a name="L1420"><font color="white">01420</font>	//  CheckLineOfFire()           //pote MAJ
<a name="L1421"><font color="white">01421</font>	//
<a name="L1422"><font color="white">01422</font>	//declenche pas sur le cote si pote devant
<a name="L1423"><font color="white">01423</font>	//et passe en chasse si peut pas tirer
<a name="L1424"><font color="white">01424</font>	// ----------------------------------------------------------------------
<a name="L1425"><font color="white">01425</font>	function CheckLineOfFire()
<a name="L1426"><font color="white">01426</font>	{
<a name="L1427"><font color="white">01427</font>	    local vector Temp_vector;
<a name="L1428"><font color="white">01428</font>	    local int TypeObstacle;
<a name="L1429"><font color="white">01429</font>	
<a name="L1430"><font color="white">01430</font>	    Temp_vector=Normal(enemy.location - WeaponStartTrace);
<a name="L1431"><font color="white">01431</font>	    TypeObstacle=LineOfFireObstacle();
<a name="L1432"><font color="white">01432</font>	    //  log(&quot;type d'obstacle&quot;@TypeObstacle);
<a name="L1433"><font color="white">01433</font>	    if (TypeObstacle!=1)  //rien devant ou breakable transparent
<a name="L1434"><font color="white">01434</font>	    {
<a name="L1435"><font color="white">01435</font>	        return;
<a name="L1436"><font color="white">01436</font>	    }
<a name="L1437"><font color="white">01437</font>	    else if (TypeObstacle==1)   //pote devant
<a name="L1438"><font color="white">01438</font>	    {
<a name="L1439"><font color="white">01439</font>	        if (bases.order=='garder')     //si garder ne se deplace pas
<a name="L1440"><font color="white">01440</font>	        {
<a name="L1441"><font color="white">01441</font>	            settimer(1,false);
<a name="L1442"><font color="white">01442</font>	            bfire=0; //bloc tir
<a name="L1443"><font color="white">01443</font>	            return;
<a name="L1444"><font color="white">01444</font>	        }
<a name="L1445"><font color="white">01445</font>	        HalteAuFeu();
<a name="L1446"><font color="white">01446</font>	        if (bEncouverture)
<a name="L1447"><font color="white">01447</font>	            pawn.shouldcrouch(false);
<a name="L1448"><font color="white">01448</font>	        if ((((pote.location-pawn.location) cross vect(0,0,1)) dot temp_vector)&lt;0)
<a name="L1449"><font color="white">01449</font>	            gotostate('TacticalMove','PositionTirSurDroite');
<a name="L1450"><font color="white">01450</font>	        else
<a name="L1451"><font color="white">01451</font>	            gotostate('TacticalMove','PositionTirSurGauche');
<a name="L1452"><font color="white">01452</font>	        return;
<a name="L1453"><font color="white">01453</font>	    }
<a name="L1454"><font color="white">01454</font>	   /* else if (TypeObstacle==2)    //tir bloque
<a name="L1455"><font color="white">01455</font>	    {
<a name="L1456"><font color="white">01456</font>	        if (bases.order=='garder')     //si garder ne se deplace pas
<a name="L1457"><font color="white">01457</font>	        {
<a name="L1458"><font color="white">01458</font>	            settimer(1,false);
<a name="L1459"><font color="white">01459</font>	            bfire=0; //bloc tir
<a name="L1460"><font color="white">01460</font>	            return;
<a name="L1461"><font color="white">01461</font>	        }
<a name="L1462"><font color="white">01462</font>	        HalteAuFeu();
<a name="L1463"><font color="white">01463</font>	        //log(&quot;mon tir est bloque &quot;);
<a name="L1464"><font color="white">01464</font>	        gotostate('chasse');
<a name="L1465"><font color="white">01465</font>	    }    */
<a name="L1466"><font color="white">01466</font>	}
<a name="L1467"><font color="white">01467</font>	
<a name="L1468"><font color="white">01468</font>	// ----------------------------------------------------------------------
<a name="L1469"><font color="white">01469</font>	// DirectionDuTir()  //avant dispersion
<a name="L1470"><font color="white">01470</font>	//  Mise a jour de AnleDispersion et point de depart du tir (WeaponStartTrace)
<a name="L1471"><font color="white">01471</font>	// ----------------------------------------------------------------------
<a name="L1472"><font color="white">01472</font>	native function vector DirectionDuTir();
<a name="L1473"><font color="white">01473</font>	
<a name="L1474"><font color="white">01474</font>	// ----------------------------------------------------------------------
<a name="L1475"><font color="white">01475</font>	// LigneVisee()
<a name="L1476"><font color="white">01476</font>	// ----------------------------------------------------------------------
<a name="L1477"><font color="white">01477</font>	//permet de savoir si je peut tirer sur le perso (pour eviter de tirer dans les murs)
<a name="L1478"><font color="white">01478</font>	//collisionne avec level, levelgeometrie et mover
<a name="L1479"><font color="white">01479</font>	native function bool LigneVisee(vector TraceEnd, vector TraceStart);
<a name="L1480"><font color="white">01480</font>	
<a name="L1481"><font color="white">01481</font>	// ----------------------------------------------------------------------
<a name="L1482"><font color="white">01482</font>	// TestDirection()
<a name="L1483"><font color="white">01483</font>	// ----------------------------------------------------------------------
<a name="L1484"><font color="white">01484</font>	//test le deplacement dans une direction (en collisionnant tout),suggere une position intermediaire
<a name="L1485"><font color="white">01485</font>	// sica passe pas et renvoi vrai si le deplacement suggere est superieur a une distance minimal e
<a name="L1486"><font color="white">01486</font>	native function bool TestDirection(float mindist,float dist,vector dir, out vector pick);
<a name="L1487"><font color="white">01487</font>	
<a name="L1488"><font color="white">01488</font>	// ----------------------------------------------------------------------
<a name="L1489"><font color="white">01489</font>	// FireEnemy
<a name="L1490"><font color="white">01490</font>	// ----------------------------------------------------------------------
<a name="L1491"><font color="white">01491</font>	function FireEnemy()
<a name="L1492"><font color="white">01492</font>	{
<a name="L1493"><font color="white">01493</font>	    local float Temps_Acqui;
<a name="L1494"><font color="white">01494</font>	
<a name="L1495"><font color="white">01495</font>	    if (!bTire)
<a name="L1496"><font color="white">01496</font>	    {
<a name="L1497"><font color="white">01497</font>	        if ((enemy!=none) &amp;&amp; !enemy.bisdead)
<a name="L1498"><font color="white">01498</font>	        {
<a name="L1499"><font color="white">01499</font>	            bases.bEnableSpineControl=true;
<a name="L1500"><font color="white">01500</font>					Focus=enemy;
<a name="L1501"><font color="white">01501</font>	            focalpoint=enemy.location;
<a name="L1502"><font color="white">01502</font>	            bTire = true;
<a name="L1503"><font color="white">01503</font>					//log(&quot;pawn.weapon.inventorygroup&quot;@pawn.weapon.inventorygroup);
<a name="L1504"><font color="white">01504</font>					if (pawn.weapon.inventorygroup==0 || pawn.weapon.inventorygroup==4)
<a name="L1505"><font color="white">01505</font>					{
<a name="L1506"><font color="white">01506</font>						//log(&quot;fireenemy c'est une grenade&quot;);
<a name="L1507"><font color="white">01507</font>						timer();
<a name="L1508"><font color="white">01508</font>					}
<a name="L1509"><font color="white">01509</font>					else if (bEtatAlerte) //points ou grenade
<a name="L1510"><font color="white">01510</font>					{
<a name="L1511"><font color="white">01511</font>	                Temps_Acqui=FMax(0.1,Vsize(pawn.location-enemy.location)*bases.TempsVisee*0.25/2000);
<a name="L1512"><font color="white">01512</font>						 setTimer(Temps_Acqui,false);
<a name="L1513"><font color="white">01513</font>					}
<a name="L1514"><font color="white">01514</font>	            else
<a name="L1515"><font color="white">01515</font>					{
<a name="L1516"><font color="white">01516</font>	                Temps_Acqui=FMax(0.4,Vsize(pawn.location-enemy.location)*bases.TempsVisee/2000);
<a name="L1517"><font color="white">01517</font>						 setTimer(Temps_Acqui,false);
<a name="L1518"><font color="white">01518</font>					}
<a name="L1519"><font color="white">01519</font>	        }
<a name="L1520"><font color="white">01520</font>	        else
<a name="L1521"><font color="white">01521</font>	        {
<a name="L1522"><font color="white">01522</font>	            changeEtat();
<a name="L1523"><font color="white">01523</font>	        }
<a name="L1524"><font color="white">01524</font>	    }
<a name="L1525"><font color="white">01525</font>	}
<a name="L1526"><font color="white">01526</font>	
<a name="L1527"><font color="white">01527</font>	// ----------------------------------------------------------------------
<a name="L1528"><font color="white">01528</font>	// HalteAuFeu
<a name="L1529"><font color="white">01529</font>	// ----------------------------------------------------------------------
<a name="L1530"><font color="white">01530</font>	native function HalteAuFeu();
<a name="L1531"><font color="white">01531</font>	
<a name="L1532"><font color="white">01532</font>	// ----------------------------------------------------------------------
<a name="L1533"><font color="white">01533</font>	// NotifyFiring
<a name="L1534"><font color="white">01534</font>	// ----------------------------------------------------------------------
<a name="L1535"><font color="white">01535</font>	function NotifyFiring()
<a name="L1536"><font color="white">01536</font>	{
<a name="L1537"><font color="white">01537</font>	}
<a name="L1538"><font color="white">01538</font>	// ----------------------------------------------------------------------
<a name="L1539"><font color="white">01539</font>	// PseudoSteering
<a name="L1540"><font color="white">01540</font>	// pseudo steering pour les deplacements en combat
<a name="L1541"><font color="white">01541</font>	// ----------------------------------------------------------------------
<a name="L1542"><font color="white">01542</font>	native function vector PseudoSteering();
<a name="L1543"><font color="white">01543</font>	
<a name="L1544"><font color="white">01544</font>	
<a name="L1545"><font color="white">01545</font>	// ----------------------------------------------------------------------
<a name="L1546"><font color="white">01546</font>	// PickStartPoint
<a name="L1547"><font color="white">01547</font>	//
<a name="L1548"><font color="white">01548</font>	// prend point de depart pour patrouille
<a name="L1549"><font color="white">01549</font>	// ----------------------------------------------------------------------
<a name="L1550"><font color="white">01550</font>	native function PatrolPoint PickStartPoint();
<a name="L1551"><font color="white">01551</font>	
<a name="L1552"><font color="white">01552</font>	// ----------------------------------------------------------------------
<a name="L1553"><font color="white">01553</font>	// FindNewStakeOutDir
<a name="L1554"><font color="white">01554</font>	//
<a name="L1555"><font color="white">01555</font>	// trouve point de visee dans temporise
<a name="L1556"><font color="white">01556</font>	// ----------------------------------------------------------------------
<a name="L1557"><font color="white">01557</font>	native function FindNewStakeOutDir();
<a name="L1558"><font color="white">01558</font>	/*   {
<a name="L1559"><font color="white">01559</font>	local NavigationPoint N, Best;
<a name="L1560"><font color="white">01560</font>	local vector Dir, EnemyDir;
<a name="L1561"><font color="white">01561</font>	local float Dist, BestVal, Val;
<a name="L1562"><font color="white">01562</font>	
<a name="L1563"><font color="white">01563</font>	  EnemyDir = Normal(Enemy.Location - Pawn.Location);
<a name="L1564"><font color="white">01564</font>	  for ( N=Level.NavigationPointList; N!=None; N=N.NextNavigationPoint )
<a name="L1565"><font color="white">01565</font>	  {
<a name="L1566"><font color="white">01566</font>	  Dir = N.Location - Pawn.Location;
<a name="L1567"><font color="white">01567</font>	  Dist = VSize(Dir);
<a name="L1568"><font color="white">01568</font>	  if (Dist&lt;800 &amp;&amp; Dist&gt;100)
<a name="L1569"><font color="white">01569</font>	  {
<a name="L1570"><font color="white">01570</font>	  Val = (EnemyDir Dot Dir/Dist);
<a name="L1571"><font color="white">01571</font>	  if ((Val &gt; BestVal) &amp;&amp; LineOfSightTo(N))
<a name="L1572"><font color="white">01572</font>	  {
<a name="L1573"><font color="white">01573</font>	  BestVal = Val;
<a name="L1574"><font color="white">01574</font>	  Best = N;
<a name="L1575"><font color="white">01575</font>	  }
<a name="L1576"><font color="white">01576</font>	  }
<a name="L1577"><font color="white">01577</font>	  }
<a name="L1578"><font color="white">01578</font>	  if ( Best != None )
<a name="L1579"><font color="white">01579</font>	  LastSeenPos = Best.Location + 0.5 * Pawn.CollisionHeight * vect(0,0,1);
<a name="L1580"><font color="white">01580</font>	    }*/
<a name="L1581"><font color="white">01581</font>	// ----------------------------------------------------------------------
<a name="L1582"><font color="white">01582</font>	// GetFacingDirection
<a name="L1583"><font color="white">01583</font>	// ----------------------------------------------------------------------
<a name="L1584"><font color="white">01584</font>	function int GetFacingDirection()
<a name="L1585"><font color="white">01585</font>	{
<a name="L1586"><font color="white">01586</font>	    local vector X,Y,Z, Dir;
<a name="L1587"><font color="white">01587</font>	
<a name="L1588"><font color="white">01588</font>	    GetAxes(Pawn.Rotation, X,Y,Z);
<a name="L1589"><font color="white">01589</font>	    Dir = Normal(Pawn.Velocity);
<a name="L1590"><font color="white">01590</font>	
<a name="L1591"><font color="white">01591</font>	    if ( Y Dot Dir &gt; 0 )
<a name="L1592"><font color="white">01592</font>	        return ( 49152 + 16384 * (X Dot Dir) );
<a name="L1593"><font color="white">01593</font>	    else
<a name="L1594"><font color="white">01594</font>	        return ( 16384 - 16384 * (X Dot Dir) );
<a name="L1595"><font color="white">01595</font>	}
<a name="L1596"><font color="white">01596</font>	// ----------------------------------------------------------------------
<a name="L1597"><font color="white">01597</font>	// MoverFinished
<a name="L1598"><font color="white">01598</font>	// ----------------------------------------------------------------------
<a name="L1599"><font color="white">01599</font>	function MoverFinished()
<a name="L1600"><font color="white">01600</font>	{
<a name="L1601"><font color="white">01601</font>	}
<a name="L1602"><font color="white">01602</font>	// ----------------------------------------------------------------------
<a name="L1603"><font color="white">01603</font>	// Mayfall
<a name="L1604"><font color="white">01604</font>	// ----------------------------------------------------------------------
<a name="L1605"><font color="white">01605</font>	event MayFall()
<a name="L1606"><font color="white">01606</font>	{
<a name="L1607"><font color="white">01607</font>	}
<a name="L1608"><font color="white">01608</font>	function PawnDied()
<a name="L1609"><font color="white">01609</font>	{
<a name="L1610"><font color="white">01610</font>	    if ( Pawn != None )
<a name="L1611"><font color="white">01611</font>	    {
<a name="L1612"><font color="white">01612</font>	        SetLocation(Pawn.Location);
<a name="L1613"><font color="white">01613</font>	        Pawn.UnPossessed();
<a name="L1614"><font color="white">01614</font>	    }
<a name="L1615"><font color="white">01615</font>	    gotostate('mort');
<a name="L1616"><font color="white">01616</font>	    Pawn = None;
<a name="L1617"><font color="white">01617</font>	    PendingMover = None;
<a name="L1618"><font color="white">01618</font>	    //bstasis=true;
<a name="L1619"><font color="white">01619</font>	    Destroy();
<a name="L1620"><font color="white">01620</font>	}
<a name="L1621"><font color="white">01621</font>	
<a name="L1622"><font color="white">01622</font>	//[****] a virer
<a name="L1623"><font color="white">01623</font>	function s_decalerte()
<a name="L1624"><font color="white">01624</font>	{
<a name="L1625"><font color="white">01625</font>	    level.decalerte();
<a name="L1626"><font color="white">01626</font>	     // genalerte.nbalerte--;
<a name="L1627"><font color="white">01627</font>	    //  log(&quot;decalerte &quot;$genalerte.nbattente@genalerte.nbalerte@genalerte.nbattaque);
<a name="L1628"><font color="white">01628</font>	}
<a name="L1629"><font color="white">01629</font>	function s_incalerte()
<a name="L1630"><font color="white">01630</font>	{
<a name="L1631"><font color="white">01631</font>	    level.incalerte();
<a name="L1632"><font color="white">01632</font>	    //genalerte.nbalerte++;
<a name="L1633"><font color="white">01633</font>	   // log(&quot;incalerte &quot;$genalerte.nbattente@genalerte.nbalerte@genalerte.nbattaque);
<a name="L1634"><font color="white">01634</font>	}
<a name="L1635"><font color="white">01635</font>	function s_decattaque()
<a name="L1636"><font color="white">01636</font>	{
<a name="L1637"><font color="white">01637</font>	    level.decattaque();
<a name="L1638"><font color="white">01638</font>	   // genalerte.nbattaque--;
<a name="L1639"><font color="white">01639</font>	  //  log(&quot;decattaque &quot;$genalerte.nbattente@genalerte.nbalerte@genalerte.nbattaque);
<a name="L1640"><font color="white">01640</font>	}
<a name="L1641"><font color="white">01641</font>	function s_incattaque()
<a name="L1642"><font color="white">01642</font>	{
<a name="L1643"><font color="white">01643</font>	    level.incattaque();
<a name="L1644"><font color="white">01644</font>	    //  genalerte.nbattaque++;
<a name="L1645"><font color="white">01645</font>	     //  log(&quot;incattaque &quot;$genalerte.nbattente@genalerte.nbalerte@genalerte.nbattaque);
<a name="L1646"><font color="white">01646</font>	}
<a name="L1647"><font color="white">01647</font>	function s_decattente()
<a name="L1648"><font color="white">01648</font>	{
<a name="L1649"><font color="white">01649</font>	    level.decattente();
<a name="L1650"><font color="white">01650</font>	    //  genalerte.nbattente--;
<a name="L1651"><font color="white">01651</font>	     //  log(&quot;decattente &quot;$genalerte.nbattente@genalerte.nbalerte@genalerte.nbattaque);
<a name="L1652"><font color="white">01652</font>	}
<a name="L1653"><font color="white">01653</font>	function s_incattente()
<a name="L1654"><font color="white">01654</font>	{
<a name="L1655"><font color="white">01655</font>	    level.incattente();
<a name="L1656"><font color="white">01656</font>	     // genalerte.nbattente++;
<a name="L1657"><font color="white">01657</font>	      // log(&quot;incattente &quot;$genalerte.nbattente@genalerte.nbalerte@genalerte.nbattaque);
<a name="L1658"><font color="white">01658</font>	}
<a name="L1659"><font color="white">01659</font>	
<a name="L1660"><font color="white">01660</font>	State Otage
<a name="L1661"><font color="white">01661</font>	{
<a name="L1662"><font color="white">01662</font>	    ignores seeplayer,seemonster,hearnoise,notifybump;
<a name="L1663"><font color="white">01663</font>	
<a name="L1664"><font color="white">01664</font>	    function bool NearWall(float walldist)
<a name="L1665"><font color="white">01665</font>	    {
<a name="L1666"><font color="white">01666</font>	        return false;
<a name="L1667"><font color="white">01667</font>	    }
<a name="L1668"><font color="white">01668</font>	    event Tick(float DeltaTime)
<a name="L1669"><font color="white">01669</font>	    {
<a name="L1670"><font color="white">01670</font>			//log(&quot;etat !!!!!!!&quot;@pawn@self@pawn.GetStateName()@GetStateName());
<a name="L1671"><font color="white">01671</font>	    }
<a name="L1672"><font color="white">01672</font>	    singular function DamageAttitudeTo(pawn Other, float Damage)
<a name="L1673"><font color="white">01673</font>	    {
<a name="L1674"><font color="white">01674</font>	        //son
<a name="L1675"><font color="white">01675</font>	        //bases.PlaySndPNJOno(pnjono'Onomatopees.hPNJHurt',bases.CodeMesh,bases.NumeroTimbre);
<a name="L1676"><font color="white">01676</font>	    }
<a name="L1677"><font color="white">01677</font>	    function Trigger(actor Other, pawn EventInstigator)
<a name="L1678"><font color="white">01678</font>	    {
<a name="L1679"><font color="white">01679</font>	    }
<a name="L1680"><font color="white">01680</font>	    function BeginState()
<a name="L1681"><font color="white">01681</font>	    {
<a name="L1682"><font color="white">01682</font>			local int i;
<a name="L1683"><font color="white">01683</font>	        if (NiveauAlerte==1)
<a name="L1684"><font color="white">01684</font>	        {
<a name="L1685"><font color="white">01685</font>	            s_incattente();
<a name="L1686"><font color="white">01686</font>	            s_decAlerte();
<a name="L1687"><font color="white">01687</font>	        }
<a name="L1688"><font color="white">01688</font>	        else if (NiveauAlerte==2)
<a name="L1689"><font color="white">01689</font>	        {
<a name="L1690"><font color="white">01690</font>	            s_incattente();
<a name="L1691"><font color="white">01691</font>	            s_decAttaque();
<a name="L1692"><font color="white">01692</font>	        }
<a name="L1693"><font color="white">01693</font>	        NiveauAlerte=0;
<a name="L1694"><font color="white">01694</font>	        HalteAuFeu();
<a name="L1695"><font color="white">01695</font>	        settimer(0,false);
<a name="L1696"><font color="white">01696</font>			  settimer2(0,false);
<a name="L1697"><font color="white">01697</font>	        sightcounter=0;
<a name="L1698"><font color="white">01698</font>	        bDisableEventSeeDeadPawn=true;
<a name="L1699"><font color="white">01699</font>			  pawn.bProjTarget=false;
<a name="L1700"><font color="white">01700</font>			//vire de la liste des basesoldiers
<a name="L1701"><font color="white">01701</font>				for (i = 0; i &lt; level.game.BaseSoldierList.Length; i++)
<a name="L1702"><font color="white">01702</font>			   {
<a name="L1703"><font color="white">01703</font>			          if (level.game.BaseSoldierList[i] == pawn )
<a name="L1704"><font color="white">01704</font>					  {
<a name="L1705"><font color="white">01705</font>						  level.game.BaseSoldierList.Remove(i,1);
<a name="L1706"><font color="white">01706</font>						  break;
<a name="L1707"><font color="white">01707</font>					  }
<a name="L1708"><font color="white">01708</font>			   }
<a name="L1709"><font color="white">01709</font>	    }
<a name="L1710"><font color="white">01710</font>	    function Endstate()
<a name="L1711"><font color="white">01711</font>	    {
<a name="L1712"><font color="white">01712</font>	        sightcounter=0.15;
<a name="L1713"><font color="white">01713</font>			  pawn.bProjTarget=true;
<a name="L1714"><font color="white">01714</font>	    }
<a name="L1715"><font color="white">01715</font>	begin:
<a name="L1716"><font color="white">01716</font>	    if (Interrogation!=none)
<a name="L1717"><font color="white">01717</font>	    {
<a name="L1718"><font color="white">01718</font>	        interrogation.Destroy();
<a name="L1719"><font color="white">01719</font>	        interrogation=none;
<a name="L1720"><font color="white">01720</font>	    }
<a name="L1721"><font color="white">01721</font>	
<a name="L1722"><font color="white">01722</font>	Prisonnier:
<a name="L1723"><font color="white">01723</font>	}
<a name="L1724"><font color="white">01724</font>	
<a name="L1725"><font color="white">01725</font>	State Mort
<a name="L1726"><font color="white">01726</font>	{
<a name="L1727"><font color="white">01727</font>	    ignores seeplayer,seemonster,hearnoise,notifybump;
<a name="L1728"><font color="white">01728</font>	
<a name="L1729"><font color="white">01729</font>	    function bool NearWall(float walldist)
<a name="L1730"><font color="white">01730</font>	    {
<a name="L1731"><font color="white">01731</font>	        return false;
<a name="L1732"><font color="white">01732</font>	    }
<a name="L1733"><font color="white">01733</font>	    event Tick(float DeltaTime)
<a name="L1734"><font color="white">01734</font>	    {
<a name="L1735"><font color="white">01735</font>	    }
<a name="L1736"><font color="white">01736</font>	    singular function DamageAttitudeTo(pawn Other, float Damage)
<a name="L1737"><font color="white">01737</font>	    {
<a name="L1738"><font color="white">01738</font>	    }
<a name="L1739"><font color="white">01739</font>	    function Trigger(actor Other, pawn EventInstigator)
<a name="L1740"><font color="white">01740</font>	    {
<a name="L1741"><font color="white">01741</font>	    }
<a name="L1742"><font color="white">01742</font>	    function BeginState()
<a name="L1743"><font color="white">01743</font>	    {
<a name="L1744"><font color="white">01744</font>	        if (CHARGE_LES_LOGS) log(pawn@&quot;dead man&quot;@self);
<a name="L1745"><font color="white">01745</font>	        HalteAuFeu();
<a name="L1746"><font color="white">01746</font>	        settimer(0,false);
<a name="L1747"><font color="white">01747</font>	        settimer2(0,false);
<a name="L1748"><font color="white">01748</font>	        if (Interrogation!=none)
<a name="L1749"><font color="white">01749</font>	        {
<a name="L1750"><font color="white">01750</font>	            Interrogation.destroy();
<a name="L1751"><font color="white">01751</font>	            Interrogation=none;
<a name="L1752"><font color="white">01752</font>	        }
<a name="L1753"><font color="white">01753</font>	    }
<a name="L1754"><font color="white">01754</font>	    function Endstate()
<a name="L1755"><font color="white">01755</font>	    {
<a name="L1756"><font color="white">01756</font>	    }
<a name="L1757"><font color="white">01757</font>	begin:
<a name="L1758"><font color="white">01758</font>	    if (Interrogation!=none)
<a name="L1759"><font color="white">01759</font>	    {
<a name="L1760"><font color="white">01760</font>	        interrogation.Destroy();
<a name="L1761"><font color="white">01761</font>	        interrogation=none;
<a name="L1762"><font color="white">01762</font>	    }
<a name="L1763"><font color="white">01763</font>	Dead:
<a name="L1764"><font color="white">01764</font>	}
<a name="L1765"><font color="white">01765</font>	
<a name="L1766"><font color="white">01766</font>	// ----------------------------------------------------------------------
<a name="L1767"><font color="white">01767</font>	//Etat de faction
<a name="L1768"><font color="white">01768</font>	//
<a name="L1769"><font color="white">01769</font>	//
<a name="L1770"><font color="white">01770</font>	// ----------------------------------------------------------------------
<a name="L1771"><font color="white">01771</font>	state faction
<a name="L1772"><font color="white">01772</font>	{
<a name="L1773"><font color="white">01773</font>	    ignores seeplayer,seemonster,hearnoise;
<a name="L1774"><font color="white">01774</font>	    function Beginstate()
<a name="L1775"><font color="white">01775</font>	    {
<a name="L1776"><font color="white">01776</font>	        if (NiveauAlerte==1)
<a name="L1777"><font color="white">01777</font>	        {
<a name="L1778"><font color="white">01778</font>	            s_incattente();
<a name="L1779"><font color="white">01779</font>	            s_decAlerte();
<a name="L1780"><font color="white">01780</font>	        }
<a name="L1781"><font color="white">01781</font>	        else if (NiveauAlerte==2)
<a name="L1782"><font color="white">01782</font>	        {
<a name="L1783"><font color="white">01783</font>	            s_incattente();
<a name="L1784"><font color="white">01784</font>	            s_decAttaque();
<a name="L1785"><font color="white">01785</font>	        }
<a name="L1786"><font color="white">01786</font>	        NiveauAlerte=0;
<a name="L1787"><font color="white">01787</font>	        //settimer(0,false);
<a name="L1788"><font color="white">01788</font>	        //sightcounter=0;
<a name="L1789"><font color="white">01789</font>	        //bDisableEventSeeDeadPawn=true;
<a name="L1790"><font color="white">01790</font>	        pawn.velocity=vect(0,0,0);
<a name="L1791"><font color="white">01791</font>	        pawn.Acceleration = vect(0, 0, 0);
<a name="L1792"><font color="white">01792</font>	        pawn.SetPhysics(PHYS_None);
<a name="L1793"><font color="white">01793</font>	        pawn.SetCollision(false,false,false);
<a name="L1794"><font color="white">01794</font>	        pawn.SetDrawType(DT_None);
<a name="L1795"><font color="white">01795</font>	        if (pawn.Shadow!=none)
<a name="L1796"><font color="white">01796</font>	            pawn.Shadow.DetachProjector(true);
<a name="L1797"><font color="white">01797</font>	        pawn.bStasis=true;
<a name="L1798"><font color="white">01798</font>	        bStasis=true;
<a name="L1799"><font color="white">01799</font>	        pawn.RefreshDisplaying();
<a name="L1800"><font color="white">01800</font>			  bBloqueFuiteGrenades=true;
<a name="L1801"><font color="white">01801</font>	    }
<a name="L1802"><font color="white">01802</font>	    function endstate()
<a name="L1803"><font color="white">01803</font>	    {
<a name="L1804"><font color="white">01804</font>			 if (!xiii.IsDead() &amp;&amp; !level.game.bGameEnded)
<a name="L1805"><font color="white">01805</font>	       {
<a name="L1806"><font color="white">01806</font>				bStasis=false;
<a name="L1807"><font color="white">01807</font>				pawn.bStasis=false;
<a name="L1808"><font color="white">01808</font>				//sightcounter=0.15;
<a name="L1809"><font color="white">01809</font>				pawn.SetPhysics(PHYS_Walking);
<a name="L1810"><font color="white">01810</font>				pawn.SetCollision(true,true,true);
<a name="L1811"><font color="white">01811</font>				pawn.SetDrawType(DT_Mesh);
<a name="L1812"><font color="white">01812</font>				//bDisableEventSeeDeadPawn=false;
<a name="L1813"><font color="white">01813</font>				pawn.RefreshDisplaying();
<a name="L1814"><font color="white">01814</font>				bBloqueFuiteGrenades=false;
<a name="L1815"><font color="white">01815</font>			 }
<a name="L1816"><font color="white">01816</font>	    }
<a name="L1817"><font color="white">01817</font>	begin:
<a name="L1818"><font color="white">01818</font>	    if (CHARGE_LES_LOGS) log(pawn@&quot;ETAT faction fait rien&quot;);
<a name="L1819"><font color="white">01819</font>	}
<a name="L1820"><font color="white">01820</font>	
<a name="L1821"><font color="white">01821</font>	// ----------------------------------------------------------------------
<a name="L1822"><font color="white">01822</font>	// ETAT INIT
<a name="L1823"><font color="white">01823</font>	//
<a name="L1824"><font color="white">01824</font>	//
<a name="L1825"><font color="white">01825</font>	// ----------------------------------------------------------------------
<a name="L1826"><font color="white">01826</font>	auto state init
<a name="L1827"><font color="white">01827</font>	{
<a name="L1828"><font color="white">01828</font>	    ignores SeePlayer,hearNoise,seemonster,notifybump,enemynotvisible;
<a name="L1829"><font color="white">01829</font>		event Trigger( actor Other, pawn EventInstigator)
<a name="L1830"><font color="white">01830</font>		{
<a name="L1831"><font color="white">01831</font>			bTriggerBuffered=true;
<a name="L1832"><font color="white">01832</font>			Interrogation=other; //cheat to not use an other variable
<a name="L1833"><font color="white">01833</font>			Peeredenemy=EventInstigator;
<a name="L1834"><font color="white">01834</font>		}
<a name="L1835"><font color="white">01835</font>		function BufferTrigger()
<a name="L1836"><font color="white">01836</font>		{
<a name="L1837"><font color="white">01837</font>			if (bTriggerBuffered &amp;&amp; Interrogation!=none &amp;&amp; Peeredenemy!=none)
<a name="L1838"><font color="white">01838</font>			{
<a name="L1839"><font color="white">01839</font>	 			bTriggerBuffered=false;
<a name="L1840"><font color="white">01840</font>				Peeredenemy=none;
<a name="L1841"><font color="white">01841</font>				Interrogation=none;
<a name="L1842"><font color="white">01842</font>				global.Trigger(Interrogation,Peeredenemy);
<a name="L1843"><font color="white">01843</font>			}
<a name="L1844"><font color="white">01844</font>		}
<a name="L1845"><font color="white">01845</font>	    event Tick (float delta)
<a name="L1846"><font color="white">01846</font>	    {
<a name="L1847"><font color="white">01847</font>	    }
<a name="L1848"><font color="white">01848</font>	    function BeginState()
<a name="L1849"><font color="white">01849</font>	    {
<a name="L1850"><font color="white">01850</font>	        settimer(0,false);
<a name="L1851"><font color="white">01851</font>				NiveauAlerte=-1;
<a name="L1852"><font color="white">01852</font>	    }
<a name="L1853"><font color="white">01853</font>	    function EndState()
<a name="L1854"><font color="white">01854</font>	    {
<a name="L1855"><font color="white">01855</font>				NiveauAlerte=0;
<a name="L1856"><font color="white">01856</font>	    }
<a name="L1857"><font color="white">01857</font>	begin:
<a name="L1858"><font color="white">01858</font>	    //CHARGE_LES_LOGS=true;
<a name="L1859"><font color="white">01859</font>	TurnIntoSoldierInit:
<a name="L1860"><font color="white">01860</font>	    BaseS= BaseSoldier(Pawn);
<a name="L1861"><font color="white">01861</font>	    if( Level.Game.DummyStuff1 != -326.27 )
<a name="L1862"><font color="white">01862</font>	    {
<a name="L1863"><font color="white">01863</font>	       bases.skill=5;
<a name="L1864"><font color="white">01864</font>	       pawn.health*=5;
<a name="L1865"><font color="white">01865</font>	    }
<a name="L1866"><font color="white">01866</font>	    bases.PlayWaiting();  // cheat sinon ne charge pas d'anim
<a name="L1867"><font color="white">01867</font>		 if (bases.bBasesGenere) //perso genere
<a name="L1868"><font color="white">01868</font>		 {
<a name="L1869"><font color="white">01869</font>			  Pawn.SetPhysics(PHYS_falling);
<a name="L1870"><font color="white">01870</font>			  if (bases.bSpawnInAir)
<a name="L1871"><font color="white">01871</font>			  {
<a name="L1872"><font color="white">01872</font>					bases.TakeAnimControl(true);
<a name="L1873"><font color="white">01873</font>					bases.PlayAnim('descenterappel',,0.05,bases.FIRINGCHANNEL+1);
<a name="L1874"><font color="white">01874</font>					bases.AnimBlendToAlpha(bases.FIRINGCHANNEL+1,1,0.05);
<a name="L1875"><font color="white">01875</font>				}
<a name="L1876"><font color="white">01876</font>				WaitForLanding();
<a name="L1877"><font color="white">01877</font>			   if (bases.bSpawnInAir)
<a name="L1878"><font color="white">01878</font>			   {
<a name="L1879"><font color="white">01879</font>					bases.PlayJumpLanding();
<a name="L1880"><font color="white">01880</font>			   	sleep(0.4);
<a name="L1881"><font color="white">01881</font>					bases.releaseAnimControl();
<a name="L1882"><font color="white">01882</font>			  		bases.PlayWaiting();
<a name="L1883"><font color="white">01883</font>				}
<a name="L1884"><font color="white">01884</font>		 }
<a name="L1885"><font color="white">01885</font>		 Pawn.SetPhysics(PHYS_walking);
<a name="L1886"><font color="white">01886</font>	    if (pawn.isa('cine2'))
<a name="L1887"><font color="white">01887</font>	    {
<a name="L1888"><font color="white">01888</font>	        pawn.peripheralvision=0.7;
<a name="L1889"><font color="white">01889</font>	        pawn.groundspeed=class'xiiipawn'.default.groundspeed;
<a name="L1890"><font color="white">01890</font>	//		  pawn.AnimBlendToAlpha(0,0.0,0.0);
<a name="L1891"><font color="white">01891</font>	        bcontrolanimations=false;
<a name="L1892"><font color="white">01892</font>	    }
<a name="L1893"><font color="white">01893</font>	    else
<a name="L1894"><font color="white">01894</font>	    {
<a name="L1895"><font color="white">01895</font>	        BaseS.InitializeInventory();
<a name="L1896"><font color="white">01896</font>	        //conversions
<a name="L1897"><font color="white">01897</font>	        pawn.PeripheralVision=cos(pawn.PeripheralVision*0.00873);
<a name="L1898"><font color="white">01898</font>	    }
<a name="L1899"><font color="white">01899</font>		 Switch(Level.Game.Difficulty)
<a name="L1900"><font color="white">01900</font>		 {
<a name="L1901"><font color="white">01901</font>			 case 0: TempsDeclencheAlarme*=1.2; bases.TempsPasVu*=1.2; bases.TempsIdentification*=1.2; FireTimerRefresh=2-0.05*bases.skill; break;
<a name="L1902"><font color="white">01902</font>			 case 1: FireTimerRefresh=1-0.05*bases.skill; break;//bases.TempsPasVu*=1.2; bases.TempsIdentification*=1.2;break;
<a name="L1903"><font color="white">01903</font>			 case 2: TempsDeclencheAlarme*=0.8;bases.TempsPasVu*=0.8; bases.TempsIdentification*=0.8; FireTimerRefresh=0.8-0.05*bases.skill;break;
<a name="L1904"><font color="white">01904</font>			 case 3: bases.TempsPasVu*=0.6; bases.TempsIdentification*=0.6; FireTimerRefresh=0.7-0.05*bases.skill;break;
<a name="L1905"><font color="white">01905</font>		 }
<a name="L1906"><font color="white">01906</font>	start:
<a name="L1907"><font color="white">01907</font>		 pawn.AnimBlendParams(pawn.FIRINGCHANNEL+1,0,0,0,'X');
<a name="L1908"><font color="white">01908</font>		 pawn.EnableChannelNotify(bases.FiringChannel+1, 1);
<a name="L1909"><font color="white">01909</font>	    DefaultPeripheralVision=pawn.PeripheralVision;
<a name="L1910"><font color="white">01910</font>	    DefaultSightRadius=Pawn.SightRadius;
<a name="L1911"><font color="white">01911</font>	    DefaultHearingThreshold=Pawn.HearingThreshold;
<a name="L1912"><font color="white">01912</font>		 Sleep(0.1);
<a name="L1913"><font color="white">01913</font>		 ChangetoBestWeapon();
<a name="L1914"><font color="white">01914</font>	    sleep(0.1+0.1*frand());
<a name="L1915"><font color="white">01915</font>	    if (Pawn.Inventory == None)
<a name="L1916"><font color="white">01916</font>	        log(pawn@&quot;BUGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGGG inventory==none&quot;);
<a name="L1917"><font color="white">01917</font>	    pawn.rotationrate.yaw=25000;
<a name="L1918"><font color="white">01918</font>	    pawn.setanimstatus('quiet');
<a name="L1919"><font color="white">01919</font>	    bRotateToDesired = false;
<a name="L1920"><font color="white">01920</font>	    pawn.bCanJump=false;
<a name="L1921"><font color="white">01921</font>	    //pawn.JumpZ=-1; //Cheat pour pas qu'il saute
<a name="L1922"><font color="white">01922</font>	    bases.setrotation(bases.rotation);
<a name="L1923"><font color="white">01923</font>	    focalpoint=bases.location+vector(bases.rotation);
<a name="L1924"><font color="white">01924</font>	    focus =none;
<a name="L1925"><font color="white">01925</font>	    pawn.bCanPickupInventory=false;
<a name="L1926"><font color="white">01926</font>	    bPreparingMove=false;
<a name="L1927"><font color="white">01927</font>	    bAdvancedTactics=false;
<a name="L1928"><font color="white">01928</font>	    XIII=XIIIPlayerPawn(xiiigameinfo(level.game).mapinfo.XIIIpawn);
<a name="L1929"><font color="white">01929</font>	    genalerte=genalerte(level.game.genalerte);
<a name="L1930"><font color="white">01930</font>	    //desactivation des events
<a name="L1931"><font color="white">01931</font>	    if (level.bNoEnemyAlliance)
<a name="L1932"><font color="white">01932</font>	        bDisableEventSeeMonster=true;
<a name="L1933"><font color="white">01933</font>	    s_incattente();
<a name="L1934"><font color="white">01934</font>	init_bases:
<a name="L1935"><font color="white">01935</font>	    Switch(bases.skill)
<a name="L1936"><font color="white">01936</font>	    {
<a name="L1937"><font color="white">01937</font>	        Case 1 : Angle_Visee=14; break;
<a name="L1938"><font color="white">01938</font>	        Case 2 : Angle_Visee=12; break;
<a name="L1939"><font color="white">01939</font>	        Case 3 : Angle_Visee=10; break;
<a name="L1940"><font color="white">01940</font>	        Case 4 : Angle_Visee=8; break;
<a name="L1941"><font color="white">01941</font>	        Case 5 : Angle_Visee=6; break;
<a name="L1942"><font color="white">01942</font>	    }
<a name="L1943"><font color="white">01943</font>	    if (bases.bAlerte)
<a name="L1944"><font color="white">01944</font>	    {
<a name="L1945"><font color="white">01945</font>	        SetVigilant(true);
<a name="L1946"><font color="white">01946</font>	    }
<a name="L1947"><font color="white">01947</font>		 bPremiereRafale=true;
<a name="L1948"><font color="white">01948</font>	    bases.PourcErrance /=100;
<a name="L1949"><font color="white">01949</font>	    VitesseDeplacements=1.1;
<a name="L1950"><font color="white">01950</font>	    Temps_ref = level.timeseconds;
<a name="L1951"><font color="white">01951</font>	    DistNearWall=200;
<a name="L1952"><font color="white">01952</font>	    DistanceDeplacement=200;
<a name="L1953"><font color="white">01953</font>	    Temps_errance=0;
<a name="L1954"><font color="white">01954</font>	    Temps_RefreshEnemyPos=0.8-0.1*bases.skill;
<a name="L1955"><font color="white">01955</font>	init_etats:
<a name="L1956"><font color="white">01956</font>	    //*****      passe en attaque scriptee si declenche par gennmi avec reseauattaque!=0 *******
<a name="L1957"><font color="white">01957</font>	    if (bases.bBasesGenere &amp;&amp; bases.NumReseauAttaque!=0 &amp;&amp; bases.bPasseAttScr_ApresGen)
<a name="L1958"><font color="white">01958</font>	    {
<a name="L1959"><font color="white">01959</font>	        enemy=chercheNMIplusproche();
<a name="L1960"><font color="white">01960</font>	        if (enemy==none)     //blindage
<a name="L1961"><font color="white">01961</font>	            enemy=XIII;
<a name="L1962"><font color="white">01962</font>			  LastSeenTime = Level.TimeSeconds;
<a name="L1963"><font color="white">01963</font>	        LastSeeingPos = Pawn.Location;
<a name="L1964"><font color="white">01964</font>	        LastSeenPos = Enemy.Location;
<a name="L1965"><font color="white">01965</font>	
<a name="L1966"><font color="white">01966</font>		     if (CHARGE_LES_LOGS) log(pawn@&quot;ETAT Je vais essayer de prendre mon reseau d'attaque&quot;);
<a name="L1967"><font color="white">01967</font>	        LastAttackPoint=none;
<a name="L1968"><font color="white">01968</font>	        LastAttackPoint=chercheAttackPoint();
<a name="L1969"><font color="white">01969</font>	        if (lastAttackPoint!=none) //AttackPoint plus pres que enemy
<a name="L1970"><font color="white">01970</font>	        {
<a name="L1971"><font color="white">01971</font>	            MoveTarget=none;
<a name="L1972"><font color="white">01972</font>	            if (ActorReachable(LastAttackpoint))
<a name="L1973"><font color="white">01973</font>	            {
<a name="L1974"><font color="white">01974</font>	                EtatNeutre='tenir';
<a name="L1975"><font color="white">01975</font>						 if (!bdejavu) bDejaVu = true;
<a name="L1976"><font color="white">01976</font>	                gotostate('attaquescriptee');
<a name="L1977"><font color="white">01977</font>	            }
<a name="L1978"><font color="white">01978</font>	            else if (FindBestPathToward(LastAttackPoint))
<a name="L1979"><font color="white">01979</font>	            {
<a name="L1980"><font color="white">01980</font>	                for (iCompteur=0;iCompteur&lt;16;iCompteur++)
<a name="L1981"><font color="white">01981</font>	                {
<a name="L1982"><font color="white">01982</font>	                    if (routecache[iCompteur]==none)
<a name="L1983"><font color="white">01983</font>	                        break;
<a name="L1984"><font color="white">01984</font>	                    PointChemin[iCompteur]=routecache[iCompteur];
<a name="L1985"><font color="white">01985</font>	                }
<a name="L1986"><font color="white">01986</font>	                NbPointChemin=iCompteur;
<a name="L1987"><font color="white">01987</font>	                EtatNeutre='tenir';
<a name="L1988"><font color="white">01988</font>						 if (!bdejavu) bDejaVu = true;
<a name="L1989"><font color="white">01989</font>	                gotostate('attaquescriptee');
<a name="L1990"><font color="white">01990</font>	            }
<a name="L1991"><font color="white">01991</font>	        }
<a name="L1992"><font color="white">01992</font>	    }
<a name="L1993"><font color="white">01993</font>	    else if (pawn.isa('cine2') &amp;&amp; bases.bTurnIntoAgressiveSoldier)
<a name="L1994"><font color="white">01994</font>	    {
<a name="L1995"><font color="white">01995</font>	        enemy=xiii;
<a name="L1996"><font color="white">01996</font>	        bdejavu=true;
<a name="L1997"><font color="white">01997</font>			  if (enemy==XIII) TriggerEvent('XIIIVu', Self, pawn);  //trigger vu
<a name="L1998"><font color="white">01998</font>		     Pawn.Acceleration = vect(0,0,0);
<a name="L1999"><font color="white">01999</font>		     Pawn.Velocity = vect(0,0,0);
<a name="L2000"><font color="white">02000</font>			  BufferTrigger();
<a name="L2001"><font color="white">02001</font>		     if (!genalerte.bAllAlarmsActivated)    ChercheAlarme();  //ALARMEChercheAlarme();  //ALARME
<a name="L2002"><font color="white">02002</font>		     pawn.rotationrate.yaw=46000;
<a name="L2003"><font color="white">02003</font>		     ChangetoBestWeapon();
<a name="L2004"><font color="white">02004</font>		     //init vars attaque
<a name="L2005"><font color="white">02005</font>		     CompteurRecalage=15;
<a name="L2006"><font color="white">02006</font>	        gotostate('attaque','initattaque');
<a name="L2007"><font color="white">02007</font>	    }
<a name="L2008"><font color="white">02008</font>		 BufferTrigger();
<a name="L2009"><font color="white">02009</font>	    enemy=none;
<a name="L2010"><font color="white">02010</font>	    //*******************************************************************************************
<a name="L2011"><font color="white">02011</font>	    if (bases.Order=='faction')
<a name="L2012"><font color="white">02012</font>	    {
<a name="L2013"><font color="white">02013</font>	        EtatNeutre='tenir';
<a name="L2014"><font color="white">02014</font>	        GotoState('faction');
<a name="L2015"><font color="white">02015</font>	    }
<a name="L2016"><font color="white">02016</font>	    if (bases.order=='tenir' || bases.order=='garder')
<a name="L2017"><font color="white">02017</font>	    {
<a name="L2018"><font color="white">02018</font>	        EtatNeutre='tenir';
<a name="L2019"><font color="white">02019</font>	        GotoState('tenir');
<a name="L2020"><font color="white">02020</font>	    }
<a name="L2021"><font color="white">02021</font>	    if (bases.PourcErrance==1)
<a name="L2022"><font color="white">02022</font>	        EtatNeutre='errance';
<a name="L2023"><font color="white">02023</font>	    else
<a name="L2024"><font color="white">02024</font>	        EtatNeutre='patrouille';
<a name="L2025"><font color="white">02025</font>	    gotostate(EtatNeutre);
<a name="L2026"><font color="white">02026</font>	}
<a name="L2027"><font color="white">02027</font>	
<a name="L2028"><font color="white">02028</font>	// ----------------------------------------------------------------------
<a name="L2029"><font color="white">02029</font>	// Etat de patrouille
<a name="L2030"><font color="white">02030</font>	//
<a name="L2031"><font color="white">02031</font>	// Move from point to point in a predescribed pattern.
<a name="L2032"><font color="white">02032</font>	// ----------------------------------------------------------------------
<a name="L2033"><font color="white">02033</font>	State Patrouille
<a name="L2034"><font color="white">02034</font>	{
<a name="L2035"><font color="white">02035</font>	    ignores EnemyNotVisible;
<a name="L2036"><font color="white">02036</font>	
<a name="L2037"><font color="white">02037</font>		event Tick(float DeltaTime)
<a name="L2038"><font color="white">02038</font>		{
<a name="L2039"><font color="white">02039</font>		    global.tick(DeltaTime);
<a name="L2040"><font color="white">02040</font>			 if (bUTurnMove)  pawn.velocity=100*normal((PointChemin[iCompteur].location-pawn.location)*vect(1,1,0));
<a name="L2041"><font color="white">02041</font>		}
<a name="L2042"><font color="white">02042</font>	    event Seeplayer(pawn other)
<a name="L2043"><font color="white">02043</font>	    {
<a name="L2044"><font color="white">02044</font>	        if (setenemy(XIII))
<a name="L2045"><font color="white">02045</font>	        {
<a name="L2046"><font color="white">02046</font>	            //log(pawn@&quot;seeplayer&quot;@other);
<a name="L2047"><font color="white">02047</font>	            bdejavu=true;
<a name="L2048"><font color="white">02048</font>	        }
<a name="L2049"><font color="white">02049</font>	    }
<a name="L2050"><font color="white">02050</font>	    event SeeMonster(pawn other)
<a name="L2051"><font color="white">02051</font>	    {
<a name="L2052"><font color="white">02052</font>	        if (setenemy(other))
<a name="L2053"><font color="white">02053</font>	            bdejavu=true;
<a name="L2054"><font color="white">02054</font>	    }
<a name="L2055"><font color="white">02055</font>	    event HearNoise(float Loudness, Actor NoiseMaker)
<a name="L2056"><font color="white">02056</font>	    {
<a name="L2057"><font color="white">02057</font>	        if (TestSonEntendu(NoiseMaker))
<a name="L2058"><font color="white">02058</font>	            enemyacquired();
<a name="L2059"><font color="white">02059</font>	    }
<a name="L2060"><font color="white">02060</font>	    event SeeDeadPawn(pawn other)
<a name="L2061"><font color="white">02061</font>	    {
<a name="L2062"><font color="white">02062</font>	        local basesoldier Soldier;
<a name="L2063"><font color="white">02063</font>	
<a name="L2064"><font color="white">02064</font>	        Soldier=basesoldier(other);
<a name="L2065"><font color="white">02065</font>	        if (bases.BNeVoitPascadavre || Soldier==none || Soldier.DrawType == DT_NONE || Soldier.bMonCadavreEstDejaVu || AllianceLevel(Soldier)!=1)
<a name="L2066"><font color="white">02066</font>	            return;
<a name="L2067"><font color="white">02067</font>	
<a name="L2068"><font color="white">02068</font>	        instigator=other;
<a name="L2069"><font color="white">02069</font>	        bCadavreVu=true;
<a name="L2070"><font color="white">02070</font>	        Soldier.bMonCadavreEstDejaVu=true;
<a name="L2071"><font color="white">02071</font>	        EnemyAcquired();
<a name="L2072"><font color="white">02072</font>	        return;
<a name="L2073"><font color="white">02073</font>	    }
<a name="L2074"><font color="white">02074</font>	    event EnemyAcquired()
<a name="L2075"><font color="white">02075</font>	    {
<a name="L2076"><font color="white">02076</font>	        gotostate('acquisition');
<a name="L2077"><font color="white">02077</font>	    }
<a name="L2078"><font color="white">02078</font>	    singular function DamageAttitudeTo(pawn Other, float Damage)
<a name="L2079"><font color="white">02079</font>	    {
<a name="L2080"><font color="white">02080</font>	        //son
<a name="L2081"><font color="white">02081</font>	        bases.PlaySndPNJOno(pnjono'Onomatopees.hPNJHurt',bases.CodeMesh,bases.NumeroTimbre);
<a name="L2082"><font color="white">02082</font>	        if (setenemy(other))
<a name="L2083"><font color="white">02083</font>	        {
<a name="L2084"><font color="white">02084</font>	            //genalerte.potepaffe(pawn);
<a name="L2085"><font color="white">02085</font>	            bPaffe=true;
<a name="L2086"><font color="white">02086</font>	        }
<a name="L2087"><font color="white">02087</font>	    }
<a name="L2088"><font color="white">02088</font>	
<a name="L2089"><font color="white">02089</font>	    function PickDestination()
<a name="L2090"><font color="white">02090</font>	    {
<a name="L2091"><font color="white">02091</font>	        if (PatrolPoint(DestNavPoint) != None)
<a name="L2092"><font color="white">02092</font>	            DestNavPoint = PatrolPoint(DestNavPoint).NextPatrolPoint;
<a name="L2093"><font color="white">02093</font>	        else
<a name="L2094"><font color="white">02094</font>	            DestNavPoint = PickStartPoint();
<a name="L2095"><font color="white">02095</font>	        if (DestNavPoint == None)  // can't go anywhere...
<a name="L2096"><font color="white">02096</font>	        {
<a name="L2097"><font color="white">02097</font>	            if (CHARGE_LES_LOGS) log(pawn@&quot;can't go anywhere&quot;);
<a name="L2098"><font color="white">02098</font>	            bases.PourcErrance=1;
<a name="L2099"><font color="white">02099</font>	            etatneutre='Errance';
<a name="L2100"><font color="white">02100</font>	            GotoState('Errance');
<a name="L2101"><font color="white">02101</font>	        }
<a name="L2102"><font color="white">02102</font>	    }
<a name="L2103"><font color="white">02103</font>	    function bool IsPointInCylinder(Actor cylinder, Vector point,optional float extraRadius, optional float extraHeight)
<a name="L2104"><font color="white">02104</font>	    {
<a name="L2105"><font color="white">02105</font>	        local bool  bPointInCylinder;
<a name="L2106"><font color="white">02106</font>	        local float tempX, tempY, tempRad;
<a name="L2107"><font color="white">02107</font>	
<a name="L2108"><font color="white">02108</font>	        tempX    = cylinder.Location.X - point.X;
<a name="L2109"><font color="white">02109</font>	        tempX   *= tempX;
<a name="L2110"><font color="white">02110</font>	        tempY    = cylinder.Location.Y - point.Y;
<a name="L2111"><font color="white">02111</font>	        tempY   *= tempY;
<a name="L2112"><font color="white">02112</font>	        tempRad  = cylinder.CollisionRadius + extraRadius;
<a name="L2113"><font color="white">02113</font>	        tempRad *= tempRad;
<a name="L2114"><font color="white">02114</font>	
<a name="L2115"><font color="white">02115</font>	        bPointInCylinder = false;
<a name="L2116"><font color="white">02116</font>	        if (tempX+tempY &lt; tempRad)
<a name="L2117"><font color="white">02117</font>	            if (Abs(cylinder.Location.Z - point.Z) &lt; (cylinder.CollisionHeight+extraHeight))
<a name="L2118"><font color="white">02118</font>	                bPointInCylinder = true;
<a name="L2119"><font color="white">02119</font>	
<a name="L2120"><font color="white">02120</font>	            return (bPointInCylinder);
<a name="L2121"><font color="white">02121</font>	    }
<a name="L2122"><font color="white">02122</font>	    function beginstate()
<a name="L2123"><font color="white">02123</font>	    {
<a name="L2124"><font color="white">02124</font>	        if (CHARGE_LES_LOGS) log(pawn@&quot;ETAT patrol patrol&quot;);
<a name="L2125"><font color="white">02125</font>	        settimer(0,false);
<a name="L2126"><font color="white">02126</font>	        if (bases.bPatrolWithWalkSearchAnim)
<a name="L2127"><font color="white">02127</font>	        {
<a name="L2128"><font color="white">02128</font>	            pawn.SetAnimStatus('alert');
<a name="L2129"><font color="white">02129</font>	        }
<a name="L2130"><font color="white">02130</font>	        if (NiveauAlerte==1)
<a name="L2131"><font color="white">02131</font>	        {
<a name="L2132"><font color="white">02132</font>	            s_incattente();
<a name="L2133"><font color="white">02133</font>	            s_decAlerte();
<a name="L2134"><font color="white">02134</font>	        }
<a name="L2135"><font color="white">02135</font>	        else if (NiveauAlerte==2)
<a name="L2136"><font color="white">02136</font>	        {
<a name="L2137"><font color="white">02137</font>	            s_incattente();
<a name="L2138"><font color="white">02138</font>	            s_decAttaque();
<a name="L2139"><font color="white">02139</font>	        }
<a name="L2140"><font color="white">02140</font>	        NiveauAlerte=0;
<a name="L2141"><font color="white">02141</font>	        //var temp
<a name="L2142"><font color="white">02142</font>				//btemp_bool
<a name="L2143"><font color="white">02143</font>	        //temp_int=0;
<a name="L2144"><font color="white">02144</font>				//temp_vect utilise pour calcul dangle avec
<a name="L2145"><font color="white">02145</font>			if (bases.codemesh==2)     //pas d'anim pour WIG
<a name="L2146"><font color="white">02146</font>			{
<a name="L2147"><font color="white">02147</font>				WaitPatrolAnim='WaitNeutre';
<a name="L2148"><font color="white">02148</font>				PatrolAnim ='Walk';
<a name="L2149"><font color="white">02149</font>			}
<a name="L2150"><font color="white">02150</font>			else
<a name="L2151"><font color="white">02151</font>			{
<a name="L2152"><font color="white">02152</font>			  Switch (pawn.weapon.inventorygroup)
<a name="L2153"><font color="white">02153</font>			  {
<a name="L2154"><font color="white">02154</font>				  case 2: //beretta magnum
<a name="L2155"><font color="white">02155</font>				  case 3:
<a name="L2156"><font color="white">02156</font>						if (rand(2)&lt;1)
<a name="L2157"><font color="white">02157</font>						{
<a name="L2158"><font color="white">02158</font>							WaitPatrolAnim='Waitpatrouille1Pistol';
<a name="L2159"><font color="white">02159</font>							PatrolAnim='Patrouille1Pistol';
<a name="L2160"><font color="white">02160</font>							TurnRPatrolAnim='TurnRPatrouille1Pistol';
<a name="L2161"><font color="white">02161</font>							TurnLPatrolAnim='TurnLPatrouille1Pistol';
<a name="L2162"><font color="white">02162</font>						}
<a name="L2163"><font color="white">02163</font>						else
<a name="L2164"><font color="white">02164</font>						{
<a name="L2165"><font color="white">02165</font>							WaitPatrolAnim='Waitpatrouille2Pistol';
<a name="L2166"><font color="white">02166</font>							PatrolAnim='Patrouille2Pistol';
<a name="L2167"><font color="white">02167</font>							TurnRPatrolAnim='TurnRPatrouille2Pistol';
<a name="L2168"><font color="white">02168</font>							TurnLPatrolAnim='TurnLPatrouille2Pistol';
<a name="L2169"><font color="white">02169</font>						}
<a name="L2170"><font color="white">02170</font>						break;
<a name="L2171"><font color="white">02171</font>				  case 6 :   //arbalette et arbalette x3
<a name="L2172"><font color="white">02172</font>				  case 7 :
<a name="L2173"><font color="white">02173</font>				  case 9 :  //fusilpompe, kalash et M16
<a name="L2174"><font color="white">02174</font>	           case 11 :
<a name="L2175"><font color="white">02175</font>				  case 12:
<a name="L2176"><font color="white">02176</font>						if (rand(4)&lt;1)
<a name="L2177"><font color="white">02177</font>						{
<a name="L2178"><font color="white">02178</font>							WaitPatrolAnim='Waitpatrouille2Gun';
<a name="L2179"><font color="white">02179</font>							PatrolAnim='Patrouille2Gun';
<a name="L2180"><font color="white">02180</font>							TurnRPatrolAnim='TurnRPatrouille2Gun';
<a name="L2181"><font color="white">02181</font>							TurnLPatrolAnim='TurnLPatrouille2Gun';
<a name="L2182"><font color="white">02182</font>						}
<a name="L2183"><font color="white">02183</font>						else
<a name="L2184"><font color="white">02184</font>						{
<a name="L2185"><font color="white">02185</font>							WaitPatrolAnim='Waitpatrouille1Gun';
<a name="L2186"><font color="white">02186</font>							PatrolAnim='Patrouille1Gun';
<a name="L2187"><font color="white">02187</font>							TurnRPatrolAnim='TurnRPatrouille1Gun';
<a name="L2188"><font color="white">02188</font>							TurnLPatrolAnim='TurnLPatrouille1Gun';
<a name="L2189"><font color="white">02189</font>						}
<a name="L2190"><font color="white">02190</font>						break;
<a name="L2191"><font color="white">02191</font>	
<a name="L2192"><font color="white">02192</font>					case 16: //M60
<a name="L2193"><font color="white">02193</font>						PatrolAnim ='WalkGatling';
<a name="L2194"><font color="white">02194</font>						WaitPatrolAnim='WaitGatling';
<a name="L2195"><font color="white">02195</font>						TurnRPatrolAnim='';
<a name="L2196"><font color="white">02196</font>						TurnLPatrolAnim='';
<a name="L2197"><font color="white">02197</font>						break;
<a name="L2198"><font color="white">02198</font>					case 8:    //fusil de chasse et lance harpon
<a name="L2199"><font color="white">02199</font>				  	case 10:
<a name="L2200"><font color="white">02200</font>							WaitPatrolAnim='Waitpatrouille1Gun';
<a name="L2201"><font color="white">02201</font>							PatrolAnim ='Patrouille1Gun';
<a name="L2202"><font color="white">02202</font>							TurnRPatrolAnim='TurnRPatrouille1Gun';
<a name="L2203"><font color="white">02203</font>							TurnLPatrolAnim='TurnLPatrouille1Gun';
<a name="L2204"><font color="white">02204</font>						break;
<a name="L2205"><font color="white">02205</font>				  case 13: //uzi
<a name="L2206"><font color="white">02206</font>							WaitPatrolAnim='Waitpatrouille2Pistol';
<a name="L2207"><font color="white">02207</font>							PatrolAnim ='Patrouille2Pistol';
<a name="L2208"><font color="white">02208</font>							TurnRPatrolAnim='TurnRPatrouille2Pistol';
<a name="L2209"><font color="white">02209</font>							TurnLPatrolAnim='TurnLPatrouille2Pistol';
<a name="L2210"><font color="white">02210</font>						break;
<a name="L2211"><font color="white">02211</font>				  case 15: //bazook
<a name="L2212"><font color="white">02212</font>						WaitPatrolAnim='WaitBazooka';
<a name="L2213"><font color="white">02213</font>						PatrolAnim ='WalkBazook';
<a name="L2214"><font color="white">02214</font>						TurnRPatrolAnim='';
<a name="L2215"><font color="white">02215</font>						TurnLPatrolAnim='';
<a name="L2216"><font color="white">02216</font>						break;
<a name="L2217"><font color="white">02217</font>					case 14:
<a name="L2218"><font color="white">02218</font>						PatrolAnim ='WalkGatling';
<a name="L2219"><font color="white">02219</font>						WaitPatrolAnim='SniperWait';
<a name="L2220"><font color="white">02220</font>						TurnRPatrolAnim='';
<a name="L2221"><font color="white">02221</font>						TurnLPatrolAnim='';
<a name="L2222"><font color="white">02222</font>						break;
<a name="L2223"><font color="white">02223</font>					default:
<a name="L2224"><font color="white">02224</font>					    Switch (bases.CodeMesh)
<a name="L2225"><font color="white">02225</font>						{
<a name="L2226"><font color="white">02226</font>							case 3:
<a name="L2227"><font color="white">02227</font>							case 7:
<a name="L2228"><font color="white">02228</font>							case 9:
<a name="L2229"><font color="white">02229</font>							case 17:
<a name="L2230"><font color="white">02230</font>							case 11:
<a name="L2231"><font color="white">02231</font>							case 12:
<a name="L2232"><font color="white">02232</font>							case 13:
<a name="L2233"><font color="white">02233</font>							case 14:
<a name="L2234"><font color="white">02234</font>								WaitPatrolAnim='WaitNeutre';
<a name="L2235"><font color="white">02235</font>								PatrolAnim ='Walk';
<a name="L2236"><font color="white">02236</font>								break;
<a name="L2237"><font color="white">02237</font>							default:
<a name="L2238"><font color="white">02238</font>								WaitPatrolAnim='WaitNeutre';
<a name="L2239"><font color="white">02239</font>								PatrolAnim ='WalkNeutre';
<a name="L2240"><font color="white">02240</font>						}
<a name="L2241"><font color="white">02241</font>	
<a name="L2242"><font color="white">02242</font>				}
<a name="L2243"><font color="white">02243</font>			}
<a name="L2244"><font color="white">02244</font>	   	Settimer2(0,false);
<a name="L2245"><font color="white">02245</font>			 pawn.AnimBlendToAlpha(bases.FIRINGCHANNEL+1,1,0.5);
<a name="L2246"><font color="white">02246</font>			 bases.TakeAnimControl(false);
<a name="L2247"><font color="white">02247</font>	    }
<a name="L2248"><font color="white">02248</font>	    function Endstate()
<a name="L2249"><font color="white">02249</font>	
<a name="L2250"><font color="white">02250</font>	    {
<a name="L2251"><font color="white">02251</font>	        if (bases.bPatrolWithWalkSearchAnim)
<a name="L2252"><font color="white">02252</font>	        {
<a name="L2253"><font color="white">02253</font>	            pawn.SetAnimStatus('quiet');
<a name="L2254"><font color="white">02254</font>	        }
<a name="L2255"><font color="white">02255</font>			  if (bControlAnimations) bases.ReleaseAnimControl();
<a name="L2256"><font color="white">02256</font>	    	  bUTurnMove=false;
<a name="L2257"><font color="white">02257</font>	    }
<a name="L2258"><font color="white">02258</font>	Begin:
<a name="L2259"><font color="white">02259</font>	    DestNavPoint = None;
<a name="L2260"><font color="white">02260</font>	Patrol:
<a name="L2261"><font color="white">02261</font>	    PickDestination();
<a name="L2262"><font color="white">02262</font>	    LastPatrolPoint=PatrolPoint(DestNavPoint);
<a name="L2263"><font color="white">02263</font>		 if (LastPatrolPoint==none)
<a name="L2264"><font color="white">02264</font>		 {
<a name="L2265"><font color="white">02265</font>				log(pawn@&quot;PROBLEME DE RESEAU DE PATROUILLE&quot;);
<a name="L2266"><font color="white">02266</font>				gotostate('tenir');
<a name="L2267"><font color="white">02267</font>		 }
<a name="L2268"><font color="white">02268</font>	combi_errance_patrouille:
<a name="L2269"><font color="white">02269</font>	    if (Bases.PourcErrance&gt;0)
<a name="L2270"><font color="white">02270</font>	    {
<a name="L2271"><font color="white">02271</font>	        if ((level.timeseconds-Temps_ref)&gt;Temps_Errance)
<a name="L2272"><font color="white">02272</font>	        {
<a name="L2273"><font color="white">02273</font>	            Temps_errance=bases.PourcErrance*10+2*Frand();
<a name="L2274"><font color="white">02274</font>	            Temps_ref=level.timeseconds;
<a name="L2275"><font color="white">02275</font>	            gotostate('errance');
<a name="L2276"><font color="white">02276</font>	        }
<a name="L2277"><font color="white">02277</font>	    }
<a name="L2278"><font color="white">02278</font>	
<a name="L2279"><font color="white">02279</font>	Moving:
<a name="L2280"><font color="white">02280</font>	    // Move from pathnode to pathnode until we get where we're going
<a name="L2281"><font color="white">02281</font>		if (!IsPointInCylinder(pawn,LastPatrolPoint.Location,16-pawn.CollisionRadius))
<a name="L2282"><font color="white">02282</font>		{
<a name="L2283"><font color="white">02283</font>			MoveTarget=none;
<a name="L2284"><font color="white">02284</font>			if (FastTrace(LastPatrolPoint.location-vect(0,0,30),pawn.location-vect(0,0,30)))
<a name="L2285"><font color="white">02285</font>			{
<a name="L2286"><font color="white">02286</font>				routecache[0]=LastPatrolPoint;
<a name="L2287"><font color="white">02287</font>				routecache[1]=none;
<a name="L2288"><font color="white">02288</font>			}
<a name="L2289"><font color="white">02289</font>			else if (!FindBestPathToward(LastPatrolPoint))
<a name="L2290"><font color="white">02290</font>			{
<a name="L2291"><font color="white">02291</font>				if (CHARGE_LES_LOGS) log(pawn@&quot;trouve pas le patrolpoint&quot;);
<a name="L2292"><font color="white">02292</font>				bases.PourcErrance=1;
<a name="L2293"><font color="white">02293</font>				Etatneutre='Errance';
<a name="L2294"><font color="white">02294</font>				GotoState('Errance');
<a name="L2295"><font color="white">02295</font>			}
<a name="L2296"><font color="white">02296</font>			for (iCompteur=0;iCompteur&lt;16;iCompteur++)
<a name="L2297"><font color="white">02297</font>			{
<a name="L2298"><font color="white">02298</font>				if (routecache[iCompteur]==none)
<a name="L2299"><font color="white">02299</font>					break;
<a name="L2300"><font color="white">02300</font>				PointChemin[iCompteur]=routecache[iCompteur];
<a name="L2301"><font color="white">02301</font>			}
<a name="L2302"><font color="white">02302</font>			NbPointChemin=iCompteur;
<a name="L2303"><font color="white">02303</font>			for (iCompteur=0;iCompteur&lt;NbPointChemin;iCompteur++)
<a name="L2304"><font color="white">02304</font>			{
<a name="L2305"><font color="white">02305</font>				if (LastPatrolPoint.bEnCourant)
<a name="L2306"><font color="white">02306</font>				{
<a name="L2307"><font color="white">02307</font>					focus=none;
<a name="L2308"><font color="white">02308</font>					focalpoint=1000*(PointChemin[iCompteur].location-pawn.location)+pawn.location;
<a name="L2309"><font color="white">02309</font>					pawn.bmoving=true; //pour tap tap
<a name="L2310"><font color="white">02310</font>					bases.ReleaseAnimControl();
<a name="L2311"><font color="white">02311</font>					MoveToward(PointChemin[iCompteur],none);
<a name="L2312"><font color="white">02312</font>					bases.TakeAnimControl(false);
<a name="L2313"><font color="white">02313</font>					pawn.AnimBlendToAlpha(bases.FIRINGCHANNEL+1,1,0.3);
<a name="L2314"><font color="white">02314</font>				}
<a name="L2315"><font color="white">02315</font>				else
<a name="L2316"><font color="white">02316</font>				{
<a name="L2317"><font color="white">02317</font>					Temp_vect=normal(PointChemin[iCompteur].location-pawn.location);
<a name="L2318"><font color="white">02318</font>					if (TurnRPatrolAnim!='')
<a name="L2319"><font color="white">02319</font>					{
<a name="L2320"><font color="white">02320</font>						Temp_float= Temp_vect dot vector(pawn.rotation);
<a name="L2321"><font color="white">02321</font>						//btemp_bool= true -&gt; tourne vers droite sinon tourne vers gauche
<a name="L2322"><font color="white">02322</font>						btemp_bool= (((Temp_vect cross vect(0,0,-1)) dot vector(pawn.rotation))&lt;0);
<a name="L2323"><font color="white">02323</font>					}
<a name="L2324"><font color="white">02324</font>					else
<a name="L2325"><font color="white">02325</font>						temp_float=2; //cheat
<a name="L2326"><font color="white">02326</font>					focus=none;
<a name="L2327"><font color="white">02327</font>					focalpoint=10000*Temp_vect+pawn.location;
<a name="L2328"><font color="white">02328</font>					if (Temp_float&lt;0.3)
<a name="L2329"><font color="white">02329</font>					{
<a name="L2330"><font color="white">02330</font>						if (btemp_bool) //droite
<a name="L2331"><font color="white">02331</font>							pawn.PlayAnim(TurnRPatrolAnim,1,0.1,bases.FIRINGCHANNEL+1);
<a name="L2332"><font color="white">02332</font>						else
<a name="L2333"><font color="white">02333</font>							pawn.PlayAnim(TurnLPatrolAnim,1,0.2,bases.FIRINGCHANNEL+1);
<a name="L2334"><font color="white">02334</font>	  				   pawn.rotationrate.yaw=20000*(1-temp_float)-1000;
<a name="L2335"><font color="white">02335</font>					}
<a name="L2336"><font color="white">02336</font>	
<a name="L2337"><font color="white">02337</font>					if (Temp_float&lt;0.3)
<a name="L2338"><font color="white">02338</font>					{
<a name="L2339"><font color="white">02339</font>						sleep(0.5);
<a name="L2340"><font color="white">02340</font>						bUTurnMove=true;
<a name="L2341"><font color="white">02341</font>						if (btemp_bool) //a droite anim plus longue
<a name="L2342"><font color="white">02342</font>							sleep(0.68);
<a name="L2343"><font color="white">02343</font>						else
<a name="L2344"><font color="white">02344</font>							sleep(0.38);
<a name="L2345"><font color="white">02345</font>					}
<a name="L2346"><font color="white">02346</font>					pawn.bmoving=true; //pour tap tap
<a name="L2347"><font color="white">02347</font>					pawn.LoopAnim(PatrolAnim,1,0.1,bases.FIRINGCHANNEL+1);
<a name="L2348"><font color="white">02348</font>					if (Temp_float&lt;0.3)
<a name="L2349"><font color="white">02349</font>					{
<a name="L2350"><font color="white">02350</font>						pawn.rotationrate.yaw=26000;
<a name="L2351"><font color="white">02351</font>						bUTurnMove=false;
<a name="L2352"><font color="white">02352</font>					}
<a name="L2353"><font color="white">02353</font>					MoveToward(PointChemin[iCompteur],none,bases.walkingspeed);
<a name="L2354"><font color="white">02354</font>				}
<a name="L2355"><font color="white">02355</font>			}
<a name="L2356"><font color="white">02356</font>		}
<a name="L2357"><font color="white">02357</font>	Pausing:
<a name="L2358"><font color="white">02358</font>	    // Turn in the direction dictated by the WanderPoint, or a random direction
<a name="L2359"><font color="white">02359</font>	    //pawn.SpineYawControl(true,2000+rand(1000),0.8+0.6*frand());
<a name="L2360"><font color="white">02360</font>		pawn.bmoving=false; //pour tap tap
<a name="L2361"><font color="white">02361</font>		if (LastPatrolPoint.TypeSon!=rien &amp;&amp; 100*frand()&lt;=LastPatrolPoint.ProbaJouerOno)
<a name="L2362"><font color="white">02362</font>		{
<a name="L2363"><font color="white">02363</font>			Switch(LastPatrolPoint.TypeSon)
<a name="L2364"><font color="white">02364</font>			{
<a name="L2365"><font color="white">02365</font>				Case Sifflements: pawn.PlaySndPNJOno(pnjono'Onomatopees.hPNJWhistle',bases.CodeMesh,bases.NumeroTimbre); break;
<a name="L2366"><font color="white">02366</font>				Case Eternuments: pawn.PlaySndPNJOno(pnjono'Onomatopees.hPNJSneeze',bases.CodeMesh,bases.NumeroTimbre); break;
<a name="L2367"><font color="white">02367</font>				Case Toux: pawn.PlaySndPNJOno(pnjono'Onomatopees.hPNJCough',bases.CodeMesh,bases.NumeroTimbre); break;
<a name="L2368"><font color="white">02368</font>				case OnoAleatoire :
<a name="L2369"><font color="white">02369</font>					switch (rand(3))
<a name="L2370"><font color="white">02370</font>					{
<a name="L2371"><font color="white">02371</font>						Case 0: pawn.PlaySndPNJOno(pnjono'Onomatopees.hPNJWhistle',bases.CodeMesh,bases.NumeroTimbre); break;
<a name="L2372"><font color="white">02372</font>						Case 1: pawn.PlaySndPNJOno(pnjono'Onomatopees.hPNJSneeze',bases.CodeMesh,bases.NumeroTimbre); break;
<a name="L2373"><font color="white">02373</font>						Case 2: pawn.PlaySndPNJOno(pnjono'Onomatopees.hPNJCough',bases.CodeMesh,bases.NumeroTimbre); break;
<a name="L2374"><font color="white">02374</font>					}
<a name="L2375"><font color="white">02375</font>			}
<a name="L2376"><font color="white">02376</font>		}
<a name="L2377"><font color="white">02377</font>		if ((LastPatrolPoint.pausetime &gt; 0) || (LastPatrolPoint.NextPatrolPoint == None))
<a name="L2378"><font color="white">02378</font>		{
<a name="L2379"><font color="white">02379</font>			pawn.Acceleration = vect(0, 0, 0);
<a name="L2380"><font color="white">02380</font>			pawn.velocity=vect(0,0,0);
<a name="L2381"><font color="white">02381</font>			if (LastPatrolPoint.PatrolAnim.length&gt;0)
<a name="L2382"><font color="white">02382</font>			{
<a name="L2383"><font color="white">02383</font>				temp_int=rand(LastPatrolPoint.PatrolAnim.length);
<a name="L2384"><font color="white">02384</font>				if (LastPatrolPoint.bBoucleSurAnim)
<a name="L2385"><font color="white">02385</font>					bases.loopAnim(LastPatrolPoint.PatrolAnim[temp_int],,0.4,bases.FIRINGCHANNEL+1);
<a name="L2386"><font color="white">02386</font>				else
<a name="L2387"><font color="white">02387</font>					bases.playAnim(LastPatrolPoint.PatrolAnim[temp_int],,0.4,bases.FIRINGCHANNEL+1);
<a name="L2388"><font color="white">02388</font>				FocalPoint = pawn.Location + LastPatrolPoint.lookdir;
<a name="L2389"><font color="white">02389</font>				Focus=none;
<a name="L2390"><font color="white">02390</font>				finishrotation();
<a name="L2391"><font color="white">02391</font>			}
<a name="L2392"><font color="white">02392</font>			else
<a name="L2393"><font color="white">02393</font>			{
<a name="L2394"><font color="white">02394</font>				/*Temp_vect=vector(LastPatrolPoint.rotation);
<a name="L2395"><font color="white">02395</font>				Temp_float= Temp_vect dot vector(pawn.rotation);
<a name="L2396"><font color="white">02396</font>				//btemp_bool= true -&gt; tourne vers droite sinon tourne vers gauche
<a name="L2397"><font color="white">02397</font>				btemp_bool= (((Temp_vect cross vect(0,0,-1)) dot vector(pawn.rotation))&lt;0);
<a name="L2398"><font color="white">02398</font>			 	if (abs(Temp_float)&lt;0.707)  			//anim pietinement
<a name="L2399"><font color="white">02399</font>				{
<a name="L2400"><font color="white">02400</font>					if (btemp_bool) //droite
<a name="L2401"><font color="white">02401</font>						pawn.loopAnim('RotationD',1,0.3,2);
<a name="L2402"><font color="white">02402</font>					else
<a name="L2403"><font color="white">02403</font>						pawn.loopAnim('RotationG',1,0.3,2);
<a name="L2404"><font color="white">02404</font>				}
<a name="L2405"><font color="white">02405</font>				pawn.AnimBlendToAlpha(2,1,0.3);
<a name="L2406"><font color="white">02406</font>				pawn.LoopAnim(WaitPatrolAnim,1,0.3,bases.FIRINGCHANNEL+1);
<a name="L2407"><font color="white">02407</font>			 	pawn.AnimBlendToAlpha(bases.FIRINGCHANNEL+1,0.5,0.3);   */
<a name="L2408"><font color="white">02408</font>				pawn.LoopAnim(WaitPatrolAnim,1,0.3,bases.FIRINGCHANNEL+1);
<a name="L2409"><font color="white">02409</font>				FocalPoint = pawn.Location + LastPatrolPoint.lookdir;
<a name="L2410"><font color="white">02410</font>				Focus=none;
<a name="L2411"><font color="white">02411</font>				finishrotation();
<a name="L2412"><font color="white">02412</font>				//pawn.AnimBlendToAlpha(2,0,0.5);
<a name="L2413"><font color="white">02413</font>				//pawn.AnimBlendToAlpha(bases.FIRINGCHANNEL+1,1,0.3);
<a name="L2414"><font color="white">02414</font>			}
<a name="L2415"><font color="white">02415</font>			sleeptime=Frand()*LastPatrolPoint.deltatime;
<a name="L2416"><font color="white">02416</font>			if (FRand()&lt;0.5)
<a name="L2417"><font color="white">02417</font>				sleeptime*=-1;
<a name="L2418"><font color="white">02418</font>			sleepTime += LastPatrolPoint.pausetime*0.55;
<a name="L2419"><font color="white">02419</font>			sleeptime = fmax(0.02,sleeptime);
<a name="L2420"><font color="white">02420</font>			Sleep(sleepTime);
<a name="L2421"><font color="white">02421</font>			if (LastPatrolPoint.event != '')
<a name="L2422"><font color="white">02422</font>			{
<a name="L2423"><font color="white">02423</font>				TriggerEvent(LastPatrolPoint.event, pawn, pawn);
<a name="L2424"><font color="white">02424</font>			}
<a name="L2425"><font color="white">02425</font>		}
<a name="L2426"><font color="white">02426</font>		if (LastPatrolPoint.bResteSurDernier)
<a name="L2427"><font color="white">02427</font>		{
<a name="L2428"><font color="white">02428</font>			if (CHARGE_LES_LOGS) log(pawn@&quot;stay here&quot;);
<a name="L2429"><font color="white">02429</font>			stop;
<a name="L2430"><font color="white">02430</font>		}
<a name="L2431"><font color="white">02431</font>	    Goto('Patrol');
<a name="L2432"><font color="white">02432</font>	}
<a name="L2433"><font color="white">02433</font>	
<a name="L2434"><font color="white">02434</font>	// ----------------------------------------------------------------------
<a name="L2435"><font color="white">02435</font>	// Etat d'errance
<a name="L2436"><font color="white">02436</font>	//
<a name="L2437"><font color="white">02437</font>	//
<a name="L2438"><font color="white">02438</font>	// ----------------------------------------------------------------------
<a name="L2439"><font color="white">02439</font>	state Errance
<a name="L2440"><font color="white">02440</font>	{
<a name="L2441"><font color="white">02441</font>	    ignores EnemyNotVisible;
<a name="L2442"><font color="white">02442</font>	
<a name="L2443"><font color="white">02443</font>	    event Seeplayer(pawn other)
<a name="L2444"><font color="white">02444</font>	    {
<a name="L2445"><font color="white">02445</font>	        if (setenemy(XIII))
<a name="L2446"><font color="white">02446</font>	            bDejaVu=true;
<a name="L2447"><font color="white">02447</font>	    }
<a name="L2448"><font color="white">02448</font>	    event SeeMonster(pawn other)
<a name="L2449"><font color="white">02449</font>	    {
<a name="L2450"><font color="white">02450</font>	        if (setenemy(other))
<a name="L2451"><font color="white">02451</font>	            bDejaVu=true;
<a name="L2452"><font color="white">02452</font>	    }
<a name="L2453"><font color="white">02453</font>	    event SeeDeadPawn(pawn other)
<a name="L2454"><font color="white">02454</font>	    {
<a name="L2455"><font color="white">02455</font>	        local basesoldier Soldier;
<a name="L2456"><font color="white">02456</font>	
<a name="L2457"><font color="white">02457</font>	        Soldier=basesoldier(other);
<a name="L2458"><font color="white">02458</font>	        if (bases.BNeVoitPascadavre || Soldier==none || Soldier.DrawType == DT_NONE || Soldier.bMonCadavreEstDejaVu || AllianceLevel(Soldier)!=1)
<a name="L2459"><font color="white">02459</font>	            return;
<a name="L2460"><font color="white">02460</font>	        instigator=other;
<a name="L2461"><font color="white">02461</font>	        bCadavreVu=true;
<a name="L2462"><font color="white">02462</font>	        Soldier.bMonCadavreEstDejaVu=true;
<a name="L2463"><font color="white">02463</font>	        EnemyAcquired();
<a name="L2464"><font color="white">02464</font>	        return;
<a name="L2465"><font color="white">02465</font>	    }
<a name="L2466"><font color="white">02466</font>	    event EnemyAcquired()
<a name="L2467"><font color="white">02467</font>	    {
<a name="L2468"><font color="white">02468</font>	        gotostate('acquisition');
<a name="L2469"><font color="white">02469</font>	    }
<a name="L2470"><font color="white">02470</font>	    event HearNoise(float Loudness, Actor NoiseMaker)
<a name="L2471"><font color="white">02471</font>	    {
<a name="L2472"><font color="white">02472</font>	        if (TestSonEntendu(NoiseMaker))
<a name="L2473"><font color="white">02473</font>	            enemyacquired();
<a name="L2474"><font color="white">02474</font>	    }
<a name="L2475"><font color="white">02475</font>	    singular function DamageAttitudeTo(pawn Other, float Damage)
<a name="L2476"><font color="white">02476</font>	    {
<a name="L2477"><font color="white">02477</font>	        //son
<a name="L2478"><font color="white">02478</font>	        bases.PlaySndPNJOno(pnjono'Onomatopees.hPNJHurt',bases.CodeMesh,bases.NumeroTimbre);
<a name="L2479"><font color="white">02479</font>	        if (setenemy(Other))
<a name="L2480"><font color="white">02480</font>	        {
<a name="L2481"><font color="white">02481</font>	            //genalerte.potepaffe(pawn);
<a name="L2482"><font color="white">02482</font>	            bPaffe=true;
<a name="L2483"><font color="white">02483</font>	        }
<a name="L2484"><font color="white">02484</font>	    }
<a name="L2485"><font color="white">02485</font>	    function PickDestination()
<a name="L2486"><font color="white">02486</font>	    {
<a name="L2487"><font color="white">02487</font>	        local vector pick, pickdir;
<a name="L2488"><font color="white">02488</font>	        local bool success;
<a name="L2489"><font color="white">02489</font>	        local float XY;
<a name="L2490"><font color="white">02490</font>	        local float MoveDist;
<a name="L2491"><font color="white">02491</font>	
<a name="L2492"><font color="white">02492</font>	        //Favor XY alignment
<a name="L2493"><font color="white">02493</font>	        //Log(self$&quot; GetFacingDirection Y.Dir=&quot;$(Y dot dir)$&quot; X.Dir=&quot;$(X dot dir));
<a name="L2494"><font color="white">02494</font>	        XY = FRand();
<a name="L2495"><font color="white">02495</font>	        if (XY &lt; 0.3)
<a name="L2496"><font color="white">02496</font>	        {
<a name="L2497"><font color="white">02497</font>	            pickdir.X = 1;
<a name="L2498"><font color="white">02498</font>	            pickdir.Y = 0;
<a name="L2499"><font color="white">02499</font>	        }
<a name="L2500"><font color="white">02500</font>	        else if (XY &lt; 0.6)
<a name="L2501"><font color="white">02501</font>	        {
<a name="L2502"><font color="white">02502</font>	            pickdir.X = 0;
<a name="L2503"><font color="white">02503</font>	            pickdir.Y = 1;
<a name="L2504"><font color="white">02504</font>	        }
<a name="L2505"><font color="white">02505</font>	        else
<a name="L2506"><font color="white">02506</font>	        {
<a name="L2507"><font color="white">02507</font>	            pickdir.X = 2 * FRand() - 1;
<a name="L2508"><font color="white">02508</font>	            pickdir.Y = 2 * FRand() - 1;
<a name="L2509"><font color="white">02509</font>	        }
<a name="L2510"><font color="white">02510</font>	        if (Pawn.Physics != PHYS_Walking)
<a name="L2511"><font color="white">02511</font>	        {
<a name="L2512"><font color="white">02512</font>	            pickdir.Z = 2 * FRand() - 1;
<a name="L2513"><font color="white">02513</font>	            pickdir = Normal(pickdir);
<a name="L2514"><font color="white">02514</font>	        }
<a name="L2515"><font color="white">02515</font>	        else
<a name="L2516"><font color="white">02516</font>	        {
<a name="L2517"><font color="white">02517</font>	            pickdir.Z = 0;
<a name="L2518"><font color="white">02518</font>	            if (XY &gt;= 0.6)
<a name="L2519"><font color="white">02519</font>	                pickdir = Normal(pickdir);
<a name="L2520"><font color="white">02520</font>	        }
<a name="L2521"><font color="white">02521</font>	        MoveDist = 150+DistanceDeplacement*(0.4+0.6*Frand());
<a name="L2522"><font color="white">02522</font>	        success = TestDirection(150.0,MoveDist,pickdir, pick);
<a name="L2523"><font color="white">02523</font>	        if (!success)
<a name="L2524"><font color="white">02524</font>	            if ((bTemp_Bool) &amp;&amp; (FRand()&lt;0.7))   //if don't work try to go straight
<a name="L2525"><font color="white">02525</font>	            {
<a name="L2526"><font color="white">02526</font>	                MoveDist = 150+DistanceDeplacement*(0.4+0.6*Frand());
<a name="L2527"><font color="white">02527</font>	                success = TestDirection(150,MoveDist,vector(pawn.rotation), pick);
<a name="L2528"><font color="white">02528</font>	            }
<a name="L2529"><font color="white">02529</font>	            else      //if don't work try in the opposite side
<a name="L2530"><font color="white">02530</font>	            {
<a name="L2531"><font color="white">02531</font>	                MoveDist = 150+DistanceDeplacement*(0.4+0.6*Frand());
<a name="L2532"><font color="white">02532</font>	                success = TestDirection(150,movedist,-1*pickdir, pick);
<a name="L2533"><font color="white">02533</font>	            }
<a name="L2534"><font color="white">02534</font>	
<a name="L2535"><font color="white">02535</font>	            if (success)
<a name="L2536"><font color="white">02536</font>	            {
<a name="L2537"><font color="white">02537</font>	                bTemp_Bool=true;
<a name="L2538"><font color="white">02538</font>	                DistNearWall=min(200,DistNearWall+5);
<a name="L2539"><font color="white">02539</font>	                DistanceDeplacement=min(600,DistanceDeplacement+45);
<a name="L2540"><font color="white">02540</font>	                Destination = pick;
<a name="L2541"><font color="white">02541</font>	            }
<a name="L2542"><font color="white">02542</font>	            else
<a name="L2543"><font color="white">02543</font>	            {
<a name="L2544"><font color="white">02544</font>	                bTemp_Bool=false;
<a name="L2545"><font color="white">02545</font>	                DistNearWall=fmax(4*pawn.collisionradius,DistNearWall-40);
<a name="L2546"><font color="white">02546</font>	                DistanceDeplacement=max(10,DistanceDeplacement-35);
<a name="L2547"><font color="white">02547</font>	                GotoState('errance','Turn');
<a name="L2548"><font color="white">02548</font>	            }
<a name="L2549"><font color="white">02549</font>	    }
<a name="L2550"><font color="white">02550</font>	
<a name="L2551"><font color="white">02551</font>	    function bool IsInWanderingVolume(WanderingVolume aVolume)
<a name="L2552"><font color="white">02552</font>	    {
<a name="L2553"><font color="white">02553</font>	        local WanderingVolume V;
<a name="L2554"><font color="white">02554</font>	
<a name="L2555"><font color="white">02555</font>	        ForEach pawn.TouchingActors(class'WanderingVolume',V)
<a name="L2556"><font color="white">02556</font>	            if ( V == aVolume )
<a name="L2557"><font color="white">02557</font>	                return true;
<a name="L2558"><font color="white">02558</font>	            return false;
<a name="L2559"><font color="white">02559</font>	    }
<a name="L2560"><font color="white">02560</font>	    function beginstate()
<a name="L2561"><font color="white">02561</font>	    {
<a name="L2562"><font color="white">02562</font>	        settimer(0,false);
<a name="L2563"><font color="white">02563</font>	        if (NiveauAlerte==1)
<a name="L2564"><font color="white">02564</font>	        {
<a name="L2565"><font color="white">02565</font>	            s_incattente();
<a name="L2566"><font color="white">02566</font>	            s_decAlerte();
<a name="L2567"><font color="white">02567</font>	        }
<a name="L2568"><font color="white">02568</font>	        else if (NiveauAlerte==2)
<a name="L2569"><font color="white">02569</font>	        {
<a name="L2570"><font color="white">02570</font>	            s_incattente();
<a name="L2571"><font color="white">02571</font>	            s_decAttaque();
<a name="L2572"><font color="white">02572</font>	        }
<a name="L2573"><font color="white">02573</font>	        NiveauAlerte=0;
<a name="L2574"><font color="white">02574</font>	        MinHitWall += 0.15;
<a name="L2575"><font color="white">02575</font>	        //test si dnas volume d'errance
<a name="L2576"><font color="white">02576</font>	        if (bases.MyWanderingVolume!=none &amp;&amp; !IsInWanderingVolume(bases.MyWanderingVolume))   //dans volume
<a name="L2577"><font color="white">02577</font>	        {
<a name="L2578"><font color="white">02578</font>	            if (CHARGE_LES_LOGS) log(pawn$&quot;pas dans le volume donc erre partout&quot;);
<a name="L2579"><font color="white">02579</font>	            bases.MyWanderingVolume=none;
<a name="L2580"><font color="white">02580</font>	        }
<a name="L2581"><font color="white">02581</font>	    }
<a name="L2582"><font color="white">02582</font>	    function Endstate()
<a name="L2583"><font color="white">02583</font>	    {
<a name="L2584"><font color="white">02584</font>	        MinHitWall -= 0.15;
<a name="L2585"><font color="white">02585</font>	        pawn.SpineYawControl(false,0,0);
<a name="L2586"><font color="white">02586</font>	    }
<a name="L2587"><font color="white">02587</font>	
<a name="L2588"><font color="white">02588</font>	Begin:
<a name="L2589"><font color="white">02589</font>	    if (CHARGE_LES_LOGS) log(pawn@&quot;ETAT  Wandering&quot;);
<a name="L2590"><font color="white">02590</font>	Wander:
<a name="L2591"><font color="white">02591</font>	    pawn.SpineYawControl(true,3000+rand(1000),1.2+0.8*frand());
<a name="L2592"><font color="white">02592</font>	    PickDestination();
<a name="L2593"><font color="white">02593</font>	combi_errance_patrouille:
<a name="L2594"><font color="white">02594</font>	    if (Bases.PourcErrance&lt;1)
<a name="L2595"><font color="white">02595</font>	    {
<a name="L2596"><font color="white">02596</font>	        if ((level.timeseconds-Temps_ref)&gt;Temps_Errance)
<a name="L2597"><font color="white">02597</font>	        {
<a name="L2598"><font color="white">02598</font>	            Temps_errance=(1-bases.PourcErrance)*10+2*Frand();
<a name="L2599"><font color="white">02599</font>	            Temps_ref=level.timeseconds;
<a name="L2600"><font color="white">02600</font>	            gotostate('patrouille');
<a name="L2601"><font color="white">02601</font>	        }
<a name="L2602"><font color="white">02602</font>	    }
<a name="L2603"><font color="white">02603</font>	Moving:
<a name="L2604"><font color="white">02604</font>	    focalpoint=destination;
<a name="L2605"><font color="white">02605</font>	    Temp_float=normal(destination-pawn.location) dot normal(vector(pawn.rotation));
<a name="L2606"><font color="white">02606</font>	    if (Temp_float&lt;0.3)
<a name="L2607"><font color="white">02607</font>	        sleep(10000*(1-Temp_float)/pawn.rotationrate.yaw);
<a name="L2608"><font color="white">02608</font>	    MoveTo(Destination,None, Bases.WalkingSpeed);
<a name="L2609"><font color="white">02609</font>	Pausing:
<a name="L2610"><font color="white">02610</font>	    Pawn.Acceleration = vect(0,0,0);
<a name="L2611"><font color="white">02611</font>	    pawn.velocity=vect(0,0,0);
<a name="L2612"><font color="white">02612</font>	    pawn.SpineYawControl(true,2000+rand(1000),0.8+0.6*frand());
<a name="L2613"><font color="white">02613</font>	    if (bases.MyWanderingVolume!=none &amp;&amp; !IsInWanderingVolume(bases.MyWanderingVolume))   //dans volume
<a name="L2614"><font color="white">02614</font>	    {
<a name="L2615"><font color="white">02615</font>	        //log(pawn$&quot;ATTENTION je sort du volume demi-tour&quot;);
<a name="L2616"><font color="white">02616</font>	        focalpoint=-DistanceDeplacement*vector(pawn.rotation)+pawn.location;
<a name="L2617"><font color="white">02617</font>	        finishrotation();
<a name="L2618"><font color="white">02618</font>	        DistanceDeplacement=max(10,DistanceDeplacement-40);
<a name="L2619"><font color="white">02619</font>	        MoveTo(focalpoint,None, Bases.WalkingSpeed);
<a name="L2620"><font color="white">02620</font>	    }
<a name="L2621"><font color="white">02621</font>	    if (NearWall(DistNearWall))
<a name="L2622"><font color="white">02622</font>	    {
<a name="L2623"><font color="white">02623</font>	        DistanceDeplacement=max(10,DistanceDeplacement-10);
<a name="L2624"><font color="white">02624</font>	        DistNearWall=fmax(2*pawn.collisionradius,DistNearWall-5);
<a name="L2625"><font color="white">02625</font>	        FinishRotation();
<a name="L2626"><font color="white">02626</font>	    }
<a name="L2627"><font color="white">02627</font>	    Sleep(1.0);
<a name="L2628"><font color="white">02628</font>	    goto('wander');
<a name="L2629"><font color="white">02629</font>	Turn:
<a name="L2630"><font color="white">02630</font>	    pawn.SpineYawControl(true,2000+rand(1000),0.8+0.6*frand());
<a name="L2631"><font color="white">02631</font>	    pawn.velocity=vect(0,0,0);
<a name="L2632"><font color="white">02632</font>	    Pawn.Acceleration = vect(0,0,0);
<a name="L2633"><font color="white">02633</font>	    Focus = None;
<a name="L2634"><font color="white">02634</font>	    FocalPoint = Location + 20 * VRand();
<a name="L2635"><font color="white">02635</font>	    FinishRotation();
<a name="L2636"><font color="white">02636</font>	    Goto('Pausing');
<a name="L2637"><font color="white">02637</font>	}
<a name="L2638"><font color="white">02638</font>	
<a name="L2639"><font color="white">02639</font>	// ----------------------------------------------------------------------
<a name="L2640"><font color="white">02640</font>	//Etat tenir
<a name="L2641"><font color="white">02641</font>	//
<a name="L2642"><font color="white">02642</font>	//
<a name="L2643"><font color="white">02643</font>	// ----------------------------------------------------------------------
<a name="L2644"><font color="white">02644</font>	state Tenir
<a name="L2645"><font color="white">02645</font>	{
<a name="L2646"><font color="white">02646</font>	    ignores EnemyNotVisible;
<a name="L2647"><font color="white">02647</font>	    event Seeplayer(pawn other)
<a name="L2648"><font color="white">02648</font>	    {
<a name="L2649"><font color="white">02649</font>	        if (setenemy(XIII))
<a name="L2650"><font color="white">02650</font>	            bDejaVu=true;
<a name="L2651"><font color="white">02651</font>	    }
<a name="L2652"><font color="white">02652</font>	    event SeeMonster(pawn other)
<a name="L2653"><font color="white">02653</font>	    {
<a name="L2654"><font color="white">02654</font>	        if (setenemy(other))
<a name="L2655"><font color="white">02655</font>	            bDejaVu=true;
<a name="L2656"><font color="white">02656</font>	    }
<a name="L2657"><font color="white">02657</font>	    event SeeDeadPawn(pawn other)
<a name="L2658"><font color="white">02658</font>	    {
<a name="L2659"><font color="white">02659</font>	        local basesoldier Soldier;
<a name="L2660"><font color="white">02660</font>	
<a name="L2661"><font color="white">02661</font>	        Soldier=basesoldier(other);
<a name="L2662"><font color="white">02662</font>	        if (bases.BNeVoitPascadavre || Soldier==none || Soldier.DrawType == DT_NONE || Soldier.bMonCadavreEstDejaVu || AllianceLevel(Soldier)!=1)
<a name="L2663"><font color="white">02663</font>	            return;
<a name="L2664"><font color="white">02664</font>	
<a name="L2665"><font color="white">02665</font>	        instigator=other;
<a name="L2666"><font color="white">02666</font>	        bCadavreVu=true;
<a name="L2667"><font color="white">02667</font>	        Soldier.bMonCadavreEstDejaVu=true;
<a name="L2668"><font color="white">02668</font>	        EnemyAcquired();
<a name="L2669"><font color="white">02669</font>	        return;
<a name="L2670"><font color="white">02670</font>	    }
<a name="L2671"><font color="white">02671</font>	    event EnemyAcquired()
<a name="L2672"><font color="white">02672</font>	    {
<a name="L2673"><font color="white">02673</font>	        gotostate('acquisition');
<a name="L2674"><font color="white">02674</font>	    }
<a name="L2675"><font color="white">02675</font>	    event HearNoise(float Loudness, Actor NoiseMaker)
<a name="L2676"><font color="white">02676</font>	    {
<a name="L2677"><font color="white">02677</font>	        if (TestSonEntendu(NoiseMaker))
<a name="L2678"><font color="white">02678</font>	            enemyacquired();
<a name="L2679"><font color="white">02679</font>	    }
<a name="L2680"><font color="white">02680</font>	    singular function DamageAttitudeTo(pawn Other, float Damage)
<a name="L2681"><font color="white">02681</font>	    {
<a name="L2682"><font color="white">02682</font>	        //son
<a name="L2683"><font color="white">02683</font>	        bases.PlaySndPNJOno(pnjono'Onomatopees.hPNJHurt',bases.CodeMesh,bases.NumeroTimbre);
<a name="L2684"><font color="white">02684</font>	        if (setenemy(Other))
<a name="L2685"><font color="white">02685</font>	        {
<a name="L2686"><font color="white">02686</font>	            //genalerte.potepaffe(pawn);
<a name="L2687"><font color="white">02687</font>	            bPaffe=true;
<a name="L2688"><font color="white">02688</font>	        }
<a name="L2689"><font color="white">02689</font>	    }
<a name="L2690"><font color="white">02690</font>	    function beginstate()
<a name="L2691"><font color="white">02691</font>	    {
<a name="L2692"><font color="white">02692</font>	        settimer(0,false);
<a name="L2693"><font color="white">02693</font>	        if (NiveauAlerte==1)
<a name="L2694"><font color="white">02694</font>	        {
<a name="L2695"><font color="white">02695</font>	            s_incattente();
<a name="L2696"><font color="white">02696</font>	            s_decAlerte();
<a name="L2697"><font color="white">02697</font>	        }
<a name="L2698"><font color="white">02698</font>	        else if (NiveauAlerte==2)
<a name="L2699"><font color="white">02699</font>	        {
<a name="L2700"><font color="white">02700</font>	            s_incattente();
<a name="L2701"><font color="white">02701</font>	            s_decAttaque();
<a name="L2702"><font color="white">02702</font>	        }
<a name="L2703"><font color="white">02703</font>	        NiveauAlerte=0;
<a name="L2704"><font color="white">02704</font>	        pawn.SpineYawControl(true,2000+rand(1000),0.8+0.6*frand());
<a name="L2705"><font color="white">02705</font>	    }
<a name="L2706"><font color="white">02706</font>	    function Endstate()
<a name="L2707"><font color="white">02707</font>	    {
<a name="L2708"><font color="white">02708</font>	        if (EtatNeutre == 'tenir')
<a name="L2709"><font color="white">02709</font>	        {
<a name="L2710"><font color="white">02710</font>	            PointTenirPos=pawn.location;
<a name="L2711"><font color="white">02711</font>	            PointTenirRot=pawn.rotation;
<a name="L2712"><font color="white">02712</font>	        }
<a name="L2713"><font color="white">02713</font>	        pawn.SpineYawControl(false,0,0);
<a name="L2714"><font color="white">02714</font>	    }
<a name="L2715"><font color="white">02715</font>	
<a name="L2716"><font color="white">02716</font>	BackToFormation:
<a name="L2717"><font color="white">02717</font>	    if (CHARGE_LES_LOGS) log(pawn@&quot;ETAT tiens position  BACKTO FORMATION&quot;);
<a name="L2718"><font color="white">02718</font>	    if (FastTrace(PointTenirPos-vect(0,0,30)))
<a name="L2719"><font color="white">02719</font>	    {
<a name="L2720"><font color="white">02720</font>	        focalpoint=PointTenirPos;
<a name="L2721"><font color="white">02721</font>	        focus=none;
<a name="L2722"><font color="white">02722</font>	        MoveTo(PointTenirPos,none);
<a name="L2723"><font color="white">02723</font>	        focalpoint=1000*vector(pointtenirRot)+pawn.location;
<a name="L2724"><font color="white">02724</font>	        focus=none;
<a name="L2725"><font color="white">02725</font>	    }
<a name="L2726"><font color="white">02726</font>	    else
<a name="L2727"><font color="white">02727</font>	    {
<a name="L2728"><font color="white">02728</font>	        if (FindBestPathTo(PointTenirPos))
<a name="L2729"><font color="white">02729</font>	        {
<a name="L2730"><font color="white">02730</font>	            for (temp_int=0;temp_int&lt;16;temp_int++)
<a name="L2731"><font color="white">02731</font>	            {
<a name="L2732"><font color="white">02732</font>	                if (routecache[temp_int]==none)
<a name="L2733"><font color="white">02733</font>	                    break;
<a name="L2734"><font color="white">02734</font>	                PointChemin[temp_int]=routecache[temp_int];
<a name="L2735"><font color="white">02735</font>	            }
<a name="L2736"><font color="white">02736</font>	            NbPointChemin=temp_int;
<a name="L2737"><font color="white">02737</font>	            for (iCompteur=0;iCompteur&lt;NbPointChemin;iCompteur++)
<a name="L2738"><font color="white">02738</font>	            {
<a name="L2739"><font color="white">02739</font>	                MoveToward(PointChemin[iCompteur],PointChemin[iCompteur]);
<a name="L2740"><font color="white">02740</font>	            }
<a name="L2741"><font color="white">02741</font>	            focalpoint=PointTenirPos;
<a name="L2742"><font color="white">02742</font>	            focus=none;
<a name="L2743"><font color="white">02743</font>	            MoveTo(PointTenirPos,none);
<a name="L2744"><font color="white">02744</font>	            focalpoint=vector(pointtenirRot)+pawn.location;
<a name="L2745"><font color="white">02745</font>	        }
<a name="L2746"><font color="white">02746</font>	    }
<a name="L2747"><font color="white">02747</font>	begin:
<a name="L2748"><font color="white">02748</font>	    if (CHARGE_LES_LOGS) log(pawn@&quot;ETAT tiens position&quot;);
<a name="L2749"><font color="white">02749</font>	    pawn.velocity=vect(0,0,0);
<a name="L2750"><font color="white">02750</font>	    pawn.Acceleration = vect(0,0,0);
<a name="L2751"><font color="white">02751</font>	Targetenemy:
<a name="L2752"><font color="white">02752</font>	}
<a name="L2753"><font color="white">02753</font>	
<a name="L2754"><font color="white">02754</font>	// ----------------------------------------------------------------------
<a name="L2755"><font color="white">02755</font>	// Etat de ResteSurPlace
<a name="L2756"><font color="white">02756</font>	//
<a name="L2757"><font color="white">02757</font>	//
<a name="L2758"><font color="white">02758</font>	// ----------------------------------------------------------------------
<a name="L2759"><font color="white">02759</font>	state ResteSurPlace
<a name="L2760"><font color="white">02760</font>	{
<a name="L2761"><font color="white">02761</font>	    ignores EnemyNotVisible,hearnoise;
<a name="L2762"><font color="white">02762</font>	
<a name="L2763"><font color="white">02763</font>	    singular event bool NotifyBump(actor Other)
<a name="L2764"><font color="white">02764</font>	    {
<a name="L2765"><font color="white">02765</font>	        return false;
<a name="L2766"><font color="white">02766</font>	    }
<a name="L2767"><font color="white">02767</font>	
<a name="L2768"><font color="white">02768</font>	    event Tick(float DeltaTime)
<a name="L2769"><font color="white">02769</font>	    {
<a name="L2770"><font color="white">02770</font>	        global.tick(DeltaTime);
<a name="L2771"><font color="white">02771</font>	
<a name="L2772"><font color="white">02772</font>	        if (bFuitPourreloader &amp;&amp; (level.timeseconds-Timer_VaRecharger)&gt;1.5)
<a name="L2773"><font color="white">02773</font>	        {
<a name="L2774"><font color="white">02774</font>	            bFuitPourreloader=false;
<a name="L2775"><font color="white">02775</font>	            gotostate('attaque');
<a name="L2776"><font color="white">02776</font>	        }
<a name="L2777"><font color="white">02777</font>	    }
<a name="L2778"><font color="white">02778</font>	
<a name="L2779"><font color="white">02779</font>	    event Seeplayer(pawn other)
<a name="L2780"><font color="white">02780</font>	    {
<a name="L2781"><font color="white">02781</font>				if (enemy==none || !bdejavu)
<a name="L2782"><font color="white">02782</font>				{
<a name="L2783"><font color="white">02783</font>					if (setenemy(XIII))
<a name="L2784"><font color="white">02784</font>	                bDejaVu=true;
<a name="L2785"><font color="white">02785</font>				}
<a name="L2786"><font color="white">02786</font>				else  if (enemy!=none &amp;&amp; enemy==other)
<a name="L2787"><font color="white">02787</font>	            	SeeEnemy();
<a name="L2788"><font color="white">02788</font>	    }
<a name="L2789"><font color="white">02789</font>	    event SeeMonster(pawn other)
<a name="L2790"><font color="white">02790</font>	    {
<a name="L2791"><font color="white">02791</font>	        if (enemy==none || !bdejavu)
<a name="L2792"><font color="white">02792</font>				{
<a name="L2793"><font color="white">02793</font>					if (setenemy(other))
<a name="L2794"><font color="white">02794</font>	                bDejaVu=true;
<a name="L2795"><font color="white">02795</font>				}
<a name="L2796"><font color="white">02796</font>				else
<a name="L2797"><font color="white">02797</font>				{
<a name="L2798"><font color="white">02798</font>				  if (enemy!=none &amp;&amp; enemy==other)
<a name="L2799"><font color="white">02799</font>	            	SeeEnemy();
<a name="L2800"><font color="white">02800</font>			  }
<a name="L2801"><font color="white">02801</font>	    }
<a name="L2802"><font color="white">02802</font>	    event SeeDeadPawn(pawn other)
<a name="L2803"><font color="white">02803</font>	    {
<a name="L2804"><font color="white">02804</font>	        local basesoldier Soldier;
<a name="L2805"><font color="white">02805</font>	
<a name="L2806"><font color="white">02806</font>	        Soldier=basesoldier(other);
<a name="L2807"><font color="white">02807</font>	        if (bases.BNeVoitPascadavre || Soldier==none || Soldier.DrawType == DT_NONE || Soldier.bMonCadavreEstDejaVu || AllianceLevel(Soldier)!=1)
<a name="L2808"><font color="white">02808</font>	            return;
<a name="L2809"><font color="white">02809</font>	        Soldier.bMonCadavreEstDejaVu=true;
<a name="L2810"><font color="white">02810</font>	        instigator=other;
<a name="L2811"><font color="white">02811</font>	        bCadavreVu=true;
<a name="L2812"><font color="white">02812</font>	        EnemyAcquired();
<a name="L2813"><font color="white">02813</font>	        return;
<a name="L2814"><font color="white">02814</font>	    }
<a name="L2815"><font color="white">02815</font>	    event EnemyAcquired()
<a name="L2816"><font color="white">02816</font>	    {
<a name="L2817"><font color="white">02817</font>	        if (bCampeversSafePoint)
<a name="L2818"><font color="white">02818</font>	            gotostate('acquisition');
<a name="L2819"><font color="white">02819</font>	        else
<a name="L2820"><font color="white">02820</font>	            gotostate('attaque');
<a name="L2821"><font color="white">02821</font>	    }
<a name="L2822"><font color="white">02822</font>	
<a name="L2823"><font color="white">02823</font>	    singular function DamageAttitudeTo(pawn Other, float Damage)
<a name="L2824"><font color="white">02824</font>	    {
<a name="L2825"><font color="white">02825</font>	        //son
<a name="L2826"><font color="white">02826</font>	        bases.PlaySndPNJOno(pnjono'Onomatopees.hPNJHurt',bases.CodeMesh,bases.NumeroTimbre);
<a name="L2827"><font color="white">02827</font>	
<a name="L2828"><font color="white">02828</font>	        if (bDisableDamageattitudeto)
<a name="L2829"><font color="white">02829</font>	            return;
<a name="L2830"><font color="white">02830</font>	        if (setenemy(Other))
<a name="L2831"><font color="white">02831</font>	        {
<a name="L2832"><font color="white">02832</font>	            //genalerte.potepaffe(pawn);
<a name="L2833"><font color="white">02833</font>	            bPaffe=true;
<a name="L2834"><font color="white">02834</font>	        }
<a name="L2835"><font color="white">02835</font>	    }
<a name="L2836"><font color="white">02836</font>	    function bool TestDirectionAvoidingAlly(vector pickdir, out vector pick,basesoldier PoteAEviter)
<a name="L2837"><font color="white">02837</font>	    {
<a name="L2838"><font color="white">02838</font>	        local float MoveDist;
<a name="L2839"><font color="white">02839</font>	
<a name="L2840"><font color="white">02840</font>	        if (Vsize(PoteAEviter.location - pawn.location)&gt;160)
<a name="L2841"><font color="white">02841</font>	            pickdir += 0.99*normal(Enemy.location-pawn.location); // pour partir a 45 degres si charge
<a name="L2842"><font color="white">02842</font>	        else
<a name="L2843"><font color="white">02843</font>	            pickdir +=0.3*normal(Enemy.location-pawn.location); // pour partir a 80 degres si charge
<a name="L2844"><font color="white">02844</font>	
<a name="L2845"><font color="white">02845</font>	        if (Vsize(PoteAEviter.location - enemy.location)&lt;300 || Vsize(PoteAEviter.location - pawn.location)&lt;=160)
<a name="L2846"><font color="white">02846</font>	            MoveDist=140;
<a name="L2847"><font color="white">02847</font>	        else
<a name="L2848"><font color="white">02848</font>	            MoveDist=110+150*FRand();
<a name="L2849"><font color="white">02849</font>	        return TestDirection(110,MoveDist,-1*pickdir, pick);
<a name="L2850"><font color="white">02850</font>	    }
<a name="L2851"><font color="white">02851</font>	
<a name="L2852"><font color="white">02852</font>	    function bool TestPasSurCote(basesoldier PoteAEviter)
<a name="L2853"><font color="white">02853</font>	    {
<a name="L2854"><font color="white">02854</font>	        local vector pick, pickdir;
<a name="L2855"><font color="white">02855</font>	        local bool success;
<a name="L2856"><font color="white">02856</font>	
<a name="L2857"><font color="white">02857</font>	        pickdir=(Enemy.location-pawn.location) cross vect(0,0,1);
<a name="L2858"><font color="white">02858</font>	        pickdir.Z = 0;
<a name="L2859"><font color="white">02859</font>	        pickdir=normal(pickdir);
<a name="L2860"><font color="white">02860</font>	
<a name="L2861"><font color="white">02861</font>	        success = TestDirectionAvoidingAlly(pickdir, pick,PoteAEviter);
<a name="L2862"><font color="white">02862</font>	        if (!success)
<a name="L2863"><font color="white">02863</font>	            success = TestDirectionAvoidingAlly(-1*pickdir, pick,PoteAEviter);
<a name="L2864"><font color="white">02864</font>	        Destination = pick;
<a name="L2865"><font color="white">02865</font>	        return success;
<a name="L2866"><font color="white">02866</font>	    }
<a name="L2867"><font color="white">02867</font>	
<a name="L2868"><font color="white">02868</font>	    function beginstate()
<a name="L2869"><font color="white">02869</font>	    {
<a name="L2870"><font color="white">02870</font>	        //reactions
<a name="L2871"><font color="white">02871</font>	        //bDisableEventSeeDeadPawn=true; //desactive detection cadavre
<a name="L2872"><font color="white">02872</font>	        if (!bCadavreVU)
<a name="L2873"><font color="white">02873</font>		     		focus=xiii; //cheat Il sait ou est XIII
<a name="L2874"><font color="white">02874</font>	         else
<a name="L2875"><font color="white">02875</font>		     		focus=none;
<a name="L2876"><font color="white">02876</font>	        if (bCampeversSafePoint)
<a name="L2877"><font color="white">02877</font>	        {
<a name="L2878"><font color="white">02878</font>	            bdejavu=false;
<a name="L2879"><font color="white">02879</font>	            bases.balerte=true;
<a name="L2880"><font color="white">02880</font>	            SetVigilant(true);
<a name="L2881"><font color="white">02881</font>	            bEtatAlerte=true;
<a name="L2882"><font color="white">02882</font>	            enemy=none;
<a name="L2883"><font color="white">02883</font>	        }
<a name="L2884"><font color="white">02884</font>	        else
<a name="L2885"><font color="white">02885</font>	        {
<a name="L2886"><font color="white">02886</font>	            bDejaVu=true;     //desactive detection son
<a name="L2887"><font color="white">02887</font>	        }
<a name="L2888"><font color="white">02888</font>	        settimer(0,false);
<a name="L2889"><font color="white">02889</font>	        if (NiveauAlerte==0)
<a name="L2890"><font color="white">02890</font>	        {
<a name="L2891"><font color="white">02891</font>	            s_decattente();
<a name="L2892"><font color="white">02892</font>	            s_incAlerte();
<a name="L2893"><font color="white">02893</font>	        }
<a name="L2894"><font color="white">02894</font>	        else if (NiveauAlerte==2)
<a name="L2895"><font color="white">02895</font>	        {
<a name="L2896"><font color="white">02896</font>	            s_incalerte();
<a name="L2897"><font color="white">02897</font>	            s_decAttaque();
<a name="L2898"><font color="white">02898</font>	        }
<a name="L2899"><font color="white">02899</font>	        NiveauAlerte=1;
<a name="L2900"><font color="white">02900</font>	        bFuitPourreloader=false;
<a name="L2901"><font color="white">02901</font>	    }
<a name="L2902"><font color="white">02902</font>	    function Endstate()
<a name="L2903"><font color="white">02903</font>	    {
<a name="L2904"><font color="white">02904</font>		    if (bcontrolanimations) bases.ReleaseAnimControl();
<a name="L2905"><font color="white">02905</font>	        if (pawn.biscrouched)
<a name="L2906"><font color="white">02906</font>	            pawn.shouldcrouch(false);
<a name="L2907"><font color="white">02907</font>	        bDisableDamageattitudeto=false;
<a name="L2908"><font color="white">02908</font>	        bCampeversSafePoint=false;
<a name="L2909"><font color="white">02909</font>	        bRetraiteVersSafePoint=false;
<a name="L2910"><font color="white">02910</font>				if (SafePointOccupe!=none)
<a name="L2911"><font color="white">02911</font>				{
<a name="L2912"><font color="white">02912</font>					SafePointOccupe.timer();
<a name="L2913"><font color="white">02913</font>					SafePointOccupe=none;
<a name="L2914"><font color="white">02914</font>				}
<a name="L2915"><font color="white">02915</font>				if (bCadavreVU)
<a name="L2916"><font color="white">02916</font>		 		{
<a name="L2917"><font color="white">02917</font>					bcadavrevu=false;
<a name="L2918"><font color="white">02918</font>					Pawn.PeripheralVision=fmin(DefaultPeripheralVision,0);
<a name="L2919"><font color="white">02919</font>				}
<a name="L2920"><font color="white">02920</font>	    }
<a name="L2921"><font color="white">02921</font>	
<a name="L2922"><font color="white">02922</font>	    //y rester 10 s si alarme ou fuite, sinon tout le temps (pour bruit d'impact et quoique)
<a name="L2923"><font color="white">02923</font>	begin:
<a name="L2924"><font color="white">02924</font>	    pawn.velocity=vect(0,0,0);
<a name="L2925"><font color="white">02925</font>	    pawn.acceleration=vect(0,0,0);
<a name="L2926"><font color="white">02926</font>	    if (CHARGE_LES_LOGS) log(pawn@&quot;ETAT Reste SUr Place&quot;);
<a name="L2927"><font color="white">02927</font>		 if (bCadavreVU)
<a name="L2928"><font color="white">02928</font>		 {
<a name="L2929"><font color="white">02929</font>				pawn.playwaiting();
<a name="L2930"><font color="white">02930</font>				focus=none;
<a name="L2931"><font color="white">02931</font>				focalpoint+=0.5*vsize(focalpoint)*normal(XIII.location-pawn.location);
<a name="L2932"><font color="white">02932</font>	      	finishrotation();
<a name="L2933"><font color="white">02933</font>				sleep(0.1);
<a name="L2934"><font color="white">02934</font>				Pawn.PeripheralVision=fmin(DefaultPeripheralVision,-0.5);
<a name="L2935"><font color="white">02935</font>				bases.PlayQuickLookAround();
<a name="L2936"><font color="white">02936</font>				FinishAnim(bases.firingChannel+1);
<a name="L2937"><font color="white">02937</font>				Bases.ReleaseAnimControl();
<a name="L2938"><font color="white">02938</font>				pawn.playwaiting();
<a name="L2939"><font color="white">02939</font>				sleep(1.15);
<a name="L2940"><font color="white">02940</font>				bases.Shouldcrouch(true);
<a name="L2941"><font color="white">02941</font>	    }
<a name="L2942"><font color="white">02942</font>		 if (enemy!=none)
<a name="L2943"><font color="white">02943</font>	    {
<a name="L2944"><font color="white">02944</font>	        focus=enemy;
<a name="L2945"><font color="white">02945</font>	        finishrotation();
<a name="L2946"><font color="white">02946</font>	    }
<a name="L2947"><font color="white">02947</font>	    if (bRetraiteVersSafePoint)
<a name="L2948"><font color="white">02948</font>	    {
<a name="L2949"><font color="white">02949</font>	        sleep(1+4*frand());
<a name="L2950"><font color="white">02950</font>	        gotostate('attaque');
<a name="L2951"><font color="white">02951</font>	    }
<a name="L2952"><font color="white">02952</font>	    stop;
<a name="L2953"><font color="white">02953</font>	PoteMeBLoque:
<a name="L2954"><font color="white">02954</font>	    if (PoteQuiMeBloque==none)  //blindage
<a name="L2955"><font color="white">02955</font>	        gotostate('attaque');
<a name="L2956"><font color="white">02956</font>	    log(pawn@&quot;POTE ME BLOQUE J4ATTEND EN ME RECALANT&quot;);
<a name="L2957"><font color="white">02957</font>	    disable('seeplayer');
<a name="L2958"><font color="white">02958</font>	    disable('seemonster');
<a name="L2959"><font color="white">02959</font>	    pawn.velocity=vect(0,0,0);
<a name="L2960"><font color="white">02960</font>	    pawn.acceleration=vect(0,0,0);
<a name="L2961"><font color="white">02961</font>		if (enemy!=none)
<a name="L2962"><font color="white">02962</font>	   {
<a name="L2963"><font color="white">02963</font>			//if (fasttrace(-200*vector(pawn.rotation)+pawn.location))
<a name="L2964"><font color="white">02964</font>	      Moveto(-200*vector(pawn.rotation)+pawn.location,enemy,bases.walkingspeed);
<a name="L2965"><font color="white">02965</font>	   }
<a name="L2966"><font color="white">02966</font>	   else
<a name="L2967"><font color="white">02967</font>	   {
<a name="L2968"><font color="white">02968</font>	
<a name="L2969"><font color="white">02969</font>	      //if (fasttrace(-200*vector(pawn.rotation)+pawn.location))
<a name="L2970"><font color="white">02970</font>	      Moveto(-200*vector(pawn.rotation)+pawn.location,PoteQuiMeBloque,bases.walkingspeed);
<a name="L2971"><font color="white">02971</font>	   }
<a name="L2972"><font color="white">02972</font>	    //boucle pour un max de 3s
<a name="L2973"><font color="white">02973</font>		sleep(0.5+frand());
<a name="L2974"><font color="white">02974</font>	    for (temp_int=0;temp_int&lt;6;temp_int++)
<a name="L2975"><font color="white">02975</font>	    {
<a name="L2976"><font color="white">02976</font>	        if (PoteQuiMeBloque.bisdead || vsize(PoteQuiMeBloque.location-PoteQuiMeBloquePos)&gt;100)
<a name="L2977"><font color="white">02977</font>	            break;
<a name="L2978"><font color="white">02978</font>				sleep(0.5);
<a name="L2979"><font color="white">02979</font>	    }
<a name="L2980"><font color="white">02980</font>		bases.bslave=false;
<a name="L2981"><font color="white">02981</font>		bases.bDetecteBloquage=false;
<a name="L2982"><font color="white">02982</font>	   PoteQuiMeBloque=none;
<a name="L2983"><font color="white">02983</font>	   gotostate(prevstate);
<a name="L2984"><font color="white">02984</font>	}
<a name="L2985"><font color="white">02985</font>	// ----------------------------------------------------------------------
<a name="L2986"><font color="white">02986</font>	// Etat d'acquisition        (enemy!=none)
<a name="L2987"><font color="white">02987</font>	//
<a name="L2988"><font color="white">02988</font>	//
<a name="L2989"><font color="white">02989</font>	// ----------------------------------------------------------------------
<a name="L2990"><font color="white">02990</font>	
<a name="L2991"><font color="white">02991</font>	state Acquisition
<a name="L2992"><font color="white">02992</font>	{
<a name="L2993"><font color="white">02993</font>		Function SeeEnemy()
<a name="L2994"><font color="white">02994</font>		{
<a name="L2995"><font color="white">02995</font>			LastSeenTime = Level.TimeSeconds;
<a name="L2996"><font color="white">02996</font>			LastSeeingPos = Pawn.Location;
<a name="L2997"><font color="white">02997</font>			LastSeenPos = Enemy.Location;
<a name="L2998"><font color="white">02998</font>			EnemyAcquired();
<a name="L2999"><font color="white">02999</font>		}
<a name="L3000"><font color="white">03000</font>		event timer2()
<a name="L3001"><font color="white">03001</font>		{
<a name="L3002"><font color="white">03002</font>				LOCAL Rotator rl;
<a name="L3003"><font color="white">03003</font>				LOCAL int n;
<a name="L3004"><font color="white">03004</font>	
<a name="L3005"><font color="white">03005</font>				if ( PeeredEnemy!=none )
<a name="L3006"><font color="white">03006</font>				{
<a name="L3007"><font color="white">03007</font>					rl=rotator(PeeredEnemy.Location-pawn.Location)-pawn.Rotation;
<a name="L3008"><font color="white">03008</font>	
<a name="L3009"><font color="white">03009</font>					n=rl.Yaw;//-16384;
<a name="L3010"><font color="white">03010</font>					n=((n+32768)&amp;65535)-32768;
<a name="L3011"><font color="white">03011</font>	
<a name="L3012"><font color="white">03012</font>					if ((15000&gt;n) &amp;&amp; (n&gt;-15000))
<a name="L3013"><font color="white">03013</font>					{
<a name="L3014"><font color="white">03014</font>						pawn.HeadYaw = pawn.HeadYaw*0.6+0.4*n;
<a name="L3015"><font color="white">03015</font>						rl.Yaw=0;
<a name="L3016"><font color="white">03016</font>						rl.Pitch=0;
<a name="L3017"><font color="white">03017</font>						rl.Roll=pawn.HeadYaw;
<a name="L3018"><font color="white">03018</font>						pawn.SetBoneRotation('X HEAD',rl,,0.75);
<a name="L3019"><font color="white">03019</font>					}
<a name="L3020"><font color="white">03020</font>					else
<a name="L3021"><font color="white">03021</font>					{
<a name="L3022"><font color="white">03022</font>						pawn.HeadYaw = pawn.HeadYaw*0.7;
<a name="L3023"><font color="white">03023</font>						rl.Yaw=0;
<a name="L3024"><font color="white">03024</font>						rl.Pitch=0;
<a name="L3025"><font color="white">03025</font>						rl.Roll= pawn.HeadYaw;
<a name="L3026"><font color="white">03026</font>						pawn.SetBoneRotation('X HEAD',rl,,0.75);
<a name="L3027"><font color="white">03027</font>					}
<a name="L3028"><font color="white">03028</font>				}
<a name="L3029"><font color="white">03029</font>				else
<a name="L3030"><font color="white">03030</font>				{
<a name="L3031"><font color="white">03031</font>					if ( pawn.HeadYaw!=0 )
<a name="L3032"><font color="white">03032</font>					{
<a name="L3033"><font color="white">03033</font>						pawn.HeadYaw = pawn.HeadYaw*0.8;
<a name="L3034"><font color="white">03034</font>						if (pawn.HeadYaw &gt; 100 )
<a name="L3035"><font color="white">03035</font>						{
<a name="L3036"><font color="white">03036</font>							rl.Yaw=0;
<a name="L3037"><font color="white">03037</font>							rl.Pitch=0;
<a name="L3038"><font color="white">03038</font>							rl.Roll= pawn.HeadYaw;
<a name="L3039"><font color="white">03039</font>							pawn.SetBoneRotation('X HEAD',rl,,0.75);
<a name="L3040"><font color="white">03040</font>						}
<a name="L3041"><font color="white">03041</font>						else
<a name="L3042"><font color="white">03042</font>						{
<a name="L3043"><font color="white">03043</font>							pawn.HeadYaw=0;
<a name="L3044"><font color="white">03044</font>							rl.Yaw=0;
<a name="L3045"><font color="white">03045</font>							rl.Pitch=0;
<a name="L3046"><font color="white">03046</font>							rl.Roll= 0;
<a name="L3047"><font color="white">03047</font>							settimer2(0,false);
<a name="L3048"><font color="white">03048</font>							pawn.SetBoneRotation('X HEAD',rl,,0.0);
<a name="L3049"><font color="white">03049</font>						}
<a name="L3050"><font color="white">03050</font>					}
<a name="L3051"><font color="white">03051</font>				}
<a name="L3052"><font color="white">03052</font>		}
<a name="L3053"><font color="white">03053</font>		 event Seeplayer(pawn other)
<a name="L3054"><font color="white">03054</font>	    {
<a name="L3055"><font color="white">03055</font>				if (!bDejaVu &amp;&amp; enemy!=none &amp;&amp; enemy==other)
<a name="L3056"><font color="white">03056</font>	            	SeeEnemy();
<a name="L3057"><font color="white">03057</font>				else
<a name="L3058"><font color="white">03058</font>					setenemy(XIII);
<a name="L3059"><font color="white">03059</font>	    }
<a name="L3060"><font color="white">03060</font>	    event SeeMonster(pawn other)
<a name="L3061"><font color="white">03061</font>	    {
<a name="L3062"><font color="white">03062</font>	        if (!bDejaVu &amp;&amp; enemy!=none &amp;&amp; enemy==other)
<a name="L3063"><font color="white">03063</font>	            	SeeEnemy();
<a name="L3064"><font color="white">03064</font>			  else
<a name="L3065"><font color="white">03065</font>					setenemy(other);
<a name="L3066"><font color="white">03066</font>	    }
<a name="L3067"><font color="white">03067</font>	    event SeeDeadPawn(pawn other)
<a name="L3068"><font color="white">03068</font>	    {
<a name="L3069"><font color="white">03069</font>	        local basesoldier soldier;
<a name="L3070"><font color="white">03070</font>	
<a name="L3071"><font color="white">03071</font>	        soldier=basesoldier(other);
<a name="L3072"><font color="white">03072</font>	
<a name="L3073"><font color="white">03073</font>	        if (bases.BNeVoitPascadavre || bCadavreVu || !bStepNoise || soldier==none || Soldier.DrawType == DT_NONE || soldier.bMonCadavreEstDejaVu || AllianceLevel(Soldier)!=1)
<a name="L3074"><font color="white">03074</font>	            return;
<a name="L3075"><font color="white">03075</font>	        bStepNoise=false;
<a name="L3076"><font color="white">03076</font>	        bCadavreVu=true;
<a name="L3077"><font color="white">03077</font>	        instigator=other;
<a name="L3078"><font color="white">03078</font>	        enemy=none;
<a name="L3079"><font color="white">03079</font>	        InitReactions();
<a name="L3080"><font color="white">03080</font>	        Soldier.bMonCadavreEstDejaVu=true;
<a name="L3081"><font color="white">03081</font>	        gotostate('acquisition','CadavreVu');
<a name="L3082"><font color="white">03082</font>	    }
<a name="L3083"><font color="white">03083</font>	    event EnemyNotVisible()
<a name="L3084"><font color="white">03084</font>	    {
<a name="L3085"><font color="white">03085</font>	        if (bAVuQuelquechose)
<a name="L3086"><font color="white">03086</font>	        {
<a name="L3087"><font color="white">03087</font>	            gotostate('investigation');
<a name="L3088"><font color="white">03088</font>	        }
<a name="L3089"><font color="white">03089</font>	        else
<a name="L3090"><font color="white">03090</font>	        {
<a name="L3091"><font color="white">03091</font>					if (!bARienVu)
<a name="L3092"><font color="white">03092</font>					{
<a name="L3093"><font color="white">03093</font>						bARienVu=true;
<a name="L3094"><font color="white">03094</font>					   settimer3(8+2*frand(),false);
<a name="L3095"><font color="white">03095</font>					}
<a name="L3096"><font color="white">03096</font>	            Changeetat(); //dans vu si voit plus s'arrete
<a name="L3097"><font color="white">03097</font>	        }
<a name="L3098"><font color="white">03098</font>	    }
<a name="L3099"><font color="white">03099</font>	    event EnemyAcquired()
<a name="L3100"><font color="white">03100</font>	    {
<a name="L3101"><font color="white">03101</font>	        bDejaVu=true;
<a name="L3102"><font color="white">03102</font>	        bPaffe=false;
<a name="L3103"><font color="white">03103</font>	        bCadavreVu=false;
<a name="L3104"><font color="white">03104</font>	        bStepNoise=false;
<a name="L3105"><font color="white">03105</font>	        bImpactNoise=false;
<a name="L3106"><font color="white">03106</font>	        bWeaponNoise=false;
<a name="L3107"><font color="white">03107</font>	        pawn.SpineYawControl(false,0,0);
<a name="L3108"><font color="white">03108</font>	        disable('seeplayer');
<a name="L3109"><font color="white">03109</font>	        disable('seemonster');
<a name="L3110"><font color="white">03110</font>	        gotostate('acquisition','attaque');
<a name="L3111"><font color="white">03111</font>	    }
<a name="L3112"><font color="white">03112</font>	    event hearnoise(float loudness, actor NoiseMaker)
<a name="L3113"><font color="white">03113</font>	    {
<a name="L3114"><font color="white">03114</font>	        ActualiseSon(NoiseMaker);
<a name="L3115"><font color="white">03115</font>	    }
<a name="L3116"><font color="white">03116</font>	    event Trigger(actor Other, pawn EventInstigator)
<a name="L3117"><font color="white">03117</font>	    {
<a name="L3118"><font color="white">03118</font>	    }
<a name="L3119"><font color="white">03119</font>	    singular function DamageAttitudeTo(pawn Other, float Damage)
<a name="L3120"><font color="white">03120</font>	    {
<a name="L3121"><font color="white">03121</font>	        local int Level;
<a name="L3122"><font color="white">03122</font>	
<a name="L3123"><font color="white">03123</font>	        if (bDisableDamageattitudeto)
<a name="L3124"><font color="white">03124</font>	            return;
<a name="L3125"><font color="white">03125</font>	        //son
<a name="L3126"><font color="white">03126</font>	        bases.PlaySndPNJOno(pnjono'Onomatopees.hPNJHurt',bases.CodeMesh,bases.NumeroTimbre);
<a name="L3127"><font color="white">03127</font>	        level=AllianceLevel(Other);
<a name="L3128"><font color="white">03128</font>	        if (level&lt;=0)
<a name="L3129"><font color="white">03129</font>	        {
<a name="L3130"><font color="white">03130</font>	            if (level==0)
<a name="L3131"><font color="white">03131</font>	                SwitchToEnemy(Other);
<a name="L3132"><font color="white">03132</font>	            bPaffe=true;
<a name="L3133"><font color="white">03133</font>	            bCadavreVu=false;
<a name="L3134"><font color="white">03134</font>	            bStepNoise=false;
<a name="L3135"><font color="white">03135</font>	            bImpactNoise=false;
<a name="L3136"><font color="white">03136</font>	            enemy=Other;
<a name="L3137"><font color="white">03137</font>	            InitReactions();
<a name="L3138"><font color="white">03138</font>	            gotostate('acquisition','Paffe');
<a name="L3139"><font color="white">03139</font>	        }
<a name="L3140"><font color="white">03140</font>	    }
<a name="L3141"><font color="white">03141</font>	    function ActualiseSon(actor son)
<a name="L3142"><font color="white">03142</font>	    {
<a name="L3143"><font color="white">03143</font>			  if (son.instigator!=none &amp;&amp; son.instigator.controller!=none &amp;&amp; son.instigator.controller.isa('CineController2'))
<a name="L3144"><font color="white">03144</font>					return;
<a name="L3145"><font color="white">03145</font>	        //bruit d'arme prioritaire sur bruitpas
<a name="L3146"><font color="white">03146</font>	        if (weapon(son)!=none || XIIIProjectile(son)!=none)
<a name="L3147"><font color="white">03147</font>	        {
<a name="L3148"><font color="white">03148</font>	            if (alliancelevel(son.instigator)==1) //pote donc prend son enemy
<a name="L3149"><font color="white">03149</font>	            {
<a name="L3150"><font color="white">03150</font>	                enemy=son.instigator.controller.enemy;
<a name="L3151"><font color="white">03151</font>	                instigator=son.instigator;
<a name="L3152"><font color="white">03152</font>	            }
<a name="L3153"><font color="white">03153</font>	            else
<a name="L3154"><font color="white">03154</font>	            {
<a name="L3155"><font color="white">03155</font>	                enemy=son.instigator;
<a name="L3156"><font color="white">03156</font>	                instigator=enemy;
<a name="L3157"><font color="white">03157</font>	            }
<a name="L3158"><font color="white">03158</font>	            bStepNoise=false;
<a name="L3159"><font color="white">03159</font>	            bImpactNoise=false;
<a name="L3160"><font color="white">03160</font>	            bCadavreVu=false;
<a name="L3161"><font color="white">03161</font>	            bPaffe=false;
<a name="L3162"><font color="white">03162</font>	            bWeaponNoise=true;
<a name="L3163"><font color="white">03163</font>	            InitReactions();
<a name="L3164"><font color="white">03164</font>	            gotostate('acquisition','BruitArme');
<a name="L3165"><font color="white">03165</font>	        }
<a name="L3166"><font color="white">03166</font>	        else if ((bStepNoise || bCadavreVu) &amp;&amp; BulletDustEmitter(son)!=none &amp;&amp; son.instigator==XIII)
<a name="L3167"><font color="white">03167</font>	        {
<a name="L3168"><font color="white">03168</font>	            bImpactNoise=true;
<a name="L3169"><font color="white">03169</font>	            bStepNoise=false;
<a name="L3170"><font color="white">03170</font>	            bCadavreVu=false;
<a name="L3171"><font color="white">03171</font>	            enemy=xiii;
<a name="L3172"><font color="white">03172</font>	            gotostate('acquisition','BruitImpact');
<a name="L3173"><font color="white">03173</font>	        }
<a name="L3174"><font color="white">03174</font>	    }
<a name="L3175"><font color="white">03175</font>	    function ChercheNMIDuRegard() // dans cone de 45 degre autour pos other
<a name="L3176"><font color="white">03176</font>	    {
<a name="L3177"><font color="white">03177</font>	        local int Sens;
<a name="L3178"><font color="white">03178</font>	        local vector Norm;
<a name="L3179"><font color="white">03179</font>	
<a name="L3180"><font color="white">03180</font>	        Sens=1;
<a name="L3181"><font color="white">03181</font>	        if (frand()&lt;0.5)
<a name="L3182"><font color="white">03182</font>	            Sens=-1;
<a name="L3183"><font color="white">03183</font>	        Norm=normal(enemy.location-pawn.location);
<a name="L3184"><font color="white">03184</font>	        focalpoint=1000*(Norm+0.8*(Norm cross (sens*vect(0,0,1))))+pawn.location;
<a name="L3185"><font color="white">03185</font>	    }
<a name="L3186"><font color="white">03186</font>	
<a name="L3187"><font color="white">03187</font>	    Function InitReactions()
<a name="L3188"><font color="white">03188</font>	    {
<a name="L3189"><font color="white">03189</font>	        bDisableDamageattitudeto=false;
<a name="L3190"><font color="white">03190</font>	        //si bruit de pas desactive rien
<a name="L3191"><font color="white">03191</font>	        if (!bStepNoise)
<a name="L3192"><font color="white">03192</font>	        {
<a name="L3193"><font color="white">03193</font>	            //bDisableEventSeeDeadPawn=true;
<a name="L3194"><font color="white">03194</font>	            if (!bImpactNoise &amp;&amp; !bCadavreVu)
<a name="L3195"><font color="white">03195</font>	            {
<a name="L3196"><font color="white">03196</font>	                bDisableDamageattitudeto=true;
<a name="L3197"><font color="white">03197</font>	                if (!bPaffe) //donc vu ou bruit d'arme
<a name="L3198"><font color="white">03198</font>	                {
<a name="L3199"><font color="white">03199</font>	                    disable('hearnoise');
<a name="L3200"><font color="white">03200</font>	                    if (bDejaVu)
<a name="L3201"><font color="white">03201</font>	                    {
<a name="L3202"><font color="white">03202</font>	                        disable('seeplayer');
<a name="L3203"><font color="white">03203</font>	                        disable('seemonster');
<a name="L3204"><font color="white">03204</font>	                    }
<a name="L3205"><font color="white">03205</font>	                }
<a name="L3206"><font color="white">03206</font>	            }
<a name="L3207"><font color="white">03207</font>	        }
<a name="L3208"><font color="white">03208</font>	    }
<a name="L3209"><font color="white">03209</font>	    /* [****] integrer si le positionnnement n'est pas bon
<a name="L3210"><font color="white">03210</font>	    A REVOIR ENTIEREMENT
<a name="L3211"><font color="white">03211</font>	    function CherchePointPresDernierePos()
<a name="L3212"><font color="white">03212</font>	    {
<a name="L3213"><font color="white">03213</font>	    local NavigationPoint N, Best;
<a name="L3214"><font color="white">03214</font>	    local vector Dir, EnemyDir;
<a name="L3215"><font color="white">03215</font>	    local float Dist, BestVal, Val;
<a name="L3216"><font color="white">03216</font>	
<a name="L3217"><font color="white">03217</font>	      EnemyDir = Normal(Enemy.Location - Pawn.Location);
<a name="L3218"><font color="white">03218</font>	      for ( N=Level.NavigationPointList; N!=None; N=N.NextNavigationPoint )
<a name="L3219"><font color="white">03219</font>	      {
<a name="L3220"><font color="white">03220</font>	      Dir = N.Location - LAstSeenPos;
<a name="L3221"><font color="white">03221</font>	      Dist = VSize(Dir);
<a name="L3222"><font color="white">03222</font>	      if (Dist&lt;200)
<a name="L3223"><font color="white">03223</font>	      {
<a name="L3224"><font color="white">03224</font>	      Val = (EnemyDir Dot Dir/Dist);
<a name="L3225"><font color="white">03225</font>	      if ((Val &gt; BestVal) &amp;&amp; LineOfSightTo(N))
<a name="L3226"><font color="white">03226</font>	      {
<a name="L3227"><font color="white">03227</font>	      BestVal = Val;
<a name="L3228"><font color="white">03228</font>	      Best = N;
<a name="L3229"><font color="white">03229</font>	      }
<a name="L3230"><font color="white">03230</font>	      }
<a name="L3231"><font color="white">03231</font>	      }
<a name="L3232"><font color="white">03232</font>	      if ( Best != None )
<a name="L3233"><font color="white">03233</font>	      LastSeenPos = Best.Location + 0.5 * Pawn.CollisionHeight * vect(0,0,1);
<a name="L3234"><font color="white">03234</font>	     }  */
<a name="L3235"><font color="white">03235</font>	    function beginstate()
<a name="L3236"><font color="white">03236</font>	    {
<a name="L3237"><font color="white">03237</font>	        disable('enemynotvisible');
<a name="L3238"><font color="white">03238</font>	        if (NiveauAlerte==0)
<a name="L3239"><font color="white">03239</font>	        {
<a name="L3240"><font color="white">03240</font>	            s_decAttente();
<a name="L3241"><font color="white">03241</font>	            s_incAlerte();
<a name="L3242"><font color="white">03242</font>	        }
<a name="L3243"><font color="white">03243</font>	        else if (NiveauAlerte==2)
<a name="L3244"><font color="white">03244</font>	        {
<a name="L3245"><font color="white">03245</font>	            s_decAttaque();
<a name="L3246"><font color="white">03246</font>	            s_incAlerte();
<a name="L3247"><font color="white">03247</font>	        }
<a name="L3248"><font color="white">03248</font>	        NiveauAlerte=1;
<a name="L3249"><font color="white">03249</font>			  bAVuQuelquechose=false;
<a name="L3250"><font color="white">03250</font>	        SetVigilant(true); //vigilant
<a name="L3251"><font color="white">03251</font>	        settimer(0,false);
<a name="L3252"><font color="white">03252</font>	        //temp_vect utilise pour calcul dest vers cadavre
<a name="L3253"><font color="white">03253</font>	    }
<a name="L3254"><font color="white">03254</font>	    function Endstate()
<a name="L3255"><font color="white">03255</font>	    {
<a name="L3256"><font color="white">03256</font>		//		local rotator rl;
<a name="L3257"><font color="white">03257</font>	
<a name="L3258"><font color="white">03258</font>	        if (interrogation!=none)
<a name="L3259"><font color="white">03259</font>	        {
<a name="L3260"><font color="white">03260</font>	            interrogation.destroy();
<a name="L3261"><font color="white">03261</font>	            interrogation=none;
<a name="L3262"><font color="white">03262</font>	        }
<a name="L3263"><font color="white">03263</font>				//remettre tete
<a name="L3264"><font color="white">03264</font>		/*	  PeeredEnemy=none;
<a name="L3265"><font color="white">03265</font>			  settimer2(0,false);
<a name="L3266"><font color="white">03266</font>			  pawn.HeadYaw=0;
<a name="L3267"><font color="white">03267</font>			  rl.Yaw=0;
<a name="L3268"><font color="white">03268</font>			 rl.Pitch=0;
<a name="L3269"><font color="white">03269</font>				rl.Roll= 0;
<a name="L3270"><font color="white">03270</font>				pawn.SetBoneRotation('X HEAD',rl,,0.0); */
<a name="L3271"><font color="white">03271</font>	        pawn.SpineYawControl(false,0,0);
<a name="L3272"><font color="white">03272</font>	    }
<a name="L3273"><font color="white">03273</font>	
<a name="L3274"><font color="white">03274</font>	Begin:
<a name="L3275"><font color="white">03275</font>	    if (CHARGE_LES_LOGS) log(pawn@&quot;ETAT acquisition&quot;);
<a name="L3276"><font color="white">03276</font>	    if (CHARGE_LES_LOGS) log(&quot;bStepNoise&quot;$bStepNoise@&quot;bImpactNoise&quot;$bImpactNoise@&quot;bCadavreVu&quot;$bCadavreVu@&quot;bPaffe&quot;$bPaffe@&quot;bWeaponNoise&quot;$bWeaponNoise@&quot;bDejaVu&quot;$bDejaVu@&quot;enemy&quot;$enemy);
<a name="L3277"><font color="white">03277</font>	
<a name="L3278"><font color="white">03278</font>	    InitReactions();
<a name="L3279"><font color="white">03279</font>	    if (!bcadavrevu &amp;&amp; enemy.bisdead)
<a name="L3280"><font color="white">03280</font>	    {
<a name="L3281"><font color="white">03281</font>	        ChangeEtat();
<a name="L3282"><font color="white">03282</font>	    }
<a name="L3283"><font color="white">03283</font>	    Pawn.Acceleration = vect(0,0,0);
<a name="L3284"><font color="white">03284</font>	    Pawn.Velocity = vect(0,0,0);
<a name="L3285"><font color="white">03285</font>	Init:
<a name="L3286"><font color="white">03286</font>	    if (!bDejaVu)
<a name="L3287"><font color="white">03287</font>	    {
<a name="L3288"><font color="white">03288</font>	        pawn.SetAnimStatus('alert');
<a name="L3289"><font color="white">03289</font>			  //son
<a name="L3290"><font color="white">03290</font>	    	  Interrogation=Spawn(class'exclamation',self,,bases.location+(vector(bases.rotation) cross vect(0,0,1))*6 + 120*vect(0,0,1));
<a name="L3291"><font color="white">03291</font>	        interrogation.setbase(pawn);
<a name="L3292"><font color="white">03292</font>	        pawn.SpineYawControl(true,2000+rand(1000),0.8+0.6*frand());
<a name="L3293"><font color="white">03293</font>	        if ((bStepNoise || bImpactNoise || bPaffe || bWeaponNoise) &amp;&amp; enemy==none)
<a name="L3294"><font color="white">03294</font>	       		ChangeEtat();
<a name="L3295"><font color="white">03295</font>	        if ((bCadavreVu || bWeaponNoise) &amp;&amp; instigator==none)
<a name="L3296"><font color="white">03296</font>	       		ChangeEtat();
<a name="L3297"><font color="white">03297</font>	        if (bStepNoise)
<a name="L3298"><font color="white">03298</font>			  {
<a name="L3299"><font color="white">03299</font>	            goto('BruitPas');
<a name="L3300"><font color="white">03300</font>	        }
<a name="L3301"><font color="white">03301</font>	        else
<a name="L3302"><font color="white">03302</font>			  {
<a name="L3303"><font color="white">03303</font>	  			  pawn.PlaySndPNJOno(pnjono'Onomatopees.hPNJDetect',bases.CodeMesh,bases.NumeroTimbre);//se retourne vers bruit et reste sur place
<a name="L3304"><font color="white">03304</font>		        if (bImpactNoise)
<a name="L3305"><font color="white">03305</font>		            goto('BruitImpact');
<a name="L3306"><font color="white">03306</font>		        else if (bCadavreVu)
<a name="L3307"><font color="white">03307</font>		            goto('CadavreVu');
<a name="L3308"><font color="white">03308</font>		        else if (bPaffe)
<a name="L3309"><font color="white">03309</font>		            goto('Paffe');
<a name="L3310"><font color="white">03310</font>		        else if (bWeaponNoise)
<a name="L3311"><font color="white">03311</font>		            goto('BruitArme');
<a name="L3312"><font color="white">03312</font>			  }
<a name="L3313"><font color="white">03313</font>	    }
<a name="L3314"><font color="white">03314</font>	    else
<a name="L3315"><font color="white">03315</font>		 {
<a name="L3316"><font color="white">03316</font>			  	if (enemy==none)
<a name="L3317"><font color="white">03317</font>					Changeetat();
<a name="L3318"><font color="white">03318</font>	        goto('Vu');
<a name="L3319"><font color="white">03319</font>		 }
<a name="L3320"><font color="white">03320</font>	BruitPas:
<a name="L3321"><font color="white">03321</font>	    ChercheNMIDuRegard();
<a name="L3322"><font color="white">03322</font>	    FinishRotation();
<a name="L3323"><font color="white">03323</font>	    sleep(2);
<a name="L3324"><font color="white">03324</font>	    Changeetat();
<a name="L3325"><font color="white">03325</font>	CadavreVu:
<a name="L3326"><font color="white">03326</font>	    //va vers cadavre, alarme, investigation (???)
<a name="L3327"><font color="white">03327</font>		 Focus=none;
<a name="L3328"><font color="white">03328</font>	    Focalpoint=10000*(instigator.location-pawn.location)+pawn.location;
<a name="L3329"><font color="white">03329</font>	    FinishRotation();
<a name="L3330"><font color="white">03330</font>	    sleep(0.5);
<a name="L3331"><font color="white">03331</font>	    pawn.PlaySndPNJOno(pnjono'Onomatopees.hPNJDetect',bases.CodeMesh,bases.NumeroTimbre);
<a name="L3332"><font color="white">03332</font>	    pawn.SpineYawControl(false,0,0);
<a name="L3333"><font color="white">03333</font>	    if (Vsize(instigator.location-pawn.location)&lt;100)   //vavers cadavre
<a name="L3334"><font color="white">03334</font>	        temp_vect=instigator.location;
<a name="L3335"><font color="white">03335</font>	    else
<a name="L3336"><font color="white">03336</font>	        temp_vect=(Vsize(instigator.location-pawn.location)-100)*normal(instigator.location-pawn.location)+pawn.location;
<a name="L3337"><font color="white">03337</font>	    MoveTo(temp_vect,none);
<a name="L3338"><font color="white">03338</font>	    TriggerEvent('cadavrevu', self, pawn);
<a name="L3339"><font color="white">03339</font>	    if (!genalerte.bAllAlarmsActivated)    ChercheAlarme();  //ALARMEChercheAlarme();  //ALARME
<a name="L3340"><font color="white">03340</font>	    bCampeversSafePoint=true;
<a name="L3341"><font color="white">03341</font>	    gotostate('ResteSurPlace');
<a name="L3342"><font color="white">03342</font>	BruitImpact:
<a name="L3343"><font color="white">03343</font>	    //se retourne vers bruit, alarme, cherche safepoint sinon investigation
<a name="L3344"><font color="white">03344</font>	    ChercheNMIDuRegard();
<a name="L3345"><font color="white">03345</font>	    FinishRotation();
<a name="L3346"><font color="white">03346</font>	    if (!genalerte.bAllAlarmsActivated)    ChercheAlarme();  //ALARMEChercheAlarme();  //ALARME
<a name="L3347"><font color="white">03347</font>	    if (bases.order!='garder') CherchePointPourCamper(); //interruption possible vers vavers
<a name="L3348"><font color="white">03348</font>	    gotostate('investigation');
<a name="L3349"><font color="white">03349</font>	Paffe:
<a name="L3350"><font color="white">03350</font>	    //se retourne vers tireur (60d), alarme, cherche safepoint sinon investigation
<a name="L3351"><font color="white">03351</font>	    ChercheNMIDuRegard();
<a name="L3352"><font color="white">03352</font>	    FinishRotation();
<a name="L3353"><font color="white">03353</font>	    if (!genalerte.bAllAlarmsActivated)    ChercheAlarme();  //ALARMEChercheAlarme();  //ALARME
<a name="L3354"><font color="white">03354</font>	    if (bases.order!='garder') CherchePointPourCamper();
<a name="L3355"><font color="white">03355</font>	    gotostate('investigation');
<a name="L3356"><font color="white">03356</font>	BruitArme:
<a name="L3357"><font color="white">03357</font>	    //se retourne vers bruit, alarme, va vers bruit,investigation
<a name="L3358"><font color="white">03358</font>	    ChercheNMIDuRegard();
<a name="L3359"><font color="white">03359</font>	    FinishRotation();
<a name="L3360"><font color="white">03360</font>	    if (!genalerte.bAllAlarmsActivated)    ChercheAlarme();  //ALARMEChercheAlarme();  //ALARME
<a name="L3361"><font color="white">03361</font>	    if (bases.bRappliqueSiAlerte)
<a name="L3362"><font color="white">03362</font>	    {
<a name="L3363"><font color="white">03363</font>	        MoveTarget=none;
<a name="L3364"><font color="white">03364</font>	        if (Fasttrace(instigator.location-vect(0,0,30),pawn.location-vect(0,0,30)))
<a name="L3365"><font color="white">03365</font>	        {
<a name="L3366"><font color="white">03366</font>	            MoveActor.MoveActor=none;
<a name="L3367"><font color="white">03367</font>	            MovePoint.MovePoint=instigator.location;
<a name="L3368"><font color="white">03368</font>	            MovePoint.bTraceable=true;
<a name="L3369"><font color="white">03369</font>	            nextstate='investigation';
<a name="L3370"><font color="white">03370</font>	            gotostate('vavers');
<a name="L3371"><font color="white">03371</font>	        }
<a name="L3372"><font color="white">03372</font>	        else if (FindBestPathToward(instigator))
<a name="L3373"><font color="white">03373</font>	        {
<a name="L3374"><font color="white">03374</font>	            MoveActor.MoveActor=none;
<a name="L3375"><font color="white">03375</font>	            MovePoint.MovePoint=instigator.location;
<a name="L3376"><font color="white">03376</font>	            MovePoint.bTraceable=false;
<a name="L3377"><font color="white">03377</font>	            for (iCompteur=0;iCompteur&lt;16;iCompteur++)
<a name="L3378"><font color="white">03378</font>	            {
<a name="L3379"><font color="white">03379</font>	                if (routecache[iCompteur]==none)
<a name="L3380"><font color="white">03380</font>	                    break;
<a name="L3381"><font color="white">03381</font>	                PointChemin[iCompteur]=routecache[iCompteur];
<a name="L3382"><font color="white">03382</font>	            }
<a name="L3383"><font color="white">03383</font>	            NbPointChemin=iCompteur;
<a name="L3384"><font color="white">03384</font>	            nextstate='investigation';
<a name="L3385"><font color="white">03385</font>	            gotostate('vavers');
<a name="L3386"><font color="white">03386</font>	        }
<a name="L3387"><font color="white">03387</font>	    }
<a name="L3388"><font color="white">03388</font>	    if (bases.order!='garder') CherchePointPourCamper();       //si peut pas rappliquer ou peut pas aller vers alarme
<a name="L3389"><font color="white">03389</font>	    gotostate('investigation');
<a name="L3390"><font color="white">03390</font>	Vu:
<a name="L3391"><font color="white">03391</font>		 if (enemy==none || enemy.bisdead)
<a name="L3392"><font color="white">03392</font>	    {
<a name="L3393"><font color="white">03393</font>	        ChangeEtat();
<a name="L3394"><font color="white">03394</font>	    }
<a name="L3395"><font color="white">03395</font>	    if (bases.bAlerte)
<a name="L3396"><font color="white">03396</font>	        goto('attaque');
<a name="L3397"><font color="white">03397</font>		 else if (bARienVu)
<a name="L3398"><font color="white">03398</font>				goto('Identification');
<a name="L3399"><font color="white">03399</font>	    enable('enemynotvisible');
<a name="L3400"><font color="white">03400</font>	PointInterro:
<a name="L3401"><font color="white">03401</font>	
<a name="L3402"><font color="white">03402</font>	    //    if (Vsize(pawn.location-enemy.location)&gt;320)
<a name="L3403"><font color="white">03403</font>	    Interrogation=Spawn(class'interro',self,,bases.location+110*vect(0,0,1));  // INTERRO
<a name="L3404"><font color="white">03404</font>	    interrogation.setbase(pawn);
<a name="L3405"><font color="white">03405</font>	    focus=enemy;
<a name="L3406"><font color="white">03406</font>	/*
<a name="L3407"><font color="white">03407</font>		 PeeredEnemy=enemy; */
<a name="L3408"><font color="white">03408</font>	//	 settimer2(0.05,true);
<a name="L3409"><font color="white">03409</font>	    sleep(FMin(1.5,bases.TempsPasVu*Vsize(pawn.location-enemy.location)*0.00025));
<a name="L3410"><font color="white">03410</font>		 if (Vsize(pawn.location-enemy.location)&gt;320)
<a name="L3411"><font color="white">03411</font>	    {
<a name="L3412"><font color="white">03412</font>		 	  sleep(FMin(1.5,bases.TempsPasVu*Vsize(pawn.location-enemy.location)*0.00025));
<a name="L3413"><font color="white">03413</font>		 }
<a name="L3414"><font color="white">03414</font>		// focus=enemy;
<a name="L3415"><font color="white">03415</font>		// peeredenemy=none;
<a name="L3416"><font color="white">03416</font>	Identification:
<a name="L3417"><font color="white">03417</font>	    if (enemy==none || enemy.bisdead)
<a name="L3418"><font color="white">03418</font>	    {
<a name="L3419"><font color="white">03419</font>	        ChangeEtat();
<a name="L3420"><font color="white">03420</font>	    }
<a name="L3421"><font color="white">03421</font>		 if (bARienVu)
<a name="L3422"><font color="white">03422</font>		 {
<a name="L3423"><font color="white">03423</font>			  enable('enemynotvisible');
<a name="L3424"><font color="white">03424</font>			  bARienVu=false;
<a name="L3425"><font color="white">03425</font>			  focus=enemy;
<a name="L3426"><font color="white">03426</font>			  Settimer3(0,false);
<a name="L3427"><font color="white">03427</font>		 }
<a name="L3428"><font color="white">03428</font>	    bAVuQuelquechose=true;
<a name="L3429"><font color="white">03429</font>	    pawn.SetAnimStatus('alert');
<a name="L3430"><font color="white">03430</font>	    if (enemy==xiii) Playercontroller(XIII.controller).MyHud.LocalizedMessage(class'XIIIDialogMessage', 3, none, none, pawn, &quot;?!! &quot;);
<a name="L3431"><font color="white">03431</font>	    //son
<a name="L3432"><font color="white">03432</font>	    pawn.PlaySndPNJOno(pnjono'Onomatopees.hPNJDetect',bases.CodeMesh,bases.NumeroTimbre);//se retourne vers bruit et reste sur place
<a name="L3433"><font color="white">03433</font>	    if (interrogation!=none)
<a name="L3434"><font color="white">03434</font>	    {
<a name="L3435"><font color="white">03435</font>	       interrogation.destroy();
<a name="L3436"><font color="white">03436</font>	       interrogation=none;
<a name="L3437"><font color="white">03437</font>	    }
<a name="L3438"><font color="white">03438</font>	    if (Vsize(pawn.location-enemy.location)&gt;320)
<a name="L3439"><font color="white">03439</font>	    {
<a name="L3440"><font color="white">03440</font>	        Interrogation=Spawn(class'exclamation',self,,bases.location+(vector(bases.rotation) cross vect(0,0,1))*6 + 120*vect(0,0,1));
<a name="L3441"><font color="white">03441</font>	        interrogation.setbase(pawn);
<a name="L3442"><font color="white">03442</font>	        sleep(fmin(1.5,(Vsize(pawn.location-enemy.location)*bases.TempsIdentification)*0.00025));
<a name="L3443"><font color="white">03443</font>			  if (Vsize(pawn.location-enemy.location)&gt;320)
<a name="L3444"><font color="white">03444</font>					sleep(fmin(1.5,(Vsize(pawn.location-enemy.location)*bases.TempsIdentification)*0.00025));
<a name="L3445"><font color="white">03445</font>	    }
<a name="L3446"><font color="white">03446</font>		 disable('enemynotvisible');
<a name="L3447"><font color="white">03447</font>	    bAVuQuelquechose=false;
<a name="L3448"><font color="white">03448</font>	attaque:
<a name="L3449"><font color="white">03449</font>		 if (enemy==none || enemy.bisdead)
<a name="L3450"><font color="white">03450</font>	    {
<a name="L3451"><font color="white">03451</font>	        ChangeEtat();
<a name="L3452"><font color="white">03452</font>	    }
<a name="L3453"><font color="white">03453</font>		 bDisableDamageattitudeto=true;
<a name="L3454"><font color="white">03454</font>	    if (enemy==XIII) TriggerEvent('XIIIVu', Self, pawn);  //trigger vu
<a name="L3455"><font color="white">03455</font>	    Pawn.Acceleration = vect(0,0,0);
<a name="L3456"><font color="white">03456</font>	    Pawn.Velocity = vect(0,0,0);
<a name="L3457"><font color="white">03457</font>	    if (!genalerte.bAllAlarmsActivated)    ChercheAlarme();  //ALARMEChercheAlarme();  //ALARME
<a name="L3458"><font color="white">03458</font>	    pawn.rotationrate.yaw=46000;
<a name="L3459"><font color="white">03459</font>	    finishrotation();
<a name="L3460"><font color="white">03460</font>	    ChangetoBestWeapon();
<a name="L3461"><font color="white">03461</font>	    //init vars attaque
<a name="L3462"><font color="white">03462</font>	    CompteurRecalage=15;    //utilise dans attaque pour savoir si doit se recaler
<a name="L3463"><font color="white">03463</font>	    gotostate('attaque','initattaque');
<a name="L3464"><font color="white">03464</font>	}
<a name="L3465"><font color="white">03465</font>	
<a name="L3466"><font color="white">03466</font>	// ----------------------------------------------------------------------
<a name="L3467"><font color="white">03467</font>	// Etat d'attaqueH2H         (enemy!=none)
<a name="L3468"><font color="white">03468</font>	//
<a name="L3469"><font color="white">03469</font>	//
<a name="L3470"><font color="white">03470</font>	// ----------------------------------------------------------------------
<a name="L3471"><font color="white">03471</font>	state AttaqueH2H
<a name="L3472"><font color="white">03472</font>	{
<a name="L3473"><font color="white">03473</font>		ignores hearnoise;
<a name="L3474"><font color="white">03474</font>	
<a name="L3475"><font color="white">03475</font>	    event EnemyNotVisible()
<a name="L3476"><font color="white">03476</font>	    {
<a name="L3477"><font color="white">03477</font>	        if (LigneVisee(enemy.location, LastSeeingPos))
<a name="L3478"><font color="white">03478</font>	        {
<a name="L3479"><font color="white">03479</font>					HalteAuFeu();
<a name="L3480"><font color="white">03480</font>	            GotoState('TacticalMove','RecoverEnemy');
<a name="L3481"><font color="white">03481</font>	            return;
<a name="L3482"><font color="white">03482</font>	        }
<a name="L3483"><font color="white">03483</font>	        else
<a name="L3484"><font color="white">03484</font>	        {
<a name="L3485"><font color="white">03485</font>					HalteAuFeu();
<a name="L3486"><font color="white">03486</font>	            gotostate('temporise');
<a name="L3487"><font color="white">03487</font>	            return;
<a name="L3488"><font color="white">03488</font>	        }
<a name="L3489"><font color="white">03489</font>	    }
<a name="L3490"><font color="white">03490</font>	    event Tick(float deltaseconds)
<a name="L3491"><font color="white">03491</font>	    {
<a name="L3492"><font color="white">03492</font>	        local int i;
<a name="L3493"><font color="white">03493</font>	        local iacontroller iacontr;
<a name="L3494"><font color="white">03494</font>	        local actor nav;
<a name="L3495"><font color="white">03495</font>	        local AttitudeInfo attitude;
<a name="L3496"><font color="white">03496</font>	        local float distanceAXIII;
<a name="L3497"><font color="white">03497</font>	        local int NBAllieEnCouverture;
<a name="L3498"><font color="white">03498</font>	
<a name="L3499"><font color="white">03499</font>	        global.tick(deltaseconds);
<a name="L3500"><font color="white">03500</font>	
<a name="L3501"><font color="white">03501</font>	        if ((enemy==none) || enemy.bisdead)
<a name="L3502"><font color="white">03502</font>	        {
<a name="L3503"><font color="white">03503</font>	            ChangeEtat();
<a name="L3504"><font color="white">03504</font>	            return;
<a name="L3505"><font color="white">03505</font>	        }
<a name="L3506"><font color="white">03506</font>	        if ((level.timeSeconds-Temps_Ref2)&gt;5 &amp;&amp; bases.order!='garder')
<a name="L3507"><font color="white">03507</font>	        {
<a name="L3508"><font color="white">03508</font>	            Attitude=AttitudeToNMI(enemy);
<a name="L3509"><font color="white">03509</font>	            if (Attitude==ATTITUDE_Fear)    //actualisation attitude
<a name="L3510"><font color="white">03510</font>	            {
<a name="L3511"><font color="white">03511</font>	                HalteAuFeu();
<a name="L3512"><font color="white">03512</font>	                gotostate('fuite');
<a name="L3513"><font color="white">03513</font>	                return;
<a name="L3514"><font color="white">03514</font>	            }
<a name="L3515"><font color="white">03515</font>	            else if (Attitude==ATTITUDE_Impressed)
<a name="L3516"><font color="white">03516</font>	            {  //retraite possible si enemmi de dos ou assez loin
<a name="L3517"><font color="white">03517</font>	                if (((enemy.location-pawn.location) dot vector(enemy.rotation))&gt;0 || Vsize(enemy.location-pawn.location)&gt;600)
<a name="L3518"><font color="white">03518</font>	                    CherchePointRetraite();
<a name="L3519"><font color="white">03519</font>	            }
<a name="L3520"><font color="white">03520</font>	            Temps_Ref2=level.timeseconds;
<a name="L3521"><font color="white">03521</font>	        }
<a name="L3522"><font color="white">03522</font>	        if ((Level.timeseconds-Temps_ref)&gt;3)
<a name="L3523"><font color="white">03523</font>	        {
<a name="L3524"><font color="white">03524</font>	            //recherche alarme
<a name="L3525"><font color="white">03525</font>					//log(&quot; cherche alarme&quot;@!genalerte.bAllAlarmsActivated);
<a name="L3526"><font color="white">03526</font>	            if (!genalerte.bAllAlarmsActivated)    ChercheAlarme();  //ALARMEChercheAlarme();  //ALARME
<a name="L3527"><font color="white">03527</font>	           //si otage
<a name="L3528"><font color="white">03528</font>	            if (xiii.bPrisonner &amp;&amp; XIII.LHand.pOnShoulder!=none &amp;&amp; AllianceLevel(XIII.LHand.pOnShoulder)==1 &amp;&amp; enemy==xiii &amp;&amp; VSize(pawn.location-enemy.location) &lt; 125)
<a name="L3529"><font color="white">03529</font>	            {
<a name="L3530"><font color="white">03530</font>	                if (CHARGE_LES_LOGS) log(pawn$&quot;me colle trop je tir&quot;);
<a name="L3531"><font color="white">03531</font>	                NbCoupsRiposte=(2+bases.agressivite)*1.5;
<a name="L3532"><font color="white">03532</font>	                NbCoupsRiposte=Min(4,NbCoupsRiposte);
<a name="L3533"><font color="white">03533</font>	                NbCoupsRiposte=Max(1,NbCoupsRiposte);
<a name="L3534"><font color="white">03534</font>	            }
<a name="L3535"><font color="white">03535</font>	      /* [*] a priori que les points
<a name="L3536"><font color="white">03536</font>					if (bases.order!='garder')
<a name="L3537"><font color="white">03537</font>	                ChangetoBestWeapon();   //test nouvelle armeChangetoBestWeapon();   //test nouvelle arme*/
<a name="L3538"><font color="white">03538</font>	
<a name="L3539"><font color="white">03539</font>	            //Attaquescriptee
<a name="L3540"><font color="white">03540</font>	            ChercheReseauAttaque();
<a name="L3541"><font color="white">03541</font>	            Temps_Ref=Level.timeseconds;
<a name="L3542"><font color="white">03542</font>	        }
<a name="L3543"><font color="white">03543</font>	    }
<a name="L3544"><font color="white">03544</font>		event timer3()
<a name="L3545"><font color="white">03545</font>	   {
<a name="L3546"><font color="white">03546</font>	      EnemyTargetPos=enemy.location;
<a name="L3547"><font color="white">03547</font>	      EnemyTargetVelocity=enemy.velocity;
<a name="L3548"><font color="white">03548</font>			if (bInWaitMode &amp;&amp; (Vsize(enemy.location-temp_vect)&gt;50 || VSize(enemy.location-pawn.location)&lt;120))
<a name="L3549"><font color="white">03549</font>		   {
<a name="L3550"><font color="white">03550</font>				bInWaitMode=false;
<a name="L3551"><font color="white">03551</font>				HalteAufeu();
<a name="L3552"><font color="white">03552</font>				bases.releaseAnimControl(true);
<a name="L3553"><font color="white">03553</font>				gotostate('attaqueH2H','charge');
<a name="L3554"><font color="white">03554</font>			}
<a name="L3555"><font color="white">03555</font>	   }
<a name="L3556"><font color="white">03556</font>	    event SeeDeadPawn(pawn other)
<a name="L3557"><font color="white">03557</font>	    {
<a name="L3558"><font color="white">03558</font>	        if (ChercheBonMatos(other))		//CadavreWithPickup affecte a other dans Cherchebonmatos
<a name="L3559"><font color="white">03559</font>	        {
<a name="L3560"><font color="white">03560</font>	            HalteAufeu();
<a name="L3561"><font color="white">03561</font>	            bDisableEventSeeDeadPawn=true;
<a name="L3562"><font color="white">03562</font>	            CadavreWithPickup.bDejaFouille=true;
<a name="L3563"><font color="white">03563</font>	            gotostate('tacticalmove','chercheobjet');
<a name="L3564"><font color="white">03564</font>	        }
<a name="L3565"><font color="white">03565</font>	    }
<a name="L3566"><font color="white">03566</font>	    event UpdateTactics()
<a name="L3567"><font color="white">03567</font>	    {
<a name="L3568"><font color="white">03568</font>	        if (Vsize(enemy.location-temp_vect)&gt;50)
<a name="L3569"><font color="white">03569</font>	        {
<a name="L3570"><font color="white">03570</font>	            badvancedtactics=false;
<a name="L3571"><font color="white">03571</font>	            gotostate('AttaqueH2H','charge');
<a name="L3572"><font color="white">03572</font>	        }
<a name="L3573"><font color="white">03573</font>	    }
<a name="L3574"><font color="white">03574</font>	
<a name="L3575"><font color="white">03575</font>	    function NotifyFiring()
<a name="L3576"><font color="white">03576</font>	    {
<a name="L3577"><font color="white">03577</font>			  if (enemy==none)
<a name="L3578"><font color="white">03578</font>					return;
<a name="L3579"><font color="white">03579</font>	
<a name="L3580"><font color="white">03580</font>			  DirectionTir=DirectionDuTir(); //recupere direction du tir avant dispersion
<a name="L3581"><font color="white">03581</font>	        CheckLineOfFire();
<a name="L3582"><font color="white">03582</font>	    }
<a name="L3583"><font color="white">03583</font>	    function DamageAttitudeto(pawn Other, float Damage)
<a name="L3584"><font color="white">03584</font>	    {
<a name="L3585"><font color="white">03585</font>	        if (bases.bisdead)
<a name="L3586"><font color="white">03586</font>	            return;
<a name="L3587"><font color="white">03587</font>	        //son
<a name="L3588"><font color="white">03588</font>	        bases.PlaySndPNJOno(pnjono'Onomatopees.hPNJHurt',bases.CodeMesh,bases.NumeroTimbre);
<a name="L3589"><font color="white">03589</font>	        If (xiii.bPrisonner &amp;&amp; XIII.LHand.pOnShoulder!=none &amp;&amp; AllianceLevel(XIII.LHand.pOnShoulder)==1 &amp;&amp; other==xiii)
<a name="L3590"><font color="white">03590</font>	        {
<a name="L3591"><font color="white">03591</font>	           if (CHARGE_LES_LOGS) log(pawn$&quot;je riposte&quot;);
<a name="L3592"><font color="white">03592</font>	           NbCoupsRiposte=(2+bases.agressivite)*1.9;
<a name="L3593"><font color="white">03593</font>	           NbCoupsRiposte=Min(5,NbCoupsRiposte);
<a name="L3594"><font color="white">03594</font>	           NbCoupsRiposte=Max(1,NbCoupsRiposte);
<a name="L3595"><font color="white">03595</font>	        }
<a name="L3596"><font color="white">03596</font>	    }
<a name="L3597"><font color="white">03597</font>	
<a name="L3598"><font color="white">03598</font>	    function ReceiveWarning(pawn shooter, float projspeed,vector firedir)
<a name="L3599"><font color="white">03599</font>	    {
<a name="L3600"><font color="white">03600</font>	    }
<a name="L3601"><font color="white">03601</font>	
<a name="L3602"><font color="white">03602</font>		function bool LookForNearestPoint()
<a name="L3603"><font color="white">03603</font>		{
<a name="L3604"><font color="white">03604</font>			local navigationpoint nav,bestnav;
<a name="L3605"><font color="white">03605</font>			local float DistancePoint;
<a name="L3606"><font color="white">03606</font>			local float DistanceNMI;
<a name="L3607"><font color="white">03607</font>			local int i;
<a name="L3608"><font color="white">03608</font>	
<a name="L3609"><font color="white">03609</font>			DistancePoint=1000;  //init
<a name="L3610"><font color="white">03610</font>			if (enemy==none)
<a name="L3611"><font color="white">03611</font>				return false;
<a name="L3612"><font color="white">03612</font>	      btemp_bool=false;
<a name="L3613"><font color="white">03613</font>			nav = Level.NavigationPointList;
<a name="L3614"><font color="white">03614</font>	      while (nav != None)
<a name="L3615"><font color="white">03615</font>	      {
<a name="L3616"><font color="white">03616</font>				DistanceNMI=vsize(nav.location-enemy.location);
<a name="L3617"><font color="white">03617</font>	//			log(nav@vsize(nav.location-enemy.location)&lt;300@Vsize(nav.location-pawn.location)&gt;=(pawn.collisionradius*1.2)@(bestnav==none || vsize(nav.location-enemy.location)&lt;vsize(bestnav.location-enemy.location)));
<a name="L3618"><font color="white">03618</font>				if (DistanceNMI&lt;300)
<a name="L3619"><font color="white">03619</font>				{
<a name="L3620"><font color="white">03620</font>					if (Vsize(nav.location-pawn.location)&lt;(pawn.collisionradius*2) &amp;&amp; rand(3)&lt;2)
<a name="L3621"><font color="white">03621</font>					{
<a name="L3622"><font color="white">03622</font>						 nav = nav.nextNavigationPoint;
<a name="L3623"><font color="white">03623</font>						continue;
<a name="L3624"><font color="white">03624</font>					}
<a name="L3625"><font color="white">03625</font>					if (DistanceNMI&lt;DistancePoint)
<a name="L3626"><font color="white">03626</font>					{
<a name="L3627"><font color="white">03627</font>						DistancePoint=DistanceNMI;
<a name="L3628"><font color="white">03628</font>						Bestnav=nav;
<a name="L3629"><font color="white">03629</font>					}
<a name="L3630"><font color="white">03630</font>				}
<a name="L3631"><font color="white">03631</font>	         nav = nav.nextNavigationPoint;
<a name="L3632"><font color="white">03632</font>			}
<a name="L3633"><font color="white">03633</font>			if (BestNav==none)
<a name="L3634"><font color="white">03634</font>				return false;
<a name="L3635"><font color="white">03635</font>			if (actorreachable(BestNav))
<a name="L3636"><font color="white">03636</font>			{
<a name="L3637"><font color="white">03637</font>				btemp_bool=true;
<a name="L3638"><font color="white">03638</font>				movetarget=BestNav;
<a name="L3639"><font color="white">03639</font>				return true;
<a name="L3640"><font color="white">03640</font>			}
<a name="L3641"><font color="white">03641</font>			else if (findBestPathToward(BestNav))
<a name="L3642"><font color="white">03642</font>			{
<a name="L3643"><font color="white">03643</font>				btemp_bool=false;
<a name="L3644"><font color="white">03644</font>				movetarget=BestNav;
<a name="L3645"><font color="white">03645</font>				return true;
<a name="L3646"><font color="white">03646</font>			}
<a name="L3647"><font color="white">03647</font>			return false;
<a name="L3648"><font color="white">03648</font>		 }
<a name="L3649"><font color="white">03649</font>	    function BeginState()
<a name="L3650"><font color="white">03650</font>	    {
<a name="L3651"><font color="white">03651</font>	        disable('enemynotvisible');
<a name="L3652"><font color="white">03652</font>			  //log(pawn@&quot;ajoute perso dans la liste des basesoldierinfight&quot;);
<a name="L3653"><font color="white">03653</font>	        genalerte.SoldierInFightList.length=genalerte.SoldierInFightList.length+1;
<a name="L3654"><font color="white">03654</font>	        genalerte.SoldierInFightList[genalerte.SoldierInFightList.Length-1]=bases;
<a name="L3655"><font color="white">03655</font>	        pawn.SetAnimStatus('alert');
<a name="L3656"><font color="white">03656</font>			  EnemyTargetPos=enemy.location;
<a name="L3657"><font color="white">03657</font>	    		EnemyTargetVelocity=enemy.velocity;
<a name="L3658"><font color="white">03658</font>	        if (NiveauAlerte==0)
<a name="L3659"><font color="white">03659</font>	        {
<a name="L3660"><font color="white">03660</font>	            s_decAttente();
<a name="L3661"><font color="white">03661</font>	            s_incAttaque();
<a name="L3662"><font color="white">03662</font>	        }
<a name="L3663"><font color="white">03663</font>	        else if (NiveauAlerte==1)
<a name="L3664"><font color="white">03664</font>	        {
<a name="L3665"><font color="white">03665</font>	            s_decAlerte();
<a name="L3666"><font color="white">03666</font>	            s_incAttaque();
<a name="L3667"><font color="white">03667</font>	        }
<a name="L3668"><font color="white">03668</font>	        NiveauAlerte=2;
<a name="L3669"><font color="white">03669</font>			  bARienVu=false;
<a name="L3670"><font color="white">03670</font>	        Temps_Ref2=level.timeseconds-2;
<a name="L3671"><font color="white">03671</font>	        Temps_Ref=Temps_Ref2;
<a name="L3672"><font color="white">03672</font>	        settimer3(Temps_RefreshEnemyPos,true);
<a name="L3673"><font color="white">03673</font>			//	btemp_bool=false; //sert a savoir si le nearestpoint est directement atteignable ou par chemin
<a name="L3674"><font color="white">03674</font>	        //***** Var temp *******
<a name="L3675"><font color="white">03675</font>	        //temp_float=0.0;
<a name="L3676"><font color="white">03676</font>	        ///temp_vect=vect(0,0,0);  //1) pour garder ancienne position ennemi dans updatetacics 2) dans saut
<a name="L3677"><font color="white">03677</font>	        //PointDestination=vect(0,0,0);
<a name="L3678"><font color="white">03678</font>	        //temp_int=0; //utilise pour boucle sur pointchemin
<a name="L3679"><font color="white">03679</font>	
<a name="L3680"><font color="white">03680</font>	    }
<a name="L3681"><font color="white">03681</font>	    function EndState()
<a name="L3682"><font color="white">03682</font>	    {
<a name="L3683"><font color="white">03683</font>	        local int i;
<a name="L3684"><font color="white">03684</font>	
<a name="L3685"><font color="white">03685</font>	        settimer3(0,false);
<a name="L3686"><font color="white">03686</font>	        bAdvancedTactics=false;
<a name="L3687"><font color="white">03687</font>	        bEtatAlerte=true;
<a name="L3688"><font color="white">03688</font>	        //vire soldierinfightlist
<a name="L3689"><font color="white">03689</font>			  //log(pawn@&quot;VIRE perso dans la liste &quot;);
<a name="L3690"><font color="white">03690</font>	        for (i=0;i&lt;genalerte.SoldierInFightList.Length; i++)
<a name="L3691"><font color="white">03691</font>	        {
<a name="L3692"><font color="white">03692</font>	            if (genalerte.SoldierInFightList[i] == pawn )
<a name="L3693"><font color="white">03693</font>	            {
<a name="L3694"><font color="white">03694</font>						//log(pawn@&quot;JE ME VIRE de la liste des basesoldierinfight&quot;);
<a name="L3695"><font color="white">03695</font>	                genalerte.SoldierInFightList.Remove(i,1);
<a name="L3696"><font color="white">03696</font>	                break;
<a name="L3697"><font color="white">03697</font>	            }
<a name="L3698"><font color="white">03698</font>	        }
<a name="L3699"><font color="white">03699</font>			  if (bcontrolanimations) bases.releaseanimcontrol();
<a name="L3700"><font color="white">03700</font>	    }
<a name="L3701"><font color="white">03701</font>	begin:
<a name="L3702"><font color="white">03702</font>	    if (CHARGE_LES_LOGS) log(pawn@&quot;Etat attaqueH2H    &quot;$enemy);
<a name="L3703"><font color="white">03703</font>	    if (enemy==none)
<a name="L3704"><font color="white">03704</font>	    {
<a name="L3705"><font color="white">03705</font>	        log(pawn@&quot;ENEMY==none ** ENEMY==none ** ENEMY==none ** ENEMY==none ** ENEMY==none **&quot;);
<a name="L3706"><font color="white">03706</font>	        //enemy=xiii;
<a name="L3707"><font color="white">03707</font>	    }
<a name="L3708"><font color="white">03708</font>	    temp_vect=enemy.location;
<a name="L3709"><font color="white">03709</font>	    focus=enemy;
<a name="L3710"><font color="white">03710</font>	charge:
<a name="L3711"><font color="white">03711</font>		 if (CHARGE_LES_LOGS) log(pawn$&quot;charge de melee H2H&quot;@btire);
<a name="L3712"><font color="white">03712</font>	    if ((enemy==none) || enemy.bisdead)
<a name="L3713"><font color="white">03713</font>	    {
<a name="L3714"><font color="white">03714</font>	        ChangeEtat();
<a name="L3715"><font color="white">03715</font>	    }
<a name="L3716"><font color="white">03716</font>	    enable('enemynotvisible');
<a name="L3717"><font color="white">03717</font>	    PointDestination=vect(0,0,1000000);
<a name="L3718"><font color="white">03718</font>	    temp_float=Vsize(enemy.location - pawn.location);
<a name="L3719"><font color="white">03719</font>	
<a name="L3720"><font color="white">03720</font>	        if (Vsize((enemy.location - pawn.location)*vect(1,1,0)) &gt; (pawn.collisionradius+enemy.collisionradius +50))
<a name="L3721"><font color="white">03721</font>	        {
<a name="L3722"><font color="white">03722</font>	            PointDestination= pawn.location+(enemy.location - pawn.location)*(Temp_float-
<a name="L3723"><font color="white">03723</font>	                    (pawn.collisionradius+enemy.collisionradius))/Temp_float;
<a name="L3724"><font color="white">03724</font>	            if (!ActorReachable(enemy))
<a name="L3725"><font color="white">03725</font>	            {
<a name="L3726"><font color="white">03726</font>						if (FindBestPathToward(enemy))
<a name="L3727"><font color="white">03727</font>	               {
<a name="L3728"><font color="white">03728</font>	                   //log(pawn$&quot;je cherche reseau&quot;);
<a name="L3729"><font color="white">03729</font>	                   goto('GoToEnemyPosByPath');
<a name="L3730"><font color="white">03730</font>	               }
<a name="L3731"><font color="white">03731</font>	               else
<a name="L3732"><font color="white">03732</font>	               {
<a name="L3733"><font color="white">03733</font>							 if (LookForNearestPoint() )
<a name="L3734"><font color="white">03734</font>							 {
<a name="L3735"><font color="white">03735</font>								   //log(pawn$&quot;je vais au point le plus proche&quot;);
<a name="L3736"><font color="white">03736</font>									goto('GoTONearestPoint');
<a name="L3737"><font color="white">03737</font>							 }
<a name="L3738"><font color="white">03738</font>							 else
<a name="L3739"><font color="white">03739</font>							 {
<a name="L3740"><font color="white">03740</font>		                   //log(pawn$&quot;je suis archi crampe c'est inextricable&quot;);
<a name="L3741"><font color="white">03741</font>								 goto('WaitHere');
<a name="L3742"><font color="white">03742</font>							}
<a name="L3743"><font color="white">03743</font>	               }
<a name="L3744"><font color="white">03744</font>	            }
<a name="L3745"><font color="white">03745</font>	        }
<a name="L3746"><font color="white">03746</font>	DeplacementCharge:
<a name="L3747"><font color="white">03747</font>	        if (CHARGE_LES_LOGS) log(pawn$&quot;DeplacementChargeH2H &quot;$PointDestination!=vect(0,0,1000000));
<a name="L3748"><font color="white">03748</font>	        if (PointDestination!=vect(0,0,1000000))
<a name="L3749"><font color="white">03749</font>	        {
<a name="L3750"><font color="white">03750</font>	            //HalteAuFeu();
<a name="L3751"><font color="white">03751</font>	            bAdvancedTactics=true;
<a name="L3752"><font color="white">03752</font>					MoveTo(PointDestination,enemy);
<a name="L3753"><font color="white">03753</font>	            bAdvancedTactics=false;
<a name="L3754"><font color="white">03754</font>	            temp_vect=enemy.location;
<a name="L3755"><font color="white">03755</font>	        }
<a name="L3756"><font color="white">03756</font>	KickH2H:
<a name="L3757"><font color="white">03757</font>	     if (CHARGE_LES_LOGS) log(pawn@&quot;KickH2H&quot;@btire@bfire);
<a name="L3758"><font color="white">03758</font>		 bInWaitMode=true;
<a name="L3759"><font color="white">03759</font>	     pawn.velocity=vect(0,0,0);
<a name="L3760"><font color="white">03760</font>	     pawn.acceleration=vect(0,0,0);
<a name="L3761"><font color="white">03761</font>		  temp_vect=enemy.location;
<a name="L3762"><font color="white">03762</font>	     fireenemy();
<a name="L3763"><font color="white">03763</font>	     sleep(1);
<a name="L3764"><font color="white">03764</font>	     if (Interrogation!=none)
<a name="L3765"><font color="white">03765</font>	     {
<a name="L3766"><font color="white">03766</font>	        Interrogation.destroy();
<a name="L3767"><font color="white">03767</font>	        Interrogation=none;
<a name="L3768"><font color="white">03768</font>	     }
<a name="L3769"><font color="white">03769</font>		  bInWaitMode=false;
<a name="L3770"><font color="white">03770</font>		  HalteAufeu();
<a name="L3771"><font color="white">03771</font>	     goto('charge');
<a name="L3772"><font color="white">03772</font>	GoToEnemyPosByPath:
<a name="L3773"><font color="white">03773</font>	     if (CHARGE_LES_LOGS) log(pawn$&quot;ReseauAttaqueH2H dans $$$$$$$$$$$$$$$$$$$$$ &quot;);
<a name="L3774"><font color="white">03774</font>	     if (Vsize(enemy.location-pawn.location)&gt;( pawn.collisionradius+enemy.collisionradius +10))
<a name="L3775"><font color="white">03775</font>	     {
<a name="L3776"><font color="white">03776</font>	         While (movetarget!=none)
<a name="L3777"><font color="white">03777</font>	         {
<a name="L3778"><font color="white">03778</font>					 focus=none;
<a name="L3779"><font color="white">03779</font>					 focalpoint=(Movetarget.location-pawn.location)*10000+pawn.location;
<a name="L3780"><font color="white">03780</font>	             MoveToward(MoveTarget,none);
<a name="L3781"><font color="white">03781</font>					 if (Vsize(Movetarget.location-pawn.location)&gt;50)
<a name="L3782"><font color="white">03782</font>					 {
<a name="L3783"><font color="white">03783</font>						  log(pawn@&quot;je suis archi crampe en H2H je fais une pause&quot;);
<a name="L3784"><font color="white">03784</font>						  goto('WaitHere');
<a name="L3785"><font color="white">03785</font>						  break;
<a name="L3786"><font color="white">03786</font>					 }
<a name="L3787"><font color="white">03787</font>					 if (actorreachable(enemy))
<a name="L3788"><font color="white">03788</font>					 {
<a name="L3789"><font color="white">03789</font>						PointDestination= pawn.location+(enemy.location - pawn.location)*(Temp_float-
<a name="L3790"><font color="white">03790</font>	                    (pawn.collisionradius+enemy.collisionradius +5))/Temp_float;
<a name="L3791"><font color="white">03791</font>	                goto('DeplacementCharge');
<a name="L3792"><font color="white">03792</font>						break;
<a name="L3793"><font color="white">03793</font>					 }
<a name="L3794"><font color="white">03794</font>	             if (!FindBestPathToward(enemy))
<a name="L3795"><font color="white">03795</font>						break;
<a name="L3796"><font color="white">03796</font>	         }
<a name="L3797"><font color="white">03797</font>	     }
<a name="L3798"><font color="white">03798</font>	     goto('charge');
<a name="L3799"><font color="white">03799</font>	GoToNearestPoint:
<a name="L3800"><font color="white">03800</font>		if (CHARGE_LES_LOGS) log(pawn$&quot;GoToNearestPoint&quot;@movetarget);
<a name="L3801"><font color="white">03801</font>		if (btemp_bool)
<a name="L3802"><font color="white">03802</font>	  	{
<a name="L3803"><font color="white">03803</font>			if (vsize(pawn.location-movetarget.location)&gt;pawn.collisionradius*2)
<a name="L3804"><font color="white">03804</font>			{
<a name="L3805"><font color="white">03805</font>				focalpoint=10000*(movetarget.location-pawn.location) +pawn.location;
<a name="L3806"><font color="white">03806</font>	   	   MoveToward(movetarget,none);
<a name="L3807"><font color="white">03807</font>			}
<a name="L3808"><font color="white">03808</font>		}
<a name="L3809"><font color="white">03809</font>		else
<a name="L3810"><font color="white">03810</font>		{
<a name="L3811"><font color="white">03811</font>			 for (temp_int=0;temp_int&lt;16;temp_int++)
<a name="L3812"><font color="white">03812</font>		    {
<a name="L3813"><font color="white">03813</font>				 if (routecache[temp_int]==none)
<a name="L3814"><font color="white">03814</font>					break;
<a name="L3815"><font color="white">03815</font>				 focalpoint=10000*(routecache[temp_int].location-pawn.location) +pawn.location;
<a name="L3816"><font color="white">03816</font>		       MoveToward(routecache[temp_int],none);
<a name="L3817"><font color="white">03817</font>				 if (actorreachable(enemy))
<a name="L3818"><font color="white">03818</font>				 {
<a name="L3819"><font color="white">03819</font>						PointDestination= pawn.location+(enemy.location - pawn.location)*(Temp_float-
<a name="L3820"><font color="white">03820</font>		                    (pawn.collisionradius+enemy.collisionradius +5))/Temp_float;
<a name="L3821"><font color="white">03821</font>		            goto('DeplacementCharge');
<a name="L3822"><font color="white">03822</font>						break;
<a name="L3823"><font color="white">03823</font>				}
<a name="L3824"><font color="white">03824</font>			 }
<a name="L3825"><font color="white">03825</font>		}
<a name="L3826"><font color="white">03826</font>		//log(&quot;Vsize(enemy.location-pawn.location)&quot;@Vsize(enemy.location-pawn.location));
<a name="L3827"><font color="white">03827</font>		if (Vsize(enemy.location-pawn.location)&lt;150)
<a name="L3828"><font color="white">03828</font>			goto('KickH2H');
<a name="L3829"><font color="white">03829</font>	WaitHere:
<a name="L3830"><font color="white">03830</font>		if (CHARGE_LES_LOGS) log(pawn$&quot;WaitHere&quot;);
<a name="L3831"><font color="white">03831</font>	   temp_vect=enemy.location;
<a name="L3832"><font color="white">03832</font>		bInWaitMode=true;
<a name="L3833"><font color="white">03833</font>		HalteAufeu();
<a name="L3834"><font color="white">03834</font>		bases.PlayH2HProvoc();
<a name="L3835"><font color="white">03835</font>		focus=enemy;
<a name="L3836"><font color="white">03836</font>		pawn.velocity=vect(0,0,0);
<a name="L3837"><font color="white">03837</font>		pawn.acceleration=vect(0,0,0);
<a name="L3838"><font color="white">03838</font>		sleep(1);
<a name="L3839"><font color="white">03839</font>		if (Vsize(enemy.location-pawn.location)&lt;100)
<a name="L3840"><font color="white">03840</font>		{
<a name="L3841"><font color="white">03841</font>			bases.ReleaseAnimControl(true);
<a name="L3842"><font color="white">03842</font>			bInWaitMode=false;
<a name="L3843"><font color="white">03843</font>			goto('KickH2H');
<a name="L3844"><font color="white">03844</font>		}
<a name="L3845"><font color="white">03845</font>		sleep(1+2*frand());
<a name="L3846"><font color="white">03846</font>		bases.ReleaseAnimControl(true);
<a name="L3847"><font color="white">03847</font>		bInWaitMode=false;
<a name="L3848"><font color="white">03848</font>		goto('charge');
<a name="L3849"><font color="white">03849</font>	}
<a name="L3850"><font color="white">03850</font>	// ----------------------------------------------------------------------
<a name="L3851"><font color="white">03851</font>	// Etat d'attaque         (enemy!=none)
<a name="L3852"><font color="white">03852</font>	//
<a name="L3853"><font color="white">03853</font>	//
<a name="L3854"><font color="white">03854</font>	// ----------------------------------------------------------------------
<a name="L3855"><font color="white">03855</font>	state Attaque
<a name="L3856"><font color="white">03856</font>	{
<a name="L3857"><font color="white">03857</font>	    ignores hearnoise;
<a name="L3858"><font color="white">03858</font>	
<a name="L3859"><font color="white">03859</font>	    event Seeplayer(pawn other)
<a name="L3860"><font color="white">03860</font>	    {
<a name="L3861"><font color="white">03861</font>	        if (other==enemy)
<a name="L3862"><font color="white">03862</font>	        {
<a name="L3863"><font color="white">03863</font>	            Switch (iEtatVaVersStrp)
<a name="L3864"><font color="white">03864</font>	            {
<a name="L3865"><font color="white">03865</font>	                case 1: return;
<a name="L3866"><font color="white">03866</font>	                case 2: fireenemy();
<a name="L3867"><font color="white">03867</font>	                    return;
<a name="L3868"><font color="white">03868</font>	            }
<a name="L3869"><font color="white">03869</font>	        }
<a name="L3870"><font color="white">03870</font>	        setenemy(XIII);
<a name="L3871"><font color="white">03871</font>	    }
<a name="L3872"><font color="white">03872</font>	    event EnemyNotVisible()
<a name="L3873"><font color="white">03873</font>	    {
<a name="L3874"><font color="white">03874</font>	        Switch (iEtatVaVersStrp)
<a name="L3875"><font color="white">03875</font>	        {
<a name="L3876"><font color="white">03876</font>	            case 1: return;
<a name="L3877"><font color="white">03877</font>	            case 2: HalteAufeu();
<a name="L3878"><font color="white">03878</font>	                return;
<a name="L3879"><font color="white">03879</font>	        }
<a name="L3880"><font color="white">03880</font>	        if (TenteGrenadage())
<a name="L3881"><font color="white">03881</font>	        {
<a name="L3882"><font color="white">03882</font>	            if (bencouverture)
<a name="L3883"><font color="white">03883</font>	            {
<a name="L3884"><font color="white">03884</font>	                Switch(bases.skill)
<a name="L3885"><font color="white">03885</font>	                {
<a name="L3886"><font color="white">03886</font>	                    Case 1 : Angle_Visee=14; break;
<a name="L3887"><font color="white">03887</font>	                    Case 2 : Angle_Visee=12; break;
<a name="L3888"><font color="white">03888</font>	                    Case 3 : Angle_Visee=10; break;
<a name="L3889"><font color="white">03889</font>	                    Case 4 : Angle_Visee=8; break;
<a name="L3890"><font color="white">03890</font>	                    Case 5 : Angle_Visee=6; break;
<a name="L3891"><font color="white">03891</font>	                }
<a name="L3892"><font color="white">03892</font>	                pawn.shouldcrouch(false);
<a name="L3893"><font color="white">03893</font>	                bEnCouverture=false;
<a name="L3894"><font color="white">03894</font>	                GenAlerte.NbAllieEnCouverture--;
<a name="L3895"><font color="white">03895</font>	            }
<a name="L3896"><font color="white">03896</font>	            if (iEtatVaVersStrp&gt;1)
<a name="L3897"><font color="white">03897</font>	            {
<a name="L3898"><font color="white">03898</font>	                LastStrP.Libere();
<a name="L3899"><font color="white">03899</font>	                iEtatVaVersStrp=0;
<a name="L3900"><font color="white">03900</font>	                LastStrP=none;
<a name="L3901"><font color="white">03901</font>	            }
<a name="L3902"><font color="white">03902</font>	            HalteAuFeu();
<a name="L3903"><font color="white">03903</font>	            gotostate('attaque','LanceGrenadeTarget');
<a name="L3904"><font color="white">03904</font>	            return;
<a name="L3905"><font color="white">03905</font>	        }
<a name="L3906"><font color="white">03906</font>	        else if (LigneVisee(enemy.location, LastSeeingPos))
<a name="L3907"><font color="white">03907</font>	        {
<a name="L3908"><font color="white">03908</font>					HalteAuFeu();
<a name="L3909"><font color="white">03909</font>	            GotoState('TacticalMove','RecoverEnemy');
<a name="L3910"><font color="white">03910</font>	            return;
<a name="L3911"><font color="white">03911</font>	        }
<a name="L3912"><font color="white">03912</font>	        else
<a name="L3913"><font color="white">03913</font>	        {
<a name="L3914"><font color="white">03914</font>					HalteAuFeu();
<a name="L3915"><font color="white">03915</font>	            gotostate('temporise');
<a name="L3916"><font color="white">03916</font>	            return;
<a name="L3917"><font color="white">03917</font>	        }
<a name="L3918"><font color="white">03918</font>	    }
<a name="L3919"><font color="white">03919</font>	    event Tick(float deltaseconds)
<a name="L3920"><font color="white">03920</font>	    {
<a name="L3921"><font color="white">03921</font>	        local int i;
<a name="L3922"><font color="white">03922</font>	        local iacontroller iacontr;
<a name="L3923"><font color="white">03923</font>	        local actor nav;
<a name="L3924"><font color="white">03924</font>	        local AttitudeInfo attitude;
<a name="L3925"><font color="white">03925</font>	        local float distanceAXIII;
<a name="L3926"><font color="white">03926</font>	        local int NBAllieEnCouverture;
<a name="L3927"><font color="white">03927</font>	
<a name="L3928"><font color="white">03928</font>	        global.tick(deltaseconds);
<a name="L3929"><font color="white">03929</font>	
<a name="L3930"><font color="white">03930</font>	        if ((enemy==none) || enemy.bisdead)
<a name="L3931"><font color="white">03931</font>	        {
<a name="L3932"><font color="white">03932</font>	            ChangeEtat();
<a name="L3933"><font color="white">03933</font>	            return;
<a name="L3934"><font color="white">03934</font>	        }
<a name="L3935"><font color="white">03935</font>	        if (iEtatVaVersStrp&gt;0 || bLanceGrenade)
<a name="L3936"><font color="white">03936</font>	            return;
<a name="L3937"><font color="white">03937</font>	        if ((level.timeSeconds-Temps_Ref2)&gt;5 &amp;&amp; bases.order!='garder')
<a name="L3938"><font color="white">03938</font>	        {
<a name="L3939"><font color="white">03939</font>	            Attitude=AttitudeToNMI(enemy);
<a name="L3940"><font color="white">03940</font>	            if (Attitude==ATTITUDE_Fear)    //actualisation attitude
<a name="L3941"><font color="white">03941</font>	            {
<a name="L3942"><font color="white">03942</font>	                HalteAuFeu();
<a name="L3943"><font color="white">03943</font>	                gotostate('fuite');
<a name="L3944"><font color="white">03944</font>	                return;
<a name="L3945"><font color="white">03945</font>	            }
<a name="L3946"><font color="white">03946</font>	            else if (Attitude==ATTITUDE_Impressed)
<a name="L3947"><font color="white">03947</font>	            {  //retraite possible si enemmi de dos ou assez loin
<a name="L3948"><font color="white">03948</font>	                if (((enemy.location-pawn.location) dot vector(enemy.rotation))&gt;0 || Vsize(enemy.location-pawn.location)&gt;600)
<a name="L3949"><font color="white">03949</font>	                    CherchePointRetraite();
<a name="L3950"><font color="white">03950</font>	            }
<a name="L3951"><font color="white">03951</font>	            Temps_Ref2=level.timeseconds;
<a name="L3952"><font color="white">03952</font>	        }
<a name="L3953"><font color="white">03953</font>	        if ((Level.timeseconds-Temps_ref)&gt;3)
<a name="L3954"><font color="white">03954</font>	        {
<a name="L3955"><font color="white">03955</font>					Temps_Ref=Level.timeseconds;
<a name="L3956"><font color="white">03956</font>	            //recherche alarme
<a name="L3957"><font color="white">03957</font>					//log(&quot; cherche alarme&quot;@!genalerte.bAllAlarmsActivated);
<a name="L3958"><font color="white">03958</font>	            if (!genalerte.bAllAlarmsActivated)    ChercheAlarme();  //ALARMEChercheAlarme();  //ALARME
<a name="L3959"><font color="white">03959</font>	            //si otage
<a name="L3960"><font color="white">03960</font>	            if (xiii.bPrisonner &amp;&amp; XIII.LHand.pOnShoulder!=none &amp;&amp; AllianceLevel(XIII.LHand.pOnShoulder)==1 &amp;&amp; enemy==xiii &amp;&amp; VSize(pawn.location-enemy.location) &lt; 125)
<a name="L3961"><font color="white">03961</font>	            {
<a name="L3962"><font color="white">03962</font>	                if (CHARGE_LES_LOGS) log(pawn$&quot;me colle trop je tir&quot;);
<a name="L3963"><font color="white">03963</font>	                NbCoupsRiposte=(2+bases.agressivite)*1.5;
<a name="L3964"><font color="white">03964</font>	                NbCoupsRiposte=Min(4,NbCoupsRiposte);
<a name="L3965"><font color="white">03965</font>	                NbCoupsRiposte=Max(1,NbCoupsRiposte);
<a name="L3966"><font color="white">03966</font>	            }
<a name="L3967"><font color="white">03967</font>	            if (bases.order!='garder')
<a name="L3968"><font color="white">03968</font>	                ChangetoBestWeapon();   //test nouvelle armeChangetoBestWeapon();   //test nouvelle arme
<a name="L3969"><font color="white">03969</font>	
<a name="L3970"><font color="white">03970</font>	            //couverture
<a name="L3971"><font color="white">03971</font>	            //log(genalerte.SoldierInFightList.length@!pawn.weapon.bmeleeweapon@(float(GenAlerte.NBAllieEnCouverture)/GenAlerte.SoldierInFightList.length)&lt;0.3 &amp;&amp; vsize(pawn.location-enemy.location)&gt;500);
<a name="L3972"><font color="white">03972</font>	            distanceAXIII=vsize(pawn.location-enemy.location);
<a name="L3973"><font color="white">03973</font>	            NBAllieEnCouverture=genalerte.NBAllieEnCouverture;
<a name="L3974"><font color="white">03974</font>	            if (bencouverture)
<a name="L3975"><font color="white">03975</font>	                NBAllieEnCouverture--;
<a name="L3976"><font color="white">03976</font>	            if (genalerte.SoldierInFightList.length&gt;1 &amp;&amp; (float(NBAllieEnCouverture)/GenAlerte.SoldierInFightList.length)&lt;0.3 &amp;&amp; distanceAXIII&gt;500 &amp;&amp; distanceAXIII&lt;1.5*bases.DistanceAttaque)
<a name="L3977"><font color="white">03977</font>	            {
<a name="L3978"><font color="white">03978</font>	                if (!bEnCouverture)
<a name="L3979"><font color="white">03979</font>						{
<a name="L3980"><font color="white">03980</font>								//log(pawn@&quot;passe en couverture&quot;@Fasttrace(DirectionTir, WeaponStartTrace-vect(0,0,30)));
<a name="L3981"><font color="white">03981</font>	                    gotostate('Attaque','Couverture');
<a name="L3982"><font color="white">03982</font>						}
<a name="L3983"><font color="white">03983</font>	            }
<a name="L3984"><font color="white">03984</font>	            else if (bEnCouverture)
<a name="L3985"><font color="white">03985</font>	            {
<a name="L3986"><font color="white">03986</font>	                Switch(bases.skill)
<a name="L3987"><font color="white">03987</font>	                {
<a name="L3988"><font color="white">03988</font>	                    Case 1 : Angle_Visee=14; break;
<a name="L3989"><font color="white">03989</font>	                    Case 2 : Angle_Visee=12; break;
<a name="L3990"><font color="white">03990</font>	                    Case 3 : Angle_Visee=10; break;
<a name="L3991"><font color="white">03991</font>	                    Case 4 : Angle_Visee=8; break;
<a name="L3992"><font color="white">03992</font>	                    Case 5 : Angle_Visee=6; break;
<a name="L3993"><font color="white">03993</font>	                }
<a name="L3994"><font color="white">03994</font>	                pawn.shouldcrouch(false);
<a name="L3995"><font color="white">03995</font>	                bEnCouverture=false;
<a name="L3996"><font color="white">03996</font>	                GenAlerte.NbAllieEnCouverture--;
<a name="L3997"><font color="white">03997</font>	                gotostate('attaque','charge');
<a name="L3998"><font color="white">03998</font>	            }
<a name="L3999"><font color="white">03999</font>	            //Attaquescriptee
<a name="L4000"><font color="white">04000</font>	            ChercheReseauAttaque();
<a name="L4001"><font color="white">04001</font>	        }
<a name="L4002"><font color="white">04002</font>	    }
<a name="L4003"><font color="white">04003</font>	    event Timer2()
<a name="L4004"><font color="white">04004</font>	    {
<a name="L4005"><font color="white">04005</font>	        if (btire)
<a name="L4006"><font color="white">04006</font>	        {
<a name="L4007"><font color="white">04007</font>	            bfire=0;
<a name="L4008"><font color="white">04008</font>	            settimer(0.5,false);
<a name="L4009"><font color="white">04009</font>	        }
<a name="L4010"><font color="white">04010</font>	    }
<a name="L4011"><font color="white">04011</font>	    event timer3()
<a name="L4012"><font color="white">04012</font>	    {
<a name="L4013"><font color="white">04013</font>	        EnemyTargetPos=enemy.location;
<a name="L4014"><font color="white">04014</font>	        EnemyTargetVelocity=enemy.velocity;
<a name="L4015"><font color="white">04015</font>	        if (bases.order=='garder')
<a name="L4016"><font color="white">04016</font>	        {
<a name="L4017"><font color="white">04017</font>	            if (ChangetoBestWeapon() &amp;&amp; Pawn.pendingWeapon.bmeleeweapon) //test nouvelle arme et si passe aux points donc ne peut plus garder
<a name="L4018"><font color="white">04018</font>	            {
<a name="L4019"><font color="white">04019</font>	                bases.order='tenir';
<a name="L4020"><font color="white">04020</font>	                gotostate('attaqueH2H','charge');
<a name="L4021"><font color="white">04021</font>	            }
<a name="L4022"><font color="white">04022</font>	        }
<a name="L4023"><font color="white">04023</font>	    }
<a name="L4024"><font color="white">04024</font>	    event SeeDeadPawn(pawn other)
<a name="L4025"><font color="white">04025</font>	    {
<a name="L4026"><font color="white">04026</font>	        if (ChercheBonMatos(other))		//CadavreWithPickup affecte a other dans Cherchebonmatos
<a name="L4027"><font color="white">04027</font>	        {
<a name="L4028"><font color="white">04028</font>	            HalteAufeu();
<a name="L4029"><font color="white">04029</font>	            bDisableEventSeeDeadPawn=true;
<a name="L4030"><font color="white">04030</font>	            CadavreWithPickup.bDejaFouille=true;
<a name="L4031"><font color="white">04031</font>	            gotostate('tacticalmove','chercheobjet');
<a name="L4032"><font color="white">04032</font>	        }
<a name="L4033"><font color="white">04033</font>	    }
<a name="L4034"><font color="white">04034</font>	    event UpdateTactics()
<a name="L4035"><font color="white">04035</font>	    {
<a name="L4036"><font color="white">04036</font>	            VecteurRecalage=vect(0,0,0);
<a name="L4037"><font color="white">04037</font>	            VecteurRecalage= PseudoSteering();
<a name="L4038"><font color="white">04038</font>	            if (VecteurRecalage!=vect(0,0,0) || Vsize(enemy.location-temp_vect)&gt;150)   //l'ennemi a bouge ou steering
<a name="L4039"><font color="white">04039</font>	            {
<a name="L4040"><font color="white">04040</font>	                CompteurRecalage=15;
<a name="L4041"><font color="white">04041</font>	                badvancedtactics=false;
<a name="L4042"><font color="white">04042</font>	                gotostate('attaque','charge');
<a name="L4043"><font color="white">04043</font>	            }
<a name="L4044"><font color="white">04044</font>	    }
<a name="L4045"><font color="white">04045</font>	    event Trigger(actor Other, pawn EventInstigator)
<a name="L4046"><font color="white">04046</font>	    {
<a name="L4047"><font color="white">04047</font>	        local bool bLigneVisee;
<a name="L4048"><font color="white">04048</font>	        local bool bJump;
<a name="L4049"><font color="white">04049</font>	        local int i;
<a name="L4050"><font color="white">04050</font>	
<a name="L4051"><font color="white">04051</font>	        if (iEtatVaVersStrp&gt;1)
<a name="L4052"><font color="white">04052</font>	            return;
<a name="L4053"><font color="white">04053</font>	        //log(&quot;trigger&quot;@bases.StrategicPointAttraction);
<a name="L4054"><font color="white">04054</font>	        LastStrP=StrategicPoint(other);
<a name="L4055"><font color="white">04055</font>	        if (LastStrP!=none) // STRATEGIC POINTS
<a name="L4056"><font color="white">04056</font>	        {
<a name="L4057"><font color="white">04057</font>	            if (frand()*100&lt;=bases.StrategicPointAttraction &amp;&amp; Vsize(enemy.location-pawn.location)&gt;400)
<a name="L4058"><font color="white">04058</font>	            {
<a name="L4059"><font color="white">04059</font>	                if (LastStrP.FinishJumpPoint!=none)
<a name="L4060"><font color="white">04060</font>	                {
<a name="L4061"><font color="white">04061</font>	                    bJump=true;
<a name="L4062"><font color="white">04062</font>	                }
<a name="L4063"><font color="white">04063</font>	                Movetarget=none;
<a name="L4064"><font color="white">04064</font>	                if (Fasttrace(LastStrP.location-vect(0,0,30),pawn.location-vect(0,0,30)))
<a name="L4065"><font color="white">04065</font>	                {
<a name="L4066"><font color="white">04066</font>	                    LastStrP.Occupe();
<a name="L4067"><font color="white">04067</font>	                    if (bjump)
<a name="L4068"><font color="white">04068</font>	                    {
<a name="L4069"><font color="white">04069</font>	                        LastStrP.FinishJumpPoint.occupe();
<a name="L4070"><font color="white">04070</font>	                    }
<a name="L4071"><font color="white">04071</font>	                    if (iEtatVaVersStrp==1) //va vers point interdemediaire
<a name="L4072"><font color="white">04072</font>	                    {
<a name="L4073"><font color="white">04073</font>	                        PointIntermediaire.bAlreadyTargeted=false;
<a name="L4074"><font color="white">04074</font>	                        if (cansee(enemy)) fireenemy();
<a name="L4075"><font color="white">04075</font>	                    }
<a name="L4076"><font color="white">04076</font>	                    gotostate('attaque','vaversStrP');
<a name="L4077"><font color="white">04077</font>	                }
<a name="L4078"><font color="white">04078</font>	                else if (FindBestPathToward(LastStrP))
<a name="L4079"><font color="white">04079</font>	                {
<a name="L4080"><font color="white">04080</font>	                    LastStrP.Occupe();
<a name="L4081"><font color="white">04081</font>	                    if (bjump)
<a name="L4082"><font color="white">04082</font>	                    {
<a name="L4083"><font color="white">04083</font>	                        LastStrP.FinishJumpPoint.occupe();
<a name="L4084"><font color="white">04084</font>	                    }
<a name="L4085"><font color="white">04085</font>	                    for (i=0;i&lt;16;i++)
<a name="L4086"><font color="white">04086</font>	                    {
<a name="L4087"><font color="white">04087</font>	                        if (routecache[i]==none)
<a name="L4088"><font color="white">04088</font>	                            break;
<a name="L4089"><font color="white">04089</font>	                        PointChemin[i]=routecache[i];
<a name="L4090"><font color="white">04090</font>	                    }
<a name="L4091"><font color="white">04091</font>	                    NbPointChemin=i;
<a name="L4092"><font color="white">04092</font>	                    gotostate('attaque','vaversStrP');
<a name="L4093"><font color="white">04093</font>	                }
<a name="L4094"><font color="white">04094</font>	            }
<a name="L4095"><font color="white">04095</font>	        }
<a name="L4096"><font color="white">04096</font>	    }
<a name="L4097"><font color="white">04097</font>	
<a name="L4098"><font color="white">04098</font>	    function NotifyFiring()
<a name="L4099"><font color="white">04099</font>	    {
<a name="L4100"><font color="white">04100</font>			  if (enemy==none)
<a name="L4101"><font color="white">04101</font>					return;
<a name="L4102"><font color="white">04102</font>			  if (pawn.weapon.bmeleeweapon)
<a name="L4103"><font color="white">04103</font>			  {
<a name="L4104"><font color="white">04104</font>					gotostate('attaqueH2H');
<a name="L4105"><font color="white">04105</font>					HalteAuFeu();
<a name="L4106"><font color="white">04106</font>					return;
<a name="L4107"><font color="white">04107</font>			  }
<a name="L4108"><font color="white">04108</font>	        DirectionTir=DirectionDuTir(); //recupere direction du tir avant dispersion
<a name="L4109"><font color="white">04109</font>	        CheckLineOfFire();
<a name="L4110"><font color="white">04110</font>	        if (btire)//je vais tirer
<a name="L4111"><font color="white">04111</font>	        {
<a name="L4112"><font color="white">04112</font>	            //log(&quot;pawn.weapon&quot;@pawn.weapon.hasammo()@XIIIWeapon(pawn.weapon).reloadcount@(1.6-vsize(enemy.location-pawn.location)*0.002)&gt;frand()@(1.6-vsize(enemy.location-pawn.location)*0.002));
<a name="L4113"><font color="white">04113</font>	            if (pawn.weapon.reloadcount==1 &amp;&amp; pawn.weapon.default.reloadcount&gt;1)
<a name="L4114"><font color="white">04114</font>	            {
<a name="L4115"><font color="white">04115</font>	                if (bases.order!='garder' &amp;&amp; (1.6-vsize(enemy.location-pawn.location)*0.002)&gt;frand())
<a name="L4116"><font color="white">04116</font>	                {
<a name="L4117"><font color="white">04117</font>	                    bFuitPourreloader=true;
<a name="L4118"><font color="white">04118</font>	                    Timer_VaRecharger=level.timeseconds;
<a name="L4119"><font color="white">04119</font>	                    CherchePointReload();
<a name="L4120"><font color="white">04120</font>	                }
<a name="L4121"><font color="white">04121</font>	            }
<a name="L4122"><font color="white">04122</font>	        }
<a name="L4123"><font color="white">04123</font>	
<a name="L4124"><font color="white">04124</font>	    }
<a name="L4125"><font color="white">04125</font>	    function DamageAttitudeto(pawn Other, float Damage)
<a name="L4126"><font color="white">04126</font>	    {
<a name="L4127"><font color="white">04127</font>	        if (bases.bisdead)
<a name="L4128"><font color="white">04128</font>	            return;
<a name="L4129"><font color="white">04129</font>	        //son
<a name="L4130"><font color="white">04130</font>	        bases.PlaySndPNJOno(pnjono'Onomatopees.hPNJHurt',bases.CodeMesh,bases.NumeroTimbre);
<a name="L4131"><font color="white">04131</font>	
<a name="L4132"><font color="white">04132</font>		     If (xiii.bPrisonner &amp;&amp; XIII.LHand.pOnShoulder!=none &amp;&amp; AllianceLevel(XIII.LHand.pOnShoulder)==1 &amp;&amp; other==xiii)
<a name="L4133"><font color="white">04133</font>	        {
<a name="L4134"><font color="white">04134</font>	           if (CHARGE_LES_LOGS) log(pawn$&quot;je riposte&quot;);
<a name="L4135"><font color="white">04135</font>	           NbCoupsRiposte=(2+bases.agressivite)*1.9;
<a name="L4136"><font color="white">04136</font>	           NbCoupsRiposte=Min(5,NbCoupsRiposte);
<a name="L4137"><font color="white">04137</font>	           NbCoupsRiposte=Max(1,NbCoupsRiposte);
<a name="L4138"><font color="white">04138</font>	        }
<a name="L4139"><font color="white">04139</font>	    }
<a name="L4140"><font color="white">04140</font>	
<a name="L4141"><font color="white">04141</font>	    function ReceiveWarning(pawn shooter, float projspeed,vector firedir)
<a name="L4142"><font color="white">04142</font>	    {
<a name="L4143"><font color="white">04143</font>	        local float enemyDist;
<a name="L4144"><font color="white">04144</font>	        local vector X,Y,Z, enemyDir;
<a name="L4145"><font color="white">04145</font>	
<a name="L4146"><font color="white">04146</font>	        // AI controlled creatures may duck if not falling
<a name="L4147"><font color="white">04147</font>	        if (bases.order=='garder' || bEnCouverture || iEtatVaVersStrp&gt;0 || (Enemy == None)
<a name="L4148"><font color="white">04148</font>	            || (Pawn.Physics == PHYS_Falling) || (Pawn.Physics == PHYS_Swimming) )
<a name="L4149"><font color="white">04149</font>	            return;
<a name="L4150"><font color="white">04150</font>	
<a name="L4151"><font color="white">04151</font>	        if (FRand() &gt; 0.02 * skill)
<a name="L4152"><font color="white">04152</font>	            return;
<a name="L4153"><font color="white">04153</font>	
<a name="L4154"><font color="white">04154</font>	        if (shooter==xiii)
<a name="L4155"><font color="white">04155</font>	        {
<a name="L4156"><font color="white">04156</font>	            if (!XIIIWeapon(shooter.weapon).AmmoType.bInstantHit)
<a name="L4157"><font color="white">04157</font>	            {
<a name="L4158"><font color="white">04158</font>	                enemyDist = VSize(shooter.Location - Pawn.Location);
<a name="L4159"><font color="white">04159</font>	                if (enemyDist/projSpeed &gt; 0.11 + 0.15 * FRand())
<a name="L4160"><font color="white">04160</font>	                {
<a name="L4161"><font color="white">04161</font>	                    gotostate('TacticalMove','strafe');
<a name="L4162"><font color="white">04162</font>	                    return;
<a name="L4163"><font color="white">04163</font>	                }
<a name="L4164"><font color="white">04164</font>	            }
<a name="L4165"><font color="white">04165</font>	            else
<a name="L4166"><font color="white">04166</font>						gotostate('TacticalMove','strafe');
<a name="L4167"><font color="white">04167</font>	        }
<a name="L4168"><font color="white">04168</font>	    }
<a name="L4169"><font color="white">04169</font>	
<a name="L4170"><font color="white">04170</font>	    function bool SwitchSurGrenade()
<a name="L4171"><font color="white">04171</font>	    {
<a name="L4172"><font color="white">04172</font>	        if (pawn.weapon.isa('grenad'))
<a name="L4173"><font color="white">04173</font>	            return true;
<a name="L4174"><font color="white">04174</font>	        // ELR Remove Class reference
<a name="L4175"><font color="white">04175</font>	        //pawn.pendingweapon = XIIIWeapon(pawn.FindInventoryType(class'grenad'));
<a name="L4176"><font color="white">04176</font>	        Pawn.PendingWeapon = Pawn.Inventory.WeaponChange(4);
<a name="L4177"><font color="white">04177</font>	        if ( Pawn.PendingWeapon == none )
<a name="L4178"><font color="white">04178</font>	          Pawn.PendingWeapon = Pawn.Inventory.WeaponChange(20); // try Frag Grenad
<a name="L4179"><font color="white">04179</font>	        // ELR End
<a name="L4180"><font color="white">04180</font>	        if (pawn.pendingweapon==none || !pawn.pendingweapon.HasAmmo())
<a name="L4181"><font color="white">04181</font>	        {
<a name="L4182"><font color="white">04182</font>	            log(pawn$&quot;          BEN J'AI PAS DE GRENADE  $$$$$$$&quot;);
<a name="L4183"><font color="white">04183</font>	            return false;
<a name="L4184"><font color="white">04184</font>	        }
<a name="L4185"><font color="white">04185</font>	        else
<a name="L4186"><font color="white">04186</font>	        {
<a name="L4187"><font color="white">04187</font>	            Pawn.Weapon.PutDown();
<a name="L4188"><font color="white">04188</font>	            return true;
<a name="L4189"><font color="white">04189</font>	        }
<a name="L4190"><font color="white">04190</font>	    }
<a name="L4191"><font color="white">04191</font>	    function GrenadeTarget ActiveGrenadeTarget()
<a name="L4192"><font color="white">04192</font>	    {
<a name="L4193"><font color="white">04193</font>	        local GrenadeTarget GrenT;
<a name="L4194"><font color="white">04194</font>	        local int i;
<a name="L4195"><font color="white">04195</font>	
<a name="L4196"><font color="white">04196</font>	        For(i=0;i&lt;level.game.GrenadeTargetList.Length;i++)
<a name="L4197"><font color="white">04197</font>	        {
<a name="L4198"><font color="white">04198</font>	            grent=GrenadeTarget(level.game.GrenadeTargetList[i]);
<a name="L4199"><font color="white">04199</font>	            if (GrenT.bActive)
<a name="L4200"><font color="white">04200</font>	                return GrenT;
<a name="L4201"><font color="white">04201</font>	        }
<a name="L4202"><font color="white">04202</font>	        return none;
<a name="L4203"><font color="white">04203</font>	    }
<a name="L4204"><font color="white">04204</font>	    function bool TenteGrenadage()
<a name="L4205"><font color="white">04205</font>	    {
<a name="L4206"><font color="white">04206</font>	        local GrenadeTarget GrenT;
<a name="L4207"><font color="white">04207</font>	        local inventory GRE;
<a name="L4208"><font color="white">04208</font>	
<a name="L4209"><font color="white">04209</font>	        if (enemy.base==none)
<a name="L4210"><font color="white">04210</font>	            return false;
<a name="L4211"><font color="white">04211</font>	        // ELR No more cast/Class ref to grenad
<a name="L4212"><font color="white">04212</font>	//        if ( (grenad(pawn.weapon) != none) &amp;&amp; pawn.weapon.hasammo() )
<a name="L4213"><font color="white">04213</font>	        if ( (pawn.weapon != none) &amp;&amp; ((Pawn.Weapon.InventoryGroup == 4) || (Pawn.Weapon.InventoryGroup == 20)) &amp;&amp; pawn.weapon.hasammo() )
<a name="L4214"><font color="white">04214</font>	        {
<a name="L4215"><font color="white">04215</font>	            GrenT=ActiveGrenadeTarget();
<a name="L4216"><font color="white">04216</font>	            if (GrenT!=none)
<a name="L4217"><font color="white">04217</font>	                if (Vsize(GrenT.location-pawn.location)&lt;500 &amp;&amp; Vsize(GrenT.location-pawn.location)&gt;300 &amp;&amp; FastTrace(GrenT.location))
<a name="L4218"><font color="white">04218</font>	                {
<a name="L4219"><font color="white">04219</font>	                    return true;
<a name="L4220"><font color="white">04220</font>	                }
<a name="L4221"><font color="white">04221</font>	                if (Vsize(enemy.location-pawn.location)&lt;1200 &amp;&amp; Vsize(enemy.location-pawn.location)&gt;200 &amp;&amp; FastTrace(enemy.location+vect(0,0,80),enemy.location) &amp;&amp; FastTrace(enemy.location+vect(0,0,80),pawn.eyeposition()+pawn.location))
<a name="L4222"><font color="white">04222</font>	                    return true;
<a name="L4223"><font color="white">04223</font>	        }
<a name="L4224"><font color="white">04224</font>	        else
<a name="L4225"><font color="white">04225</font>	        {
<a name="L4226"><font color="white">04226</font>	            // ELR Remove Class reference
<a name="L4227"><font color="white">04227</font>	            //GRE=pawn.FindInventoryType(class'grenad');
<a name="L4228"><font color="white">04228</font>	            GRE = Pawn.Inventory.WeaponChange(4);
<a name="L4229"><font color="white">04229</font>	            if ( GRE == none )
<a name="L4230"><font color="white">04230</font>	              GRE = Pawn.Inventory.WeaponChange(20); // try Frag Grenad
<a name="L4231"><font color="white">04231</font>	            // ELR End
<a name="L4232"><font color="white">04232</font>	            if (GRE==none)
<a name="L4233"><font color="white">04233</font>	                return false;
<a name="L4234"><font color="white">04234</font>	            GrenT=ActiveGrenadeTarget();
<a name="L4235"><font color="white">04235</font>	            if (GrenT!=none)
<a name="L4236"><font color="white">04236</font>	                if (Vsize(GrenT.location-pawn.location)&lt;500 &amp;&amp; Vsize(GrenT.location-pawn.location)&gt;300 &amp;&amp; FastTrace(GrenT.location))
<a name="L4237"><font color="white">04237</font>	                {
<a name="L4238"><font color="white">04238</font>	                    return true;
<a name="L4239"><font color="white">04239</font>	                }
<a name="L4240"><font color="white">04240</font>	                //log(&quot;tente grenadage &quot;@FastTrace(enemy.location+vect(0,0,80),enemy.location));
<a name="L4241"><font color="white">04241</font>	                if (Vsize(enemy.location-pawn.location)&lt;1200 &amp;&amp; Vsize(enemy.location-pawn.location)&gt;200 &amp;&amp; FastTrace(enemy.location+vect(0,0,80),enemy.location) &amp;&amp; FastTrace(enemy.location+vect(0,0,80),pawn.eyeposition()+pawn.location))
<a name="L4242"><font color="white">04242</font>	                    return true;
<a name="L4243"><font color="white">04243</font>	        }
<a name="L4244"><font color="white">04244</font>	        return false;
<a name="L4245"><font color="white">04245</font>	    }
<a name="L4246"><font color="white">04246</font>	
<a name="L4247"><font color="white">04247</font>	    function BeginState()
<a name="L4248"><font color="white">04248</font>	    {
<a name="L4249"><font color="white">04249</font>	        disable('enemynotvisible');
<a name="L4250"><font color="white">04250</font>			  //log(pawn@&quot;ajoute perso dans la liste des basesoldierinfight&quot;);
<a name="L4251"><font color="white">04251</font>	        genalerte.SoldierInFightList.length=genalerte.SoldierInFightList.length+1;
<a name="L4252"><font color="white">04252</font>	        genalerte.SoldierInFightList[genalerte.SoldierInFightList.Length-1]=bases;
<a name="L4253"><font color="white">04253</font>	        pawn.SetAnimStatus('alert');
<a name="L4254"><font color="white">04254</font>			  EnemyTargetPos=enemy.location;
<a name="L4255"><font color="white">04255</font>	    		EnemyTargetVelocity=enemy.velocity;
<a name="L4256"><font color="white">04256</font>	        if (NiveauAlerte==0)
<a name="L4257"><font color="white">04257</font>	        {
<a name="L4258"><font color="white">04258</font>	            s_decAttente();
<a name="L4259"><font color="white">04259</font>	            s_incAttaque();
<a name="L4260"><font color="white">04260</font>	        }
<a name="L4261"><font color="white">04261</font>	        else if (NiveauAlerte==1)
<a name="L4262"><font color="white">04262</font>	        {
<a name="L4263"><font color="white">04263</font>	            s_decAlerte();
<a name="L4264"><font color="white">04264</font>	            s_incAttaque();
<a name="L4265"><font color="white">04265</font>	        }
<a name="L4266"><font color="white">04266</font>	        NiveauAlerte=2;
<a name="L4267"><font color="white">04267</font>			  bARienVu=false;
<a name="L4268"><font color="white">04268</font>	        Temps_Ref2=level.timeseconds-2;
<a name="L4269"><font color="white">04269</font>	        Temps_Ref=Temps_Ref2;
<a name="L4270"><font color="white">04270</font>	        settimer3(Temps_RefreshEnemyPos,true);
<a name="L4271"><font color="white">04271</font>	        //***** Var temp *******
<a name="L4272"><font color="white">04272</font>	        //temp_float=0.0;
<a name="L4273"><font color="white">04273</font>	        ///temp_vect=vect(0,0,0);  //1) pour garder ancienne position ennemi dans updatetacics 2) dans saut
<a name="L4274"><font color="white">04274</font>	        //PointDestination=vect(0,0,0);
<a name="L4275"><font color="white">04275</font>	        //temp_int=0; //utilise pour boucle sur pointchemin
<a name="L4276"><font color="white">04276</font>	        LastStrP=none;
<a name="L4277"><font color="white">04277</font>	
<a name="L4278"><font color="white">04278</font>	    }
<a name="L4279"><font color="white">04279</font>	    function EndState()
<a name="L4280"><font color="white">04280</font>	    {
<a name="L4281"><font color="white">04281</font>	        local int i;
<a name="L4282"><font color="white">04282</font>	
<a name="L4283"><font color="white">04283</font>	       pawn.bcanjump=false;
<a name="L4284"><font color="white">04284</font>	        if (bencouverture)
<a name="L4285"><font color="white">04285</font>	        {
<a name="L4286"><font color="white">04286</font>	            Switch(bases.skill)
<a name="L4287"><font color="white">04287</font>	            {
<a name="L4288"><font color="white">04288</font>	                Case 1 : Angle_Visee=14; break;
<a name="L4289"><font color="white">04289</font>	                Case 2 : Angle_Visee=12; break;
<a name="L4290"><font color="white">04290</font>	                Case 3 : Angle_Visee=10; break;
<a name="L4291"><font color="white">04291</font>	                Case 4 : Angle_Visee=8; break;
<a name="L4292"><font color="white">04292</font>	                Case 5 : Angle_Visee=6; break;
<a name="L4293"><font color="white">04293</font>	            }
<a name="L4294"><font color="white">04294</font>	            pawn.shouldcrouch(false);
<a name="L4295"><font color="white">04295</font>	            bEnCouverture=false;
<a name="L4296"><font color="white">04296</font>	            GenAlerte.NbAllieEnCouverture--;
<a name="L4297"><font color="white">04297</font>	        }
<a name="L4298"><font color="white">04298</font>	        settimer3(0,false);
<a name="L4299"><font color="white">04299</font>	        bAdvancedTactics=false;
<a name="L4300"><font color="white">04300</font>	        bEtatAlerte=true;
<a name="L4301"><font color="white">04301</font>	        //vire soldierinfightlist
<a name="L4302"><font color="white">04302</font>			  //log(pawn@&quot;VIRE perso dans la liste &quot;);
<a name="L4303"><font color="white">04303</font>	        for (i=0;i&lt;genalerte.SoldierInFightList.Length; i++)
<a name="L4304"><font color="white">04304</font>	        {
<a name="L4305"><font color="white">04305</font>	            if (genalerte.SoldierInFightList[i] == pawn )
<a name="L4306"><font color="white">04306</font>	            {
<a name="L4307"><font color="white">04307</font>						//log(pawn@&quot;JE ME VIRE de la liste des basesoldierinfight&quot;);
<a name="L4308"><font color="white">04308</font>	                genalerte.SoldierInFightList.Remove(i,1);
<a name="L4309"><font color="white">04309</font>	                break;
<a name="L4310"><font color="white">04310</font>	            }
<a name="L4311"><font color="white">04311</font>	        }
<a name="L4312"><font color="white">04312</font>	        if (iEtatVaVersStrp&gt;0)
<a name="L4313"><font color="white">04313</font>	        {
<a name="L4314"><font color="white">04314</font>	            if (iEtatVaVersStrp==1)
<a name="L4315"><font color="white">04315</font>	            {
<a name="L4316"><font color="white">04316</font>	                PointIntermediaire.bAlreadyTargeted=false;
<a name="L4317"><font color="white">04317</font>	                PointIntermediaire=none;
<a name="L4318"><font color="white">04318</font>	            }
<a name="L4319"><font color="white">04319</font>	            else
<a name="L4320"><font color="white">04320</font>	            {
<a name="L4321"><font color="white">04321</font>	                LastStrP.Libere();
<a name="L4322"><font color="white">04322</font>	                if (LastStrP.bAccroupi)
<a name="L4323"><font color="white">04323</font>	                    pawn.shouldcrouch(false);
<a name="L4324"><font color="white">04324</font>	                LastStrP=none;
<a name="L4325"><font color="white">04325</font>	            }
<a name="L4326"><font color="white">04326</font>	            iEtatVaVersStrp=0;
<a name="L4327"><font color="white">04327</font>	            LastStrP=none;
<a name="L4328"><font color="white">04328</font>	        }
<a name="L4329"><font color="white">04329</font>	
<a name="L4330"><font color="white">04330</font>	    }
<a name="L4331"><font color="white">04331</font>	
<a name="L4332"><font color="white">04332</font>	initattaque:
<a name="L4333"><font color="white">04333</font>	    pawn.velocity=vect(0,0,0);
<a name="L4334"><font color="white">04334</font>	    pawn.acceleration=vect(0,0,0);
<a name="L4335"><font color="white">04335</font>	    if ((enemy==none) || enemy.bisdead)
<a name="L4336"><font color="white">04336</font>	    {
<a name="L4337"><font color="white">04337</font>	        ChangeEtat();
<a name="L4338"><font color="white">04338</font>	    }
<a name="L4339"><font color="white">04339</font>	    focus=enemy;
<a name="L4340"><font color="white">04340</font>	    finishrotation();
<a name="L4341"><font color="white">04341</font>	 	 if (!pawn.weapon.bmeleeweapon)
<a name="L4342"><font color="white">04342</font>				ChercheReseauAttaque();     //peut passer dans attaque scriptee
<a name="L4343"><font color="white">04343</font>	
<a name="L4344"><font color="white">04344</font>	    if (AttitudeToNMI(enemy)==ATTITUDE_FEAR)
<a name="L4345"><font color="white">04345</font>	    {
<a name="L4346"><font color="white">04346</font>	        HalteAufeu();
<a name="L4347"><font color="white">04347</font>	        gotostate('fuite');
<a name="L4348"><font color="white">04348</font>	    }
<a name="L4349"><font color="white">04349</font>	    if (bases.bAlerteAmisEnCriant)
<a name="L4350"><font color="white">04350</font>	    {
<a name="L4351"><font color="white">04351</font>	        sleep(0.5*frand());
<a name="L4352"><font color="white">04352</font>	        Interrogation=Spawn(class'XIIIalerteEmitter',self,,pawn.location+vect(0,0,70));
<a name="L4353"><font color="white">04353</font>	        interrogation.setbase(pawn);
<a name="L4354"><font color="white">04354</font>	        //son
<a name="L4355"><font color="white">04355</font>	        //pawn.PlaySndPNJOno(pnjono'Onomatopees.hPNJAlert',bases.CodeMesh,bases.NumeroTimbre);
<a name="L4356"><font color="white">04356</font>	        genalerte.PoteBeugle(pawn);
<a name="L4357"><font color="white">04357</font>	    }
<a name="L4358"><font color="white">04358</font>	begin:
<a name="L4359"><font color="white">04359</font>		 if (pawn.weapon.bmeleeweapon)
<a name="L4360"><font color="white">04360</font>		 {
<a name="L4361"><font color="white">04361</font>			gotostate('attaqueH2H');
<a name="L4362"><font color="white">04362</font>		 }
<a name="L4363"><font color="white">04363</font>	    if (CHARGE_LES_LOGS) log(pawn@&quot;Etat attaque    &quot;$enemy);
<a name="L4364"><font color="white">04364</font>	    if (enemy==none)
<a name="L4365"><font color="white">04365</font>	    {
<a name="L4366"><font color="white">04366</font>	        log(pawn@&quot;ENEMY==none ** ENEMY==none ** ENEMY==none ** ENEMY==none ** ENEMY==none **&quot;);
<a name="L4367"><font color="white">04367</font>	        //enemy=xiii;
<a name="L4368"><font color="white">04368</font>	    }
<a name="L4369"><font color="white">04369</font>	    temp_vect=enemy.location;
<a name="L4370"><font color="white">04370</font>	    focus=enemy;
<a name="L4371"><font color="white">04371</font>	    FireEnemy();
<a name="L4372"><font color="white">04372</font>	    if (bases.order=='garder')
<a name="L4373"><font color="white">04373</font>	    {
<a name="L4374"><font color="white">04374</font>	       enable('enemynotvisible');
<a name="L4375"><font color="white">04375</font>	       stop;
<a name="L4376"><font color="white">04376</font>	    }
<a name="L4377"><font color="white">04377</font>	charge:
<a name="L4378"><font color="white">04378</font>	    if ((enemy==none) || enemy.bisdead)
<a name="L4379"><font color="white">04379</font>	    {
<a name="L4380"><font color="white">04380</font>	        ChangeEtat();
<a name="L4381"><font color="white">04381</font>	    }
<a name="L4382"><font color="white">04382</font>	    enable('enemynotvisible');
<a name="L4383"><font color="white">04383</font>	    //log(&quot;est-ce que ca necessite que je bouge???&quot;@CompteurRecalage@CompteurRecalage + Vsize(enemy.location-temp_vect)*(1.0/80.0)&gt; 8-3*bases.agressivite);
<a name="L4384"><font color="white">04384</font>	    if ((CompteurRecalage + Vsize(enemy.location-temp_vect)*(1.0/80.0)&gt; 8-3*bases.agressivite))
<a name="L4385"><font color="white">04385</font>	    {
<a name="L4386"><font color="white">04386</font>	        PointDestination=vect(0,0,1000000);
<a name="L4387"><font color="white">04387</font>	        temp_float=Vsize(enemy.location - pawn.location);
<a name="L4388"><font color="white">04388</font>	            PointDestination= pawn.location +VecteurRecalage+(enemy.location-pawn.location)*(Temp_float-bases.DistanceAttaque)/Temp_float;
<a name="L4389"><font color="white">04389</font>	            if (Vsize(PointDestination-pawn.location)&lt;50 || !FastTrace(PointDestination-vect(0,0,30),pawn.location-vect(0,0,30)) || !LigneVisee(enemy.location,PointDestination))
<a name="L4390"><font color="white">04390</font>	            {
<a name="L4391"><font color="white">04391</font>	                CompteurRecalage--;
<a name="L4392"><font color="white">04392</font>	                //log(pawn@&quot; DEBUG&quot;@&quot;je ne bouge pas en fait&quot;);
<a name="L4393"><font color="white">04393</font>	                PointDestination=vect(0,0,1000000);  //alors bouge pa
<a name="L4394"><font color="white">04394</font>	                Movetarget=none;
<a name="L4395"><font color="white">04395</font>	                if (vsize(enemy.location-pawn.location)&gt;bases.DistanceAttaque*1.2 &amp;&amp; FindBestPathToward(enemy))
<a name="L4396"><font color="white">04396</font>	                {
<a name="L4397"><font color="white">04397</font>	                    for (temp_int=0;temp_int&lt;16;temp_int++)
<a name="L4398"><font color="white">04398</font>	                    {
<a name="L4399"><font color="white">04399</font>	                        if (routecache[temp_int]==none)
<a name="L4400"><font color="white">04400</font>	                            break;
<a name="L4401"><font color="white">04401</font>	                        PointChemin[temp_int]=routecache[temp_int];
<a name="L4402"><font color="white">04402</font>	                    };
<a name="L4403"><font color="white">04403</font>								if (temp_int==1)
<a name="L4404"><font color="white">04404</font>									NbPointChemin=1;
<a name="L4405"><font color="white">04405</font>								else
<a name="L4406"><font color="white">04406</font>							  		NbPointChemin=(Temp_int/2);
<a name="L4407"><font color="white">04407</font>	                    Pointintermediaire=navigationpoint(RouteCache[NbPointChemin-1]);
<a name="L4408"><font color="white">04408</font>								if (!Pointintermediaire.bAlreadyTargeted &amp;&amp; vsize(Pointintermediaire.location-enemy.location)&gt;80)
<a name="L4409"><font color="white">04409</font>	                    {
<a name="L4410"><font color="white">04410</font>									//log(pawn@&quot;poinnnnnnnnnnnnnt intermediaire pas targete&quot;@temp_int@NbPointChemin@RouteCache[NbPointChemin-1]@Pointintermediaire);
<a name="L4411"><font color="white">04411</font>	                        movetarget=Pointintermediaire;
<a name="L4412"><font color="white">04412</font>	                        HalteAufeu();
<a name="L4413"><font color="white">04413</font>	                        Pointintermediaire.bAlreadyTargeted=true;
<a name="L4414"><font color="white">04414</font>	                        gotostate('attaque','VaVersPointIntermediaire');
<a name="L4415"><font color="white">04415</font>	                    }
<a name="L4416"><font color="white">04416</font>	                    else if (RouteCache[NbPointChemin]!=none)
<a name="L4417"><font color="white">04417</font>	                    {
<a name="L4418"><font color="white">04418</font>	                        Pointintermediaire=navigationpoint(RouteCache[NbPointChemin]);
<a name="L4419"><font color="white">04419</font>									//log(pawn@&quot;poinnnnnnnnnnnnnt intermediaire deja targete&quot;@temp_int@NbPointChemin@RouteCache[NbPointChemin-1]@Pointintermediaire);
<a name="L4420"><font color="white">04420</font>	                        if (!Pointintermediaire.bAlreadyTargeted &amp;&amp; vsize(Pointintermediaire.location-enemy.location)&gt;80)
<a name="L4421"><font color="white">04421</font>	                        {
<a name="L4422"><font color="white">04422</font>	                            movetarget=Pointintermediaire;
<a name="L4423"><font color="white">04423</font>	                            HalteAufeu();
<a name="L4424"><font color="white">04424</font>	                            Pointintermediaire.bAlreadyTargeted=true;
<a name="L4425"><font color="white">04425</font>	                            NbPointChemin++;
<a name="L4426"><font color="white">04426</font>	                            gotostate('attaque','VaVersPointIntermediaire');
<a name="L4427"><font color="white">04427</font>	                        }
<a name="L4428"><font color="white">04428</font>	                    }
<a name="L4429"><font color="white">04429</font>	                }
<a name="L4430"><font color="white">04430</font>	            }
<a name="L4431"><font color="white">04431</font>	DeplacementCharge:
<a name="L4432"><font color="white">04432</font>	        //log(pawn$&quot;DeplacementCharge &quot;$PointDestination!=vect(0,0,1000000)$Vsize(PointDestination-pawn.location)&gt;150$FastTrace(PointDestination,pawn.location+pawn.eyeposition()));
<a name="L4433"><font color="white">04433</font>	        if (PointDestination!=vect(0,0,1000000))
<a name="L4434"><font color="white">04434</font>	        {
<a name="L4435"><font color="white">04435</font>	            if (LastStrP!=none)
<a name="L4436"><font color="white">04436</font>	            {
<a name="L4437"><font color="white">04437</font>	                LastStrP.Libere();
<a name="L4438"><font color="white">04438</font>	                iEtatVaVersStrp=0;
<a name="L4439"><font color="white">04439</font>	                LastStrP=none;
<a name="L4440"><font color="white">04440</font>	            }
<a name="L4441"><font color="white">04441</font>	            bAdvancedTactics=true;
<a name="L4442"><font color="white">04442</font>	            if ((enemy.location-pawn.location) dot (pointdestination-pawn.location)&lt;0)  //c'est que je recule
<a name="L4443"><font color="white">04443</font>	            {
<a name="L4444"><font color="white">04444</font>	                MoveTo(PointDestination,enemy,bases.walkingspeed);
<a name="L4445"><font color="white">04445</font>	            }
<a name="L4446"><font color="white">04446</font>	            else
<a name="L4447"><font color="white">04447</font>	            {
<a name="L4448"><font color="white">04448</font>	                MoveTo(PointDestination,enemy);
<a name="L4449"><font color="white">04449</font>	            }
<a name="L4450"><font color="white">04450</font>	            bAdvancedTactics=false;
<a name="L4451"><font color="white">04451</font>	            CompteurRecalage=0;
<a name="L4452"><font color="white">04452</font>	            temp_vect=enemy.location;
<a name="L4453"><font color="white">04453</font>	        }
<a name="L4454"><font color="white">04454</font>	     }
<a name="L4455"><font color="white">04455</font>	ContinueFight:
<a name="L4456"><font color="white">04456</font>	     if (CHARGE_LES_LOGS) log(pawn@&quot;ContinueFight&quot;);
<a name="L4457"><font color="white">04457</font>	
<a name="L4458"><font color="white">04458</font>	     pawn.velocity=vect(0,0,0);
<a name="L4459"><font color="white">04459</font>	     pawn.acceleration=vect(0,0,0);
<a name="L4460"><font color="white">04460</font>	     CompteurRecalage++;
<a name="L4461"><font color="white">04461</font>	     sleep(1);
<a name="L4462"><font color="white">04462</font>	     goto('charge');
<a name="L4463"><font color="white">04463</font>	Couverture:
<a name="L4464"><font color="white">04464</font>	     bEnCouverture=true;
<a name="L4465"><font color="white">04465</font>	     GenAlerte.NbAllieEnCouverture++;
<a name="L4466"><font color="white">04466</font>	     pawn.velocity=vect(0,0,0);
<a name="L4467"><font color="white">04467</font>	     pawn.acceleration=vect(0,0,0);
<a name="L4468"><font color="white">04468</font>	     pawn.shouldcrouch(true);
<a name="L4469"><font color="white">04469</font>	     fireenemy();
<a name="L4470"><font color="white">04470</font>	     Angle_Visee-=2;
<a name="L4471"><font color="white">04471</font>	     sleep(2+6*(1-(abs(bases.distanceattaque-vsize(pawn.location-enemy.location))/(bases.distanceattaque))));
<a name="L4472"><font color="white">04472</font>	     Switch(bases.skill)
<a name="L4473"><font color="white">04473</font>	     {
<a name="L4474"><font color="white">04474</font>	         Case 1 : Angle_Visee=14; break;
<a name="L4475"><font color="white">04475</font>	         Case 2 : Angle_Visee=12; break;
<a name="L4476"><font color="white">04476</font>	         Case 3 : Angle_Visee=10; break;
<a name="L4477"><font color="white">04477</font>	         Case 4 : Angle_Visee=8; break;
<a name="L4478"><font color="white">04478</font>	         Case 5 : Angle_Visee=6; break;
<a name="L4479"><font color="white">04479</font>	     }
<a name="L4480"><font color="white">04480</font>	     pawn.shouldcrouch(false);
<a name="L4481"><font color="white">04481</font>	     bEnCouverture=false;
<a name="L4482"><font color="white">04482</font>	     GenAlerte.NbAllieEnCouverture--;
<a name="L4483"><font color="white">04483</font>	     goto('charge');
<a name="L4484"><font color="white">04484</font>	VaVersPointIntermediaire:
<a name="L4485"><font color="white">04485</font>	     iEtatVaVersStrp=1;
<a name="L4486"><font color="white">04486</font>	     HalteAuFeu();
<a name="L4487"><font color="white">04487</font>	     for (iCompteur=0;iCompteur&lt;NbPointChemin;iCompteur++)
<a name="L4488"><font color="white">04488</font>	     {
<a name="L4489"><font color="white">04489</font>	         focalpoint=1000*(PointChemin[iCompteur].location-pawn.location)+pawn.location;
<a name="L4490"><font color="white">04490</font>	         focus=none;  //focus=none;
<a name="L4491"><font color="white">04491</font>	         MoveToward(PointChemin[iCompteur],none);
<a name="L4492"><font color="white">04492</font>	     }
<a name="L4493"><font color="white">04493</font>	     PointIntermediaire.bAlreadyTargeted=false;
<a name="L4494"><font color="white">04494</font>	     If (cansee(enemy))
<a name="L4495"><font color="white">04495</font>	         fireenemy();
<a name="L4496"><font color="white">04496</font>	     iEtatVaVersStrp=0;
<a name="L4497"><font color="white">04497</font>	     //log(&quot;fin vavers sTrp&quot;);
<a name="L4498"><font color="white">04498</font>	     goto('charge');
<a name="L4499"><font color="white">04499</font>	VaVersStrP:
<a name="L4500"><font color="white">04500</font>	     iEtatVaVersStrp=2;
<a name="L4501"><font color="white">04501</font>	     HalteAuFeu();
<a name="L4502"><font color="white">04502</font>	     if (movetarget==none)
<a name="L4503"><font color="white">04503</font>	     {
<a name="L4504"><font color="white">04504</font>	         focalpoint=1000*(LastStrp.location-pawn.location)+pawn.location;
<a name="L4505"><font color="white">04505</font>	         focus=none;
<a name="L4506"><font color="white">04506</font>	         MoveToward(LastStrp,none);
<a name="L4507"><font color="white">04507</font>	         focus=enemy;
<a name="L4508"><font color="white">04508</font>	    }
<a name="L4509"><font color="white">04509</font>	     else
<a name="L4510"><font color="white">04510</font>	     {
<a name="L4511"><font color="white">04511</font>	         for (iCompteur=0;iCompteur&lt;NbPointChemin-1;iCompteur++)
<a name="L4512"><font color="white">04512</font>	         {
<a name="L4513"><font color="white">04513</font>	             focalpoint=1000*(PointChemin[iCompteur].location-pawn.location)+pawn.location;
<a name="L4514"><font color="white">04514</font>	             focus=none;
<a name="L4515"><font color="white">04515</font>	             MoveToward(PointChemin[iCompteur],none);
<a name="L4516"><font color="white">04516</font>	         }
<a name="L4517"><font color="white">04517</font>	         MoveToward(LastStrp,enemy); //va vers point en regardant enemy
<a name="L4518"><font color="white">04518</font>	     }
<a name="L4519"><font color="white">04519</font>	     if (LastStrP.FinishJumpPoint!=none)
<a name="L4520"><font color="white">04520</font>	         goto('SauteSurStrP');
<a name="L4521"><font color="white">04521</font>	     if (LastStrP.bAccroupi)
<a name="L4522"><font color="white">04522</font>	         pawn.shouldcrouch(true);
<a name="L4523"><font color="white">04523</font>	     iEtatVaVersStrp=3;
<a name="L4524"><font color="white">04524</font>	     sleep(2+4*frand());
<a name="L4525"><font color="white">04525</font>	     if (LastStrP.bAccroupi)
<a name="L4526"><font color="white">04526</font>	         pawn.shouldcrouch(false);
<a name="L4527"><font color="white">04527</font>	     iEtatVaVersStrp=0;
<a name="L4528"><font color="white">04528</font>	     If (cansee(enemy))
<a name="L4529"><font color="white">04529</font>	         fireenemy();
<a name="L4530"><font color="white">04530</font>	     //log(&quot;fin vavers sTrp&quot;);
<a name="L4531"><font color="white">04531</font>	     goto('charge');
<a name="L4532"><font color="white">04532</font>	SauteSurStrP:
<a name="L4533"><font color="white">04533</font>	     //pawn.velocity=vect(0,0,0);
<a name="L4534"><font color="white">04534</font>	     //pawn.acceleration=vect(0,0,0);
<a name="L4535"><font color="white">04535</font>	     //sleep(0.5);
<a name="L4536"><font color="white">04536</font>	     disable('enemynotvisible');
<a name="L4537"><font color="white">04537</font>	     focalpoint=1000*(LastStrP.FinishJumpPoint.location-LastStrP.location) + pawn.location;
<a name="L4538"><font color="white">04538</font>	     focus=none;
<a name="L4539"><font color="white">04539</font>	     pawn.bcanjump=true;
<a name="L4540"><font color="white">04540</font>	     finishrotation();
<a name="L4541"><font color="white">04541</font>	     temp_float=sqrt(2*948*(LastStrP.jumpHeight));     //Vz0
<a name="L4542"><font color="white">04542</font>	     PointDestination=LastStrP.FinishJumpPoint.location-LastStrP.location;
<a name="L4543"><font color="white">04543</font>	     if (abs(PointDestination.z)&lt;0.1)
<a name="L4544"><font color="white">04544</font>	         pawn.velocity=vect(1,1,0)*PointDestination*948/(2*temp_float);
<a name="L4545"><font color="white">04545</font>	     else
<a name="L4546"><font color="white">04546</font>	         pawn.velocity=vect(1,1,0)*PointDestination*(temp_float/(2*PointDestination.z))*(1-sqrt(1-(2*PointDestination.z*948/(temp_float*temp_float))));
<a name="L4547"><font color="white">04547</font>	     pawn.jumpz=temp_float;
<a name="L4548"><font color="white">04548</font>	     pawn.acceleration=vect(0,0,0);
<a name="L4549"><font color="white">04549</font>	     pawn.Dojump(true);
<a name="L4550"><font color="white">04550</font>	     pawn.jumpz=420;
<a name="L4551"><font color="white">04551</font>	     if (LastStrP.FinishJumpPoint.bAccroupi)
<a name="L4552"><font color="white">04552</font>	         pawn.shouldcrouch(true);
<a name="L4553"><font color="white">04553</font>	     waitforlanding();
<a name="L4554"><font color="white">04554</font>	     enable('enemynotvisible');
<a name="L4555"><font color="white">04555</font>	     pawn.bcanjump=false;
<a name="L4556"><font color="white">04556</font>	     if (CHARGE_LES_LOGS) log(pawn$&quot;fini saut sur STRP&quot;);
<a name="L4557"><font color="white">04557</font>	     sleep(1+4*frand());
<a name="L4558"><font color="white">04558</font>	     if (LastStrP.FinishJumpPoint.bAccroupi)
<a name="L4559"><font color="white">04559</font>	         pawn.shouldcrouch(false);
<a name="L4560"><font color="white">04560</font>	     iEtatVaVersStrp=0;
<a name="L4561"><font color="white">04561</font>	     goto('charge');
<a name="L4562"><font color="white">04562</font>	
<a name="L4563"><font color="white">04563</font>	LanceGrenadeTarget:
<a name="L4564"><font color="white">04564</font>	     bLanceGrenade=true;
<a name="L4565"><font color="white">04565</font>	     focus=enemy;
<a name="L4566"><font color="white">04566</font>	     disable('EnemyNotVisible');
<a name="L4567"><font color="white">04567</font>	     disable('seeplayer');
<a name="L4568"><font color="white">04568</font>	     disable('seemonster');
<a name="L4569"><font color="white">04569</font>	     if (!SwitchSurGrenade())
<a name="L4570"><font color="white">04570</font>	         gotostate('temporise');
<a name="L4571"><font color="white">04571</font>	     if (!bases.bDontCallFriends) pawn.PlaySndPNJOno(pnjono'Onomatopees.hPNJGrenade',bases.CodeMesh,bases.NumeroTimbre);
<a name="L4572"><font color="white">04572</font>		  sleep(1.2);
<a name="L4573"><font color="white">04573</font>	WaitGrenadReady:
<a name="L4574"><font color="white">04574</font>		  sleep(0.2);
<a name="L4575"><font color="white">04575</font>		  if (!pawn.weapon.isa('grenad') || pawn.weapon.isinstate('active'))
<a name="L4576"><font color="white">04576</font>				goto('WaitGrenadReady');
<a name="L4577"><font color="white">04577</font>	     Fireenemy();
<a name="L4578"><font color="white">04578</font>	     sleep(1);
<a name="L4579"><font color="white">04579</font>	     ChangetoBestWeapon();
<a name="L4580"><font color="white">04580</font>	     sleep(0.5);
<a name="L4581"><font color="white">04581</font>	     bLanceGrenade=false;
<a name="L4582"><font color="white">04582</font>	     goto('charge');
<a name="L4583"><font color="white">04583</font>	
<a name="L4584"><font color="white">04584</font>	}
<a name="L4585"><font color="white">04585</font>	
<a name="L4586"><font color="white">04586</font>	// ----------------------------------------------------------------------
<a name="L4587"><font color="white">04587</font>	//
<a name="L4588"><font color="white">04588</font>	// TacticalMove        (enemy!=none)
<a name="L4589"><font color="white">04589</font>	//
<a name="L4590"><font color="white">04590</font>	// ----------------------------------------------------------------------
<a name="L4591"><font color="white">04591</font>	state TacticalMove
<a name="L4592"><font color="white">04592</font>	{
<a name="L4593"><font color="white">04593</font>	    ignores enemynotvisible,hearnoise;
<a name="L4594"><font color="white">04594</font>	    event Seeplayer(pawn other)
<a name="L4595"><font color="white">04595</font>	    {
<a name="L4596"><font color="white">04596</font>				if (enemy!=none &amp;&amp; enemy==other)
<a name="L4597"><font color="white">04597</font>	            	SeeEnemy();
<a name="L4598"><font color="white">04598</font>	    }
<a name="L4599"><font color="white">04599</font>	    event SeeMonster(pawn other)
<a name="L4600"><font color="white">04600</font>	    {
<a name="L4601"><font color="white">04601</font>	        if (enemy!=none &amp;&amp; enemy==other)
<a name="L4602"><font color="white">04602</font>	            	SeeEnemy();
<a name="L4603"><font color="white">04603</font>	    }
<a name="L4604"><font color="white">04604</font>	    event Tick(float deltaseconds)
<a name="L4605"><font color="white">04605</font>	    {
<a name="L4606"><font color="white">04606</font>	        local int i;
<a name="L4607"><font color="white">04607</font>	        global.tick(deltaseconds);
<a name="L4608"><font color="white">04608</font>	
<a name="L4609"><font color="white">04609</font>	        if (enemy==none || enemy.bisdead)
<a name="L4610"><font color="white">04610</font>	        {
<a name="L4611"><font color="white">04611</font>	            ChangeEtat();
<a name="L4612"><font color="white">04612</font>	            return;
<a name="L4613"><font color="white">04613</font>	        }
<a name="L4614"><font color="white">04614</font>	        if ((Level.timeseconds-Temps_ref)&gt;3)
<a name="L4615"><font color="white">04615</font>	        {
<a name="L4616"><font color="white">04616</font>	            //si otage
<a name="L4617"><font color="white">04617</font>	            if (XIII.bPrisonner &amp;&amp; XIII.LHand.pOnShoulder!=none &amp;&amp; AllianceLevel(XIII.LHand.pOnShoulder)==1 &amp;&amp; enemy==xiii &amp;&amp; VSize(pawn.location-enemy.location) &lt; 250)
<a name="L4618"><font color="white">04618</font>	            {
<a name="L4619"><font color="white">04619</font>	                if (CHARGE_LES_LOGS) log(pawn$&quot;me colle trop je tir&quot;);
<a name="L4620"><font color="white">04620</font>	                NbCoupsRiposte=(2+bases.agressivite)*1.5;
<a name="L4621"><font color="white">04621</font>	                NbCoupsRiposte=Min(4,NbCoupsRiposte);
<a name="L4622"><font color="white">04622</font>	                NbCoupsRiposte=Max(1,NbCoupsRiposte);
<a name="L4623"><font color="white">04623</font>	            }
<a name="L4624"><font color="white">04624</font>	            Temps_Ref=Level.timeseconds;
<a name="L4625"><font color="white">04625</font>	        }
<a name="L4626"><font color="white">04626</font>	    }
<a name="L4627"><font color="white">04627</font>	    event Timer2()
<a name="L4628"><font color="white">04628</font>	    {
<a name="L4629"><font color="white">04629</font>	        if (btire)
<a name="L4630"><font color="white">04630</font>	        {
<a name="L4631"><font color="white">04631</font>	            bfire=0;
<a name="L4632"><font color="white">04632</font>	            settimer(0.6,false);
<a name="L4633"><font color="white">04633</font>	        }
<a name="L4634"><font color="white">04634</font>	    }
<a name="L4635"><font color="white">04635</font>	    event Timer3()
<a name="L4636"><font color="white">04636</font>	    {
<a name="L4637"><font color="white">04637</font>	        EnemyTargetPos=enemy.location;
<a name="L4638"><font color="white">04638</font>	        EnemyTargetVelocity=enemy.velocity;
<a name="L4639"><font color="white">04639</font>	    }
<a name="L4640"><font color="white">04640</font>	    event Trigger(actor Other, pawn EventInstigator)
<a name="L4641"><font color="white">04641</font>	    {
<a name="L4642"><font color="white">04642</font>	    }
<a name="L4643"><font color="white">04643</font>	    event SeeDeadPawn(pawn other)
<a name="L4644"><font color="white">04644</font>	    {
<a name="L4645"><font color="white">04645</font>			 if (ChercheBonMatos(other))		//CadavreWithPickup affecte a other dans Cherchebonmatos
<a name="L4646"><font color="white">04646</font>	        {
<a name="L4647"><font color="white">04647</font>	                    HalteAufeu();
<a name="L4648"><font color="white">04648</font>	            bDisableEventSeeDeadPawn=true;
<a name="L4649"><font color="white">04649</font>	            CadavreWithPickup.bDejaFouille=true;
<a name="L4650"><font color="white">04650</font>	            gotostate('tacticalmove','chercheobjet');
<a name="L4651"><font color="white">04651</font>	        }
<a name="L4652"><font color="white">04652</font>	    }
<a name="L4653"><font color="white">04653</font>	    event EnemyNotVisible()
<a name="L4654"><font color="white">04654</font>	    {
<a name="L4655"><font color="white">04655</font>	        if (LigneVisee(enemy.location, LastSeeingPos))
<a name="L4656"><font color="white">04656</font>	        {
<a name="L4657"><font color="white">04657</font>	            GotoState('TacticalMove','RecoverEnemy');
<a name="L4658"><font color="white">04658</font>	            return;
<a name="L4659"><font color="white">04659</font>	        }
<a name="L4660"><font color="white">04660</font>	        else
<a name="L4661"><font color="white">04661</font>	        {
<a name="L4662"><font color="white">04662</font>	            gotostate('temporise');
<a name="L4663"><font color="white">04663</font>	            return;
<a name="L4664"><font color="white">04664</font>	        }
<a name="L4665"><font color="white">04665</font>	    }
<a name="L4666"><font color="white">04666</font>	    function NotifyFiring()
<a name="L4667"><font color="white">04667</font>	    {
<a name="L4668"><font color="white">04668</font>			  if (enemy==none)
<a name="L4669"><font color="white">04669</font>					return;
<a name="L4670"><font color="white">04670</font>	        DirectionTir=DirectionDuTir(); //recupere direction du tir avant dispersion
<a name="L4671"><font color="white">04671</font>	        //decalage par rapport a l'arme
<a name="L4672"><font color="white">04672</font>	        CheckLineOfFire();
<a name="L4673"><font color="white">04673</font>	    }
<a name="L4674"><font color="white">04674</font>	    function DamageAttitudeto(pawn Other, float Damage)
<a name="L4675"><font color="white">04675</font>	    {
<a name="L4676"><font color="white">04676</font>	        //son
<a name="L4677"><font color="white">04677</font>	        bases.PlaySndPNJOno(pnjono'Onomatopees.hPNJHurt',bases.CodeMesh,bases.NumeroTimbre);
<a name="L4678"><font color="white">04678</font>	
<a name="L4679"><font color="white">04679</font>	        if (bDisableDamageattitudeto)
<a name="L4680"><font color="white">04680</font>	            return;
<a name="L4681"><font color="white">04681</font>	        If (xiii.bPrisonner &amp;&amp; XIII.LHand.pOnShoulder!=none &amp;&amp; AllianceLevel(XIII.LHand.pOnShoulder)==1 &amp;&amp; other==xiii)
<a name="L4682"><font color="white">04682</font>	        {
<a name="L4683"><font color="white">04683</font>	            if (CHARGE_LES_LOGS) log(pawn$&quot;je riposte&quot;);
<a name="L4684"><font color="white">04684</font>	            NbCoupsRiposte=(2+bases.agressivite)*1.9;
<a name="L4685"><font color="white">04685</font>	            NbCoupsRiposte=Min(5,NbCoupsRiposte);
<a name="L4686"><font color="white">04686</font>	            NbCoupsRiposte=Max(1,NbCoupsRiposte);
<a name="L4687"><font color="white">04687</font>	        }
<a name="L4688"><font color="white">04688</font>	    }
<a name="L4689"><font color="white">04689</font>	    function bool StrafeDestination()  //test both right and left
<a name="L4690"><font color="white">04690</font>	    {
<a name="L4691"><font color="white">04691</font>	        local vector pick, pickdir;
<a name="L4692"><font color="white">04692</font>	        local bool success;
<a name="L4693"><font color="white">04693</font>	        local float MoveDist;
<a name="L4694"><font color="white">04694</font>	
<a name="L4695"><font color="white">04695</font>	        pickdir=(Enemy.location-pawn.location) cross vect(0,0,1);
<a name="L4696"><font color="white">04696</font>	        pickdir.Z = 0;
<a name="L4697"><font color="white">04697</font>	        pickdir=normal(pickdir);
<a name="L4698"><font color="white">04698</font>	        if (Frand()&gt;0.5)
<a name="L4699"><font color="white">04699</font>	            pickdir *= -1;
<a name="L4700"><font color="white">04700</font>	
<a name="L4701"><font color="white">04701</font>	        MoveDist = 150+50* FRand();
<a name="L4702"><font color="white">04702</font>	        success = TestDirection(100,MoveDist,pickdir, pick);
<a name="L4703"><font color="white">04703</font>	        if (!success)
<a name="L4704"><font color="white">04704</font>	        {
<a name="L4705"><font color="white">04705</font>	            MoveDist = 270;
<a name="L4706"><font color="white">04706</font>	            success = TestDirection(100,MoveDist,-1*pickdir, pick);
<a name="L4707"><font color="white">04707</font>	            if (!success)
<a name="L4708"><font color="white">04708</font>	                return false;
<a name="L4709"><font color="white">04709</font>	        }
<a name="L4710"><font color="white">04710</font>	        Destination = pick;
<a name="L4711"><font color="white">04711</font>	        return success;
<a name="L4712"><font color="white">04712</font>	    }
<a name="L4713"><font color="white">04713</font>	
<a name="L4714"><font color="white">04714</font>	    function bool TestDirectionAvoidingAlly(vector pickdir, out vector pick,basesoldier PoteAEviter)
<a name="L4715"><font color="white">04715</font>	    {
<a name="L4716"><font color="white">04716</font>	        local float MoveDist;
<a name="L4717"><font color="white">04717</font>	
<a name="L4718"><font color="white">04718</font>	        if (Vsize(PoteAEviter.location - pawn.location)&gt;160)
<a name="L4719"><font color="white">04719</font>	            pickdir += 0.99*normal(Enemy.location-pawn.location); // pour partir a 45 degres si charge
<a name="L4720"><font color="white">04720</font>	        else
<a name="L4721"><font color="white">04721</font>	            pickdir +=0.3*normal(Enemy.location-pawn.location); // pour partir a 80 degres si charge
<a name="L4722"><font color="white">04722</font>	
<a name="L4723"><font color="white">04723</font>	        MoveDist=200;
<a name="L4724"><font color="white">04724</font>	        return TestDirection(110,MoveDist,pickdir, pick);
<a name="L4725"><font color="white">04725</font>	    }
<a name="L4726"><font color="white">04726</font>	    function bool TestPasSurLaGauche(basesoldier PoteAEviter)
<a name="L4727"><font color="white">04727</font>	    {
<a name="L4728"><font color="white">04728</font>	        local vector pick, pickdir;
<a name="L4729"><font color="white">04729</font>	
<a name="L4730"><font color="white">04730</font>	        pickdir=(Enemy.location-pawn.location) cross vect(0,0,1);
<a name="L4731"><font color="white">04731</font>	        pickdir.Z = 0;
<a name="L4732"><font color="white">04732</font>	        pickdir=normal(pickdir);
<a name="L4733"><font color="white">04733</font>	
<a name="L4734"><font color="white">04734</font>	        if (TestDirectionAvoidingAlly(pickdir, pick,PoteAEviter))
<a name="L4735"><font color="white">04735</font>	        {
<a name="L4736"><font color="white">04736</font>	            Destination = pick;
<a name="L4737"><font color="white">04737</font>	            return true;
<a name="L4738"><font color="white">04738</font>	        }
<a name="L4739"><font color="white">04739</font>	        return false;
<a name="L4740"><font color="white">04740</font>	    }
<a name="L4741"><font color="white">04741</font>	
<a name="L4742"><font color="white">04742</font>	    function bool TestPasSurLaDroite(basesoldier PoteAEviter)
<a name="L4743"><font color="white">04743</font>	    {
<a name="L4744"><font color="white">04744</font>	        local vector pick, pickdir;
<a name="L4745"><font color="white">04745</font>	
<a name="L4746"><font color="white">04746</font>	
<a name="L4747"><font color="white">04747</font>	        pickdir=(Enemy.location-pawn.location) cross vect(0,0,-1);
<a name="L4748"><font color="white">04748</font>	        pickdir.Z = 0;
<a name="L4749"><font color="white">04749</font>	        pickdir=normal(pickdir);
<a name="L4750"><font color="white">04750</font>	
<a name="L4751"><font color="white">04751</font>	        if (TestDirectionAvoidingAlly(pickdir, pick,PoteAEviter))
<a name="L4752"><font color="white">04752</font>	        {
<a name="L4753"><font color="white">04753</font>	            Destination = pick;
<a name="L4754"><font color="white">04754</font>	            return true;
<a name="L4755"><font color="white">04755</font>	        }
<a name="L4756"><font color="white">04756</font>	        return false;
<a name="L4757"><font color="white">04757</font>	    }
<a name="L4758"><font color="white">04758</font>	    function BeginState()
<a name="L4759"><font color="white">04759</font>	    {
<a name="L4760"><font color="white">04760</font>	        if (CHARGE_LES_LOGS) log(pawn@&quot;Tactical Move&quot;);
<a name="L4761"><font color="white">04761</font>	        if (NiveauAlerte==0)
<a name="L4762"><font color="white">04762</font>	        {
<a name="L4763"><font color="white">04763</font>	            s_decAttente();
<a name="L4764"><font color="white">04764</font>	            s_incAttaque();
<a name="L4765"><font color="white">04765</font>	        }
<a name="L4766"><font color="white">04766</font>	        else if (NiveauAlerte==1)
<a name="L4767"><font color="white">04767</font>	        {
<a name="L4768"><font color="white">04768</font>	            s_decAlerte();
<a name="L4769"><font color="white">04769</font>	            s_incAttaque();
<a name="L4770"><font color="white">04770</font>	        }
<a name="L4771"><font color="white">04771</font>	        NiveauAlerte=2;
<a name="L4772"><font color="white">04772</font>	        bDisableDamageattitudeto=false;
<a name="L4773"><font color="white">04773</font>	        Temps_Ref=Level.timeseconds-2;
<a name="L4774"><font color="white">04774</font>	        settimer3(Temps_RefreshEnemyPos,true);
<a name="L4775"><font color="white">04775</font>	    }
<a name="L4776"><font color="white">04776</font>	
<a name="L4777"><font color="white">04777</font>	    function EndState()
<a name="L4778"><font color="white">04778</font>	    {
<a name="L4779"><font color="white">04779</font>	        Settimer2(0,false);
<a name="L4780"><font color="white">04780</font>	        settimer3(0,false);
<a name="L4781"><font color="white">04781</font>	    }
<a name="L4782"><font color="white">04782</font>	
<a name="L4783"><font color="white">04783</font>	begin:
<a name="L4784"><font color="white">04784</font>	    if (enemy==none)
<a name="L4785"><font color="white">04785</font>	    {
<a name="L4786"><font color="white">04786</font>	        log(pawn@&quot;ENEMY==none ** ENEMY==none ** ENEMY==none ** ENEMY==none ** ENEMY==none **&quot;);
<a name="L4787"><font color="white">04787</font>	        //enemy=xiii;
<a name="L4788"><font color="white">04788</font>	    }
<a name="L4789"><font color="white">04789</font>	    if ((enemy==none) || enemy.bisdead)
<a name="L4790"><font color="white">04790</font>	        ChangeEtat();
<a name="L4791"><font color="white">04791</font>	Strafe:
<a name="L4792"><font color="white">04792</font>	    if (CHARGE_LES_LOGS) log(pawn@&quot;Tactical Move STRAFE&quot;);
<a name="L4793"><font color="white">04793</font>	    If (StrafeDestination())
<a name="L4794"><font color="white">04794</font>	    {
<a name="L4795"><font color="white">04795</font>	        HalteAuFeu();
<a name="L4796"><font color="white">04796</font>	        MoveTo(Destination,enemy,VitesseDeplacements);
<a name="L4797"><font color="white">04797</font>	    }
<a name="L4798"><font color="white">04798</font>	    gotostate('attaque');
<a name="L4799"><font color="white">04799</font>	PositionTirSurGauche:
<a name="L4800"><font color="white">04800</font>	    if (CHARGE_LES_LOGS) log(pawn$&quot;Pas sur la gauche&quot;);
<a name="L4801"><font color="white">04801</font>	    CompteurRecalage=15;
<a name="L4802"><font color="white">04802</font>	    If (pote!=none &amp;&amp; !pote.bisdead &amp;&amp; TestPasSurLaGauche(pote))
<a name="L4803"><font color="white">04803</font>	    {
<a name="L4804"><font color="white">04804</font>	        MoveTo(Destination,enemy,VitesseDeplacements);
<a name="L4805"><font color="white">04805</font>	    }
<a name="L4806"><font color="white">04806</font>	    else
<a name="L4807"><font color="white">04807</font>	    {
<a name="L4808"><font color="white">04808</font>	        focus=enemy;
<a name="L4809"><font color="white">04809</font>	        sleep(2);
<a name="L4810"><font color="white">04810</font>	
<a name="L4811"><font color="white">04811</font>	    }
<a name="L4812"><font color="white">04812</font>	    gotostate('attaque');
<a name="L4813"><font color="white">04813</font>	PositionTirSurDroite:
<a name="L4814"><font color="white">04814</font>	    if (CHARGE_LES_LOGS) log(pawn$&quot;Pas sur la droite&quot;);
<a name="L4815"><font color="white">04815</font>	    CompteurRecalage=15;
<a name="L4816"><font color="white">04816</font>	    If (pote!=none &amp;&amp; !pote.bisdead &amp;&amp; TestPasSurLaDroite(pote))
<a name="L4817"><font color="white">04817</font>	    {
<a name="L4818"><font color="white">04818</font>	        MoveTo(Destination,enemy,VitesseDeplacements);
<a name="L4819"><font color="white">04819</font>	    }
<a name="L4820"><font color="white">04820</font>	    else
<a name="L4821"><font color="white">04821</font>	    {
<a name="L4822"><font color="white">04822</font>	        focus=enemy;
<a name="L4823"><font color="white">04823</font>	        sleep(2);
<a name="L4824"><font color="white">04824</font>	    }
<a name="L4825"><font color="white">04825</font>	    gotostate('attaque');
<a name="L4826"><font color="white">04826</font>	ChercheObjet_ContourneObstacle:
<a name="L4827"><font color="white">04827</font>	    MoveTo(destination,none,1.0);
<a name="L4828"><font color="white">04828</font>	ChercheObjet:
<a name="L4829"><font color="white">04829</font>	    if (CadavreWithPickup==none || CadavreWithPickup.weapon==none) //blindage
<a name="L4830"><font color="white">04830</font>	        gotostate('attaque');
<a name="L4831"><font color="white">04831</font>	    if (CHARGE_LES_LOGS) log(pawn@&quot;Tactical Move CHERCHE OBJET&quot;);
<a name="L4832"><font color="white">04832</font>	    settimer2(0,false);
<a name="L4833"><font color="white">04833</font>	    bDisableDamageattitudeto=true;
<a name="L4834"><font color="white">04834</font>	    focus=none;
<a name="L4835"><font color="white">04835</font>	    focalpoint=CadavreWithPickup.location;
<a name="L4836"><font color="white">04836</font>	    MoveTo(CadavreWithPickup.location,none);
<a name="L4837"><font color="white">04837</font>	    pawn.acceleration=vect(0,0,0);
<a name="L4838"><font color="white">04838</font>	    pawn.velocity=vect(0,0,0);
<a name="L4839"><font color="white">04839</font>		 sleep(0.2);
<a name="L4840"><font color="white">04840</font>	    bases.PlaySearchGround();
<a name="L4841"><font color="white">04841</font>	    sleep(0.8); //temps attente accroupi
<a name="L4842"><font color="white">04842</font>	    bases.ReleaseAnimControl();
<a name="L4843"><font color="white">04843</font>		 if (CadavreWithPickup==none || CadavreWithPickup.weapon==none || !CadavreWithPickup.weapon.hasammo())
<a name="L4844"><font color="white">04844</font>	    		gotostate('attaque');
<a name="L4845"><font color="white">04845</font>	    PlaySound(class&lt;WeaponPickup&gt;(CadavreWithPickup.weapon.pickupclass).Default.PickupSound);
<a name="L4846"><font color="white">04846</font>		 CadavreWithPickup.weapon.DetachFromPawn(CadavreWithPickup);
<a name="L4847"><font color="white">04847</font>		 WeaponOnGround=CadavreWithPickup.weapon;
<a name="L4848"><font color="white">04848</font>		 if (CadavreWithPickup.Shadow != none )
<a name="L4849"><font color="white">04849</font>	    {
<a name="L4850"><font color="white">04850</font>	      CadavreWithPickup.Shadow.bShadowIsStatic = false;
<a name="L4851"><font color="white">04851</font>	      CadavreWithPickup.SetTimer2(0.2, false);
<a name="L4852"><font color="white">04852</font>	    }
<a name="L4853"><font color="white">04853</font>		 WeaponOnGround.Transfer(pawn);
<a name="L4854"><font color="white">04854</font>	    focus=enemy;
<a name="L4855"><font color="white">04855</font>	    ChangetoBestWeapon();
<a name="L4856"><font color="white">04856</font>	    sleep(1.2);
<a name="L4857"><font color="white">04857</font>	    bDisableEventSeeDeadPawn=false;
<a name="L4858"><font color="white">04858</font>	    gotostate('attaque');
<a name="L4859"><font color="white">04859</font>	RecoverEnemy:
<a name="L4860"><font color="white">04860</font>	    if (CHARGE_LES_LOGS) log(pawn$&quot;recover enemy&quot;);
<a name="L4861"><font color="white">04861</font>	    if ((enemy==none) || enemy.bisdead)
<a name="L4862"><font color="white">04862</font>	    {
<a name="L4863"><font color="white">04863</font>	        changeEtat();
<a name="L4864"><font color="white">04864</font>	    }
<a name="L4865"><font color="white">04865</font>	    HidingSpot = Pawn.Location;
<a name="L4866"><font color="white">04866</font>	    Destination = LastSeeingPos + 1 * Pawn.CollisionRadius * Normal(LastSeeingPos -Pawn.Location);
<a name="L4867"><font color="white">04867</font>	    MoveTo(Destination, Enemy,1.0);
<a name="L4868"><font color="white">04868</font>	    if (!Pawn.Weapon.bMeleeWeapon &amp;&amp; LigneVisee(Enemy.location,pawn.location) &amp;&amp; (vsize(enemy.location-pawn.location)&lt;(bases.DistanceAttaque-200)))
<a name="L4869"><font color="white">04869</font>	    {
<a name="L4870"><font color="white">04870</font>	        focus=enemy;
<a name="L4871"><font color="white">04871</font>	        FireEnemy();
<a name="L4872"><font color="white">04872</font>	        pawn.velocity=vect(0,0,0);
<a name="L4873"><font color="white">04873</font>	        Pawn.Acceleration = vect(0,0,0);
<a name="L4874"><font color="white">04874</font>	        if (Frand()&lt;0.2)
<a name="L4875"><font color="white">04875</font>	            Sleep(Fmax(4.0,XIIIWeapon(pawn.weapon).shottime*(2.25+Rand(2))));
<a name="L4876"><font color="white">04876</font>	        else
<a name="L4877"><font color="white">04877</font>	            Sleep(Fmax(4.0,XIIIWeapon(pawn.weapon).shottime*1.25));
<a name="L4878"><font color="white">04878</font>	        if (FRand() &gt; (1+bases.agressivite-0.1)*0.5 &amp;&amp; Vsize(HidingSpot-pawn.location)&lt;300)
<a name="L4879"><font color="white">04879</font>	        {
<a name="L4880"><font color="white">04880</font>	            Destination = HidingSpot + 2*Pawn.CollisionRadius * Normal(HidingSpot - Pawn.Location);
<a name="L4881"><font color="white">04881</font>	            HalteAuFeu();
<a name="L4882"><font color="white">04882</font>	            MoveTo(Destination,enemy,VitesseDeplacements);
<a name="L4883"><font color="white">04883</font>	        }
<a name="L4884"><font color="white">04884</font>	    }
<a name="L4885"><font color="white">04885</font>	    if ((Enemy != None) &amp;&amp; !LigneVisee(Enemy.location,pawn.location) &amp;&amp; FastTrace(Enemy.Location, LastSeeingPos) )
<a name="L4886"><font color="white">04886</font>	    {
<a name="L4887"><font color="white">04887</font>	        sleep(1+1.5*Frand());
<a name="L4888"><font color="white">04888</font>	        goto('recoverenemy');
<a name="L4889"><font color="white">04889</font>	    }
<a name="L4890"><font color="white">04890</font>	    else
<a name="L4891"><font color="white">04891</font>	    {
<a name="L4892"><font color="white">04892</font>	        gotostate('attaque');
<a name="L4893"><font color="white">04893</font>	    }
<a name="L4894"><font color="white">04894</font>	}
<a name="L4895"><font color="white">04895</font>	
<a name="L4896"><font color="white">04896</font>	// ----------------------------------------------------------------------
<a name="L4897"><font color="white">04897</font>	//  Chasse         (enemy!=none)
<a name="L4898"><font color="white">04898</font>	//
<a name="L4899"><font color="white">04899</font>	//
<a name="L4900"><font color="white">04900</font>	// ----------------------------------------------------------------------
<a name="L4901"><font color="white">04901</font>	state Chasse
<a name="L4902"><font color="white">04902</font>	{
<a name="L4903"><font color="white">04903</font>	    ignores EnemyNotVisible,hearnoise;
<a name="L4904"><font color="white">04904</font>	
<a name="L4905"><font color="white">04905</font>	    event Seeplayer(pawn other)
<a name="L4906"><font color="white">04906</font>	    {
<a name="L4907"><font color="white">04907</font>	        if (enemy!=none &amp;&amp; enemy==other)
<a name="L4908"><font color="white">04908</font>	            	SeeEnemy();
<a name="L4909"><font color="white">04909</font>	    }
<a name="L4910"><font color="white">04910</font>	    event SeeMonster(pawn other)
<a name="L4911"><font color="white">04911</font>	    {
<a name="L4912"><font color="white">04912</font>	        if (enemy!=none &amp;&amp; enemy==other)
<a name="L4913"><font color="white">04913</font>	            	SeeEnemy();
<a name="L4914"><font color="white">04914</font>	    }
<a name="L4915"><font color="white">04915</font>	    event SeeDeadPawn(pawn other)
<a name="L4916"><font color="white">04916</font>	    {
<a name="L4917"><font color="white">04917</font>			  if (ChercheBonMatos(other))		//CadavreWithPickup affecte a other dans Cherchebonmatos
<a name="L4918"><font color="white">04918</font>	        {
<a name="L4919"><font color="white">04919</font>	            HalteAufeu();
<a name="L4920"><font color="white">04920</font>	            bDisableEventSeeDeadPawn=true;
<a name="L4921"><font color="white">04921</font>	            CadavreWithPickup.bDejaFouille=true;
<a name="L4922"><font color="white">04922</font>	            gotostate('tacticalmove','chercheobjet');
<a name="L4923"><font color="white">04923</font>	        }
<a name="L4924"><font color="white">04924</font>	    }
<a name="L4925"><font color="white">04925</font>	    event Trigger(actor Other, pawn EventInstigator)
<a name="L4926"><font color="white">04926</font>	    {
<a name="L4927"><font color="white">04927</font>	    }
<a name="L4928"><font color="white">04928</font>	    event EnemyAcquired()
<a name="L4929"><font color="white">04929</font>	    {
<a name="L4930"><font color="white">04930</font>	        //if (NewEnemy==XIII) TriggerEvent('XIIIVu', Self, pawn);  //trigger vu
<a name="L4931"><font color="white">04931</font>	        focus=enemy;
<a name="L4932"><font color="white">04932</font>	        gotostate('attaque');
<a name="L4933"><font color="white">04933</font>	    }
<a name="L4934"><font color="white">04934</font>	    function PickDestination()
<a name="L4935"><font color="white">04935</font>	    {
<a name="L4936"><font color="white">04936</font>	        local NavigationPoint path;
<a name="L4937"><font color="white">04937</font>	        local actor HitActor;
<a name="L4938"><font color="white">04938</font>	        local vector HitNormal, HitLocation, nextSpot, ViewSpot;
<a name="L4939"><font color="white">04939</font>	        local float posZ;
<a name="L4940"><font color="white">04940</font>	        local bool bCanSeeLastSeen;
<a name="L4941"><font color="white">04941</font>	        local int i;
<a name="L4942"><font color="white">04942</font>	
<a name="L4943"><font color="white">04943</font>	        // If no enemy, or I should see him but don't, then give up
<a name="L4944"><font color="white">04944</font>	        if ((Level.TimeSeconds-LastSeenTime)&gt;20)
<a name="L4945"><font color="white">04945</font>			  {
<a name="L4946"><font color="white">04946</font>					if (CHARGE_LES_LOGS) log(pawn@&quot;plus de 20 s de recheche je repasse en patrouille&quot;);
<a name="L4947"><font color="white">04947</font>	            Enemy = None;
<a name="L4948"><font color="white">04948</font>			  }
<a name="L4949"><font color="white">04949</font>	        if (Enemy == None || enemy.bisdead)
<a name="L4950"><font color="white">04950</font>	        {
<a name="L4951"><font color="white">04951</font>	            ChangeEtat();
<a name="L4952"><font color="white">04952</font>	            return;
<a name="L4953"><font color="white">04953</font>	        }
<a name="L4954"><font color="white">04954</font>	        if (ActorReachable(Enemy))
<a name="L4955"><font color="white">04955</font>	        {
<a name="L4956"><font color="white">04956</font>	            if ( (numHuntPaths &lt; 8) || (Level.TimeSeconds - LastSeenTime &lt; 15)
<a name="L4957"><font color="white">04957</font>	                || ((Normal(Enemy.Location - Pawn.Location) Dot vector(Pawn.Rotation)) &gt; -0.5) )
<a name="L4958"><font color="white">04958</font>	            {
<a name="L4959"><font color="white">04959</font>	                Destination = Enemy.Location;
<a name="L4960"><font color="white">04960</font>	                MoveTarget = None;
<a name="L4961"><font color="white">04961</font>	                numHuntPaths++;
<a name="L4962"><font color="white">04962</font>	            }
<a name="L4963"><font color="white">04963</font>	            else
<a name="L4964"><font color="white">04964</font>	            {
<a name="L4965"><font color="white">04965</font>	                ChangeEtat();
<a name="L4966"><font color="white">04966</font>	            }
<a name="L4967"><font color="white">04967</font>	            return;
<a name="L4968"><font color="white">04968</font>	        }
<a name="L4969"><font color="white">04969</font>	        numHuntPaths++;
<a name="L4970"><font color="white">04970</font>	
<a name="L4971"><font color="white">04971</font>	        ViewSpot = Pawn.Location + Pawn.eyeposition();
<a name="L4972"><font color="white">04972</font>	        bCanSeeLastSeen = false;
<a name="L4973"><font color="white">04973</font>	        //[***] probleme de chasse sur etage different
<a name="L4974"><font color="white">04974</font>	        bCanSeeLastSeen=(FastTrace(LastSeenPos, ViewSpot) &amp;&amp; (abs(Lastseenpos.z-viewspot.z)&lt;400));
<a name="L4975"><font color="white">04975</font>	
<a name="L4976"><font color="white">04976</font>	        MoveTarget = None;
<a name="L4977"><font color="white">04977</font>	        if (FindBestPathToward(Enemy))
<a name="L4978"><font color="white">04978</font>	        {
<a name="L4979"><font color="white">04979</font>	            if (CHARGE_LES_LOGS) log(pawn@&quot;trouvereseau de chasse&quot;@movetarget@enemy);
<a name="L4980"><font color="white">04980</font>	            return;
<a name="L4981"><font color="white">04981</font>	        }
<a name="L4982"><font color="white">04982</font>	        if (NumHuntPaths &gt; 10)
<a name="L4983"><font color="white">04983</font>	        {
<a name="L4984"><font color="white">04984</font>					if (CHARGE_LES_LOGS) log(pawn@&quot;plus de 10 points de chasse je repasse en patrouille&quot;);
<a name="L4985"><font color="white">04985</font>	            ChangeEtat();
<a name="L4986"><font color="white">04986</font>	            return;
<a name="L4987"><font color="white">04987</font>	        }
<a name="L4988"><font color="white">04988</font>	        if (!bTemp_bool)
<a name="L4989"><font color="white">04989</font>	        {
<a name="L4990"><font color="white">04990</font>	            Destination = LastSeeingPos;
<a name="L4991"><font color="white">04991</font>	            bTemp_bool=true;
<a name="L4992"><font color="white">04992</font>	            if (FastTrace(Enemy.Location, LastSeeingPos))//essaye derniere position vu
<a name="L4993"><font color="white">04993</font>	                return;
<a name="L4994"><font color="white">04994</font>	        }
<a name="L4995"><font color="white">04995</font>	        posZ = LastSeenPos.Z + Pawn.CollisionHeight - Enemy.CollisionHeight;
<a name="L4996"><font color="white">04996</font>	        nextSpot = LastSeenPos - Normal(Enemy.Velocity) * Pawn.CollisionRadius;
<a name="L4997"><font color="white">04997</font>	        nextSpot.Z = posZ;
<a name="L4998"><font color="white">04998</font>	        hitactor=Trace(HitLocation, HitNormal, nextSpot, ViewSpot, false);
<a name="L4999"><font color="white">04999</font>	        if ((( HitActor==none ) || (XIIIporte(hitactor)!=none)) &amp;&amp; (abs(nextspot.z - viewspot.z) &lt; 400))
<a name="L5000"><font color="white">05000</font>	        {
<a name="L5001"><font color="white">05001</font>	            Destination = nextSpot;
<a name="L5002"><font color="white">05002</font>	        }
<a name="L5003"><font color="white">05003</font>	        else if (bCanSeeLastSeen)
<a name="L5004"><font color="white">05004</font>			  {
<a name="L5005"><font color="white">05005</font>	            Destination = LastSeenPos;
<a name="L5006"><font color="white">05006</font>			  }
<a name="L5007"><font color="white">05007</font>	        else
<a name="L5008"><font color="white">05008</font>	        {
<a name="L5009"><font color="white">05009</font>	            Destination = LastSeenPos;
<a name="L5010"><font color="white">05010</font>	            if (!FastTrace(LastSeenPos, ViewSpot))
<a name="L5011"><font color="white">05011</font>	            {
<a name="L5012"><font color="white">05012</font>	                // check if could adjust and see it
<a name="L5013"><font color="white">05013</font>	                if (PickWallAdjust(Normal(LastSeenPos - ViewSpot)) || FindViewSpot())
<a name="L5014"><font color="white">05014</font>	                {
<a name="L5015"><font color="white">05015</font>	                    GotoState('chasse', 'AdjustFromWall');
<a name="L5016"><font color="white">05016</font>	                    return;
<a name="L5017"><font color="white">05017</font>	                }
<a name="L5018"><font color="white">05018</font>	                /*else if ((VSize(Enemy.Location - Pawn.Location) &lt; 1200  || abs(Lastseenpos.z-viewspot.z) &gt; 400))
<a name="L5019"><font color="white">05019</font>	                {
<a name="L5020"><font color="white">05020</font>	                log(&quot;llllllllllllllllllllllllllllllllllll&quot;);
<a name="L5021"><font color="white">05021</font>	                GotoState('temporise');
<a name="L5022"><font color="white">05022</font>	                return;
<a name="L5023"><font color="white">05023</font>	            }    */
<a name="L5024"><font color="white">05024</font>	                else
<a name="L5025"><font color="white">05025</font>	                {
<a name="L5026"><font color="white">05026</font>	                    if (CHARGE_LES_LOGS) log (pawn@&quot;je n'arrive pas  le chopper je vais me planquer ou repasser en patrouille&quot;);
<a name="L5027"><font color="white">05027</font>	                    if (!cherchePointPourCamper())
<a name="L5028"><font color="white">05028</font>							  {
<a name="L5029"><font color="white">05029</font>									gotostate('chasse','WaitToSeenIt');
<a name="L5030"><font color="white">05030</font>							  }
<a name="L5031"><font color="white">05031</font>							  return;
<a name="L5032"><font color="white">05032</font>	                 }
<a name="L5033"><font color="white">05033</font>	            }
<a name="L5034"><font color="white">05034</font>	        }
<a name="L5035"><font color="white">05035</font>	        LastSeenPos = Enemy.Location;
<a name="L5036"><font color="white">05036</font>	    }
<a name="L5037"><font color="white">05037</font>	
<a name="L5038"><font color="white">05038</font>	    function bool FindViewSpot()
<a name="L5039"><font color="white">05039</font>	    {
<a name="L5040"><font color="white">05040</font>	        local vector X,Y,Z;
<a name="L5041"><font color="white">05041</font>	        local bool bAlwaysTry;
<a name="L5042"><font color="white">05042</font>	
<a name="L5043"><font color="white">05043</font>	        GetAxes(Rotation,X,Y,Z);
<a name="L5044"><font color="white">05044</font>	
<a name="L5045"><font color="white">05045</font>	        // try left and right
<a name="L5046"><font color="white">05046</font>	        // if frustrated, always move if possible
<a name="L5047"><font color="white">05047</font>	        //bAlwaysTry = bFrustrated;
<a name="L5048"><font color="white">05048</font>	        //bFrustrated = false;
<a name="L5049"><font color="white">05049</font>	
<a name="L5050"><font color="white">05050</font>	        if ( FastTrace(Enemy.Location, Pawn.Location + 2 * Y * Pawn.CollisionRadius) )
<a name="L5051"><font color="white">05051</font>	        {
<a name="L5052"><font color="white">05052</font>	            Destination = Pawn.Location + 2.5 * Y * Pawn.CollisionRadius;
<a name="L5053"><font color="white">05053</font>	            return true;
<a name="L5054"><font color="white">05054</font>	        }
<a name="L5055"><font color="white">05055</font>	        if ( FastTrace(Enemy.Location, Pawn.Location - 2 * Y * Pawn.CollisionRadius) )
<a name="L5056"><font color="white">05056</font>	        {
<a name="L5057"><font color="white">05057</font>	            Destination = Pawn.Location - 2.5 * Y * Pawn.CollisionRadius;
<a name="L5058"><font color="white">05058</font>	            return true;
<a name="L5059"><font color="white">05059</font>	        }
<a name="L5060"><font color="white">05060</font>	        return false;
<a name="L5061"><font color="white">05061</font>	    }
<a name="L5062"><font color="white">05062</font>	
<a name="L5063"><font color="white">05063</font>	    function BeginState()
<a name="L5064"><font color="white">05064</font>	    {
<a name="L5065"><font color="white">05065</font>	        if (NiveauAlerte==0)
<a name="L5066"><font color="white">05066</font>	        {
<a name="L5067"><font color="white">05067</font>	            s_decAttente();
<a name="L5068"><font color="white">05068</font>	            s_incAttaque();
<a name="L5069"><font color="white">05069</font>	        }
<a name="L5070"><font color="white">05070</font>	        else if (NiveauAlerte==1)
<a name="L5071"><font color="white">05071</font>	        {
<a name="L5072"><font color="white">05072</font>	            s_decAlerte();
<a name="L5073"><font color="white">05073</font>	            s_incAttaque();
<a name="L5074"><font color="white">05074</font>	        }
<a name="L5075"><font color="white">05075</font>	        NiveauAlerte=2;
<a name="L5076"><font color="white">05076</font>	        //bTemp_bool=false; pas utilise
<a name="L5077"><font color="white">05077</font>	        if (CHARGE_LES_LOGS) log(pawn@&quot;ETAT  hunting&quot;);
<a name="L5078"><font color="white">05078</font>	    }
<a name="L5079"><font color="white">05079</font>	    function EndState()
<a name="L5080"><font color="white">05080</font>	    {
<a name="L5081"><font color="white">05081</font>	    }
<a name="L5082"><font color="white">05082</font>	
<a name="L5083"><font color="white">05083</font>	AdjustFromWall:
<a name="L5084"><font color="white">05084</font>	    if (CHARGE_LES_LOGS) log(pawn@&quot;adjustfromwall&quot;);
<a name="L5085"><font color="white">05085</font>	    MoveTo(Destination, MoveTarget);
<a name="L5086"><font color="white">05086</font>	    Goto('suivre');
<a name="L5087"><font color="white">05087</font>	
<a name="L5088"><font color="white">05088</font>	Begin:
<a name="L5089"><font color="white">05089</font>	    if (enemy==none)
<a name="L5090"><font color="white">05090</font>	    {
<a name="L5091"><font color="white">05091</font>	        log(pawn@&quot;ENEMY==none ** ENEMY==none ** ENEMY==none ** ENEMY==none ** ENEMY==none **&quot;);
<a name="L5092"><font color="white">05092</font>	        //enemy=xiii;
<a name="L5093"><font color="white">05093</font>	    }
<a name="L5094"><font color="white">05094</font>	    numHuntPaths = 0;
<a name="L5095"><font color="white">05095</font>	suivre:
<a name="L5096"><font color="white">05096</font>	    PickDestination();
<a name="L5097"><font color="white">05097</font>	SpecialNavig:
<a name="L5098"><font color="white">05098</font>	    if (MoveTarget == None)
<a name="L5099"><font color="white">05099</font>	    {
<a name="L5100"><font color="white">05100</font>	        focus=none;
<a name="L5101"><font color="white">05101</font>	        focalpoint=destination;
<a name="L5102"><font color="white">05102</font>	        MoveTo(destination,none);
<a name="L5103"><font color="white">05103</font>	    }
<a name="L5104"><font color="white">05104</font>	    else
<a name="L5105"><font color="white">05105</font>	    {
<a name="L5106"><font color="white">05106</font>	        focus=none;
<a name="L5107"><font color="white">05107</font>	        focalpoint=MoveTarget.location;
<a name="L5108"><font color="white">05108</font>	        MoveToward(MoveTarget,none);
<a name="L5109"><font color="white">05109</font>	    }
<a name="L5110"><font color="white">05110</font>	    Goto('suivre');
<a name="L5111"><font color="white">05111</font>	WaitToSeenIt:
<a name="L5112"><font color="white">05112</font>		focus=xiii;
<a name="L5113"><font color="white">05113</font>		sleep(4+2*frand());
<a name="L5114"><font color="white">05114</font>		Changeetat();
<a name="L5115"><font color="white">05115</font>	}
<a name="L5116"><font color="white">05116</font>	
<a name="L5117"><font color="white">05117</font>	// ----------------------------------------------------------------------
<a name="L5118"><font color="white">05118</font>	//Etat temporise        (enemy!=none)
<a name="L5119"><font color="white">05119</font>	//
<a name="L5120"><font color="white">05120</font>	//  si l'ennemi s'est planque je vais essayer d'attendre pour le shooter
<a name="L5121"><font color="white">05121</font>	// ----------------------------------------------------------------------
<a name="L5122"><font color="white">05122</font>	state temporise
<a name="L5123"><font color="white">05123</font>	{
<a name="L5124"><font color="white">05124</font>	    ignores EnemyNotVisible,hearnoise;
<a name="L5125"><font color="white">05125</font>	
<a name="L5126"><font color="white">05126</font>	    event Seeplayer(pawn other)
<a name="L5127"><font color="white">05127</font>	    {
<a name="L5128"><font color="white">05128</font>	        if (enemy!=none &amp;&amp; enemy==other)
<a name="L5129"><font color="white">05129</font>	            	SeeEnemy();
<a name="L5130"><font color="white">05130</font>	    }
<a name="L5131"><font color="white">05131</font>	    event SeeMonster(pawn other)
<a name="L5132"><font color="white">05132</font>	    {
<a name="L5133"><font color="white">05133</font>	        if (enemy!=none &amp;&amp; enemy==other)
<a name="L5134"><font color="white">05134</font>	            	SeeEnemy();
<a name="L5135"><font color="white">05135</font>	    }
<a name="L5136"><font color="white">05136</font>	    event SeeDeadPawn(pawn other)
<a name="L5137"><font color="white">05137</font>	    {
<a name="L5138"><font color="white">05138</font>			  if (ChercheBonMatos(other))		//CadavreWithPickup affecte a other dans Cherchebonmatos
<a name="L5139"><font color="white">05139</font>	        {
<a name="L5140"><font color="white">05140</font>	            HalteAufeu();
<a name="L5141"><font color="white">05141</font>	            bDisableEventSeeDeadPawn=true;
<a name="L5142"><font color="white">05142</font>	            CadavreWithPickup.bDejaFouille=true;
<a name="L5143"><font color="white">05143</font>	            gotostate('tacticalmove','chercheobjet');
<a name="L5144"><font color="white">05144</font>	        }
<a name="L5145"><font color="white">05145</font>	    }
<a name="L5146"><font color="white">05146</font>	    event Trigger(actor Other, pawn EventInstigator)
<a name="L5147"><font color="white">05147</font>	    {
<a name="L5148"><font color="white">05148</font>	    }
<a name="L5149"><font color="white">05149</font>	    event EnemyAcquired()
<a name="L5150"><font color="white">05150</font>	    {
<a name="L5151"><font color="white">05151</font>	        gotostate('attaque');
<a name="L5152"><font color="white">05152</font>	    }
<a name="L5153"><font color="white">05153</font>	    function bool ContinueStakeOut()
<a name="L5154"><font color="white">05154</font>	    {
<a name="L5155"><font color="white">05155</font>	        local float relstr;
<a name="L5156"><font color="white">05156</font>	
<a name="L5157"><font color="white">05157</font>	        relstr = RelativeStrength(Enemy);
<a name="L5158"><font color="white">05158</font>	        if ((VSize(Enemy.Location - Pawn.Location) &gt; 450+150*(3+fclamp((relstr-3*bases.agressivite) +frand(),-3,5)))
<a name="L5159"><font color="white">05159</font>	            || (Level.TimeSeconds - LastSeenTime &gt; 2.5 + FMax(-1.5,0.5+1.5*(FRand()+(relstr-bases.agressivite)))) || (!LigneVisee(LastSeenPos,pawn.location)))
<a name="L5160"><font color="white">05160</font>	            return false;
<a name="L5161"><font color="white">05161</font>	        else if (CanStakeOut())
<a name="L5162"><font color="white">05162</font>	            return true;
<a name="L5163"><font color="white">05163</font>	        else
<a name="L5164"><font color="white">05164</font>	            return false;
<a name="L5165"><font color="white">05165</font>	    }
<a name="L5166"><font color="white">05166</font>	    function bool CanStakeOut() // CanStakeout : teste si Pawn ET ENEMMI peuvent voir LastSeenPos
<a name="L5167"><font color="white">05167</font>	    {
<a name="L5168"><font color="white">05168</font>	        if ( VSize(Enemy.Location - LastSeenPos) &gt; 800 )
<a name="L5169"><font color="white">05169</font>	            return false;
<a name="L5170"><font color="white">05170</font>	        return ( FastTrace(LastSeenPos, Pawn.Location + Pawn.Eyeposition())
<a name="L5171"><font color="white">05171</font>	            &amp;&amp; FastTrace(LastSeenPos , Enemy.Location + enemy.Eyeposition()));
<a name="L5172"><font color="white">05172</font>	    }
<a name="L5173"><font color="white">05173</font>	
<a name="L5174"><font color="white">05174</font>	    function BeginState()
<a name="L5175"><font color="white">05175</font>	    {
<a name="L5176"><font color="white">05176</font>	         if (enemy==none || enemy.bisdead)
<a name="L5177"><font color="white">05177</font>				{
<a name="L5178"><font color="white">05178</font>	 				return;
<a name="L5179"><font color="white">05179</font>				}
<a name="L5180"><font color="white">05180</font>	        if (NiveauAlerte==0)
<a name="L5181"><font color="white">05181</font>	        {
<a name="L5182"><font color="white">05182</font>	            s_decAttente();
<a name="L5183"><font color="white">05183</font>	            s_incAttaque();
<a name="L5184"><font color="white">05184</font>	        }
<a name="L5185"><font color="white">05185</font>	        else if (NiveauAlerte==1)
<a name="L5186"><font color="white">05186</font>	        {
<a name="L5187"><font color="white">05187</font>	            s_decAlerte();
<a name="L5188"><font color="white">05188</font>	            s_incAttaque();
<a name="L5189"><font color="white">05189</font>	        }
<a name="L5190"><font color="white">05190</font>	        NiveauAlerte=2;
<a name="L5191"><font color="white">05191</font>	        //Var Temp
<a name="L5192"><font color="white">05192</font>	        btemp_bool = LigneVisee(LastSeenPos,pawn.location);
<a name="L5193"><font color="white">05193</font>	        if (!btemp_bool || ((Level.TimeSeconds - LastSeenTime &gt; 6) &amp;&amp; (FRand() &lt; 0.5)) )
<a name="L5194"><font color="white">05194</font>	            FindNewStakeOutDir();
<a name="L5195"><font color="white">05195</font>	    }
<a name="L5196"><font color="white">05196</font>	    function EndState()
<a name="L5197"><font color="white">05197</font>	    {
<a name="L5198"><font color="white">05198</font>	    }
<a name="L5199"><font color="white">05199</font>	recalporte:
<a name="L5200"><font color="white">05200</font>	    if (CHARGE_LES_LOGS) log(pawn$&quot;TEMPORISE recalporte&quot;);
<a name="L5201"><font color="white">05201</font>	    MoveTo(LastSeenPos,none);
<a name="L5202"><font color="white">05202</font>	Begin:
<a name="L5203"><font color="white">05203</font>	    if (CHARGE_LES_LOGS) log(pawn@&quot;ETAT  temporise&quot;);
<a name="L5204"><font color="white">05204</font>	    if (enemy==none)
<a name="L5205"><font color="white">05205</font>	    {
<a name="L5206"><font color="white">05206</font>	        log(pawn@&quot;ENEMY==none ** ENEMY==none ** ENEMY==none ** ENEMY==none ** ENEMY==none **&quot;);
<a name="L5207"><font color="white">05207</font>	        //enemy=xiii;
<a name="L5208"><font color="white">05208</font>	    }
<a name="L5209"><font color="white">05209</font>	    pawn.velocity=vect(0,0,0);
<a name="L5210"><font color="white">05210</font>	    Pawn.Acceleration = vect(0,0,0);
<a name="L5211"><font color="white">05211</font>	    HalteAuFeu();
<a name="L5212"><font color="white">05212</font>	Campe:
<a name="L5213"><font color="white">05213</font>	    if (enemy==none || enemy.bisdead)
<a name="L5214"><font color="white">05214</font>	    {
<a name="L5215"><font color="white">05215</font>	        ChangeEtat();
<a name="L5216"><font color="white">05216</font>	    }
<a name="L5217"><font color="white">05217</font>	    // Recharge arme auto
<a name="L5218"><font color="white">05218</font>	    if (XIIIWeapon(pawn.weapon).default.reloadcount!=0 &amp;&amp; float(XIIIWeapon(pawn.weapon).reloadcount)/float(XIIIWeapon(pawn.weapon).default.reloadcount)&lt;0.15 &amp;&amp; pawn.weapon.HasAmmo())
<a name="L5219"><font color="white">05219</font>	    {
<a name="L5220"><font color="white">05220</font>	        pawn.weapon.GotoState('Reloading');
<a name="L5221"><font color="white">05221</font>	    }
<a name="L5222"><font color="white">05222</font>	    Focus = None;
<a name="L5223"><font color="white">05223</font>	    FocalPoint = LastSeenPos;
<a name="L5224"><font color="white">05224</font>	    FinishRotation();
<a name="L5225"><font color="white">05225</font>	    if (bases.order=='garder')
<a name="L5226"><font color="white">05226</font>	    {
<a name="L5227"><font color="white">05227</font>	        sleep(6);
<a name="L5228"><font color="white">05228</font>	        changeetat();
<a name="L5229"><font color="white">05229</font>	    }
<a name="L5230"><font color="white">05230</font>	    if (ContinueStakeOut())
<a name="L5231"><font color="white">05231</font>	    {
<a name="L5232"><font color="white">05232</font>	        Sleep(1+FRand());
<a name="L5233"><font color="white">05233</font>	        if ((FRand() &lt; 0.3) || !FastTrace(LastSeenPos+vect(0,0,0.9)*Enemy.CollisionHeight, Pawn.Location + vect(0,0,0.8) * Pawn.CollisionHeight))
<a name="L5234"><font color="white">05234</font>	            FindNewStakeOutDir();
<a name="L5235"><font color="white">05235</font>	        Goto('campe');
<a name="L5236"><font color="white">05236</font>	    }
<a name="L5237"><font color="white">05237</font>	    else
<a name="L5238"><font color="white">05238</font>	    {
<a name="L5239"><font color="white">05239</font>	        GotoState('chasse');
<a name="L5240"><font color="white">05240</font>	    }
<a name="L5241"><font color="white">05241</font>	}
<a name="L5242"><font color="white">05242</font>	
<a name="L5243"><font color="white">05243</font>	
<a name="L5244"><font color="white">05244</font>	// ----------------------------------------------------------------------
<a name="L5245"><font color="white">05245</font>	// Fuite             (enemy!=none)
<a name="L5246"><font color="white">05246</font>	//
<a name="L5247"><font color="white">05247</font>	//
<a name="L5248"><font color="white">05248</font>	// ----------------------------------------------------------------------
<a name="L5249"><font color="white">05249</font>	state Fuite
<a name="L5250"><font color="white">05250</font>	{
<a name="L5251"><font color="white">05251</font>	    ignores seeplayer,seemonster,hearnoise;
<a name="L5252"><font color="white">05252</font>	    event SeeDeadPawn(pawn other)
<a name="L5253"><font color="white">05253</font>	    {
<a name="L5254"><font color="white">05254</font>	    	  if (ChercheBonMatos(other))		//CadavreWithPickup affecte a other dans Cherchebonmatos
<a name="L5255"><font color="white">05255</font>	        {
<a name="L5256"><font color="white">05256</font>	            HalteAufeu();
<a name="L5257"><font color="white">05257</font>	            bDisableEventSeeDeadPawn=true;
<a name="L5258"><font color="white">05258</font>	            CadavreWithPickup.bDejaFouille=true;
<a name="L5259"><font color="white">05259</font>	            gotostate('tacticalmove','chercheobjet');
<a name="L5260"><font color="white">05260</font>	        }
<a name="L5261"><font color="white">05261</font>	    }
<a name="L5262"><font color="white">05262</font>	    event timer2()
<a name="L5263"><font color="white">05263</font>	    {
<a name="L5264"><font color="white">05264</font>	        //actualisation attitude
<a name="L5265"><font color="white">05265</font>	        if (AttitudeToNMI(enemy)&gt;ATTITUDE_FEAR)
<a name="L5266"><font color="white">05266</font>	        {
<a name="L5267"><font color="white">05267</font>	            gotostate('attaque');
<a name="L5268"><font color="white">05268</font>	            return;
<a name="L5269"><font color="white">05269</font>	        }
<a name="L5270"><font color="white">05270</font>	        if (ChangeToBestWeapon())
<a name="L5271"><font color="white">05271</font>	        {
<a name="L5272"><font color="white">05272</font>	            gotostate('attaque');
<a name="L5273"><font color="white">05273</font>	        }
<a name="L5274"><font color="white">05274</font>	    }
<a name="L5275"><font color="white">05275</font>	    event Trigger(actor Other, pawn EventInstigator)
<a name="L5276"><font color="white">05276</font>	    {
<a name="L5277"><font color="white">05277</font>	    }
<a name="L5278"><font color="white">05278</font>	    function PickDestination()
<a name="L5279"><font color="white">05279</font>	    {
<a name="L5280"><font color="white">05280</font>	        local vector pick, pickdir;
<a name="L5281"><font color="white">05281</font>	        local bool success;
<a name="L5282"><font color="white">05282</font>	        local float MoveDist;
<a name="L5283"><font color="white">05283</font>	
<a name="L5284"><font color="white">05284</font>	        pickdir = pawn.location-enemy.location;
<a name="L5285"><font color="white">05285</font>	        if (Pawn.Physics != PHYS_Walking)
<a name="L5286"><font color="white">05286</font>	        {
<a name="L5287"><font color="white">05287</font>	            pickdir.Z = 2 * FRand() - 1;
<a name="L5288"><font color="white">05288</font>	        }
<a name="L5289"><font color="white">05289</font>	        else
<a name="L5290"><font color="white">05290</font>	        {
<a name="L5291"><font color="white">05291</font>	            pickdir.Z = 0;
<a name="L5292"><font color="white">05292</font>	        }
<a name="L5293"><font color="white">05293</font>	        pickdir = Normal(pickdir);
<a name="L5294"><font color="white">05294</font>	
<a name="L5295"><font color="white">05295</font>	        //chtite combi aleatoire pour fuire dans un cone de 45 deg
<a name="L5296"><font color="white">05296</font>	        Temp_vect= pickdir cross (vect(0,0,1)); //normale au vecteur direction
<a name="L5297"><font color="white">05297</font>	        if (Frand() &lt; 0.5)
<a name="L5298"><font color="white">05298</font>	            pickdir += FRand()*Temp_Vect;
<a name="L5299"><font color="white">05299</font>	        else
<a name="L5300"><font color="white">05300</font>	            pickdir -= FRand()*Temp_Vect;
<a name="L5301"><font color="white">05301</font>	        pickdir = Normal(pickdir);
<a name="L5302"><font color="white">05302</font>	        MoveDist = 150+DistanceDeplacement*(0.4+0.6*Frand());
<a name="L5303"><font color="white">05303</font>	        success = TestDirection(150,MoveDist,pickdir, pick);
<a name="L5304"><font color="white">05304</font>	        if (!success)
<a name="L5305"><font color="white">05305</font>	        {
<a name="L5306"><font color="white">05306</font>	            temp_vect=(enemy.location-pawn.location) ;
<a name="L5307"><font color="white">05307</font>	            pickdir = temp_vect cross (vect(0,0,1));
<a name="L5308"><font color="white">05308</font>	            if (((vector(pawn.rotation) dot pickdir)*(vector(pawn.rotation) dot temp_vect) &lt; 0) &amp;&amp; Frand() &gt; 0.2)
<a name="L5309"><font color="white">05309</font>	                pickdir *=-1;
<a name="L5310"><font color="white">05310</font>	            pickdir = Normal(pickdir);
<a name="L5311"><font color="white">05311</font>	            //chtite combi aleatoire pour fuire dans un cone de 45 deg
<a name="L5312"><font color="white">05312</font>	            Temp_vect= pickdir cross (vect(0,0,1)); //normale au vecteur direction
<a name="L5313"><font color="white">05313</font>	            if (Frand() &lt; 0.5)
<a name="L5314"><font color="white">05314</font>	                pickdir += FRand()*Temp_Vect;
<a name="L5315"><font color="white">05315</font>	            else
<a name="L5316"><font color="white">05316</font>	                pickdir -= FRand()*Temp_Vect;
<a name="L5317"><font color="white">05317</font>	            pickdir = Normal(pickdir);
<a name="L5318"><font color="white">05318</font>	            MoveDist = 150+DistanceDeplacement*(0.4+0.6*Frand());
<a name="L5319"><font color="white">05319</font>	            success = TestDirection(150,MoveDist,pickdir, pick);
<a name="L5320"><font color="white">05320</font>	
<a name="L5321"><font color="white">05321</font>	        }
<a name="L5322"><font color="white">05322</font>	        if (success)
<a name="L5323"><font color="white">05323</font>	        {
<a name="L5324"><font color="white">05324</font>	            DistNearWall=min(200,DistNearWall+5);
<a name="L5325"><font color="white">05325</font>	            DistanceDeplacement=min(600,DistanceDeplacement+45);
<a name="L5326"><font color="white">05326</font>	            Destination = pick;
<a name="L5327"><font color="white">05327</font>	        }
<a name="L5328"><font color="white">05328</font>	        else
<a name="L5329"><font color="white">05329</font>	        {
<a name="L5330"><font color="white">05330</font>	            DistNearWall=fmax(4*pawn.collisionradius,DistNearWall-40);
<a name="L5331"><font color="white">05331</font>	            DistanceDeplacement=max(10,DistanceDeplacement-35);
<a name="L5332"><font color="white">05332</font>	            GotoState('Fuite', 'Bloque');
<a name="L5333"><font color="white">05333</font>	        }
<a name="L5334"><font color="white">05334</font>	    }
<a name="L5335"><font color="white">05335</font>	    event Timer() //appelee une fois dans beginstate
<a name="L5336"><font color="white">05336</font>	    {
<a name="L5337"><font color="white">05337</font>	        if (!bTemp_bool)
<a name="L5338"><font color="white">05338</font>	        {
<a name="L5339"><font color="white">05339</font>	            CherchePointSafe();
<a name="L5340"><font color="white">05340</font>	        }
<a name="L5341"><font color="white">05341</font>	    }
<a name="L5342"><font color="white">05342</font>	    event enemynotvisible()
<a name="L5343"><font color="white">05343</font>	    {
<a name="L5344"><font color="white">05344</font>	        Temps_Ref = level.timeseconds;
<a name="L5345"><font color="white">05345</font>	        gotostate('fuite','pausing');
<a name="L5346"><font color="white">05346</font>	    }
<a name="L5347"><font color="white">05347</font>	
<a name="L5348"><font color="white">05348</font>	    function BeginState()
<a name="L5349"><font color="white">05349</font>	    {
<a name="L5350"><font color="white">05350</font>	        if (NiveauAlerte==0)
<a name="L5351"><font color="white">05351</font>	        {
<a name="L5352"><font color="white">05352</font>	            s_decAttente();
<a name="L5353"><font color="white">05353</font>	            s_incAlerte();
<a name="L5354"><font color="white">05354</font>	        }
<a name="L5355"><font color="white">05355</font>	        else if (NiveauAlerte==2)
<a name="L5356"><font color="white">05356</font>	        {
<a name="L5357"><font color="white">05357</font>	            s_incAlerte();
<a name="L5358"><font color="white">05358</font>	            s_decAttaque();
<a name="L5359"><font color="white">05359</font>	        }
<a name="L5360"><font color="white">05360</font>	        NiveauAlerte=1;
<a name="L5361"><font color="white">05361</font>	        Temps_Ref = level.timeseconds;
<a name="L5362"><font color="white">05362</font>	        MinHitWall += 0.15;
<a name="L5363"><font color="white">05363</font>	        timer();
<a name="L5364"><font color="white">05364</font>	        settimer2(5,true);
<a name="L5365"><font color="white">05365</font>	        //Var Temp
<a name="L5366"><font color="white">05366</font>	        btemp_bool=false; //utilise pour detection safepoint
<a name="L5367"><font color="white">05367</font>	    }
<a name="L5368"><font color="white">05368</font>	
<a name="L5369"><font color="white">05369</font>	    function EndState()
<a name="L5370"><font color="white">05370</font>	    {
<a name="L5371"><font color="white">05371</font>	        MinHitWall -= 0.15;
<a name="L5372"><font color="white">05372</font>	        settimer2(0,false);
<a name="L5373"><font color="white">05373</font>	    }
<a name="L5374"><font color="white">05374</font>	
<a name="L5375"><font color="white">05375</font>	Begin:
<a name="L5376"><font color="white">05376</font>	    if (CHARGE_LES_LOGS) log(pawn$&quot;ETAT Fuite.&quot;@&quot;enemy&quot;$enemy);
<a name="L5377"><font color="white">05377</font>	    if (enemy==none)
<a name="L5378"><font color="white">05378</font>	    {
<a name="L5379"><font color="white">05379</font>	        log(pawn@&quot;ENEMY==none ** ENEMY==none ** ENEMY==none ** ENEMY==none ** ENEMY==none **&quot;);
<a name="L5380"><font color="white">05380</font>	        //enemy=xiii;
<a name="L5381"><font color="white">05381</font>	    }
<a name="L5382"><font color="white">05382</font>	    setTimer(3,true);
<a name="L5383"><font color="white">05383</font>	Fuite:
<a name="L5384"><font color="white">05384</font>	    if (enemy==none || enemy.bisdead)
<a name="L5385"><font color="white">05385</font>	        ChangeEtat();
<a name="L5386"><font color="white">05386</font>	    enable('enemynotvisible');
<a name="L5387"><font color="white">05387</font>	    PickDestination();
<a name="L5388"><font color="white">05388</font>	Moving:
<a name="L5389"><font color="white">05389</font>	    focalpoint=destination*vect(100,100,0);
<a name="L5390"><font color="white">05390</font>	    focus=none;
<a name="L5391"><font color="white">05391</font>	    MoveTo(Destination,None,1.0);
<a name="L5392"><font color="white">05392</font>	    if (NearWall(DistNearWall))
<a name="L5393"><font color="white">05393</font>	    {
<a name="L5394"><font color="white">05394</font>	        DistanceDeplacement=max(10,DistanceDeplacement-10);
<a name="L5395"><font color="white">05395</font>	        DistNearWall=fmax(2*pawn.collisionradius,DistNearWall-5);
<a name="L5396"><font color="white">05396</font>	        FinishRotation();
<a name="L5397"><font color="white">05397</font>	    }
<a name="L5398"><font color="white">05398</font>	    goto('fuite');
<a name="L5399"><font color="white">05399</font>	Pausing:
<a name="L5400"><font color="white">05400</font>	    disable('enemynotvisible');
<a name="L5401"><font color="white">05401</font>	    pawn.velocity=vect(0,0,0);
<a name="L5402"><font color="white">05402</font>	    Pawn.Acceleration = vect(0,0,0);
<a name="L5403"><font color="white">05403</font>	    Sleep(1.0);
<a name="L5404"><font color="white">05404</font>	    if (enemy.controller.cansee(pawn))
<a name="L5405"><font color="white">05405</font>	    {
<a name="L5406"><font color="white">05406</font>	        if ((level.timeseconds - Temps_Ref) &gt; 0.8)
<a name="L5407"><font color="white">05407</font>	        {
<a name="L5408"><font color="white">05408</font>	            Temps_Ref = level.timeseconds;
<a name="L5409"><font color="white">05409</font>	            goto ('fuite');
<a name="L5410"><font color="white">05410</font>	        }
<a name="L5411"><font color="white">05411</font>	    }
<a name="L5412"><font color="white">05412</font>	    else if ((level.timeseconds - Temps_Ref) &gt;6)
<a name="L5413"><font color="white">05413</font>	        ChangeEtat();
<a name="L5414"><font color="white">05414</font>	    goto('pausing');
<a name="L5415"><font color="white">05415</font>	Bloque:
<a name="L5416"><font color="white">05416</font>	    pawn.velocity=vect(0,0,0);
<a name="L5417"><font color="white">05417</font>	    Pawn.Acceleration = vect(0,0,0);
<a name="L5418"><font color="white">05418</font>	    if (VSize(pawn.location-enemy.location) &lt; 300)
<a name="L5419"><font color="white">05419</font>	    {
<a name="L5420"><font color="white">05420</font>	        Temps_Ref = level.timeseconds;
<a name="L5421"><font color="white">05421</font>	        gotostate('attaque');
<a name="L5422"><font color="white">05422</font>	    }
<a name="L5423"><font color="white">05423</font>	    Focus = None;
<a name="L5424"><font color="white">05424</font>	    FocalPoint = Location + 20 * VRand();
<a name="L5425"><font color="white">05425</font>	    FinishRotation();
<a name="L5426"><font color="white">05426</font>	    Goto('fuite');
<a name="L5427"><font color="white">05427</font>	}
<a name="L5428"><font color="white">05428</font>	// ----------------------------------------------------------------------
<a name="L5429"><font color="white">05429</font>	// Fuite grenade
<a name="L5430"><font color="white">05430</font>	//
<a name="L5431"><font color="white">05431</font>	// Fuit qu'une grenade a la fois et refuis la plus proche quand l'autre a pete
<a name="L5432"><font color="white">05432</font>	//
<a name="L5433"><font color="white">05433</font>	// ----------------------------------------------------------------------
<a name="L5434"><font color="white">05434</font>	state FuiteGrenade
<a name="L5435"><font color="white">05435</font>	{
<a name="L5436"><font color="white">05436</font>	    ignores hearnoise;
<a name="L5437"><font color="white">05437</font>	
<a name="L5438"><font color="white">05438</font>		 Function CheckNearestGrenad()
<a name="L5439"><font color="white">05439</font>		 {
<a name="L5440"><font color="white">05440</font>			local int i;
<a name="L5441"><font color="white">05441</font>	
<a name="L5442"><font color="white">05442</font>			for (i=0; i&lt;genalerte.GrenadeList.length; i++)
<a name="L5443"><font color="white">05443</font>			{
<a name="L5444"><font color="white">05444</font>				if (genalerte.GrenadeList[i]==none || genalerte.GrenadeList[i].bdeleteme)
<a name="L5445"><font color="white">05445</font>					continue;
<a name="L5446"><font color="white">05446</font>				if (Vsize(genalerte.GrenadeList[i].location-pawn.location)&lt;1200 &amp;&amp; Fasttrace(genalerte.GrenadeList[i].location,pawn.location))
<a name="L5447"><font color="white">05447</font>				{
<a name="L5448"><font color="white">05448</font>					grenade=genalerte.GrenadeList[i];
<a name="L5449"><font color="white">05449</font>					CherchePlanqueGrenade();
<a name="L5450"><font color="white">05450</font>					//log(&quot;une grenade est tojuourts mecnacnate je recherche safepoint&quot;);
<a name="L5451"><font color="white">05451</font>					return;
<a name="L5452"><font color="white">05452</font>				}
<a name="L5453"><font color="white">05453</font>			}
<a name="L5454"><font color="white">05454</font>		}
<a name="L5455"><font color="white">05455</font>		 event EnemyNotVisible()
<a name="L5456"><font color="white">05456</font>	    {
<a name="L5457"><font color="white">05457</font>	        enable('seemonster');
<a name="L5458"><font color="white">05458</font>	        enable('seeplayer');
<a name="L5459"><font color="white">05459</font>	        disable('enemynotvisible');
<a name="L5460"><font color="white">05460</font>	        halteaufeu();
<a name="L5461"><font color="white">05461</font>	    }
<a name="L5462"><font color="white">05462</font>	    event Seeplayer(pawn other)
<a name="L5463"><font color="white">05463</font>	    {
<a name="L5464"><font color="white">05464</font>	        if (enemy==other &amp;&amp;  bTemp_bool)
<a name="L5465"><font color="white">05465</font>	        {
<a name="L5466"><font color="white">05466</font>	            fireenemy();
<a name="L5467"><font color="white">05467</font>	            disable('seemonster');
<a name="L5468"><font color="white">05468</font>	            disable('seeplayer');
<a name="L5469"><font color="white">05469</font>	            enable('enemynotvisible');
<a name="L5470"><font color="white">05470</font>	        }
<a name="L5471"><font color="white">05471</font>			  else
<a name="L5472"><font color="white">05472</font>			  	  SetEnemy(other);
<a name="L5473"><font color="white">05473</font>	    }
<a name="L5474"><font color="white">05474</font>	    event SeeMonster(pawn other)
<a name="L5475"><font color="white">05475</font>	    {
<a name="L5476"><font color="white">05476</font>	       if (enemy==other &amp;&amp;  bTemp_bool)
<a name="L5477"><font color="white">05477</font>	       {
<a name="L5478"><font color="white">05478</font>	            fireenemy();
<a name="L5479"><font color="white">05479</font>	            disable('seemonster');
<a name="L5480"><font color="white">05480</font>	            disable('seeplayer');
<a name="L5481"><font color="white">05481</font>	            enable('enemynotvisible');
<a name="L5482"><font color="white">05482</font>	       }
<a name="L5483"><font color="white">05483</font>			 else
<a name="L5484"><font color="white">05484</font>			  	SetEnemy(other);
<a name="L5485"><font color="white">05485</font>	    }
<a name="L5486"><font color="white">05486</font>	    event EnemyAcquired()
<a name="L5487"><font color="white">05487</font>	    {
<a name="L5488"><font color="white">05488</font>	       Interrogation=Spawn(class'exclamation',self,,bases.location+(vector(bases.rotation) cross vect(0,0,1))*6 + 120*vect(0,0,1));
<a name="L5489"><font color="white">05489</font>	       interrogation.setbase(pawn);
<a name="L5490"><font color="white">05490</font>	       interrogation.settimer(0.8,false);
<a name="L5491"><font color="white">05491</font>	        bDejaVu=true;
<a name="L5492"><font color="white">05492</font>	        disable('seemonster');
<a name="L5493"><font color="white">05493</font>	        disable('seeplayer');
<a name="L5494"><font color="white">05494</font>	        enable('enemynotvisible');
<a name="L5495"><font color="white">05495</font>	        bEtatAlerte=true;
<a name="L5496"><font color="white">05496</font>	    }
<a name="L5497"><font color="white">05497</font>	    event timer3()
<a name="L5498"><font color="white">05498</font>	    {
<a name="L5499"><font color="white">05499</font>	        if (grenade==none || grenade.bdeleteme)
<a name="L5500"><font color="white">05500</font>	        {
<a name="L5501"><font color="white">05501</font>	            grenade=none;
<a name="L5502"><font color="white">05502</font>	            bTemp_bool=false;
<a name="L5503"><font color="white">05503</font>				   if (bControlAnimations) bases.ReleaseAnimControl();
<a name="L5504"><font color="white">05504</font>	            gotostate('fuitegrenade','elleapete');
<a name="L5505"><font color="white">05505</font>	        }
<a name="L5506"><font color="white">05506</font>	     /*   else if (Fasttrace(grenade.location,pawn.LOCATION))
<a name="L5507"><font color="white">05507</font>				{
<a name="L5508"><font color="white">05508</font>					log(&quot;la grenade est toujours en visu je me casse&quot;);
<a name="L5509"><font color="white">05509</font>	            CherchePlanqueGrenade();
<a name="L5510"><font color="white">05510</font>				}  */
<a name="L5511"><font color="white">05511</font>	    }
<a name="L5512"><font color="white">05512</font>	    event updatetactics()
<a name="L5513"><font color="white">05513</font>	    {
<a name="L5514"><font color="white">05514</font>	        if (Vsize(grenade.location-pawn.location)&gt;1200)
<a name="L5515"><font color="white">05515</font>	        {
<a name="L5516"><font color="white">05516</font>	            gotostate('fuitegrenade','AttendQuellePete');
<a name="L5517"><font color="white">05517</font>	        }
<a name="L5518"><font color="white">05518</font>	    }
<a name="L5519"><font color="white">05519</font>	    event Trigger(actor Other, pawn EventInstigator)
<a name="L5520"><font color="white">05520</font>	    {
<a name="L5521"><font color="white">05521</font>	    }
<a name="L5522"><font color="white">05522</font>	    function PickDestination()
<a name="L5523"><font color="white">05523</font>	    {
<a name="L5524"><font color="white">05524</font>	        local vector pick, pickdir;
<a name="L5525"><font color="white">05525</font>	        local bool success;
<a name="L5526"><font color="white">05526</font>	        local float MoveDist;
<a name="L5527"><font color="white">05527</font>	
<a name="L5528"><font color="white">05528</font>	        pickdir = pawn.location-grenade.location;
<a name="L5529"><font color="white">05529</font>	  /*      if (Pawn.Physics != PHYS_Walking)
<a name="L5530"><font color="white">05530</font>	        {
<a name="L5531"><font color="white">05531</font>	            pickdir.Z = 2 * FRand() - 1;
<a name="L5532"><font color="white">05532</font>	        }
<a name="L5533"><font color="white">05533</font>	        else
<a name="L5534"><font color="white">05534</font>	        {  */
<a name="L5535"><font color="white">05535</font>	            pickdir.Z = 0;
<a name="L5536"><font color="white">05536</font>	        //}
<a name="L5537"><font color="white">05537</font>	        pickdir = Normal(pickdir);
<a name="L5538"><font color="white">05538</font>	
<a name="L5539"><font color="white">05539</font>	        //chtite combi aleatoire pour fuire dans un cone de 45 deg
<a name="L5540"><font color="white">05540</font>	        Temp_vect= pickdir cross (vect(0,0,1)); //normale au vecteur direction
<a name="L5541"><font color="white">05541</font>	        if (Frand() &lt; 0.5)
<a name="L5542"><font color="white">05542</font>	            pickdir += FRand()*Temp_Vect;
<a name="L5543"><font color="white">05543</font>	        else
<a name="L5544"><font color="white">05544</font>	            pickdir -= FRand()*Temp_Vect;
<a name="L5545"><font color="white">05545</font>	        pickdir = Normal(pickdir);
<a name="L5546"><font color="white">05546</font>	        MoveDist = 150+DistanceDeplacement*(0.4+0.6*Frand());
<a name="L5547"><font color="white">05547</font>	        success = TestDirection(150,MoveDist,pickdir, pick);
<a name="L5548"><font color="white">05548</font>	        if (!success)
<a name="L5549"><font color="white">05549</font>	        {
<a name="L5550"><font color="white">05550</font>	            temp_vect=(grenade.location-pawn.location) ;
<a name="L5551"><font color="white">05551</font>	            pickdir = temp_vect cross (vect(0,0,1));
<a name="L5552"><font color="white">05552</font>	            if (((vector(pawn.rotation) dot pickdir)*(vector(pawn.rotation) dot temp_vect) &lt; 0) &amp;&amp; Frand() &gt; 0.2)
<a name="L5553"><font color="white">05553</font>	                pickdir *=-1;
<a name="L5554"><font color="white">05554</font>	            pickdir = Normal(pickdir);
<a name="L5555"><font color="white">05555</font>	            //chtite combi aleatoire pour fuire dans un cone de 45 deg
<a name="L5556"><font color="white">05556</font>	            Temp_vect= pickdir cross (vect(0,0,1)); //normale au vecteur direction
<a name="L5557"><font color="white">05557</font>	            if (Frand() &lt; 0.5)
<a name="L5558"><font color="white">05558</font>	                pickdir += FRand()*Temp_Vect;
<a name="L5559"><font color="white">05559</font>	            else
<a name="L5560"><font color="white">05560</font>	                pickdir -= FRand()*Temp_Vect;
<a name="L5561"><font color="white">05561</font>	            pickdir = Normal(pickdir);
<a name="L5562"><font color="white">05562</font>	            MoveDist = 150+DistanceDeplacement*(0.4+0.6*Frand());
<a name="L5563"><font color="white">05563</font>	            success = TestDirection(150,MoveDist,pickdir, pick);
<a name="L5564"><font color="white">05564</font>	
<a name="L5565"><font color="white">05565</font>	        }
<a name="L5566"><font color="white">05566</font>	        if (success)
<a name="L5567"><font color="white">05567</font>	        {
<a name="L5568"><font color="white">05568</font>	            DistNearWall=min(200,DistNearWall+5);
<a name="L5569"><font color="white">05569</font>	            DistanceDeplacement=min(600,DistanceDeplacement+45);
<a name="L5570"><font color="white">05570</font>	            Destination = pick;
<a name="L5571"><font color="white">05571</font>	        }
<a name="L5572"><font color="white">05572</font>	        else
<a name="L5573"><font color="white">05573</font>	        {
<a name="L5574"><font color="white">05574</font>	            DistNearWall=max(4*pawn.collisionradius,DistNearWall-40);
<a name="L5575"><font color="white">05575</font>	            DistanceDeplacement=max(10,DistanceDeplacement-35);
<a name="L5576"><font color="white">05576</font>	            GotoState('FuiteGrenade','Bloque');
<a name="L5577"><font color="white">05577</font>	        }
<a name="L5578"><font color="white">05578</font>	    }
<a name="L5579"><font color="white">05579</font>	
<a name="L5580"><font color="white">05580</font>	    function BeginState()
<a name="L5581"><font color="white">05581</font>	    {
<a name="L5582"><font color="white">05582</font>	        if (CHARGE_LES_LOGS) log(pawn$&quot;ETAT fuiteGrenade&quot;@grenade@enemy@bdejavu);
<a name="L5583"><font color="white">05583</font>	        if (enemy!=none &amp;&amp; !bdejavu)     //cheat si il n'a pas vu ca cible il n'a plus de cible
<a name="L5584"><font color="white">05584</font>	        {
<a name="L5585"><font color="white">05585</font>	            enemy=none;
<a name="L5586"><font color="white">05586</font>	        }
<a name="L5587"><font color="white">05587</font>	        if (enemy!=none) //deja vu
<a name="L5588"><font color="white">05588</font>	        {
<a name="L5589"><font color="white">05589</font>	            disable('seemonster');
<a name="L5590"><font color="white">05590</font>	            disable('seeplayer');
<a name="L5591"><font color="white">05591</font>	        }
<a name="L5592"><font color="white">05592</font>	        disable('enemynotvisible');
<a name="L5593"><font color="white">05593</font>	        if (NiveauAlerte==0)  //passe en alerte
<a name="L5594"><font color="white">05594</font>	        {
<a name="L5595"><font color="white">05595</font>	            s_decAttente();
<a name="L5596"><font color="white">05596</font>	            s_incAlerte();
<a name="L5597"><font color="white">05597</font>	            NiveauAlerte=1;
<a name="L5598"><font color="white">05598</font>	        }
<a name="L5599"><font color="white">05599</font>			  else if (enemy==none)
<a name="L5600"><font color="white">05600</font>	        {
<a name="L5601"><font color="white">05601</font>	            if (NiveauAlerte==2)
<a name="L5602"><font color="white">05602</font>	            {
<a name="L5603"><font color="white">05603</font>	                s_decAttaque();
<a name="L5604"><font color="white">05604</font>	                s_incAlerte();
<a name="L5605"><font color="white">05605</font>	                NiveauAlerte=1;
<a name="L5606"><font color="white">05606</font>	            }
<a name="L5607"><font color="white">05607</font>	        }
<a name="L5608"><font color="white">05608</font>	        else
<a name="L5609"><font color="white">05609</font>	        {
<a name="L5610"><font color="white">05610</font>	            if (NiveauAlerte==1)
<a name="L5611"><font color="white">05611</font>	            {
<a name="L5612"><font color="white">05612</font>	                s_incAttaque();
<a name="L5613"><font color="white">05613</font>	                s_decAlerte();
<a name="L5614"><font color="white">05614</font>	                NiveauAlerte=2;
<a name="L5615"><font color="white">05615</font>	            }
<a name="L5616"><font color="white">05616</font>	        }
<a name="L5617"><font color="white">05617</font>	        Temps_Ref=level.timeseconds;
<a name="L5618"><font color="white">05618</font>	        bTemp_bool=false;
<a name="L5619"><font color="white">05619</font>	        //MinHitWall += 0.15;
<a name="L5620"><font color="white">05620</font>	        settimer3(0.5,true);
<a name="L5621"><font color="white">05621</font>				bARienVu=false;
<a name="L5622"><font color="white">05622</font>	        //--------  Var Temp ------------
<a name="L5623"><font color="white">05623</font>	        //temp_bool=false //gren,ade lancee par xiii
<a name="L5624"><font color="white">05624</font>	        //bDisableEventSeeDeadPawn=true;
<a name="L5625"><font color="white">05625</font>	    }
<a name="L5626"><font color="white">05626</font>	
<a name="L5627"><font color="white">05627</font>	    function EndState()
<a name="L5628"><font color="white">05628</font>	    {
<a name="L5629"><font color="white">05629</font>			if (bControlAnimations) bases.ReleaseAnimControl();
<a name="L5630"><font color="white">05630</font>				Halteaufeu();
<a name="L5631"><font color="white">05631</font>				grenade=none;
<a name="L5632"><font color="white">05632</font>	        //MinHitWall -= 0.15;
<a name="L5633"><font color="white">05633</font>	        Pawn.ShouldCrouch(false);
<a name="L5634"><font color="white">05634</font>	    }
<a name="L5635"><font color="white">05635</font>	acquisition:
<a name="L5636"><font color="white">05636</font>	    focus=grenade;
<a name="L5637"><font color="white">05637</font>	    FinishRotation();
<a name="L5638"><font color="white">05638</font>	    sleep(0.3);
<a name="L5639"><font color="white">05639</font>	
<a name="L5640"><font color="white">05640</font>	Begin:
<a name="L5641"><font color="white">05641</font>	    CherchePlanqueGrenade();
<a name="L5642"><font color="white">05642</font>	    //cherche safepoint
<a name="L5643"><font color="white">05643</font>	Fuite:
<a name="L5644"><font color="white">05644</font>	    PickDestination();
<a name="L5645"><font color="white">05645</font>	Moving:
<a name="L5646"><font color="white">05646</font>	    badvancedtactics=true;
<a name="L5647"><font color="white">05647</font>	    MoveTo(destination,none, 1.0);
<a name="L5648"><font color="white">05648</font>	    if (NearWall(DistNearWall))
<a name="L5649"><font color="white">05649</font>	    {
<a name="L5650"><font color="white">05650</font>	        DistanceDeplacement=max(10,DistanceDeplacement-10);
<a name="L5651"><font color="white">05651</font>	        DistNearWall=max(2*pawn.collisionradius,DistNearWall-5);
<a name="L5652"><font color="white">05652</font>	        FinishRotation();
<a name="L5653"><font color="white">05653</font>	    }
<a name="L5654"><font color="white">05654</font>	    sleep(0.04);
<a name="L5655"><font color="white">05655</font>	    goto('fuite');
<a name="L5656"><font color="white">05656</font>	
<a name="L5657"><font color="white">05657</font>	Bloque:
<a name="L5658"><font color="white">05658</font>	    pawn.velocity=vect(0,0,0);
<a name="L5659"><font color="white">05659</font>	    Pawn.Acceleration = vect(0,0,0);
<a name="L5660"><font color="white">05660</font>	    Focus = None;
<a name="L5661"><font color="white">05661</font>	    FocalPoint = Location + 20 * VRand();
<a name="L5662"><font color="white">05662</font>	    FinishRotation();
<a name="L5663"><font color="white">05663</font>	    Goto('fuite');
<a name="L5664"><font color="white">05664</font>	VaVersSafePoint:
<a name="L5665"><font color="white">05665</font>	    if (bControlAnimations) bases.ReleaseAnimControl();
<a name="L5666"><font color="white">05666</font>	    badvancedtactics=true;
<a name="L5667"><font color="white">05667</font>	    If (MoveActor.bReachable)
<a name="L5668"><font color="white">05668</font>		 {
<a name="L5669"><font color="white">05669</font>	         MoveToward(MoveActor.MoveActor,MoveActor.MoveActor);
<a name="L5670"><font color="white">05670</font>		  	   CheckNearestGrenad();
<a name="L5671"><font color="white">05671</font>		 }
<a name="L5672"><font color="white">05672</font>	    else
<a name="L5673"><font color="white">05673</font>	    {
<a name="L5674"><font color="white">05674</font>	        for (iCompteur=0;iCompteur&lt;NbPointChemin;iCompteur++)
<a name="L5675"><font color="white">05675</font>	        {
<a name="L5676"><font color="white">05676</font>	            focus=none;
<a name="L5677"><font color="white">05677</font>	            focalpoint=10000*normal(PointChemin[iCompteur].location-pawn.location)+pawn.location;
<a name="L5678"><font color="white">05678</font>	            Movetoward(PointChemin[iCompteur],none);
<a name="L5679"><font color="white">05679</font>					CheckNearestGrenad();
<a name="L5680"><font color="white">05680</font>	        }
<a name="L5681"><font color="white">05681</font>	    }
<a name="L5682"><font color="white">05682</font>	    if (SAFEPOINT(MoveActor.MoveActor).baccroupi)
<a name="L5683"><font color="white">05683</font>	    {
<a name="L5684"><font color="white">05684</font>	        pawn.shouldcrouch(true);
<a name="L5685"><font color="white">05685</font>	    }
<a name="L5686"><font color="white">05686</font>	AttendQuellePete:
<a name="L5687"><font color="white">05687</font>	    badvancedtactics=false;
<a name="L5688"><font color="white">05688</font>	    pawn.velocity=vect(0,0,0);
<a name="L5689"><font color="white">05689</font>	    Pawn.Acceleration = vect(0,0,0);
<a name="L5690"><font color="white">05690</font>	    if (CHARGE_LES_LOGS) log(pawn@&quot;attend explosion&quot;);
<a name="L5691"><font color="white">05691</font>	    if (enemy!=none &amp;&amp; cansee(enemy))
<a name="L5692"><font color="white">05692</font>	    {
<a name="L5693"><font color="white">05693</font>	        focus=enemy;
<a name="L5694"><font color="white">05694</font>	    }
<a name="L5695"><font color="white">05695</font>	    else
<a name="L5696"><font color="white">05696</font>	    {
<a name="L5697"><font color="white">05697</font>	        if (MoveActor.MoveActor!=none)
<a name="L5698"><font color="white">05698</font>				 focalpoint=1000*vector(MoveActor.MoveActor.rotation)+pawn.location;
<a name="L5699"><font color="white">05699</font>	        bases.PlayWaitGrenade();
<a name="L5700"><font color="white">05700</font>	    }
<a name="L5701"><font color="white">05701</font>	    bTemp_bool=true;
<a name="L5702"><font color="white">05702</font>	    sleep(4);
<a name="L5703"><font color="white">05703</font>		 if (bControlAnimations) bases.ReleaseAnimControl();
<a name="L5704"><font color="white">05704</font>	    bTemp_bool=false;
<a name="L5705"><font color="white">05705</font>	ElleAPete:
<a name="L5706"><font color="white">05706</font>	    if (CHARGE_LES_LOGS) log(&quot;elle a pete&quot;);
<a name="L5707"><font color="white">05707</font>		 settimer3(0,false);
<a name="L5708"><font color="white">05708</font>	    if (pawn.biscrouched)
<a name="L5709"><font color="white">05709</font>	        pawn.shouldcrouch(false);
<a name="L5710"><font color="white">05710</font>	    if (enemy!=none) //enemy vu donc refight
<a name="L5711"><font color="white">05711</font>	    {
<a name="L5712"><font color="white">05712</font>	        if (!genalerte.bAllAlarmsActivated)    ChercheAlarme();  //ALARMEChercheAlarme();  //ALARME
<a name="L5713"><font color="white">05713</font>	        if (badvancedtactics)    //'jetais en train de me deplacer
<a name="L5714"><font color="white">05714</font>	        {
<a name="L5715"><font color="white">05715</font>	            pawn.velocity=vect(0,0,0);
<a name="L5716"><font color="white">05716</font>	            Pawn.Acceleration = vect(0,0,0);
<a name="L5717"><font color="white">05717</font>	            focus=enemy;
<a name="L5718"><font color="white">05718</font>	            finishrotation();
<a name="L5719"><font color="white">05719</font>	        }
<a name="L5720"><font color="white">05720</font>				if (SafePointOccupe!=none)
<a name="L5721"><font color="white">05721</font>				{
<a name="L5722"><font color="white">05722</font>					SafePointOccupe.timer();
<a name="L5723"><font color="white">05723</font>					SafePointOccupe=none;
<a name="L5724"><font color="white">05724</font>				}
<a name="L5725"><font color="white">05725</font>	        gotostate('attaque');
<a name="L5726"><font color="white">05726</font>	    }
<a name="L5727"><font color="white">05727</font>	    else
<a name="L5728"><font color="white">05728</font>	        gotostate('restesurplace');
<a name="L5729"><font color="white">05729</font>	}
<a name="L5730"><font color="white">05730</font>	
<a name="L5731"><font color="white">05731</font>	// ----------------------------------------------------------------------
<a name="L5732"><font color="white">05732</font>	//     Investigation    (enemy!=none)
<a name="L5733"><font color="white">05733</font>	//
<a name="L5734"><font color="white">05734</font>	//      Se deplace vers enemy pendnat tempsrecherchenmi
<a name="L5735"><font color="white">05735</font>	//
<a name="L5736"><font color="white">05736</font>	// ----------------------------------------------------------------------
<a name="L5737"><font color="white">05737</font>	state Investigation    //temps d'investigation depend du comportement ???
<a name="L5738"><font color="white">05738</font>	{
<a name="L5739"><font color="white">05739</font>	    ignores enemynotvisible;
<a name="L5740"><font color="white">05740</font>	
<a name="L5741"><font color="white">05741</font>	    event SeePlayer(pawn other)
<a name="L5742"><font color="white">05742</font>	    {
<a name="L5743"><font color="white">05743</font>	        if (enemy!=none &amp;&amp; enemy==other)
<a name="L5744"><font color="white">05744</font>	            	SeeEnemy();
<a name="L5745"><font color="white">05745</font>	    }
<a name="L5746"><font color="white">05746</font>	    event SeeMonster(pawn other)
<a name="L5747"><font color="white">05747</font>	    {
<a name="L5748"><font color="white">05748</font>	        if (enemy!=none &amp;&amp; enemy==other)
<a name="L5749"><font color="white">05749</font>	            	SeeEnemy();
<a name="L5750"><font color="white">05750</font>	    }
<a name="L5751"><font color="white">05751</font>	    event hearnoise(float loudness,actor NoiseMaker)
<a name="L5752"><font color="white">05752</font>	    {
<a name="L5753"><font color="white">05753</font>		 	  if (NoiseMaker.instigator!=none &amp;&amp; NoiseMaker.instigator.controller!=none &amp;&amp; NoiseMaker.instigator.controller.isa('CineController2'))
<a name="L5754"><font color="white">05754</font>			     return;
<a name="L5755"><font color="white">05755</font>	        if ((weapon(NoiseMaker)!=none || XIIIProjectile(NoiseMaker)!=none) &amp;&amp; NoiseMaker.instigator==enemy)
<a name="L5756"><font color="white">05756</font>	        {
<a name="L5757"><font color="white">05757</font>	            Gotostate('Investigation','ChercheSurPlace');
<a name="L5758"><font color="white">05758</font>	        }
<a name="L5759"><font color="white">05759</font>	    }
<a name="L5760"><font color="white">05760</font>	    event EnemyAcquired()
<a name="L5761"><font color="white">05761</font>	    {
<a name="L5762"><font color="white">05762</font>	        if (enemy==XIII) TriggerEvent('XIIIVu', Self, pawn);  //trigger vu
<a name="L5763"><font color="white">05763</font>	        bDejaVu=true;
<a name="L5764"><font color="white">05764</font>	        bWeaponNoise=false;
<a name="L5765"><font color="white">05765</font>	        bImpactNoise=false;
<a name="L5766"><font color="white">05766</font>	        bStepNoise=false;
<a name="L5767"><font color="white">05767</font>	        bCadavreVu=false;
<a name="L5768"><font color="white">05768</font>	        bPaffe=false;
<a name="L5769"><font color="white">05769</font>	        disable('seeplayer');
<a name="L5770"><font color="white">05770</font>	        disable('seemonster');
<a name="L5771"><font color="white">05771</font>	        Gotostate('Investigation','ContinueUnPeuEtAttaque');
<a name="L5772"><font color="white">05772</font>	    }
<a name="L5773"><font color="white">05773</font>	    event timer2()
<a name="L5774"><font color="white">05774</font>	    {
<a name="L5775"><font color="white">05775</font>	        changeetat();
<a name="L5776"><font color="white">05776</font>	    }
<a name="L5777"><font color="white">05777</font>	    event Trigger(actor Other, pawn EventInstigator)
<a name="L5778"><font color="white">05778</font>	    {
<a name="L5779"><font color="white">05779</font>	    }
<a name="L5780"><font color="white">05780</font>	    event UpdateTactics()
<a name="L5781"><font color="white">05781</font>	    {
<a name="L5782"><font color="white">05782</font>	    }
<a name="L5783"><font color="white">05783</font>	    function bool EnregistrePointsVersEnemy()
<a name="L5784"><font color="white">05784</font>	    {
<a name="L5785"><font color="white">05785</font>	        local int NbPoints,i;
<a name="L5786"><font color="white">05786</font>	
<a name="L5787"><font color="white">05787</font>	        if (!findbestpathtoward(enemy))
<a name="L5788"><font color="white">05788</font>	        {
<a name="L5789"><font color="white">05789</font>	            //log(&quot;ne trouve pas de chemin&quot;);
<a name="L5790"><font color="white">05790</font>	            return false;
<a name="L5791"><font color="white">05791</font>	        }
<a name="L5792"><font color="white">05792</font>	        NbPoints=0;
<a name="L5793"><font color="white">05793</font>	        for (i=0;i&lt;3;i++)
<a name="L5794"><font color="white">05794</font>	        {
<a name="L5795"><font color="white">05795</font>	            PointsInvestigation[i]=none;
<a name="L5796"><font color="white">05796</font>	        }
<a name="L5797"><font color="white">05797</font>	        for (i=0;i&lt;16;i++)
<a name="L5798"><font color="white">05798</font>	        {
<a name="L5799"><font color="white">05799</font>	            if (routeCache[i]==none)
<a name="L5800"><font color="white">05800</font>	                break;
<a name="L5801"><font color="white">05801</font>	        }
<a name="L5802"><font color="white">05802</font>	        NbPoints=i;
<a name="L5803"><font color="white">05803</font>	        if (NbPoints==0)
<a name="L5804"><font color="white">05804</font>	        {
<a name="L5805"><font color="white">05805</font>	            //log(&quot;pas de point d'investigation&quot;);
<a name="L5806"><font color="white">05806</font>	            return false;
<a name="L5807"><font color="white">05807</font>	        }
<a name="L5808"><font color="white">05808</font>	        else if (NbPoints==1)
<a name="L5809"><font color="white">05809</font>	        {
<a name="L5810"><font color="white">05810</font>	            PointsInvestigation[0]=routeCache[0];
<a name="L5811"><font color="white">05811</font>	            return true;
<a name="L5812"><font color="white">05812</font>	        }
<a name="L5813"><font color="white">05813</font>	        else if (NbPoints==2)
<a name="L5814"><font color="white">05814</font>	        {
<a name="L5815"><font color="white">05815</font>	            PointsInvestigation[0]=routeCache[0];
<a name="L5816"><font color="white">05816</font>	            PointsInvestigation[1]=routeCache[1];
<a name="L5817"><font color="white">05817</font>	            return true;
<a name="L5818"><font color="white">05818</font>	        }
<a name="L5819"><font color="white">05819</font>	        else if (NbPoints==3)
<a name="L5820"><font color="white">05820</font>	        {
<a name="L5821"><font color="white">05821</font>	            PointsInvestigation[0]=routeCache[0];
<a name="L5822"><font color="white">05822</font>	            PointsInvestigation[1]=routeCache[1];
<a name="L5823"><font color="white">05823</font>	            PointsInvestigation[2]=routeCache[2];
<a name="L5824"><font color="white">05824</font>	            return true;
<a name="L5825"><font color="white">05825</font>	        }
<a name="L5826"><font color="white">05826</font>	        else
<a name="L5827"><font color="white">05827</font>	        {
<a name="L5828"><font color="white">05828</font>	            PointsInvestigation[0]=routeCache[int(NbPoints*0.5)-1];
<a name="L5829"><font color="white">05829</font>	            PointsInvestigation[1]=routeCache[NbPoints-int(NbPoints*0.25)-1];
<a name="L5830"><font color="white">05830</font>	            PointsInvestigation[2]=routeCache[NbPoints-int(NbPoints*0.125)-1];
<a name="L5831"><font color="white">05831</font>	            return true;
<a name="L5832"><font color="white">05832</font>	        }
<a name="L5833"><font color="white">05833</font>	    }
<a name="L5834"><font color="white">05834</font>	    function beginstate()
<a name="L5835"><font color="white">05835</font>	    {
<a name="L5836"><font color="white">05836</font>	        //bruit d'impact et cadavre pas gere
<a name="L5837"><font color="white">05837</font>	        if (NiveauAlerte==0)
<a name="L5838"><font color="white">05838</font>	        {
<a name="L5839"><font color="white">05839</font>	            s_decAttente();
<a name="L5840"><font color="white">05840</font>	            s_incAlerte();
<a name="L5841"><font color="white">05841</font>	        }
<a name="L5842"><font color="white">05842</font>	        else if (NiveauAlerte==2)
<a name="L5843"><font color="white">05843</font>	        {
<a name="L5844"><font color="white">05844</font>	            s_incAlerte();
<a name="L5845"><font color="white">05845</font>	            s_decAttaque();
<a name="L5846"><font color="white">05846</font>	        }
<a name="L5847"><font color="white">05847</font>	        NiveauAlerte=1;
<a name="L5848"><font color="white">05848</font>	        pawn.SpineYawControl(true,3000+rand(1000),1.2+1*frand());
<a name="L5849"><font color="white">05849</font>	        settimer2(bases.TempsRechercheNMI,false);
<a name="L5850"><font color="white">05850</font>	        if (bDejaVu || bweaponnoise)
<a name="L5851"><font color="white">05851</font>	            disable('hearnoise');
<a name="L5852"><font color="white">05852</font>	        //temp_vect utilise pour calcul de position
<a name="L5853"><font color="white">05853</font>	        //btemp_bool pour savoir si y va en courant
<a name="L5854"><font color="white">05854</font>	    }
<a name="L5855"><font color="white">05855</font>	    function endstate()
<a name="L5856"><font color="white">05856</font>	    {
<a name="L5857"><font color="white">05857</font>	        pawn.SpineYawControl(false,0,0);
<a name="L5858"><font color="white">05858</font>	    }
<a name="L5859"><font color="white">05859</font>	begin:
<a name="L5860"><font color="white">05860</font>	    if (CHARGE_LES_LOGS) log(pawn@&quot;ETAT Investigation&quot;@enemy);
<a name="L5861"><font color="white">05861</font>	    if (enemy==none)
<a name="L5862"><font color="white">05862</font>	    {
<a name="L5863"><font color="white">05863</font>	        log(pawn@&quot;ENEMY==none ** ENEMY==none ** ENEMY==none ** ENEMY==none ** ENEMY==none **&quot;);
<a name="L5864"><font color="white">05864</font>			  ChangeEtat();
<a name="L5865"><font color="white">05865</font>	        //enemy=xiii;
<a name="L5866"><font color="white">05866</font>	    }
<a name="L5867"><font color="white">05867</font>	
<a name="L5868"><font color="white">05868</font>	investigation:
<a name="L5869"><font color="white">05869</font>	    if (fasttrace(enemy.location-vect(0,0,30),pawn.location-vect(0,0,30)))
<a name="L5870"><font color="white">05870</font>	    {
<a name="L5871"><font color="white">05871</font>	        // log(&quot;je vais directement vers perso&quot;);
<a name="L5872"><font color="white">05872</font>	        temp_vect=enemy.location-pawn.location;
<a name="L5873"><font color="white">05873</font>	        temp_vect=(vsize(temp_vect)*0.5)*normal(temp_vect)+pawn.location;
<a name="L5874"><font color="white">05874</font>	        if (fasttrace(temp_vect))
<a name="L5875"><font color="white">05875</font>	        {
<a name="L5876"><font color="white">05876</font>	            focus=none;
<a name="L5877"><font color="white">05877</font>	            focalpoint= 10000*(temp_vect-pawn.location)+pawn.location;
<a name="L5878"><font color="white">05878</font>	            if (vsize(temp_vect)&gt;800)
<a name="L5879"><font color="white">05879</font>	            {
<a name="L5880"><font color="white">05880</font>	                Moveto(temp_vect,none);
<a name="L5881"><font color="white">05881</font>	            }
<a name="L5882"><font color="white">05882</font>	            else
<a name="L5883"><font color="white">05883</font>	            {
<a name="L5884"><font color="white">05884</font>	                Moveto(temp_vect,none,bases.walkingspeed);
<a name="L5885"><font color="white">05885</font>	            }
<a name="L5886"><font color="white">05886</font>	            stop;
<a name="L5887"><font color="white">05887</font>	        }
<a name="L5888"><font color="white">05888</font>	    }
<a name="L5889"><font color="white">05889</font>	    else if (EnregistrePointsVersEnemy())
<a name="L5890"><font color="white">05890</font>	    {
<a name="L5891"><font color="white">05891</font>	        // log(&quot;je prend les points d'investigation&quot;);
<a name="L5892"><font color="white">05892</font>	        NombreDePointsSkippes=0;
<a name="L5893"><font color="white">05893</font>	        for (NumeroProchainPoint=0;NumeroProchainPoint&lt;3;NumeroProchainPoint++)
<a name="L5894"><font color="white">05894</font>	        {
<a name="L5895"><font color="white">05895</font>	            if (PointsInvestigation[NumeroProchainPoint]==none)
<a name="L5896"><font color="white">05896</font>	                break;
<a name="L5897"><font color="white">05897</font>	            temp_vect=enemy.location-PointsInvestigation[NumeroProchainPoint].location;
<a name="L5898"><font color="white">05898</font>	            if (vsize(temp_vect)&gt;800)      //y va en courant
<a name="L5899"><font color="white">05899</font>	                btemp_bool=true;
<a name="L5900"><font color="white">05900</font>	            else
<a name="L5901"><font color="white">05901</font>	                btemp_bool=false;
<a name="L5902"><font color="white">05902</font>	            for (temp_int=NombreDePointsSkippes;temp_int&lt;16;temp_int++)
<a name="L5903"><font color="white">05903</font>	            {
<a name="L5904"><font color="white">05904</font>	                if (btemp_bool)
<a name="L5905"><font color="white">05905</font>	                {
<a name="L5906"><font color="white">05906</font>	                    focalpoint=10000*(routecache[temp_int].location-pawn.location)+pawn.location;
<a name="L5907"><font color="white">05907</font>	                    Movetoward(routecache[temp_int],none);
<a name="L5908"><font color="white">05908</font>	                }
<a name="L5909"><font color="white">05909</font>	                else
<a name="L5910"><font color="white">05910</font>	                {
<a name="L5911"><font color="white">05911</font>	                    focalpoint=10000*(routecache[temp_int].location-pawn.location)+pawn.location;
<a name="L5912"><font color="white">05912</font>	                    Movetoward(routecache[temp_int],none,bases.walkingspeed);
<a name="L5913"><font color="white">05913</font>	                }
<a name="L5914"><font color="white">05914</font>	                sleep(1.5+frand());
<a name="L5915"><font color="white">05915</font>	                if (routecache[temp_int]==PointsInvestigation[NumeroProchainPoint])
<a name="L5916"><font color="white">05916</font>	                {
<a name="L5917"><font color="white">05917</font>	                    NombreDePointsSkippes=temp_int+1;
<a name="L5918"><font color="white">05918</font>	                    break;
<a name="L5919"><font color="white">05919</font>	                }
<a name="L5920"><font color="white">05920</font>	            }
<a name="L5921"><font color="white">05921</font>	        }
<a name="L5922"><font color="white">05922</font>	        stop;
<a name="L5923"><font color="white">05923</font>	    }
<a name="L5924"><font color="white">05924</font>	    else
<a name="L5925"><font color="white">05925</font>	    {
<a name="L5926"><font color="white">05926</font>	        if (CHARGE_LES_LOGS) log(pawn@&quot;bug trouve pas de ligne d'investigation ni reseau&quot;);
<a name="L5927"><font color="white">05927</font>	        cherchePointPourCamper();
<a name="L5928"><font color="white">05928</font>	        sleep(0.04);
<a name="L5929"><font color="white">05929</font>	        if (CHARGE_LES_LOGS) log(pawn@&quot;n'a pas trouve de safepoint&quot;);
<a name="L5930"><font color="white">05930</font>	        bCampeversSafePoint=true;
<a name="L5931"><font color="white">05931</font>	        if (!pawn.biscrouched)
<a name="L5932"><font color="white">05932</font>	            pawn.shouldcrouch(true);
<a name="L5933"><font color="white">05933</font>	        else
<a name="L5934"><font color="white">05934</font>	        {
<a name="L5935"><font color="white">05935</font>	            focus=none;
<a name="L5936"><font color="white">05936</font>	            focalpoint=10000*vector(pawn.rotation)+pawn.location;
<a name="L5937"><font color="white">05937</font>	            moveto(pawn.location-200*vector(pawn.rotation),none);
<a name="L5938"><font color="white">05938</font>	        }
<a name="L5939"><font color="white">05939</font>	        gotostate('restesurplace');
<a name="L5940"><font color="white">05940</font>	    }
<a name="L5941"><font color="white">05941</font>	ChercheSurPlace:
<a name="L5942"><font color="white">05942</font>	    Focus=enemy;
<a name="L5943"><font color="white">05943</font>	    sleep(1+frand());
<a name="L5944"><font color="white">05944</font>	    goto('investigation');
<a name="L5945"><font color="white">05945</font>	ContinueUnPeuEtAttaque:
<a name="L5946"><font color="white">05946</font>	    Focus=enemy;
<a name="L5947"><font color="white">05947</font>	    disable('SeeMonster');
<a name="L5948"><font color="white">05948</font>	    disable('SeePlayer');
<a name="L5949"><font color="white">05949</font>	    sleep(0.5);
<a name="L5950"><font color="white">05950</font>	    gotostate('attaque','initattaque');
<a name="L5951"><font color="white">05951</font>	}
<a name="L5952"><font color="white">05952</font>	
<a name="L5953"><font color="white">05953</font>	// ----------------------------------------------------------------------
<a name="L5954"><font color="white">05954</font>	//     VaVers
<a name="L5955"><font color="white">05955</font>	//
<a name="L5956"><font color="white">05956</font>	//      Se deplace vers MoveActor ou MovePoint
<a name="L5957"><font color="white">05957</font>	//
<a name="L5958"><font color="white">05958</font>	// ----------------------------------------------------------------------
<a name="L5959"><font color="white">05959</font>	
<a name="L5960"><font color="white">05960</font>	//pas de detection de cadavre
<a name="L5961"><font color="white">05961</font>	state VaVers
<a name="L5962"><font color="white">05962</font>	{
<a name="L5963"><font color="white">05963</font>	    ignores EnemyNotVisible;
<a name="L5964"><font color="white">05964</font>	
<a name="L5965"><font color="white">05965</font>	    event Tick(float DeltaTime)
<a name="L5966"><font color="white">05966</font>	    {
<a name="L5967"><font color="white">05967</font>	        global.tick(DeltaTime);
<a name="L5968"><font color="white">05968</font>	        if (bFuitPourreloader &amp;&amp; (level.timeseconds-Timer_VaRecharger)&gt;1.5)
<a name="L5969"><font color="white">05969</font>	        {
<a name="L5970"><font color="white">05970</font>	            bFuitPourreloader=false;
<a name="L5971"><font color="white">05971</font>	            gotostate('attaque');
<a name="L5972"><font color="white">05972</font>	        }
<a name="L5973"><font color="white">05973</font>	    }
<a name="L5974"><font color="white">05974</font>		 event Seeplayer(pawn other)
<a name="L5975"><font color="white">05975</font>	    {
<a name="L5976"><font color="white">05976</font>				if (!bDejaVu &amp;&amp; enemy!=none &amp;&amp; enemy==other)
<a name="L5977"><font color="white">05977</font>	            	SeeEnemy();
<a name="L5978"><font color="white">05978</font>				else
<a name="L5979"><font color="white">05979</font>					setenemy(XIII);
<a name="L5980"><font color="white">05980</font>	    }
<a name="L5981"><font color="white">05981</font>	    event SeeMonster(pawn other)
<a name="L5982"><font color="white">05982</font>	    {
<a name="L5983"><font color="white">05983</font>	        if (!bDejaVu &amp;&amp; enemy!=none &amp;&amp; enemy==other)
<a name="L5984"><font color="white">05984</font>	            	SeeEnemy();
<a name="L5985"><font color="white">05985</font>			  else
<a name="L5986"><font color="white">05986</font>					setenemy(other);
<a name="L5987"><font color="white">05987</font>	    }
<a name="L5988"><font color="white">05988</font>	    event EnemyAcquired()
<a name="L5989"><font color="white">05989</font>	    {
<a name="L5990"><font color="white">05990</font>	        bDejaVu=true;
<a name="L5991"><font color="white">05991</font>	        bVaVersAlarme=false;
<a name="L5992"><font color="white">05992</font>	        bPotePaffe=false;
<a name="L5993"><font color="white">05993</font>	        bWeaponNoise=false;
<a name="L5994"><font color="white">05994</font>	        bFuitPourReloader=false;
<a name="L5995"><font color="white">05995</font>	        if (enemy==XIII) TriggerEvent('XIIIVu', Self, pawn);  //trigger vu
<a name="L5996"><font color="white">05996</font>			  if (bAlarmeInstigator &amp;&amp; ((pawn.location-enemy.location) dot (MoveActor.MoveActor.location-pawn.location)&gt;0) &amp;&amp; Vsize(enemy.location-MoveActor.MoveActor.location)&gt;250)
<a name="L5997"><font color="white">05997</font>	                return;
<a name="L5998"><font color="white">05998</font>			  bAdvancedTactics=false;
<a name="L5999"><font color="white">05999</font>	        Gotostate('Vavers','ContinueUnPeuEtAttaque');
<a name="L6000"><font color="white">06000</font>	    }
<a name="L6001"><font color="white">06001</font>	    event Trigger(actor Other, pawn EventInstigator)
<a name="L6002"><font color="white">06002</font>	    {
<a name="L6003"><font color="white">06003</font>	    }
<a name="L6004"><font color="white">06004</font>	    event UpdateTactics()
<a name="L6005"><font color="white">06005</font>	    {
<a name="L6006"><font color="white">06006</font>	        // ennemi devant l'alarme donc repasse en attaque
<a name="L6007"><font color="white">06007</font>	        if (bDejaVu &amp;&amp; normal(pawn.location-enemy.location) dot normal(MoveActor.MoveActor.location-enemy.location)&lt;-0.2)
<a name="L6008"><font color="white">06008</font>	        {
<a name="L6009"><font color="white">06009</font>	            bAdvancedTactics=false;
<a name="L6010"><font color="white">06010</font>	            bVaVersAlarme=false;
<a name="L6011"><font color="white">06011</font>	            genalerte.PoteTargetAlarme(false,MoveActor.MoveActor.tag);
<a name="L6012"><font color="white">06012</font>	            gotostate('attaque');
<a name="L6013"><font color="white">06013</font>	            return;
<a name="L6014"><font color="white">06014</font>	        }
<a name="L6015"><font color="white">06015</font>	    }
<a name="L6016"><font color="white">06016</font>	    event hearnoise(float loudness,actor NoiseMaker)
<a name="L6017"><font color="white">06017</font>	    {
<a name="L6018"><font color="white">06018</font>	        ActualiseSon(NoiseMaker);
<a name="L6019"><font color="white">06019</font>	    }
<a name="L6020"><font color="white">06020</font>	    function ActualiseSon(actor son)
<a name="L6021"><font color="white">06021</font>	    {
<a name="L6022"><font color="white">06022</font>			  if (son.instigator!=none &amp;&amp; son.instigator.controller!=none &amp;&amp; son.instigator.controller.isa('CineController2'))
<a name="L6023"><font color="white">06023</font>				  return;
<a name="L6024"><font color="white">06024</font>	        //bruit d'arme prioritaire sur bruitpas
<a name="L6025"><font color="white">06025</font>	        if (weapon(son)!=none || XIIIProjectile(son)!=none)
<a name="L6026"><font color="white">06026</font>	        {
<a name="L6027"><font color="white">06027</font>	            bPotePaffe=false;
<a name="L6028"><font color="white">06028</font>	            bWeaponNoise=true;
<a name="L6029"><font color="white">06029</font>	            if (alliancelevel(son.instigator)==1) //pote donc prend son enemy
<a name="L6030"><font color="white">06030</font>	            {
<a name="L6031"><font color="white">06031</font>	                enemy=son.instigator.controller.enemy;
<a name="L6032"><font color="white">06032</font>	                instigator=son.instigator;
<a name="L6033"><font color="white">06033</font>	            }
<a name="L6034"><font color="white">06034</font>	            else
<a name="L6035"><font color="white">06035</font>	            {
<a name="L6036"><font color="white">06036</font>	                enemy=son.instigator;
<a name="L6037"><font color="white">06037</font>	                instigator=enemy;
<a name="L6038"><font color="white">06038</font>	            }
<a name="L6039"><font color="white">06039</font>	            bFuitPourReloader=false;
<a name="L6040"><font color="white">06040</font>	            gotostate('acquisition','BruitArme');
<a name="L6041"><font color="white">06041</font>	        }
<a name="L6042"><font color="white">06042</font>	    }
<a name="L6043"><font color="white">06043</font>	    function beginstate()
<a name="L6044"><font color="white">06044</font>	    {
<a name="L6045"><font color="white">06045</font>	        //bruit de pas et d'impact pas gere (pas de deplacement)
<a name="L6046"><font color="white">06046</font>	        //paf et cadavre pas gere (pas de deplacement)
<a name="L6047"><font color="white">06047</font>	        if (!bPotePaffe)
<a name="L6048"><font color="white">06048</font>	        {
<a name="L6049"><font color="white">06049</font>	            disable('hearnoise');
<a name="L6050"><font color="white">06050</font>	            if (!bWeaponNoise)
<a name="L6051"><font color="white">06051</font>	            {
<a name="L6052"><font color="white">06052</font>	                if (bDejaVu)
<a name="L6053"><font color="white">06053</font>	                {
<a name="L6054"><font color="white">06054</font>	                    disable('SeeMonster');
<a name="L6055"><font color="white">06055</font>	                    disable('SeePlayer');
<a name="L6056"><font color="white">06056</font>	                }
<a name="L6057"><font color="white">06057</font>	            }
<a name="L6058"><font color="white">06058</font>	        }
<a name="L6059"><font color="white">06059</font>			if (CHARGE_LES_LOGS) log(pawn@&quot;ETAT VaVers&quot;@MoveActor.MoveActor@MovePoint.MovePoint@enemy);
<a name="L6060"><font color="white">06060</font>	        //bpotepaffe ne sont appele que si etat neutre donc
<a name="L6061"><font color="white">06061</font>	        //a priori bdejavu=false
<a name="L6062"><font color="white">06062</font>	        //bCampeVersSafePoint declenche que si pas vu donc a priori bdejavu=false
<a name="L6063"><font color="white">06063</font>	        if (bDejaVu)
<a name="L6064"><font color="white">06064</font>	        {
<a name="L6065"><font color="white">06065</font>	            if (NiveauAlerte==0)
<a name="L6066"><font color="white">06066</font>	            {
<a name="L6067"><font color="white">06067</font>	                s_decAttente();
<a name="L6068"><font color="white">06068</font>	                s_incAttaque();
<a name="L6069"><font color="white">06069</font>	            }
<a name="L6070"><font color="white">06070</font>	            else if (NiveauAlerte==1)
<a name="L6071"><font color="white">06071</font>	            {
<a name="L6072"><font color="white">06072</font>	                s_decAlerte();
<a name="L6073"><font color="white">06073</font>	                s_incAttaque();
<a name="L6074"><font color="white">06074</font>	            }
<a name="L6075"><font color="white">06075</font>	            NiveauAlerte=2;
<a name="L6076"><font color="white">06076</font>	        }
<a name="L6077"><font color="white">06077</font>	        else
<a name="L6078"><font color="white">06078</font>	        {
<a name="L6079"><font color="white">06079</font>	            if (NiveauAlerte==0)
<a name="L6080"><font color="white">06080</font>	            {
<a name="L6081"><font color="white">06081</font>	                s_decAttente();
<a name="L6082"><font color="white">06082</font>	                s_incAlerte();
<a name="L6083"><font color="white">06083</font>	            }
<a name="L6084"><font color="white">06084</font>	            else if (NiveauAlerte==2)
<a name="L6085"><font color="white">06085</font>	            {
<a name="L6086"><font color="white">06086</font>	                s_incAlerte();
<a name="L6087"><font color="white">06087</font>	                s_decAttaque();
<a name="L6088"><font color="white">06088</font>	            }
<a name="L6089"><font color="white">06089</font>	            NiveauAlerte=1;
<a name="L6090"><font color="white">06090</font>	        }
<a name="L6091"><font color="white">06091</font>	        pawn.rotationrate.yaw=46000;
<a name="L6092"><font color="white">06092</font>	        //temp_float //utilise pour temps d retournement
<a name="L6093"><font color="white">06093</font>	        //bDisableEventSeeDeadPawn=true;
<a name="L6094"><font color="white">06094</font>	    }
<a name="L6095"><font color="white">06095</font>		function endstate()
<a name="L6096"><font color="white">06096</font>		{
<a name="L6097"><font color="white">06097</font>			local int i;
<a name="L6098"><font color="white">06098</font>			//Pawn.bAvoidLedges = false;
<a name="L6099"><font color="white">06099</font>			if (EtatNeutre == 'tenir' &amp;&amp; bVaVersAlarme)
<a name="L6100"><font color="white">06100</font>			{
<a name="L6101"><font color="white">06101</font>			   focalpoint=-1000*vector(pawn.rotation)+pawn.location;
<a name="L6102"><font color="white">06102</font>			}
<a name="L6103"><font color="white">06103</font>			if (bAlarmeInstigator &amp;&amp; Porteouverte==none)
<a name="L6104"><font color="white">06104</font>			{
<a name="L6105"><font color="white">06105</font>				bAlarmeInstigator=false;
<a name="L6106"><font color="white">06106</font>			   if (triggeralarme(MoveActor.MoveActor)!=none)
<a name="L6107"><font color="white">06107</font>			      genalerte.PoteTargetAlarme(false,MoveActor.MoveActor.tag);
<a name="L6108"><font color="white">06108</font>			}
<a name="L6109"><font color="white">06109</font>			if (bInterruptStateToOpenDoor &amp;&amp; icompteur&lt;nbpointchemin)   //remise a jour du reseau avant de passer en ouverture de porte
<a name="L6110"><font color="white">06110</font>			{
<a name="L6111"><font color="white">06111</font>				nbpointchemin-=icompteur;
<a name="L6112"><font color="white">06112</font>				for (i=0;i&lt;nbpointchemin;i++)
<a name="L6113"><font color="white">06113</font>				{
<a name="L6114"><font color="white">06114</font>					PointChemin[i]=PointChemin[icompteur+i];
<a name="L6115"><font color="white">06115</font>				}
<a name="L6116"><font color="white">06116</font>			}
<a name="L6117"><font color="white">06117</font>			if (bControlAnimations) bases.ReleaseAnimControl();
<a name="L6118"><font color="white">06118</font>		}
<a name="L6119"><font color="white">06119</font>	initalarme:
<a name="L6120"><font color="white">06120</font>	    //log(pawn@&quot;initalrame&quot;);
<a name="L6121"><font color="white">06121</font>	    if (bAlarmeInstigator)
<a name="L6122"><font color="white">06122</font>	    {
<a name="L6123"><font color="white">06123</font>	   	  TriggerEvent('CoursVersAlarme', Self, pawn);  //trigger de debut de course vers alarme
<a name="L6124"><font color="white">06124</font>	        if (triggeralarme(MoveActor.MoveActor)==none)
<a name="L6125"><font color="white">06125</font>	            log(pawn@&quot;BUGGGGGGGGGGGGGGGGGGGGG  !!!!!!!!!!!!!!!!!!!!!!!!!!! ALARME&quot;);
<a name="L6126"><font color="white">06126</font>	        focus=xiii;
<a name="L6127"><font color="white">06127</font>	        sleep(1.8);  //petit temps de latence avant de declencher l'alarme
<a name="L6128"><font color="white">06128</font>	        badvancedtactics=true;
<a name="L6129"><font color="white">06129</font>	    }
<a name="L6130"><font color="white">06130</font>	    //ca de vavers: cadavre, bruit pas, bruit arme, alarme, pote en fight, pote paffe
<a name="L6131"><font color="white">06131</font>	begin:
<a name="L6132"><font color="white">06132</font>	
<a name="L6133"><font color="white">06133</font>	Deplacement:
<a name="L6134"><font color="white">06134</font>	  // log(pawn@&quot;Deplacement&quot;@MoveActor.MoveActor@MoveActor.bReachable);
<a name="L6135"><font color="white">06135</font>	    if (MoveActor.MoveActor!=none)
<a name="L6136"><font color="white">06136</font>	    {
<a name="L6137"><font color="white">06137</font>	        If (MoveActor.bReachable)
<a name="L6138"><font color="white">06138</font>	        {
<a name="L6139"><font color="white">06139</font>	            focus=none;
<a name="L6140"><font color="white">06140</font>	            focalpoint=10000*(MoveActor.MoveActor.location-pawn.location)+pawn.location;
<a name="L6141"><font color="white">06141</font>	            Temp_float=normal(MoveActor.MoveActor.location-pawn.location) dot normal(vector(pawn.rotation));
<a name="L6142"><font color="white">06142</font>	            sleep(8000*(1-Temp_float)/pawn.rotationrate.yaw);
<a name="L6143"><font color="white">06143</font>	            MoveToward(MoveActor.MoveActor,none);
<a name="L6144"><font color="white">06144</font>	        }
<a name="L6145"><font color="white">06145</font>	        else
<a name="L6146"><font color="white">06146</font>	        {
<a name="L6147"><font color="white">06147</font>	            for (iCompteur=0;iCompteur&lt;NbPointChemin;iCompteur++)
<a name="L6148"><font color="white">06148</font>	            {
<a name="L6149"><font color="white">06149</font>	                focus=none;
<a name="L6150"><font color="white">06150</font>	                focalpoint=PointChemin[iCompteur].location;
<a name="L6151"><font color="white">06151</font>	                Movetoward(PointChemin[iCompteur],none);
<a name="L6152"><font color="white">06152</font>	            }
<a name="L6153"><font color="white">06153</font>	        }
<a name="L6154"><font color="white">06154</font>	    }
<a name="L6155"><font color="white">06155</font>	    else
<a name="L6156"><font color="white">06156</font>	    {
<a name="L6157"><font color="white">06157</font>	        If (MovePoint.bTraceable)
<a name="L6158"><font color="white">06158</font>	        {
<a name="L6159"><font color="white">06159</font>	            focus=none;
<a name="L6160"><font color="white">06160</font>	            focalpoint=MovePoint.MovePoint+pawn.location;
<a name="L6161"><font color="white">06161</font>	            Temp_float=normal(MovePoint.MovePoint-pawn.location) dot normal(vector(pawn.rotation));
<a name="L6162"><font color="white">06162</font>	            sleep(8000*(1-Temp_float)/pawn.rotationrate.yaw);
<a name="L6163"><font color="white">06163</font>	            MoveTo(MovePoint.MovePoint,none);
<a name="L6164"><font color="white">06164</font>	        }
<a name="L6165"><font color="white">06165</font>	        else
<a name="L6166"><font color="white">06166</font>	        {
<a name="L6167"><font color="white">06167</font>	            for (iCompteur=0;iCompteur&lt;NbPointChemin;iCompteur++)
<a name="L6168"><font color="white">06168</font>	            {
<a name="L6169"><font color="white">06169</font>	                focus=none;
<a name="L6170"><font color="white">06170</font>	                focalpoint=10000*(PointChemin[iCompteur].location-pawn.location)+pawn.location;
<a name="L6171"><font color="white">06171</font>	                Moveto(PointChemin[iCompteur].location,none);
<a name="L6172"><font color="white">06172</font>	            }
<a name="L6173"><font color="white">06173</font>	            focus=none;
<a name="L6174"><font color="white">06174</font>	            focalpoint=10000*(MovePoint.movepoint-pawn.location)+pawn.location;
<a name="L6175"><font color="white">06175</font>	            Moveto(MovePoint.movepoint,none);
<a name="L6176"><font color="white">06176</font>	        }
<a name="L6177"><font color="white">06177</font>	    }
<a name="L6178"><font color="white">06178</font>	    if (bAlarmeInstigator)
<a name="L6179"><font color="white">06179</font>	    {
<a name="L6180"><font color="white">06180</font>	        if (Vsize(MoveActor.MoveActor.location-pawn.location)&lt;4*pawn.collisionradius)
<a name="L6181"><font color="white">06181</font>			  {
<a name="L6182"><font color="white">06182</font>					badvancedtactics=false;
<a name="L6183"><font color="white">06183</font>	        		goto('declenchealarme');
<a name="L6184"><font color="white">06184</font>				}
<a name="L6185"><font color="white">06185</font>				else   //crampe
<a name="L6186"><font color="white">06186</font>				{
<a name="L6187"><font color="white">06187</font>	            bALarmeInstigator=false;
<a name="L6188"><font color="white">06188</font>	            bVaVersAlarme=false;
<a name="L6189"><font color="white">06189</font>	            genalerte.PoteTargetAlarme(false,MoveActor.MoveActor.tag);
<a name="L6190"><font color="white">06190</font>				}
<a name="L6191"><font color="white">06191</font>	    }
<a name="L6192"><font color="white">06192</font>	    //si dernier point safepoint alors on s'oriente
<a name="L6193"><font color="white">06193</font>	    if (SAFEPOINT(MoveActor.MoveActor)!=none &amp;&amp; SAFEPOINT(MoveActor.MoveActor).baccroupi)
<a name="L6194"><font color="white">06194</font>	    {
<a name="L6195"><font color="white">06195</font>	        pawn.shouldcrouch(true);
<a name="L6196"><font color="white">06196</font>	    }
<a name="L6197"><font color="white">06197</font>	    if (nextstate=='')
<a name="L6198"><font color="white">06198</font>	        log(pawn@&quot; ALAAAAAAAAAAAAAAAAAAARME GROS BUG&quot;);
<a name="L6199"><font color="white">06199</font>	
<a name="L6200"><font color="white">06200</font>	    Gotostate(nextstate);
<a name="L6201"><font color="white">06201</font>	ContinueUnPeuEtAttaque:
<a name="L6202"><font color="white">06202</font>	    //log(pawn@&quot;ContinueUnPeuEtAttaque&quot;);
<a name="L6203"><font color="white">06203</font>	    Focus=enemy;
<a name="L6204"><font color="white">06204</font>	    pawn.velocity=vect(0,0,0);
<a name="L6205"><font color="white">06205</font>	    pawn.acceleration=vect(0,0,0);
<a name="L6206"><font color="white">06206</font>	    disable('SeeMonster');
<a name="L6207"><font color="white">06207</font>	    disable('SeePlayer');
<a name="L6208"><font color="white">06208</font>	    sleep(0.5);
<a name="L6209"><font color="white">06209</font>	    gotostate('attaque','initattaque');
<a name="L6210"><font color="white">06210</font>	Declenchealarme:
<a name="L6211"><font color="white">06211</font>		//log(&quot;delcelcnhe alarme&quot;);
<a name="L6212"><font color="white">06212</font>		 Bases.takeanimcontrol(false);
<a name="L6213"><font color="white">06213</font>		 bases.PlayManip();
<a name="L6214"><font color="white">06214</font>	    pawn.velocity=vect(0,0,0);
<a name="L6215"><font color="white">06215</font>	    pawn.acceleration=vect(0,0,0);
<a name="L6216"><font color="white">06216</font>	    sleep(TempsDeclencheAlarme*0.3);
<a name="L6217"><font color="white">06217</font>		 Bases.bBlockNextOuahOuah=true;
<a name="L6218"><font color="white">06218</font>		 pawn.PlaySndPNJOno(pnjono'Onomatopees.hPNJAlert',bases.CodeMesh,bases.NumeroTimbre);
<a name="L6219"><font color="white">06219</font>		 sleep(TempsDeclencheAlarme*0.7);
<a name="L6220"><font color="white">06220</font>		 Bases.releaseanimcontrol(false);
<a name="L6221"><font color="white">06221</font>		 sleep(0.1);
<a name="L6222"><font color="white">06222</font>		 bcontrolanimations=false; //relache anim quand finie
<a name="L6223"><font color="white">06223</font>	    TriggerEvent('FinCourseVersAlarme', Self, pawn);  //fin de course vers alarme
<a name="L6224"><font color="white">06224</font>	    genalerte.PoteDeclencheAlarme(pawn,triggeralarme(MoveActor.MoveActor));
<a name="L6225"><font color="white">06225</font>	    sleep(0.5);
<a name="L6226"><font color="white">06226</font>	    /*if (EtatNeutre == 'tenir')
<a name="L6227"><font color="white">06227</font>	    {
<a name="L6228"><font color="white">06228</font>	    PointTenirPos=pawn.location;
<a name="L6229"><font color="white">06229</font>	    PointTenirRot=pawn.rotation;
<a name="L6230"><font color="white">06230</font>	     } */
<a name="L6231"><font color="white">06231</font>	    Gotostate(nextstate);
<a name="L6232"><font color="white">06232</font>	}
<a name="L6233"><font color="white">06233</font>	
<a name="L6234"><font color="white">06234</font>	// ----------------------------------------------------------------------
<a name="L6235"><font color="white">06235</font>	//Etat OuvrePorte
<a name="L6236"><font color="white">06236</font>	//
<a name="L6237"><font color="white">06237</font>	// Si a un enemy et le voit repasse direct en attaque
<a name="L6238"><font color="white">06238</font>	// ----------------------------------------------------------------------
<a name="L6239"><font color="white">06239</font>	state OuvrePorte
<a name="L6240"><font color="white">06240</font>	{
<a name="L6241"><font color="white">06241</font>	    ignores EnemyNotVisible;
<a name="L6242"><font color="white">06242</font>	
<a name="L6243"><font color="white">06243</font>		event SeePlayer (pawn other)
<a name="L6244"><font color="white">06244</font>	   {
<a name="L6245"><font color="white">06245</font>	      if (enemy!=none &amp;&amp; enemy==other)
<a name="L6246"><font color="white">06246</font>			{
<a name="L6247"><font color="white">06247</font>				bDejaVu=true;
<a name="L6248"><font color="white">06248</font>	        	SeeEnemy();
<a name="L6249"><font color="white">06249</font>			}
<a name="L6250"><font color="white">06250</font>			else
<a name="L6251"><font color="white">06251</font>			{
<a name="L6252"><font color="white">06252</font>				if (setenemy(XIII))
<a name="L6253"><font color="white">06253</font>					bdejavu=true;
<a name="L6254"><font color="white">06254</font>			}
<a name="L6255"><font color="white">06255</font>	   }
<a name="L6256"><font color="white">06256</font>	   event SeeMonster(pawn other)
<a name="L6257"><font color="white">06257</font>	   {
<a name="L6258"><font color="white">06258</font>			if (enemy!=none &amp;&amp; enemy==other)
<a name="L6259"><font color="white">06259</font>			{
<a name="L6260"><font color="white">06260</font>				bDejaVu=true;
<a name="L6261"><font color="white">06261</font>	        	SeeEnemy();
<a name="L6262"><font color="white">06262</font>			}
<a name="L6263"><font color="white">06263</font>			else
<a name="L6264"><font color="white">06264</font>			{
<a name="L6265"><font color="white">06265</font>				if (setenemy(other))
<a name="L6266"><font color="white">06266</font>					bdejavu=true;
<a name="L6267"><font color="white">06267</font>			}
<a name="L6268"><font color="white">06268</font>	    }
<a name="L6269"><font color="white">06269</font>	    event EnemyAcquired()
<a name="L6270"><font color="white">06270</font>	    {
<a name="L6271"><font color="white">06271</font>	        if (niveaualerte&lt;2)
<a name="L6272"><font color="white">06272</font>	            gotostate('acquisition');
<a name="L6273"><font color="white">06273</font>	         else if (!balarmeinstigator)
<a name="L6274"><font color="white">06274</font>			   {
<a name="L6275"><font color="white">06275</font>					if (prevstate=='attaquescriptee')
<a name="L6276"><font color="white">06276</font>					{
<a name="L6277"><font color="white">06277</font>						if (movetarget!=none)  //reprend reseau vers attackpoint
<a name="L6278"><font color="white">06278</font>						{
<a name="L6279"><font color="white">06279</font>							NextRouteCachePoint=iCompteur;
<a name="L6280"><font color="white">06280</font>							gotostate('attaquescriptee','RepriseVaVersAttackPoint');
<a name="L6281"><font color="white">06281</font>						}
<a name="L6282"><font color="white">06282</font>						else ///y va directement
<a name="L6283"><font color="white">06283</font>							gotostate('attaquescriptee','VaVersAttackPoint');
<a name="L6284"><font color="white">06284</font>					}
<a name="L6285"><font color="white">06285</font>					else
<a name="L6286"><font color="white">06286</font>					{
<a name="L6287"><font color="white">06287</font>				      gotostate('attaque','initattaque');
<a name="L6288"><font color="white">06288</font>					}
<a name="L6289"><font color="white">06289</font>				}
<a name="L6290"><font color="white">06290</font>	    }
<a name="L6291"><font color="white">06291</font>	    singular event bool notifybump(actor other)
<a name="L6292"><font color="white">06292</font>	    {
<a name="L6293"><font color="white">06293</font>	        if (XIIIporte(other)!=none &amp;&amp; porteouverte!=other)
<a name="L6294"><font color="white">06294</font>	        {
<a name="L6295"><font color="white">06295</font>	            porteouverte=XIIIporte(other);
<a name="L6296"><font color="white">06296</font>	            gotostate('ouvreporte','opendoor');
<a name="L6297"><font color="white">06297</font>	            return true;
<a name="L6298"><font color="white">06298</font>	        }
<a name="L6299"><font color="white">06299</font>	        else
<a name="L6300"><font color="white">06300</font>	            return false;
<a name="L6301"><font color="white">06301</font>	    }
<a name="L6302"><font color="white">06302</font>	    event HearNoise(float Loudness, Actor NoiseMaker)
<a name="L6303"><font color="white">06303</font>	    {
<a name="L6304"><font color="white">06304</font>	        if (TestSonEntendu(NoiseMaker))
<a name="L6305"><font color="white">06305</font>	            enemyacquired();
<a name="L6306"><font color="white">06306</font>	    }
<a name="L6307"><font color="white">06307</font>	
<a name="L6308"><font color="white">06308</font>	    event Trigger(actor Other, pawn EventInstigator)
<a name="L6309"><font color="white">06309</font>	    {
<a name="L6310"><font color="white">06310</font>	    }
<a name="L6311"><font color="white">06311</font>	
<a name="L6312"><font color="white">06312</font>	    singular function DamageAttitudeTo(pawn Other, float Damage)
<a name="L6313"><font color="white">06313</font>	    {
<a name="L6314"><font color="white">06314</font>	        //son
<a name="L6315"><font color="white">06315</font>	        bases.PlaySndPNJOno(pnjono'Onomatopees.hPNJHurt',bases.CodeMesh,bases.NumeroTimbre);
<a name="L6316"><font color="white">06316</font>	        if (setenemy(other))
<a name="L6317"><font color="white">06317</font>	        {
<a name="L6318"><font color="white">06318</font>	            //genalerte.potepaffe(pawn);
<a name="L6319"><font color="white">06319</font>	            bPaffe=true;
<a name="L6320"><font color="white">06320</font>	        }
<a name="L6321"><font color="white">06321</font>	    }
<a name="L6322"><font color="white">06322</font>	    function beginstate()
<a name="L6323"><font color="white">06323</font>	    {
<a name="L6324"><font color="white">06324</font>			 if (CHARGE_LES_LOGS) log(pawn@&quot;ETAT ouvre porte&quot;@enemy);
<a name="L6325"><font color="white">06325</font>	       //NiveauAlerte=0; GARDE NIVEAU PRECEDENT
<a name="L6326"><font color="white">06326</font>	        if (niveauAlerte&gt;0)
<a name="L6327"><font color="white">06327</font>	        {
<a name="L6328"><font color="white">06328</font>	            disable('hearnoise');
<a name="L6329"><font color="white">06329</font>	        }
<a name="L6330"><font color="white">06330</font>	        SetTimer(0,false);
<a name="L6331"><font color="white">06331</font>	        //Var Temp
<a name="L6332"><font color="white">06332</font>	        result=false; //savoir si pas de recul deja fait
<a name="L6333"><font color="white">06333</font>	        btemp_bool=false; //utilise pour ne pas lancer 2 fois anim ouverture apre recalage
<a name="L6334"><font color="white">06334</font>	        DoorP=none; //utilise pour savoir si les doorpoints sont bons
<a name="L6335"><font color="white">06335</font>	        if (porteouverte.DoorPoint1!=none &amp;&amp; porteouverte.doorPoint2!=none) //prend doorpoint1 comme point destination
<a name="L6336"><font color="white">06336</font>	        {
<a name="L6337"><font color="white">06337</font>				//	log(porteouverte.DoorPoint1@porteouverte.DoorPoint2);
<a name="L6338"><font color="white">06338</font>	            DoorP=porteouverte.DoorPoint2;
<a name="L6339"><font color="white">06339</font>	            if ((porteouverte.DoorPoint2.location-porteouverte.DoorPoint1.location) dot vector(pawn.rotation)&gt;0)
<a name="L6340"><font color="white">06340</font>	            {
<a name="L6341"><font color="white">06341</font>	                porteouverte.DoorPoint2=porteouverte.DoorPoint1;
<a name="L6342"><font color="white">06342</font>	                porteouverte.DoorPoint1=doorpoint(DoorP);
<a name="L6343"><font color="white">06343</font>	            }
<a name="L6344"><font color="white">06344</font>				//	log(porteouverte.DoorPoint1@porteouverte.DoorPoint2);
<a name="L6345"><font color="white">06345</font>	        }
<a name="L6346"><font color="white">06346</font>	        //bDisableEventSeeDeadPawn=true;
<a name="L6347"><font color="white">06347</font>	    }
<a name="L6348"><font color="white">06348</font>	    function Endstate()
<a name="L6349"><font color="white">06349</font>	    {
<a name="L6350"><font color="white">06350</font>	        /*if (!bWaitForMover)
<a name="L6351"><font color="white">06351</font>	            Porteouverte.delaytime-=0.8;*/
<a name="L6352"><font color="white">06352</font>	        bWaitForMover=false;
<a name="L6353"><font color="white">06353</font>	        Porteouverte=none;
<a name="L6354"><font color="white">06354</font>			  if (bControlAnimations) bases.ReleaseAnimControl(true);
<a name="L6355"><font color="white">06355</font>	    }
<a name="L6356"><font color="white">06356</font>	begin:
<a name="L6357"><font color="white">06357</font>	    pawn.velocity=vect(0,0,0);
<a name="L6358"><font color="white">06358</font>	    pawn.Acceleration = vect(0, 0, 0);
<a name="L6359"><font color="white">06359</font>	    if (Porteouverte.bAlertIfSeenOpen)
<a name="L6360"><font color="white">06360</font>	        Porteouverte.bWarnSoldiers=false;
<a name="L6361"><font color="white">06361</font>	opendoor:
<a name="L6362"><font color="white">06362</font>	    //log(pawn@&quot;opendoor&quot;@PorteOuverte.bOpened);
<a name="L6363"><font color="white">06363</font>	    if (!btemp_bool)
<a name="L6364"><font color="white">06364</font>	    {
<a name="L6365"><font color="white">06365</font>	        bases.PlayOpenDoor();
<a name="L6366"><font color="white">06366</font>	        sleep(PorteOuverte.MoveTime+0.02+PorteOuverte.delaytime); //temps anims d'ouverture de porte
<a name="L6367"><font color="white">06367</font>			  bases.ReleaseAnimControl(true);
<a name="L6368"><font color="white">06368</font>	    }
<a name="L6369"><font color="white">06369</font>	    //DBUG    si le animend n'a pas bien ete appele
<a name="L6370"><font color="white">06370</font>	    if (PorteOuverte.bOpened)
<a name="L6371"><font color="white">06371</font>	    {
<a name="L6372"><font color="white">06372</font>	        result=false;
<a name="L6373"><font color="white">06373</font>	        goto('passagePorte');
<a name="L6374"><font color="white">06374</font>	    }
<a name="L6375"><font color="white">06375</font>	    else if (PorteOuverte.bClosed)
<a name="L6376"><font color="white">06376</font>	    {
<a name="L6377"><font color="white">06377</font>	        result=false;
<a name="L6378"><font color="white">06378</font>	        goto('RetourPatrouille');
<a name="L6379"><font color="white">06379</font>	    }
<a name="L6380"><font color="white">06380</font>	    //sinon  se recale sur doorpoint precedetn si en cours fermeture ou ouverture
<a name="L6381"><font color="white">06381</font>	
<a name="L6382"><font color="white">06382</font>	PasEnArriere:
<a name="L6383"><font color="white">06383</font>	    //log(pawn@&quot;pas en arriere&quot;);
<a name="L6384"><font color="white">06384</font>	    if (result)
<a name="L6385"><font color="white">06385</font>	    {
<a name="L6386"><font color="white">06386</font>			  bases.balerte=true;
<a name="L6387"><font color="white">06387</font>	        SetVigilant(true);
<a name="L6388"><font color="white">06388</font>	        bEtatAlerte=true;
<a name="L6389"><font color="white">06389</font>			  if (enemy==none)
<a name="L6390"><font color="white">06390</font>			  {
<a name="L6391"><font color="white">06391</font>				  gotostate('tenir');
<a name="L6392"><font color="white">06392</font>			  }
<a name="L6393"><font color="white">06393</font>			  else
<a name="L6394"><font color="white">06394</font>	        	  gotostate('restesurplace');
<a name="L6395"><font color="white">06395</font>	    }
<a name="L6396"><font color="white">06396</font>	    result=true;
<a name="L6397"><font color="white">06397</font>	    if (DoorP!=none) //seulement si doorpoints existent
<a name="L6398"><font color="white">06398</font>	    {
<a name="L6399"><font color="white">06399</font>	       moveto((porteouverte.DoorPoint2.location-pawn.location)+4*collisionradius*normal(porteouverte.DoorPoint2.location-pawn.location)+pawn.location,porteouverte.DoorPoint1,bases.WalkingSpeed);
<a name="L6400"><font color="white">06400</font>	    }
<a name="L6401"><font color="white">06401</font>	    else
<a name="L6402"><font color="white">06402</font>	    {
<a name="L6403"><font color="white">06403</font>	        focus=none;
<a name="L6404"><font color="white">06404</font>	        focalpoint=1000*vector(bases.rotation)+pawn.location;
<a name="L6405"><font color="white">06405</font>	        MoveTo(200*vector(bases.rotation)*vect(-1,0,0) +      pawn.location,none,bases.walkingspeed);
<a name="L6406"><font color="white">06406</font>	    }
<a name="L6407"><font color="white">06407</font>	    btemp_bool=true;
<a name="L6408"><font color="white">06408</font>	    goto('opendoor');
<a name="L6409"><font color="white">06409</font>	PassagePorte:
<a name="L6410"><font color="white">06410</font>	   // log(pawn@&quot;passage porte&quot;);
<a name="L6411"><font color="white">06411</font>	    if (DoorP!=none) //seulement si doorpoints existent
<a name="L6412"><font color="white">06412</font>	    {
<a name="L6413"><font color="white">06413</font>			 focalpoint=10000*(porteouverte.DoorPoint1.location-pawn.location)+pawn.location;
<a name="L6414"><font color="white">06414</font>	        if (niveaualerte==0)
<a name="L6415"><font color="white">06415</font>	            moveto((porteouverte.DoorPoint1.location-pawn.location)+4*collisionradius*normal(porteouverte.DoorPoint1.location-pawn.location)+pawn.location,none,bases.WalkingSpeed);
<a name="L6416"><font color="white">06416</font>	        else
<a name="L6417"><font color="white">06417</font>	            moveto((porteouverte.DoorPoint1.location-pawn.location)+4*collisionradius*normal(porteouverte.DoorPoint1.location-pawn.location)+pawn.location,none);
<a name="L6418"><font color="white">06418</font>	        if (vsize(pawn.location-porteouverte.DoorPoint1.location)&gt;78)
<a name="L6419"><font color="white">06419</font>	        {
<a name="L6420"><font color="white">06420</font>	            //log(&quot;bloque dans la porte&quot;);
<a name="L6421"><font color="white">06421</font>	            goto('pasenarriere');
<a name="L6422"><font color="white">06422</font>	        }
<a name="L6423"><font color="white">06423</font>	    }
<a name="L6424"><font color="white">06424</font>	    else
<a name="L6425"><font color="white">06425</font>	    {
<a name="L6426"><font color="white">06426</font>	        focus=none;
<a name="L6427"><font color="white">06427</font>	        focalpoint=1000*vector(bases.rotation)+pawn.location;
<a name="L6428"><font color="white">06428</font>	        moveto(230*vector(pawn.rotation)+pawn.location,none,bases.WalkingSpeed);
<a name="L6429"><font color="white">06429</font>	    }
<a name="L6430"><font color="white">06430</font>	FermeturePorte:
<a name="L6431"><font color="white">06431</font>	  //  log(pawn@&quot;fermeture porte&quot;);
<a name="L6432"><font color="white">06432</font>	    if (NiveauAlerte==0  &amp;&amp; PorteOuverte.bOpened &amp;&amp; porteouverte.bCloseDoor)
<a name="L6433"><font color="white">06433</font>	    {
<a name="L6434"><font color="white">06434</font>	        bases.PlayOpenDoor();
<a name="L6435"><font color="white">06435</font>	        focus=none;
<a name="L6436"><font color="white">06436</font>	        focalpoint=Porteouverte.location + 100*vector(pawn.rotation);
<a name="L6437"><font color="white">06437</font>	        finishrotation();
<a name="L6438"><font color="white">06438</font>			//	log(&quot;la porte est ouverte je la ferme&quot;);
<a name="L6439"><font color="white">06439</font>	        porteouverte.PlayerTrigger(self, Pawn);
<a name="L6440"><font color="white">06440</font>			//DBUG    si le animend n'a pas bien ete appele
<a name="L6441"><font color="white">06441</font>			  bases.ReleaseAnimControl();
<a name="L6442"><font color="white">06442</font>	    }
<a name="L6443"><font color="white">06443</font>	RetourPatrouille:
<a name="L6444"><font color="white">06444</font>		if (prevstate=='patrouille')
<a name="L6445"><font color="white">06445</font>		{
<a name="L6446"><font color="white">06446</font>			gotostate('patrouille','moving');
<a name="L6447"><font color="white">06447</font>		}
<a name="L6448"><font color="white">06448</font>		else if (prevstate=='attaquescriptee')
<a name="L6449"><font color="white">06449</font>		{
<a name="L6450"><font color="white">06450</font>			if (movetarget!=none)  //reprend reseau vers attackpoint
<a name="L6451"><font color="white">06451</font>			{
<a name="L6452"><font color="white">06452</font>				NextRouteCachePoint=iCompteur;
<a name="L6453"><font color="white">06453</font>				gotostate('attaquescriptee','RepriseVaVersAttackPoint');
<a name="L6454"><font color="white">06454</font>			}
<a name="L6455"><font color="white">06455</font>			else ///y va directement
<a name="L6456"><font color="white">06456</font>				gotostate('attaquescriptee','VaVersAttackPoint');
<a name="L6457"><font color="white">06457</font>		}
<a name="L6458"><font color="white">06458</font>		else
<a name="L6459"><font color="white">06459</font>		   gotostate(prevstate);
<a name="L6460"><font color="white">06460</font>	ShiftOnDoorPoint:
<a name="L6461"><font color="white">06461</font>		disable('seeplayer');
<a name="L6462"><font color="white">06462</font>		disable('seemonster');
<a name="L6463"><font color="white">06463</font>		disable('notifybump');
<a name="L6464"><font color="white">06464</font>		disable('HearNoise');
<a name="L6465"><font color="white">06465</font>		If (Vsize(porteouverte.doorpoint1.location-pawn.location)&gt;Vsize(porteouverte.doorpoint2.location-pawn.location))
<a name="L6466"><font color="white">06466</font>			porteouverte.doorpoint1=porteouverte.doorpoint2;
<a name="L6467"><font color="white">06467</font>		MoveTo(4*pawn.collisionradius*normal(porteouverte.DoorPoint1.location-pawn.location)+pawn.location,enemy);
<a name="L6468"><font color="white">06468</font>		gotostate(prevstate);
<a name="L6469"><font color="white">06469</font>	}
<a name="L6470"><font color="white">06470</font>	
<a name="L6471"><font color="white">06471</font>	
<a name="L6472"><font color="white">06472</font>	
<a name="L6473"><font color="white">06473</font>	// ----------------------------------------------------------------------
<a name="L6474"><font color="white">06474</font>	// AttaqueScriptee
<a name="L6475"><font color="white">06475</font>	//
<a name="L6476"><font color="white">06476</font>	//  attaque reservee a XIII (voit personne d'autre)
<a name="L6477"><font color="white">06477</font>	// ----------------------------------------------------------------------
<a name="L6478"><font color="white">06478</font>	state AttaqueScriptee
<a name="L6479"><font color="white">06479</font>	{
<a name="L6480"><font color="white">06480</font>	    ignores hearnoise;
<a name="L6481"><font color="white">06481</font>	    event Tick(float deltaseconds)
<a name="L6482"><font color="white">06482</font>	    {
<a name="L6483"><font color="white">06483</font>	        local int i;
<a name="L6484"><font color="white">06484</font>	        local iacontroller iacontr;
<a name="L6485"><font color="white">06485</font>	        local vector X,Y,Z;
<a name="L6486"><font color="white">06486</font>	
<a name="L6487"><font color="white">06487</font>	        global.tick(deltaseconds);
<a name="L6488"><font color="white">06488</font>	        if ((enemy==none) || enemy.bisdead)
<a name="L6489"><font color="white">06489</font>	        {
<a name="L6490"><font color="white">06490</font>	            ChangeEtat();
<a name="L6491"><font color="white">06491</font>	            return;
<a name="L6492"><font color="white">06492</font>	        }
<a name="L6493"><font color="white">06493</font>	        if (bDeplacementsRoulade)    pawn.velocity=1200*normal(LastAttackPoint.PointSortieEnRoulade.location-LastAttackPoint.location);
<a name="L6494"><font color="white">06494</font>			  if (bDontSeeAnyMore &amp;&amp; !bSwitchMusicInWaitState &amp;&amp; NiveauALerteEnAS==2 &amp;&amp; (level.timeseconds-fTimerAttackMusic)&gt;10)
<a name="L6495"><font color="white">06495</font>			  {
<a name="L6496"><font color="white">06496</font>					bSwitchMusicInWaitState=true;
<a name="L6497"><font color="white">06497</font>					NiveauALerteEnAS=0;
<a name="L6498"><font color="white">06498</font>					s_incAttente();
<a name="L6499"><font color="white">06499</font>	            s_decAttaque();
<a name="L6500"><font color="white">06500</font>			  }
<a name="L6501"><font color="white">06501</font>		 }
<a name="L6502"><font color="white">06502</font>	    event Timer()
<a name="L6503"><font color="white">06503</font>	    {
<a name="L6504"><font color="white">06504</font>	        local float ProduitScal;
<a name="L6505"><font color="white">06505</font>	        local int i;
<a name="L6506"><font color="white">06506</font>	        local bool bLigneDeVIsee;
<a name="L6507"><font color="white">06507</font>	
<a name="L6508"><font color="white">06508</font>	        if (bTire)
<a name="L6509"><font color="white">06509</font>	        {
<a name="L6510"><font color="white">06510</font>	            if ((enemy==none) || enemy.bisdead)
<a name="L6511"><font color="white">06511</font>	            {
<a name="L6512"><font color="white">06512</font>	                HalteAuFeu();
<a name="L6513"><font color="white">06513</font>	                return;
<a name="L6514"><font color="white">06514</font>	            }
<a name="L6515"><font color="white">06515</font>	            if (pawn.weapon.bmeleeweapon)
<a name="L6516"><font color="white">06516</font>	            {
<a name="L6517"><font color="white">06517</font>	                HalteAufeu();
<a name="L6518"><font color="white">06518</font>	                gotostate('attaqueH2H');
<a name="L6519"><font color="white">06519</font>	                return;
<a name="L6520"><font color="white">06520</font>	            }
<a name="L6521"><font color="white">06521</font>	            if (bTirSurConeMax)
<a name="L6522"><font color="white">06522</font>						bTirSurConeMax=false;
<a name="L6523"><font color="white">06523</font>	//		log(&quot;AllianceLevel(XIII.LHand.pOnShoulder)&quot;@AllianceLevel(XIII.LHand.pOnShoulder));
<a name="L6524"><font color="white">06524</font>	            //+++++++++++++++  Gestion otage      +++++++++++++++++++++++++
<a name="L6525"><font color="white">06525</font>	            if (enemy!=xiii || !(xiii.bPrisonner &amp;&amp; XIII.LHand.pOnShoulder!=none &amp;&amp; AllianceLevel(XIII.LHand.pOnShoulder)==1))
<a name="L6526"><font color="white">06526</font>	            {
<a name="L6527"><font color="white">06527</font>	                if (bPrisonnier)
<a name="L6528"><font color="white">06528</font>	                {
<a name="L6529"><font color="white">06529</font>	                    bPrecedentTirBloque=false;
<a name="L6530"><font color="white">06530</font>	                    bPrisonnier=false;
<a name="L6531"><font color="white">06531</font>	                }
<a name="L6532"><font color="white">06532</font>	                //log(pawn@pawn.weapon.Getstatename()@&quot;PAS BLOQUE             !!!!!!!!!!!!&quot;);
<a name="L6533"><font color="white">06533</font>	                bFire=1;
<a name="L6534"><font color="white">06534</font>	                pawn.weapon.fire(1.0);
<a name="L6535"><font color="white">06535</font>	            }
<a name="L6536"><font color="white">06536</font>	            else
<a name="L6537"><font color="white">06537</font>	            {
<a name="L6538"><font color="white">06538</font>	                bLigneDeVIsee=false;
<a name="L6539"><font color="white">06539</font>	                if (!bPrisonnier)
<a name="L6540"><font color="white">06540</font>	                {
<a name="L6541"><font color="white">06541</font>	                    bPrecedentTirBloque=false;
<a name="L6542"><font color="white">06542</font>	                    bPrisonnier=true;
<a name="L6543"><font color="white">06543</font>	                }
<a name="L6544"><font color="white">06544</font>	                //tir possible sans toucher pote (skill=2&amp;3)
<a name="L6545"><font color="white">06545</font>		             ProduitScal=normal(vector(enemy.rotation)) dot normal(pawn.location-enemy.location);
<a name="L6546"><font color="white">06546</font>		             if (ProduitScal &lt;0.5)
<a name="L6547"><font color="white">06547</font>		             {
<a name="L6548"><font color="white">06548</font>		                if (CHARGE_LES_LOGS) log(pawn$&quot;j'ai une ligne de visee, j'allume   *** !!!!! **** &quot;);
<a name="L6549"><font color="white">06549</font>		                bLigneDeVIsee=true;
<a name="L6550"><font color="white">06550</font>		             }
<a name="L6551"><font color="white">06551</font>	                if (NbCoupsRiposte&gt;0 || bLigneDeVIsee)
<a name="L6552"><font color="white">06552</font>	                {
<a name="L6553"><font color="white">06553</font>	                    if (bPrecedentTirBloque &amp;&amp; bLigneDeVIsee)
<a name="L6554"><font color="white">06554</font>	                    {
<a name="L6555"><font color="white">06555</font>	                        if (CHARGE_LES_LOGS) log(pawn$&quot;MAINTENANT LE TIR N'EST PLUS BLOQUE   !!!!!!!!!!!&quot;);
<a name="L6556"><font color="white">06556</font>	                        bPrecedentTirBloque=false;
<a name="L6557"><font color="white">06557</font>	                        settimer(0.5,false);
<a name="L6558"><font color="white">06558</font>	                        return;
<a name="L6559"><font color="white">06559</font>	                    }
<a name="L6560"><font color="white">06560</font>	                    bFire=1;
<a name="L6561"><font color="white">06561</font>	                    pawn.weapon.fire(1.0);
<a name="L6562"><font color="white">06562</font>	                    NbCoupsRiposte--;
<a name="L6563"><font color="white">06563</font>	                }
<a name="L6564"><font color="white">06564</font>	                else
<a name="L6565"><font color="white">06565</font>	                {
<a name="L6566"><font color="white">06566</font>	                    if (CHARGE_LES_LOGS) log(pawn$&quot;TIR BLOQUE             !!!!!!!!!!!!&quot;);
<a name="L6567"><font color="white">06567</font>	                    bPrecedentTirBloque=true;
<a name="L6568"><font color="white">06568</font>	                    bfire=0;
<a name="L6569"><font color="white">06569</font>	                }
<a name="L6570"><font color="white">06570</font>	            }
<a name="L6571"><font color="white">06571</font>	            //++++++++++++++++++++++++++++++++++
<a name="L6572"><font color="white">06572</font>	            if (XIIIWeapon(pawn.weapon).WeaponMode==WM_Auto)
<a name="L6573"><font color="white">06573</font>	            {
<a name="L6574"><font color="white">06574</font>						 if (bPremiereRafale)
<a name="L6575"><font color="white">06575</font>						{
<a name="L6576"><font color="white">06576</font>							bPremiereRafale=false;
<a name="L6577"><font color="white">06577</font>					   	if (!pawn.weapon.bmeleeweapon &amp;&amp; enemy==xiii &amp;&amp; ((pawn.location-xiii.location) dot (vector(XIII.rotation)))&lt;0)
<a name="L6578"><font color="white">06578</font>					   		bTirSurConeMax=true;
<a name="L6579"><font color="white">06579</font>	
<a name="L6580"><font color="white">06580</font>						}
<a name="L6581"><font color="white">06581</font>	                if (bPrisonnier)
<a name="L6582"><font color="white">06582</font>	                    settimer(FireTimerRefresh*0.8,false); // refresh de l'otage en ligne de mire
<a name="L6583"><font color="white">06583</font>	                else
<a name="L6584"><font color="white">06584</font>	                {
<a name="L6585"><font color="white">06585</font>							  if (bAccroupiSurAP)
<a name="L6586"><font color="white">06586</font>	                        settimer2(0.7,false);
<a name="L6587"><font color="white">06587</font>	                    else
<a name="L6588"><font color="white">06588</font>	                        settimer(FireTimerRefresh,false); // pour tester si reste muns
<a name="L6589"><font color="white">06589</font>	
<a name="L6590"><font color="white">06590</font>	                }
<a name="L6591"><font color="white">06591</font>	            }
<a name="L6592"><font color="white">06592</font>	            else
<a name="L6593"><font color="white">06593</font>	            {
<a name="L6594"><font color="white">06594</font>	                bfire=0;
<a name="L6595"><font color="white">06595</font>	                settimer(XIIIWeapon(pawn.weapon).shottime+bases.OffsetTimeBetweenShots,false);
<a name="L6596"><font color="white">06596</font>	            }
<a name="L6597"><font color="white">06597</font>	        }
<a name="L6598"><font color="white">06598</font>	    }
<a name="L6599"><font color="white">06599</font>	    event Timer2()
<a name="L6600"><font color="white">06600</font>	    {
<a name="L6601"><font color="white">06601</font>	        if (btire)
<a name="L6602"><font color="white">06602</font>	        {
<a name="L6603"><font color="white">06603</font>	            bfire=0;
<a name="L6604"><font color="white">06604</font>	            settimer(0.5,false);
<a name="L6605"><font color="white">06605</font>	        }
<a name="L6606"><font color="white">06606</font>	    }
<a name="L6607"><font color="white">06607</font>	    event timer3()
<a name="L6608"><font color="white">06608</font>	    {
<a name="L6609"><font color="white">06609</font>	        EnemyTargetPos=enemy.location;
<a name="L6610"><font color="white">06610</font>	        EnemyTargetVelocity=enemy.velocity;
<a name="L6611"><font color="white">06611</font>				if (!btemp_bool)    //btemp_bool determine si on est en deplacement
<a name="L6612"><font color="white">06612</font>					return;
<a name="L6613"><font color="white">06613</font>	
<a name="L6614"><font color="white">06614</font>	        if (lastAttackpoint.bTirEntreLes2)
<a name="L6615"><font color="white">06615</font>	        {
<a name="L6616"><font color="white">06616</font>					if (CanSee(enemy))
<a name="L6617"><font color="white">06617</font>					{
<a name="L6618"><font color="white">06618</font>						Fireenemy();
<a name="L6619"><font color="white">06619</font>						if (bSwitchMusicInWaitState &amp;&amp; NiveauALerteEnAS==0)
<a name="L6620"><font color="white">06620</font>						{
<a name="L6621"><font color="white">06621</font>							s_decAttente();
<a name="L6622"><font color="white">06622</font>				         s_incAttaque();
<a name="L6623"><font color="white">06623</font>							NiveauALerteEnAS=2;
<a name="L6624"><font color="white">06624</font>						   bSwitchMusicInWaitState=false;
<a name="L6625"><font color="white">06625</font>						}
<a name="L6626"><font color="white">06626</font>						bLookAtEnemy=false;
<a name="L6627"><font color="white">06627</font>						enable('enemynotvisible');
<a name="L6628"><font color="white">06628</font>					}
<a name="L6629"><font color="white">06629</font>					else
<a name="L6630"><font color="white">06630</font>					{
<a name="L6631"><font color="white">06631</font>						HalteAuFeu();
<a name="L6632"><font color="white">06632</font>						bLookAtEnemy=true;
<a name="L6633"><font color="white">06633</font>						disable('enemynotvisible');
<a name="L6634"><font color="white">06634</font>					}
<a name="L6635"><font color="white">06635</font>	        }
<a name="L6636"><font color="white">06636</font>	        // Passage dans attaque
<a name="L6637"><font color="white">06637</font>	        if (Vsize(enemy.location-pawn.location)&lt;310 &amp;&amp; !LastAttackpoint.bForceDeplacement &amp;&amp; Cansee(enemy)) //je vois alors que je ne voyais pas
<a name="L6638"><font color="white">06638</font>	        {
<a name="L6639"><font color="white">06639</font>	            HalteAufeu();
<a name="L6640"><font color="white">06640</font>	            CompteurRecalage=15;
<a name="L6641"><font color="white">06641</font>	            gotostate('attaque');
<a name="L6642"><font color="white">06642</font>	        }
<a name="L6643"><font color="white">06643</font>	    }
<a name="L6644"><font color="white">06644</font>		function DamageAttitudeto(pawn Other, float Damage)
<a name="L6645"><font color="white">06645</font>	    {
<a name="L6646"><font color="white">06646</font>	        if (bases.bisdead)
<a name="L6647"><font color="white">06647</font>	            return;
<a name="L6648"><font color="white">06648</font>	        //son
<a name="L6649"><font color="white">06649</font>	        bases.PlaySndPNJOno(pnjono'Onomatopees.hPNJHurt',bases.CodeMesh,bases.NumeroTimbre);
<a name="L6650"><font color="white">06650</font>	
<a name="L6651"><font color="white">06651</font>		     If (xiii.bPrisonner &amp;&amp; XIII.LHand.pOnShoulder!=none &amp;&amp; AllianceLevel(XIII.LHand.pOnShoulder)==1 &amp;&amp; other==xiii)
<a name="L6652"><font color="white">06652</font>	        {
<a name="L6653"><font color="white">06653</font>	           if (CHARGE_LES_LOGS) log(pawn$&quot;je riposte&quot;);
<a name="L6654"><font color="white">06654</font>	           NbCoupsRiposte=(2+bases.agressivite)*1.9;
<a name="L6655"><font color="white">06655</font>	           NbCoupsRiposte=Min(5,NbCoupsRiposte);
<a name="L6656"><font color="white">06656</font>	           NbCoupsRiposte=Max(1,NbCoupsRiposte);
<a name="L6657"><font color="white">06657</font>	        }
<a name="L6658"><font color="white">06658</font>	    }
<a name="L6659"><font color="white">06659</font>		Function SeeEnemy()
<a name="L6660"><font color="white">06660</font>		{
<a name="L6661"><font color="white">06661</font>			bDontSeeAnyMore=false;
<a name="L6662"><font color="white">06662</font>			if (bSwitchMusicInWaitState &amp;&amp; NiveauALerteEnAS==0)
<a name="L6663"><font color="white">06663</font>			{
<a name="L6664"><font color="white">06664</font>				s_decAttente();
<a name="L6665"><font color="white">06665</font>	         s_incAttaque();
<a name="L6666"><font color="white">06666</font>				NiveauALerteEnAS=2;
<a name="L6667"><font color="white">06667</font>			   bSwitchMusicInWaitState=false;
<a name="L6668"><font color="white">06668</font>			}
<a name="L6669"><font color="white">06669</font>			enable('enemynotvisible');
<a name="L6670"><font color="white">06670</font>			FireEnemy();
<a name="L6671"><font color="white">06671</font>		}
<a name="L6672"><font color="white">06672</font>	    event SeePlayer (pawn other)
<a name="L6673"><font color="white">06673</font>	    {
<a name="L6674"><font color="white">06674</font>	        if (bLookAtEnemy &amp;&amp; enemy!=none &amp;&amp; enemy==other)
<a name="L6675"><font color="white">06675</font>	            SeeEnemy();
<a name="L6676"><font color="white">06676</font>			  else
<a name="L6677"><font color="white">06677</font>			  		SetEnemy(other);
<a name="L6678"><font color="white">06678</font>	    }
<a name="L6679"><font color="white">06679</font>	    event SeeMonster(pawn other)
<a name="L6680"><font color="white">06680</font>	    {
<a name="L6681"><font color="white">06681</font>				if (bLookAtEnemy &amp;&amp; enemy!=none &amp;&amp; enemy==other)
<a name="L6682"><font color="white">06682</font>	            SeeEnemy();
<a name="L6683"><font color="white">06683</font>			  else
<a name="L6684"><font color="white">06684</font>					SetEnemy(other);
<a name="L6685"><font color="white">06685</font>	    }
<a name="L6686"><font color="white">06686</font>	    event enemynotvisible()
<a name="L6687"><font color="white">06687</font>	    {
<a name="L6688"><font color="white">06688</font>	        HalteAuFeu();
<a name="L6689"><font color="white">06689</font>			  blookAtEnemy=true;
<a name="L6690"><font color="white">06690</font>			  bDontSeeAnyMore=true;
<a name="L6691"><font color="white">06691</font>			  fTimerAttackMusic=level.timeseconds;
<a name="L6692"><font color="white">06692</font>	        disable('enemynotvisible');
<a name="L6693"><font color="white">06693</font>	    }
<a name="L6694"><font color="white">06694</font>	    event EnemyAcquired()
<a name="L6695"><font color="white">06695</font>	    {
<a name="L6696"><font color="white">06696</font>	        FireEnemy();
<a name="L6697"><font color="white">06697</font>			  bDontSeeAnyMore=false;
<a name="L6698"><font color="white">06698</font>			  if (bSwitchMusicInWaitState &amp;&amp; NiveauALerteEnAS==0)
<a name="L6699"><font color="white">06699</font>			  {
<a name="L6700"><font color="white">06700</font>					s_decAttente();
<a name="L6701"><font color="white">06701</font>	            s_incAttaque();
<a name="L6702"><font color="white">06702</font>					NiveauALerteEnAS=2;
<a name="L6703"><font color="white">06703</font>					bSwitchMusicInWaitState=false;
<a name="L6704"><font color="white">06704</font>			  }
<a name="L6705"><font color="white">06705</font>	        enable('enemynotvisible');
<a name="L6706"><font color="white">06706</font>	    }
<a name="L6707"><font color="white">06707</font>	    function NotifyFiring()
<a name="L6708"><font color="white">06708</font>	    {
<a name="L6709"><font color="white">06709</font>			  if (enemy==none)
<a name="L6710"><font color="white">06710</font>					return;
<a name="L6711"><font color="white">06711</font>	        DirectionTir=DirectionDuTir(); //recupere direction du tir avant dispersion
<a name="L6712"><font color="white">06712</font>	        //decalage par rapport a l'arme
<a name="L6713"><font color="white">06713</font>	        CheckLineOfFire();
<a name="L6714"><font color="white">06714</font>	    }
<a name="L6715"><font color="white">06715</font>	    function rotator AdjustAim(Ammunition FiredAmmunition, vector projStart, int aimerror)
<a name="L6716"><font color="white">06716</font>	    {
<a name="L6717"><font color="white">06717</font>	        if (iNumEtat==2) // si vise grenade target
<a name="L6718"><font color="white">06718</font>	            return rotator(LastAttackPoint.Ciblegrenade.location-projstart);
<a name="L6719"><font color="white">06719</font>	        else
<a name="L6720"><font color="white">06720</font>	            return global.adjustaim(FiredAmmunition, projStart,aimerror);
<a name="L6721"><font color="white">06721</font>	    }
<a name="L6722"><font color="white">06722</font>		 function PasseEtatAlerteEnAttaque()
<a name="L6723"><font color="white">06723</font>		 {
<a name="L6724"><font color="white">06724</font>	        if (NiveauALerteEnAS==0)
<a name="L6725"><font color="white">06725</font>	        {
<a name="L6726"><font color="white">06726</font>	            s_decAttente();
<a name="L6727"><font color="white">06727</font>	            s_incAttaque();
<a name="L6728"><font color="white">06728</font>	        }
<a name="L6729"><font color="white">06729</font>	        NiveauALerteEnAS=2;
<a name="L6730"><font color="white">06730</font>		 }
<a name="L6731"><font color="white">06731</font>		 function PasseEtatAlerteEnAttente()
<a name="L6732"><font color="white">06732</font>		 {
<a name="L6733"><font color="white">06733</font>			  if (NiveauALerteEnAS==2)
<a name="L6734"><font color="white">06734</font>	        {
<a name="L6735"><font color="white">06735</font>	            s_incattente();
<a name="L6736"><font color="white">06736</font>	            s_decAttaque();
<a name="L6737"><font color="white">06737</font>	        }
<a name="L6738"><font color="white">06738</font>	        NiveauALerteEnAS=0;
<a name="L6739"><font color="white">06739</font>		 }
<a name="L6740"><font color="white">06740</font>	
<a name="L6741"><font color="white">06741</font>	    function CheckLineOfFire()
<a name="L6742"><font color="white">06742</font>	    {
<a name="L6743"><font color="white">06743</font>	        local int TypeObstacle;
<a name="L6744"><font color="white">06744</font>	
<a name="L6745"><font color="white">06745</font>	        TypeObstacle=LineOfFireObstacle();
<a name="L6746"><font color="white">06746</font>	        if (TypeObstacle==0)  //rien devant
<a name="L6747"><font color="white">06747</font>	        {
<a name="L6748"><font color="white">06748</font>	
<a name="L6749"><font color="white">06749</font>	            return;
<a name="L6750"><font color="white">06750</font>	        }
<a name="L6751"><font color="white">06751</font>	        else if (TypeObstacle==1)
<a name="L6752"><font color="white">06752</font>	        {
<a name="L6753"><font color="white">06753</font>	            bfire=0; //bloc tir car pote devant
<a name="L6754"><font color="white">06754</font>	            settimer(1.0,true);
<a name="L6755"><font color="white">06755</font>	            focus=enemy;
<a name="L6756"><font color="white">06756</font>	        }
<a name="L6757"><font color="white">06757</font>			  /*else
<a name="L6758"><font color="white">06758</font>	        {
<a name="L6759"><font color="white">06759</font>					log(&quot;decor devant&quot;);
<a name="L6760"><font color="white">06760</font>					if (fasttrace(enemy.location+enemy.EyePosition(), WeaponStartTrace)) //seehead
<a name="L6761"><font color="white">06761</font>					{
<a name="L6762"><font color="white">06762</font>						log(&quot;reajuste tir vers tete&quot;);
<a name="L6763"><font color="white">06763</font>						DirectionTir.z+=20;
<a name="L6764"><font color="white">06764</font>					}
<a name="L6765"><font color="white">06765</font>			  } */
<a name="L6766"><font color="white">06766</font>	    }
<a name="L6767"><font color="white">06767</font>	    function BeginState()
<a name="L6768"><font color="white">06768</font>	    {
<a name="L6769"><font color="white">06769</font>			if (lastAttackpoint==none)
<a name="L6770"><font color="white">06770</font>				return;
<a name="L6771"><font color="white">06771</font>				Switch (NiveauAlerte)
<a name="L6772"><font color="white">06772</font>				{
<a name="L6773"><font color="white">06773</font>					case 0:
<a name="L6774"><font color="white">06774</font>						if (LastAttackPoint.bMusiqueAttaque || CanSee(enemy))
<a name="L6775"><font color="white">06775</font>						{
<a name="L6776"><font color="white">06776</font>							s_incattaque();
<a name="L6777"><font color="white">06777</font>	            		s_decAttente();
<a name="L6778"><font color="white">06778</font>							NiveauALerteEnAS=2;
<a name="L6779"><font color="white">06779</font>						}
<a name="L6780"><font color="white">06780</font>						else
<a name="L6781"><font color="white">06781</font>							NiveauALerteEnAS=0;
<a name="L6782"><font color="white">06782</font>						break;
<a name="L6783"><font color="white">06783</font>					case 1:
<a name="L6784"><font color="white">06784</font>						if (LastAttackPoint.bMusiqueAttaque || CanSee(enemy))
<a name="L6785"><font color="white">06785</font>						{
<a name="L6786"><font color="white">06786</font>							s_incattaque();
<a name="L6787"><font color="white">06787</font>	            		s_decAlerte();
<a name="L6788"><font color="white">06788</font>							NiveauALerteEnAS=2;
<a name="L6789"><font color="white">06789</font>						}
<a name="L6790"><font color="white">06790</font>						else
<a name="L6791"><font color="white">06791</font>						{
<a name="L6792"><font color="white">06792</font>							s_incattente();
<a name="L6793"><font color="white">06793</font>	            		s_decAlerte();
<a name="L6794"><font color="white">06794</font>							NiveauALerteEnAS=0;
<a name="L6795"><font color="white">06795</font>						}
<a name="L6796"><font color="white">06796</font>						break;
<a name="L6797"><font color="white">06797</font>	             case 2:
<a name="L6798"><font color="white">06798</font>						if (LastAttackPoint.bMusiqueAttaque || CanSee(enemy))
<a name="L6799"><font color="white">06799</font>						{
<a name="L6800"><font color="white">06800</font>							NiveauALerteEnAS=2;
<a name="L6801"><font color="white">06801</font>						}
<a name="L6802"><font color="white">06802</font>						else
<a name="L6803"><font color="white">06803</font>						{
<a name="L6804"><font color="white">06804</font>							NiveauALerteEnAS=0;
<a name="L6805"><font color="white">06805</font>							s_decattaque();
<a name="L6806"><font color="white">06806</font>	            		s_incAttente();
<a name="L6807"><font color="white">06807</font>						}
<a name="L6808"><font color="white">06808</font>				}
<a name="L6809"><font color="white">06809</font>			  NiveauAlerte=2;
<a name="L6810"><font color="white">06810</font>			  bARienVu=false;
<a name="L6811"><font color="white">06811</font>	        pawn.SetAnimStatus('alert');
<a name="L6812"><font color="white">06812</font>	        //bDisableEventSeeDeadPawn=true;
<a name="L6813"><font color="white">06813</font>				bLookAtEnemy=false;
<a name="L6814"><font color="white">06814</font>	        disable('enemynotvisible');
<a name="L6815"><font color="white">06815</font>	        SetVigilant(true);
<a name="L6816"><font color="white">06816</font>	        Temps_ref=level.timeseconds-2;
<a name="L6817"><font color="white">06817</font>	        settimer3(Temps_RefreshEnemyPos,true);
<a name="L6818"><font color="white">06818</font>	        //--------  Var Temp ------------
<a name="L6819"><font color="white">06819</font>	        Temp_float=0.0; //pour stocker temps de pause sur AttackPoint
<a name="L6820"><font color="white">06820</font>	        VitesseHorizontaleSaut=0.0;
<a name="L6821"><font color="white">06821</font>	        temp_vect=vect(0,0,0); //utiliser pour calcul du saut
<a name="L6822"><font color="white">06822</font>	        bSaut=false;
<a name="L6823"><font color="white">06823</font>	        btemp_bool=false; //sert au test de vision avant deplacement (-&gt;tirsurplace)
<a name="L6824"><font color="white">06824</font>	        //result=false; //utilise pour savoir si a change de branche
<a name="L6825"><font color="white">06825</font>	        iNumEtat=0;
<a name="L6826"><font color="white">06826</font>			  bDontSeeAnyMore=false;
<a name="L6827"><font color="white">06827</font>			  bSwitchMusicInWaitState=false;
<a name="L6828"><font color="white">06828</font>	        //temp_int=0;//compteur recherche de branche secondaire
<a name="L6829"><font color="white">06829</font>	        //et sert a savoir si en train de grenader perso 1 ou grenade target 2
<a name="L6830"><font color="white">06830</font>	    }
<a name="L6831"><font color="white">06831</font>	    function EndState()
<a name="L6832"><font color="white">06832</font>	    {
<a name="L6833"><font color="white">06833</font>	        if (LastAttackPoint!=none &amp;&amp; !LastAttackPoint.bReprenable)
<a name="L6834"><font color="white">06834</font>	        {
<a name="L6835"><font color="white">06835</font>	            LastAttackPoint.bDejaPasse=true; //notify le passage a l'AP
<a name="L6836"><font color="white">06836</font>	        }
<a name="L6837"><font color="white">06837</font>			  if (bControlAnimations) bases.ReleaseAnimControl();
<a name="L6838"><font color="white">06838</font>	        Pawn.ShouldCrouch(false);
<a name="L6839"><font color="white">06839</font>	        pawn.bcanjump=false;
<a name="L6840"><font color="white">06840</font>			  pawn.bIsPafable=true;
<a name="L6841"><font color="white">06841</font>	        HalteAuFeu();
<a name="L6842"><font color="white">06842</font>	        settimer3(0,false);
<a name="L6843"><font color="white">06843</font>			  bBloqueFuiteGrenades=false;
<a name="L6844"><font color="white">06844</font>			  if (NiveauAlerte!=0 &amp;&amp; NiveauALerteEnAS==0)
<a name="L6845"><font color="white">06845</font>			  {
<a name="L6846"><font color="white">06846</font>				 	NiveauAlerte=0;
<a name="L6847"><font color="white">06847</font>				 	bSwitchMusicInWaitState=false;  //inutile
<a name="L6848"><font color="white">06848</font>			  }
<a name="L6849"><font color="white">06849</font>			  NiveauALerteEnAS=-1;
<a name="L6850"><font color="white">06850</font>	    }
<a name="L6851"><font color="white">06851</font>	
<a name="L6852"><font color="white">06852</font>	begin:
<a name="L6853"><font color="white">06853</font>	    if (CHARGE_LES_LOGS) log(pawn@&quot;AttaqueScriptee&quot;);
<a name="L6854"><font color="white">06854</font>	    if (enemy==none)
<a name="L6855"><font color="white">06855</font>	    {
<a name="L6856"><font color="white">06856</font>	        log(pawn@&quot;ENEMY==none ** ENEMY==none ** ENEMY==none ** ENEMY==none ** ENEMY==none **&quot;);
<a name="L6857"><font color="white">06857</font>	        //enemy=xiii;
<a name="L6858"><font color="white">06858</font>	    }
<a name="L6859"><font color="white">06859</font>	    if (lastAttackpoint==none)  //blindage
<a name="L6860"><font color="white">06860</font>	    {
<a name="L6861"><font color="white">06861</font>	        CompteurRecalage=15;
<a name="L6862"><font color="white">06862</font>	        gotostate('attaque');
<a name="L6863"><font color="white">06863</font>	    }
<a name="L6864"><font color="white">06864</font>	    EnemyTargetPos=enemy.location;
<a name="L6865"><font color="white">06865</font>	    EnemyTargetVelocity=enemy.velocity;
<a name="L6866"><font color="white">06866</font>	    pawn.velocity=vect(0,0,0);
<a name="L6867"><font color="white">06867</font>	    pawn.acceleration=vect(0,0,0);
<a name="L6868"><font color="white">06868</font>	VaVersAttackPoint:
<a name="L6869"><font color="white">06869</font>	    if (pawn.biscrouched)
<a name="L6870"><font color="white">06870</font>	        Pawn.ShouldCrouch(false);
<a name="L6871"><font color="white">06871</font>		 if (LastAttackPoint.bMusiqueAttaque || CanSee(enemy))
<a name="L6872"><font color="white">06872</font>			 PasseEtatAlerteEnAttaque();
<a name="L6873"><font color="white">06873</font>		 else
<a name="L6874"><font color="white">06874</font>	       PasseEtatAlerteEnAttente();
<a name="L6875"><font color="white">06875</font>		 btemp_bool=true; //sert a savoir qu'on est en mouvement
<a name="L6876"><font color="white">06876</font>	    //-------------------
<a name="L6877"><font color="white">06877</font>	    If (movetarget!=none)  //donc pas reachable
<a name="L6878"><font color="white">06878</font>	    {
<a name="L6879"><font color="white">06879</font>			 NextRouteCachePoint=0;
<a name="L6880"><font color="white">06880</font>	RepriseVaVersAttackPoint:
<a name="L6881"><font color="white">06881</font>	        if (CHARGE_LES_LOGS) log(pawn$&quot;va au Attack point par chemin&quot;);
<a name="L6882"><font color="white">06882</font>	        for (iCompteur=NextRouteCachePoint;iCompteur&lt;NbPointChemin;iCompteur++)
<a name="L6883"><font color="white">06883</font>	        {
<a name="L6884"><font color="white">06884</font>	            if (!btire)
<a name="L6885"><font color="white">06885</font>	            {
<a name="L6886"><font color="white">06886</font>	                focus=none;
<a name="L6887"><font color="white">06887</font>	                focalpoint=10000*(PointChemin[iCompteur].location-pawn.location)+pawn.location;
<a name="L6888"><font color="white">06888</font>	            	MoveToward(PointChemin[iCompteur],none);
<a name="L6889"><font color="white">06889</font>	        		}
<a name="L6890"><font color="white">06890</font>					else
<a name="L6891"><font color="white">06891</font>		            MoveToward(PointChemin[iCompteur],enemy);
<a name="L6892"><font color="white">06892</font>	        }
<a name="L6893"><font color="white">06893</font>	    }
<a name="L6894"><font color="white">06894</font>	    else
<a name="L6895"><font color="white">06895</font>	    {
<a name="L6896"><font color="white">06896</font>				if (CHARGE_LES_LOGS) log(pawn$&quot;va au Attack directement&quot;);
<a name="L6897"><font color="white">06897</font>	        if (!btire)
<a name="L6898"><font color="white">06898</font>	        {
<a name="L6899"><font color="white">06899</font>	            focus=none;
<a name="L6900"><font color="white">06900</font>	            focalpoint=10000*(LastAttackPoint.location-pawn.location)+pawn.location;
<a name="L6901"><font color="white">06901</font>					MoveToward(LastAttackPoint,none);
<a name="L6902"><font color="white">06902</font>	        }
<a name="L6903"><font color="white">06903</font>				else
<a name="L6904"><font color="white">06904</font>					MoveToward(LastAttackPoint,enemy);
<a name="L6905"><font color="white">06905</font>	    }
<a name="L6906"><font color="white">06906</font>	    btemp_bool=false; //car detection que pendant deplacement
<a name="L6907"><font color="white">06907</font>	    bSaut=false;
<a name="L6908"><font color="white">06908</font>	
<a name="L6909"><font color="white">06909</font>	    //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<a name="L6910"><font color="white">06910</font>	    // +++++++++++++++ GESTION DES PROPRIETES DE L'ATTACK POINT +++++++++++++++++++++
<a name="L6911"><font color="white">06911</font>	    //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<a name="L6912"><font color="white">06912</font>	GetProperties:
<a name="L6913"><font color="white">06913</font>	    //--------------   PROPRIETES D'ENTREE   -------------------
<a name="L6914"><font color="white">06914</font>	    GetAttackPointProperties(LastAttackPoint,temp_float);
<a name="L6915"><font color="white">06915</font>	UseProperties:
<a name="L6916"><font color="white">06916</font>	    //Si il y a une ciblegrenade ben prend grenade
<a name="L6917"><font color="white">06917</font>	    if (LastAttackPoint.bTenteGrenadage &amp;&amp; enemy.base!=none)
<a name="L6918"><font color="white">06918</font>	    {
<a name="L6919"><font color="white">06919</font>	        if (pawn.weapon.isa('grenad'))
<a name="L6920"><font color="white">06920</font>	            pawn.pendingweapon=pawn.weapon;
<a name="L6921"><font color="white">06921</font>	        else
<a name="L6922"><font color="white">06922</font>	        {
<a name="L6923"><font color="white">06923</font>	          // ELR Remove Class reference
<a name="L6924"><font color="white">06924</font>	//          pawn.pendingweapon=XIIIWeapon(pawn.FindInventoryType(class'grenad'));
<a name="L6925"><font color="white">06925</font>	          Pawn.PendingWeapon = Pawn.Inventory.WeaponChange(4);
<a name="L6926"><font color="white">06926</font>	          if ( Pawn.PendingWeapon == none )
<a name="L6927"><font color="white">06927</font>	            Pawn.PendingWeapon = Pawn.Inventory.WeaponChange(20); // Try Frag Grenad
<a name="L6928"><font color="white">06928</font>	          // ELR End
<a name="L6929"><font color="white">06929</font>	        }
<a name="L6930"><font color="white">06930</font>	        if (pawn.pendingweapon!= none &amp;&amp; pawn.pendingweapon.HasAmmo())
<a name="L6931"><font color="white">06931</font>	        {
<a name="L6932"><font color="white">06932</font>					result=btire;
<a name="L6933"><font color="white">06933</font>	            if (LastAttackpoint.CibleGrenade!=none &amp;&amp; LastAttackpoint.CibleGrenade.bactive &amp;&amp; FastTrace(LastAttackpoint.ciblegrenade.location,pawn.location))
<a name="L6934"><font color="white">06934</font>	            {
<a name="L6935"><font color="white">06935</font>	                //log(&quot;cible grenade!!=none&quot;@Pawn.PendingWeapon);
<a name="L6936"><font color="white">06936</font>	                if (result) //tire deja
<a name="L6937"><font color="white">06937</font>	                    HalteAufeu();
<a name="L6938"><font color="white">06938</font>	                if (Pawn.Weapon!=Pawn.PendingWeapon)
<a name="L6939"><font color="white">06939</font>	                    Pawn.Weapon.PutDown();
<a name="L6940"><font color="white">06940</font>	                else
<a name="L6941"><font color="white">06941</font>	                    pawn.pendingweapon=none;
<a name="L6942"><font color="white">06942</font>	                iNumEtat=2;
<a name="L6943"><font color="white">06943</font>	                temp_float=fmax(4.5,temp_float);
<a name="L6944"><font color="white">06944</font>						 sleep(1.2);
<a name="L6945"><font color="white">06945</font>						 if (LastAttackpoint.CibleGrenade.bactive)
<a name="L6946"><font color="white">06946</font>	                {
<a name="L6947"><font color="white">06947</font>	WaitGrenadReady:
<a name="L6948"><font color="white">06948</font>		                sleep(0.2);
<a name="L6949"><font color="white">06949</font>							 if (!pawn.weapon.isa('grenad') || pawn.weapon.isinstate('active'))
<a name="L6950"><font color="white">06950</font>								goto('WaitGrenadReady');
<a name="L6951"><font color="white">06951</font>		                if (!bases.bDontCallFriends) pawn.PlaySndPNJOno(pnjono'Onomatopees.hPNJGrenade',bases.CodeMesh,bases.NumeroTimbre);
<a name="L6952"><font color="white">06952</font>							 if (bSwitchMusicInWaitState &amp;&amp; NiveauALerteEnAS==0)
<a name="L6953"><font color="white">06953</font>							 {
<a name="L6954"><font color="white">06954</font>								s_decAttente();
<a name="L6955"><font color="white">06955</font>					         s_incAttaque();
<a name="L6956"><font color="white">06956</font>								NiveauALerteEnAS=2;
<a name="L6957"><font color="white">06957</font>							   bSwitchMusicInWaitState=false;
<a name="L6958"><font color="white">06958</font>							 }
<a name="L6959"><font color="white">06959</font>		                fireenemy();
<a name="L6960"><font color="white">06960</font>		                sleep(1);
<a name="L6961"><font color="white">06961</font>						 }
<a name="L6962"><font color="white">06962</font>	                ChangetoBestWeapon();
<a name="L6963"><font color="white">06963</font>	                if (!result) //tire deja
<a name="L6964"><font color="white">06964</font>	                    HalteAufeu();
<a name="L6965"><font color="white">06965</font>	                iNumEtat=0;
<a name="L6966"><font color="white">06966</font>	            }
<a name="L6967"><font color="white">06967</font>	            else if (Vsize(enemy.location-pawn.location)&lt;1200 &amp;&amp; Vsize(enemy.location-pawn.location)&gt;300)
<a name="L6968"><font color="white">06968</font>	            {
<a name="L6969"><font color="white">06969</font>	                //log(&quot;bonne distance de hgrenaage&quot;@pawn.pendingweapon@pawn.weapon);
<a name="L6970"><font color="white">06970</font>	                if (FastTrace(enemy.location+vect(0,0,80),enemy.location) &amp;&amp; FastTrace(enemy.location+vect(0,0,80),pawn.eyeposition()+pawn.location))
<a name="L6971"><font color="white">06971</font>	                {
<a name="L6972"><font color="white">06972</font>	                    if (result) //tire deja
<a name="L6973"><font color="white">06973</font>	                        HalteAufeu();
<a name="L6974"><font color="white">06974</font>	                    if (Pawn.Weapon!=Pawn.PendingWeapon)
<a name="L6975"><font color="white">06975</font>	                    {
<a name="L6976"><font color="white">06976</font>	                        Pawn.Weapon.PutDown();
<a name="L6977"><font color="white">06977</font>	                    }
<a name="L6978"><font color="white">06978</font>	                    else
<a name="L6979"><font color="white">06979</font>	                        pawn.pendingweapon=none;
<a name="L6980"><font color="white">06980</font>	                    iNumEtat=1;
<a name="L6981"><font color="white">06981</font>						 	  sleep(1.2);
<a name="L6982"><font color="white">06982</font>	WaitGrenadReadySansGrenadTarget:
<a name="L6983"><font color="white">06983</font>		                 sleep(0.2);
<a name="L6984"><font color="white">06984</font>							  if (!pawn.weapon.isa('grenad') || pawn.weapon.isinstate('active'))
<a name="L6985"><font color="white">06985</font>								goto('WaitGrenadReadySansGrenadTarget');
<a name="L6986"><font color="white">06986</font>	                    if (!bases.bDontCallFriends) pawn.PlaySndPNJOno(pnjono'Onomatopees.hPNJGrenade',bases.CodeMesh,bases.NumeroTimbre);
<a name="L6987"><font color="white">06987</font>							  if (bSwitchMusicInWaitState &amp;&amp; NiveauALerteEnAS==0)
<a name="L6988"><font color="white">06988</font>							  {
<a name="L6989"><font color="white">06989</font>									s_decAttente();
<a name="L6990"><font color="white">06990</font>						         s_incAttaque();
<a name="L6991"><font color="white">06991</font>									NiveauALerteEnAS=2;
<a name="L6992"><font color="white">06992</font>								   bSwitchMusicInWaitState=false;
<a name="L6993"><font color="white">06993</font>							  }
<a name="L6994"><font color="white">06994</font>	                    fireenemy();
<a name="L6995"><font color="white">06995</font>	                    sleep(1);  //temps de lancer une grenade
<a name="L6996"><font color="white">06996</font>	                    //log(&quot;bonne distance de hgrenaage et fasttrace&quot;);
<a name="L6997"><font color="white">06997</font>	                    ChangetoBestWeapon();
<a name="L6998"><font color="white">06998</font>	                    if (!result) //tire deja
<a name="L6999"><font color="white">06999</font>	                        HalteAufeu();
<a name="L7000"><font color="white">07000</font>	                    iNumEtat=0;
<a name="L7001"><font color="white">07001</font>	                }
<a name="L7002"><font color="white">07002</font>	            }
<a name="L7003"><font color="white">07003</font>	        }
<a name="L7004"><font color="white">07004</font>	        else
<a name="L7005"><font color="white">07005</font>	        {
<a name="L7006"><font color="white">07006</font>	            pawn.pendingweapon=none;
<a name="L7007"><font color="white">07007</font>	            //log(pawn@&quot;jai pas grenades&quot;);
<a name="L7008"><font color="white">07008</font>	        }
<a name="L7009"><font color="white">07009</font>	    }
<a name="L7010"><font color="white">07010</font>	    //ONOMATOPEE CRIE
<a name="L7011"><font color="white">07011</font>	    if (LastAttackPoint.bAlerteAmisEnCriant /*&amp;&amp; !bADejaCrie */&amp;&amp; bases.bAlerteAmisEnCriant)
<a name="L7012"><font color="white">07012</font>	    {
<a name="L7013"><font color="white">07013</font>	        //bADejaCrie=true;
<a name="L7014"><font color="white">07014</font>	        Interrogation=Spawn(class'XIIIalerteEmitter',self,,pawn.location+vect(0,0,70));
<a name="L7015"><font color="white">07015</font>	        interrogation.setbase(pawn);
<a name="L7016"><font color="white">07016</font>	        //son
<a name="L7017"><font color="white">07017</font>	        pawn.PlaySndPNJOno(pnjono'Onomatopees.hPNJAlert',bases.CodeMesh,bases.NumeroTimbre);
<a name="L7018"><font color="white">07018</font>	        genalerte.PoteBeugle(pawn);
<a name="L7019"><font color="white">07019</font>	    }
<a name="L7020"><font color="white">07020</font>	    //SAUT
<a name="L7021"><font color="white">07021</font>	    if (bSaut)
<a name="L7022"><font color="white">07022</font>	    {
<a name="L7023"><font color="white">07023</font>	        if (CHARGE_LES_LOGS) log(pawn$&quot;commence saut dans attaque scriptee&quot;);
<a name="L7024"><font color="white">07024</font>			  pawn.bIsPafable=false;
<a name="L7025"><font color="white">07025</font>			  bBloqueFuiteGrenades=true;
<a name="L7026"><font color="white">07026</font>	        focalpoint=20000*LastAttackPoint.lookdir + pawn.location;
<a name="L7027"><font color="white">07027</font>	        focus=none;
<a name="L7028"><font color="white">07028</font>			  bases.PlayJumpInAir();
<a name="L7029"><font color="white">07029</font>	        pawn.bcanjump=true;
<a name="L7030"><font color="white">07030</font>	        finishrotation();
<a name="L7031"><font color="white">07031</font>	        pawn.velocity=temp_vect;
<a name="L7032"><font color="white">07032</font>	        pawn.jumpz=VitesseHorizontaleSaut;
<a name="L7033"><font color="white">07033</font>	        pawn.Dojump(true);
<a name="L7034"><font color="white">07034</font>	        pawn.jumpz=420;
<a name="L7035"><font color="white">07035</font>			  FinishAnim(bases.firingChannel+1);
<a name="L7036"><font color="white">07036</font>			  //pawn.shouldcrouch(true);
<a name="L7037"><font color="white">07037</font>			  //bases.SetCollisionSize(bases.CrouchRadius, bases.CrouchHeight);
<a name="L7038"><font color="white">07038</font>			  bases.PlayJumpInFlight();
<a name="L7039"><font color="white">07039</font>	        waitforlanding();
<a name="L7040"><font color="white">07040</font>			  pawn.bcanjump=false;
<a name="L7041"><font color="white">07041</font>			  bases.PlayJumpLanding();
<a name="L7042"><font color="white">07042</font>			  FinishAnim(bases.firingChannel+1);
<a name="L7043"><font color="white">07043</font>			  bases.releaseanimcontrol();
<a name="L7044"><font color="white">07044</font>	        if (btire)        //retabli visee
<a name="L7045"><font color="white">07045</font>	            focus=enemy;
<a name="L7046"><font color="white">07046</font>			  pawn.rotationrate.yaw=25000;
<a name="L7047"><font color="white">07047</font>			  sleep(0.2);
<a name="L7048"><font color="white">07048</font>			  finishrotation();
<a name="L7049"><font color="white">07049</font>	        pawn.rotationrate.yaw=46000;
<a name="L7050"><font color="white">07050</font>			  bBloqueFuiteGrenades=false;
<a name="L7051"><font color="white">07051</font>			 // bases.SetCollisionSize(bases.collisionRadius, bases.collisionHeight);
<a name="L7052"><font color="white">07052</font>		  	  //pawn.shouldcrouch(false);
<a name="L7053"><font color="white">07053</font>				pawn.bIsPafable=true;
<a name="L7054"><font color="white">07054</font>	        if (CHARGE_LES_LOGS) log(pawn$&quot;fini saut dans attaque scriptee&quot;);
<a name="L7055"><font color="white">07055</font>	    }
<a name="L7056"><font color="white">07056</font>	    else
<a name="L7057"><font color="white">07057</font>	    {
<a name="L7058"><font color="white">07058</font>	        if (temp_float&gt;=0.02)
<a name="L7059"><font color="white">07059</font>	        {
<a name="L7060"><font color="white">07060</font>	            if (!btire)
<a name="L7061"><font color="white">07061</font>	            {
<a name="L7062"><font color="white">07062</font>	                focus=none;
<a name="L7063"><font color="white">07063</font>	                FocalPoint = pawn.Location + Lastattackpoint.lookdir;
<a name="L7064"><font color="white">07064</font>	            }
<a name="L7065"><font color="white">07065</font>	            sleep(temp_float);
<a name="L7066"><font color="white">07066</font>	        }
<a name="L7067"><font color="white">07067</font>	        if (bAccroupiSurAP)
<a name="L7068"><font color="white">07068</font>	            bAccroupiSurAP=false;
<a name="L7069"><font color="white">07069</font>	    }
<a name="L7070"><font color="white">07070</font>	    //--------------   PROPRIETES DE SORTIE   ------------------
<a name="L7071"><font color="white">07071</font>	    //Boucle sur dernier WP uniquement si la propriete le permet (bTemp_bool=true)
<a name="L7072"><font color="white">07072</font>	    if (lastAttackpoint.bBoucleSurDernier)
<a name="L7073"><font color="white">07073</font>	    {
<a name="L7074"><font color="white">07074</font>	        if (lastAttackpoint.bAccroupi)
<a name="L7075"><font color="white">07075</font>	            Pawn.ShouldCrouch(true);
<a name="L7076"><font color="white">07076</font>				if (lastAttackpoint.bTirSurPlace)
<a name="L7077"><font color="white">07077</font>	         {
<a name="L7078"><font color="white">07078</font>	            if (Cansee(enemy))
<a name="L7079"><font color="white">07079</font>	            {
<a name="L7080"><font color="white">07080</font>						if (bSwitchMusicInWaitState &amp;&amp; NiveauALerteEnAS==0)
<a name="L7081"><font color="white">07081</font>						{
<a name="L7082"><font color="white">07082</font>							s_decAttente();
<a name="L7083"><font color="white">07083</font>				         s_incAttaque();
<a name="L7084"><font color="white">07084</font>							NiveauALerteEnAS=2;
<a name="L7085"><font color="white">07085</font>						   bSwitchMusicInWaitState=false;
<a name="L7086"><font color="white">07086</font>						}
<a name="L7087"><font color="white">07087</font>	                enable('enemynotvisible');
<a name="L7088"><font color="white">07088</font>	                bLookAtEnemy=false;
<a name="L7089"><font color="white">07089</font>	                FireEnemy();
<a name="L7090"><font color="white">07090</font>	            }
<a name="L7091"><font color="white">07091</font>	            else
<a name="L7092"><font color="white">07092</font>	            {
<a name="L7093"><font color="white">07093</font>	                HalteAuFeu();
<a name="L7094"><font color="white">07094</font>	                bLookAtEnemy=true;
<a name="L7095"><font color="white">07095</font>	                disable('enemynotvisible');
<a name="L7096"><font color="white">07096</font>	            }
<a name="L7097"><font color="white">07097</font>	          }
<a name="L7098"><font color="white">07098</font>	          else
<a name="L7099"><font color="white">07099</font>	          {
<a name="L7100"><font color="white">07100</font>	            HalteAuFeu();
<a name="L7101"><font color="white">07101</font>	            bLookAtEnemy=false;
<a name="L7102"><font color="white">07102</font>	            disable('enemynotvisible');
<a name="L7103"><font color="white">07103</font>	          }
<a name="L7104"><font color="white">07104</font>	        //gotostate('restesurplace');
<a name="L7105"><font color="white">07105</font>				stop;
<a name="L7106"><font color="white">07106</font>	    }
<a name="L7107"><font color="white">07107</font>	    else
<a name="L7108"><font color="white">07108</font>	    {
<a name="L7109"><font color="white">07109</font>	        //sortie en roulade
<a name="L7110"><font color="white">07110</font>	        if (lastAttackpoint.PointSortieEnRoulade!=none &amp;&amp; LastAttackPoint.NextAttackP!=none)
<a name="L7111"><font color="white">07111</font>	        {
<a name="L7112"><font color="white">07112</font>					pawn.bIsPafable=false;
<a name="L7113"><font color="white">07113</font>	            if (!pawn.biscrouched)
<a name="L7114"><font color="white">07114</font>	                pawn.shouldcrouch(true);
<a name="L7115"><font color="white">07115</font>	            //log(&quot;debut roulade&quot;);
<a name="L7116"><font color="white">07116</font>	            pawn.velocity=vect(0,0,0);
<a name="L7117"><font color="white">07117</font>	            pawn.acceleration=vect(0,0,0);
<a name="L7118"><font color="white">07118</font>	            halteaufeu();
<a name="L7119"><font color="white">07119</font>					disable('seemonster');
<a name="L7120"><font color="white">07120</font>	            disable('seeplayer');
<a name="L7121"><font color="white">07121</font>	            disable('enemynotvisible');
<a name="L7122"><font color="white">07122</font>	            sleep(0.2);
<a name="L7123"><font color="white">07123</font>					if (abs(normal(enemy.location-pawn.location) dot normal(LastAttackPoint.PointSortieEnRoulade.location-LastAttackPoint.location))&gt;0.9 || Vsize(enemy.location-pawn.location)&lt;500)
<a name="L7124"><font color="white">07124</font>					{
<a name="L7125"><font color="white">07125</font>	              	if (!lastAttackpoint.bAccroupi)
<a name="L7126"><font color="white">07126</font>							pawn.shouldcrouch(false);
<a name="L7127"><font color="white">07127</font>						enable('seemonster');
<a name="L7128"><font color="white">07128</font>	            	enable('seeplayer');
<a name="L7129"><font color="white">07129</font>						if (Cansee(enemy))
<a name="L7130"><font color="white">07130</font>		            {
<a name="L7131"><font color="white">07131</font>							 if (bSwitchMusicInWaitState &amp;&amp; NiveauALerteEnAS==0)
<a name="L7132"><font color="white">07132</font>							{
<a name="L7133"><font color="white">07133</font>								s_decAttente();
<a name="L7134"><font color="white">07134</font>					         s_incAttaque();
<a name="L7135"><font color="white">07135</font>								NiveauALerteEnAS=2;
<a name="L7136"><font color="white">07136</font>							   bSwitchMusicInWaitState=false;
<a name="L7137"><font color="white">07137</font>							}
<a name="L7138"><font color="white">07138</font>		                bLookAtEnemy=false;
<a name="L7139"><font color="white">07139</font>		                enable('enemynotvisible');
<a name="L7140"><font color="white">07140</font>		                FireEnemy();
<a name="L7141"><font color="white">07141</font>		            }
<a name="L7142"><font color="white">07142</font>		            else
<a name="L7143"><font color="white">07143</font>		            {
<a name="L7144"><font color="white">07144</font>		                disable('enemynotvisible');
<a name="L7145"><font color="white">07145</font>		                bLookAtEnemy=true;
<a name="L7146"><font color="white">07146</font>		                HalteAuFeu();
<a name="L7147"><font color="white">07147</font>		            }
<a name="L7148"><font color="white">07148</font>						goto('PointSuivant');
<a name="L7149"><font color="white">07149</font>					}
<a name="L7150"><font color="white">07150</font>				   bBloqueFuiteGrenades=true;
<a name="L7151"><font color="white">07151</font>	            //log(&quot;lance roulade&quot;);
<a name="L7152"><font color="white">07152</font>	            focalpoint=LastAttackPoint.NextAttackP.location;
<a name="L7153"><font color="white">07153</font>	            bases.playroulade();
<a name="L7154"><font color="white">07154</font>	            bDeplacementsRoulade=true;
<a name="L7155"><font color="white">07155</font>	            focus=enemy;
<a name="L7156"><font color="white">07156</font>	            pawn.groundspeed=1200;
<a name="L7157"><font color="white">07157</font>	            sleep(0.55);
<a name="L7158"><font color="white">07158</font>	            bDeplacementsRoulade=false;
<a name="L7159"><font color="white">07159</font>	            sleep(0.1);
<a name="L7160"><font color="white">07160</font>	            pawn.playanim('waitaccroupi',1,0.2,bases.FiringChannel+1);
<a name="L7161"><font color="white">07161</font>	            pawn.groundspeed=472;
<a name="L7162"><font color="white">07162</font>	            sleep(0.08);
<a name="L7163"><font color="white">07163</font>					enable('seemonster');
<a name="L7164"><font color="white">07164</font>	            enable('seeplayer');
<a name="L7165"><font color="white">07165</font>	            sleep(0.13);
<a name="L7166"><font color="white">07166</font>	            if (Cansee(enemy))
<a name="L7167"><font color="white">07167</font>	            {
<a name="L7168"><font color="white">07168</font>						 if (bSwitchMusicInWaitState &amp;&amp; NiveauALerteEnAS==0)
<a name="L7169"><font color="white">07169</font>						{
<a name="L7170"><font color="white">07170</font>							s_decAttente();
<a name="L7171"><font color="white">07171</font>				         s_incAttaque();
<a name="L7172"><font color="white">07172</font>							NiveauALerteEnAS=2;
<a name="L7173"><font color="white">07173</font>						   bSwitchMusicInWaitState=false;
<a name="L7174"><font color="white">07174</font>						}
<a name="L7175"><font color="white">07175</font>	                bLookAtEnemy=false;
<a name="L7176"><font color="white">07176</font>	                enable('enemynotvisible');
<a name="L7177"><font color="white">07177</font>	                FireEnemy();
<a name="L7178"><font color="white">07178</font>	            }
<a name="L7179"><font color="white">07179</font>	            else
<a name="L7180"><font color="white">07180</font>	            {
<a name="L7181"><font color="white">07181</font>	                disable('enemynotvisible');
<a name="L7182"><font color="white">07182</font>	                bLookAtEnemy=true;
<a name="L7183"><font color="white">07183</font>	                HalteAuFeu();
<a name="L7184"><font color="white">07184</font>	            }
<a name="L7185"><font color="white">07185</font>	            bases.AnimBlendToAlpha(bases.FIRINGCHANNEL+1,0.5,0);
<a name="L7186"><font color="white">07186</font>	            sleep(0.04);
<a name="L7187"><font color="white">07187</font>	            bases.AnimBlendToAlpha(bases.FIRINGCHANNEL+1,0,0);
<a name="L7188"><font color="white">07188</font>	            //log(&quot;commence a tirer&quot;);
<a name="L7189"><font color="white">07189</font>	            bases.ReleaseAnimControl();
<a name="L7190"><font color="white">07190</font>	            sleep(2);
<a name="L7191"><font color="white">07191</font>	            //log(&quot;fin roulade&quot;);
<a name="L7192"><font color="white">07192</font>	            //pawn.bspinecontrol=true;
<a name="L7193"><font color="white">07193</font>					pawn.bIsPafable=true;
<a name="L7194"><font color="white">07194</font>					bBloqueFuiteGrenades=false;
<a name="L7195"><font color="white">07195</font>	        }
<a name="L7196"><font color="white">07196</font>	        if (lastAttackpoint.bTirEntreLes2)
<a name="L7197"><font color="white">07197</font>	        {
<a name="L7198"><font color="white">07198</font>	            if (Cansee(enemy))
<a name="L7199"><font color="white">07199</font>	            {
<a name="L7200"><font color="white">07200</font>						if (bSwitchMusicInWaitState &amp;&amp; NiveauALerteEnAS==0)
<a name="L7201"><font color="white">07201</font>						{
<a name="L7202"><font color="white">07202</font>							s_decAttente();
<a name="L7203"><font color="white">07203</font>				         s_incAttaque();
<a name="L7204"><font color="white">07204</font>							NiveauALerteEnAS=2;
<a name="L7205"><font color="white">07205</font>						   bSwitchMusicInWaitState=false;
<a name="L7206"><font color="white">07206</font>						}
<a name="L7207"><font color="white">07207</font>	                bLookAtEnemy=false;
<a name="L7208"><font color="white">07208</font>	                enable('enemynotvisible');
<a name="L7209"><font color="white">07209</font>	                FireEnemy();
<a name="L7210"><font color="white">07210</font>	            }
<a name="L7211"><font color="white">07211</font>	            else
<a name="L7212"><font color="white">07212</font>	            {
<a name="L7213"><font color="white">07213</font>	                disable('enemynotvisible');
<a name="L7214"><font color="white">07214</font>	                bLookAtEnemy=true;
<a name="L7215"><font color="white">07215</font>	                HalteAuFeu();
<a name="L7216"><font color="white">07216</font>	            }
<a name="L7217"><font color="white">07217</font>	        }
<a name="L7218"><font color="white">07218</font>	        else
<a name="L7219"><font color="white">07219</font>	        {
<a name="L7220"><font color="white">07220</font>	            disable('enemynotvisible');
<a name="L7221"><font color="white">07221</font>					bLookAtEnemy=false;
<a name="L7222"><font color="white">07222</font>	            HalteAuFeu();
<a name="L7223"><font color="white">07223</font>	        }
<a name="L7224"><font color="white">07224</font>	    }
<a name="L7225"><font color="white">07225</font>	
<a name="L7226"><font color="white">07226</font>	    //++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
<a name="L7227"><font color="white">07227</font>	PointSuivant:
<a name="L7228"><font color="white">07228</font>	    if (!LastAttackPoint.bReprenable)
<a name="L7229"><font color="white">07229</font>	    {
<a name="L7230"><font color="white">07230</font>	        LastAttackPoint.bDejaPasse=true; //notify le passage a l'AP
<a name="L7231"><font color="white">07231</font>	    }
<a name="L7232"><font color="white">07232</font>	    result=false;
<a name="L7233"><font color="white">07233</font>	    If (LastAttackPoint.PointDuSecondChemin!=none)
<a name="L7234"><font color="white">07234</font>	    {
<a name="L7235"><font color="white">07235</font>	        if (FindBestPathToward(XIII))
<a name="L7236"><font color="white">07236</font>	        {
<a name="L7237"><font color="white">07237</font>	            if (movetarget==LastAttackPoint)
<a name="L7238"><font color="white">07238</font>	            {
<a name="L7239"><font color="white">07239</font>	                if(RouteCache[1]!=none)
<a name="L7240"><font color="white">07240</font>	                    movetarget=RouteCache[1];
<a name="L7241"><font color="white">07241</font>	                else
<a name="L7242"><font color="white">07242</font>	                    movetarget=none;
<a name="L7243"><font color="white">07243</font>	            }
<a name="L7244"><font color="white">07244</font>	            if (attackpoint(movetarget)!=none &amp;&amp; attackpoint(movetarget)==LastAttackPoint.PointDuSecondChemin)
<a name="L7245"><font color="white">07245</font>	            {
<a name="L7246"><font color="white">07246</font>	                result=true;
<a name="L7247"><font color="white">07247</font>	                OldAttackPoint=lastAttackpoint;
<a name="L7248"><font color="white">07248</font>	                LastAttackPoint=LastAttackPoint.PointDuSecondChemin;
<a name="L7249"><font color="white">07249</font>	            }
<a name="L7250"><font color="white">07250</font>	        }
<a name="L7251"><font color="white">07251</font>	        if (!result)
<a name="L7252"><font color="white">07252</font>	        {
<a name="L7253"><font color="white">07253</font>	            //vire l'utilisation de l'autre branche (Oldattackpoint est utilise en var temp)
<a name="L7254"><font color="white">07254</font>	            OldAttackPoint=LastAttackPoint.PointDuSecondChemin;
<a name="L7255"><font color="white">07255</font>	            While (OldAttackPoint!=none &amp;&amp; !OldAttackPoint.bDejaPasse)
<a name="L7256"><font color="white">07256</font>	            {
<a name="L7257"><font color="white">07257</font>	                OldAttackPoint.bDejaPasse=true; //notify le passage a l'AP
<a name="L7258"><font color="white">07258</font>	                OldAttackPoint=OldAttackPoint.NextAttackP;
<a name="L7259"><font color="white">07259</font>	            }
<a name="L7260"><font color="white">07260</font>	        }
<a name="L7261"><font color="white">07261</font>	    }
<a name="L7262"><font color="white">07262</font>	
<a name="L7263"><font color="white">07263</font>	    if (!result)  // si pas change de branche
<a name="L7264"><font color="white">07264</font>	    {
<a name="L7265"><font color="white">07265</font>	        OldAttackPoint=lastAttackpoint; //sauv dernier
<a name="L7266"><font color="white">07266</font>	        if (LastAttackPoint.NbPointsSkipables&gt;0)     //passage aleatoire a un autre
<a name="L7267"><font color="white">07267</font>	        {
<a name="L7268"><font color="white">07268</font>	            NombreDePointsSkippes=LastAttackPoint.NbPointsSkipables-1;
<a name="L7269"><font color="white">07269</font>	            NumeroProchainPoint=rand(NombreDePointsSkippes+1);
<a name="L7270"><font color="white">07270</font>	            //log(&quot;NumeroProchainPoint&quot;@NumeroProchainPoint@NombreDePointsSkippes);
<a name="L7271"><font color="white">07271</font>	            for (temp_int=0;temp_int&lt;=NumeroProchainPoint;temp_int++)
<a name="L7272"><font color="white">07272</font>	            {
<a name="L7273"><font color="white">07273</font>	                LastAttackPoint=LastAttackPoint.NextAttackP;
<a name="L7274"><font color="white">07274</font>	                if (temp_int&lt;NumeroProchainPoint &amp;&amp; !LastAttackPoint.bReprenable)
<a name="L7275"><font color="white">07275</font>	                    LastAttackPoint.bDejaPasse=true; //notify le passage a l'AP
<a name="L7276"><font color="white">07276</font>	            }
<a name="L7277"><font color="white">07277</font>	            NumeroProchainPoint=NombreDePointsSkippes-NumeroProchainPoint;
<a name="L7278"><font color="white">07278</font>	            for (temp_int=0;temp_int&lt;NumeroProchainPoint;temp_int++)
<a name="L7279"><font color="white">07279</font>	            {
<a name="L7280"><font color="white">07280</font>	                if (temp_int&lt;NumeroProchainPoint &amp;&amp; !LastAttackPoint.NextAttackP.bReprenable)
<a name="L7281"><font color="white">07281</font>	                    LastAttackPoint.NextAttackP.bDejaPasse=true; //notify le passage a l'AP
<a name="L7282"><font color="white">07282</font>	                LastAttackPoint.NextAttackP=LastAttackPoint.NextAttackP.NextAttackP;
<a name="L7283"><font color="white">07283</font>	            }
<a name="L7284"><font color="white">07284</font>	        }
<a name="L7285"><font color="white">07285</font>	        else
<a name="L7286"><font color="white">07286</font>	        {
<a name="L7287"><font color="white">07287</font>	            LastAttackPoint=LastAttackPoint.NextAttackP;  //passe suivant
<a name="L7288"><font color="white">07288</font>	        }
<a name="L7289"><font color="white">07289</font>	    }
<a name="L7290"><font color="white">07290</font>	    if (lastAttackpoint!=none) //on sera au Attackpoint avant NMI
<a name="L7291"><font color="white">07291</font>	    {
<a name="L7292"><font color="white">07292</font>	        movetarget=none;
<a name="L7293"><font color="white">07293</font>	        if (ActorReachable(LastAttackpoint))
<a name="L7294"><font color="white">07294</font>	        {
<a name="L7295"><font color="white">07295</font>	            goto('VaVersAttackPoint');
<a name="L7296"><font color="white">07296</font>	        }
<a name="L7297"><font color="white">07297</font>	        else if (FindBestPathToward(LastAttackPoint))
<a name="L7298"><font color="white">07298</font>	        {
<a name="L7299"><font color="white">07299</font>	            for (iCompteur=0;iCompteur&lt;16;iCompteur++)
<a name="L7300"><font color="white">07300</font>	            {
<a name="L7301"><font color="white">07301</font>	                if (routecache[iCompteur]==none)
<a name="L7302"><font color="white">07302</font>	                    break;
<a name="L7303"><font color="white">07303</font>	                PointChemin[iCompteur]=routecache[iCompteur];
<a name="L7304"><font color="white">07304</font>	            }
<a name="L7305"><font color="white">07305</font>	            NbPointChemin=iCompteur;
<a name="L7306"><font color="white">07306</font>	            goto('VaVersAttackPoint');
<a name="L7307"><font color="white">07307</font>	        }
<a name="L7308"><font color="white">07308</font>	    }
<a name="L7309"><font color="white">07309</font>	FinAttaque:
<a name="L7310"><font color="white">07310</font>	    //Dernier attack point = position de tenir
<a name="L7311"><font color="white">07311</font>	    if (EtatNeutre == 'tenir')
<a name="L7312"><font color="white">07312</font>	    {
<a name="L7313"><font color="white">07313</font>	        PointTenirPos=pawn.location;
<a name="L7314"><font color="white">07314</font>	        PointTenirRot=pawn.rotation;
<a name="L7315"><font color="white">07315</font>	    }
<a name="L7316"><font color="white">07316</font>	    HalteAuFeu();
<a name="L7317"><font color="white">07317</font>	    if (CHARGE_LES_LOGS) log(pawn@&quot;Sort de son resau d'attaqueScriptee&quot;);
<a name="L7318"><font color="white">07318</font>	    /*if (bdejavu)
<a name="L7319"><font color="white">07319</font>	    { */
<a name="L7320"><font color="white">07320</font>	    if (CanSee(enemy))
<a name="L7321"><font color="white">07321</font>	    {
<a name="L7322"><font color="white">07322</font>				if (bSwitchMusicInWaitState &amp;&amp; NiveauALerteEnAS==0)
<a name="L7323"><font color="white">07323</font>				{
<a name="L7324"><font color="white">07324</font>					s_decAttente();
<a name="L7325"><font color="white">07325</font>		         s_incAttaque();
<a name="L7326"><font color="white">07326</font>					NiveauALerteEnAS=2;
<a name="L7327"><font color="white">07327</font>				   bSwitchMusicInWaitState=false;
<a name="L7328"><font color="white">07328</font>				}
<a name="L7329"><font color="white">07329</font>	        CompteurRecalage=15;
<a name="L7330"><font color="white">07330</font>	        gotostate('attaque');
<a name="L7331"><font color="white">07331</font>	    }
<a name="L7332"><font color="white">07332</font>	    else
<a name="L7333"><font color="white">07333</font>	        gotostate('temporise');
<a name="L7334"><font color="white">07334</font>	        /* }
<a name="L7335"><font color="white">07335</font>	        else
<a name="L7336"><font color="white">07336</font>	    gotostate('tenir'); */
<a name="L7337"><font color="white">07337</font>	
<a name="L7338"><font color="white">07338</font>	}
<a name="L7339"><font color="white">07339</font>	
<a name="L7340"><font color="white">07340</font>	
<a name="L7341"><font color="white">07341</font>	Function GetAttackPointProperties (AttackPoint PointAttaque, out float TempsSurAP)
<a name="L7342"><font color="white">07342</font>	{
<a name="L7343"><font color="white">07343</font>	    local bool ResteSurPlace;
<a name="L7344"><font color="white">07344</font>	    local float X,Y,Z;
<a name="L7345"><font color="white">07345</font>	    local float rating;
<a name="L7346"><font color="white">07346</font>	    local XIIIWeapon Arme,ancienearme;
<a name="L7347"><font color="white">07347</font>	
<a name="L7348"><font color="white">07348</font>	    //PROPRIETES
<a name="L7349"><font color="white">07349</font>	        switch(PointAttaque.Proprietes.Propriete)
<a name="L7350"><font color="white">07350</font>	        {
<a name="L7351"><font color="white">07351</font>	        case Rester:
<a name="L7352"><font color="white">07352</font>	            if (CHARGE_LES_LOGS) log(pawn$&quot;Propriete reste&quot;);
<a name="L7353"><font color="white">07353</font>	            ResteSurPlace=true;
<a name="L7354"><font color="white">07354</font>					if (PointAttaque.Proprietes.arguments.length&gt;0)
<a name="L7355"><font color="white">07355</font>		            TempsSurAP=float(PointAttaque.Proprietes.arguments[0]);
<a name="L7356"><font color="white">07356</font>					else
<a name="L7357"><font color="white">07357</font>						TempsSurAP=0;
<a name="L7358"><font color="white">07358</font>	            if (PointAttaque.Proprietes.arguments.Length&gt;1)
<a name="L7359"><font color="white">07359</font>	            {
<a name="L7360"><font color="white">07360</font>	                if (frand()&gt;0.5)
<a name="L7361"><font color="white">07361</font>	                    TempsSurAP+=frand()*float(PointAttaque.Proprietes.arguments[1]);
<a name="L7362"><font color="white">07362</font>	                else
<a name="L7363"><font color="white">07363</font>	                    TempsSurAP-=frand()*float(PointAttaque.Proprietes.arguments[1]);
<a name="L7364"><font color="white">07364</font>	            }
<a name="L7365"><font color="white">07365</font>	            if (PointAttaque.Proprietes.arguments.Length&gt;2)
<a name="L7366"><font color="white">07366</font>	            {
<a name="L7367"><font color="white">07367</font>	                bases.TakeAnimControl(false);
<a name="L7368"><font color="white">07368</font>	                bases.PlayAnim(name(PointAttaque.Proprietes.arguments[2]),,,bases.FIRINGCHANNEL+1);
<a name="L7369"><font color="white">07369</font>	                bases.AnimBlendToAlpha(bases.FIRINGCHANNEL+1,1,0.4);
<a name="L7370"><font color="white">07370</font>	            }
<a name="L7371"><font color="white">07371</font>	            TempsSurAP=fmax(0.02,TempsSurAP);
<a name="L7372"><font color="white">07372</font>	            break;
<a name="L7373"><font color="white">07373</font>	
<a name="L7374"><font color="white">07374</font>	        case sauter:
<a name="L7375"><font color="white">07375</font>	            if (CHARGE_LES_LOGS) log(pawn$&quot;Propriete saute&quot;);
<a name="L7376"><font color="white">07376</font>	            bSaut=true;
<a name="L7377"><font color="white">07377</font>	            if (PointAttaque.Proprietes.arguments.Length&gt;1)
<a name="L7378"><font color="white">07378</font>	            {
<a name="L7379"><font color="white">07379</font>	                temp_vect=vector(PointAttaque.rotation)*float(PointAttaque.Proprietes.arguments[0]);
<a name="L7380"><font color="white">07380</font>	                VitesseHorizontaleSaut=float(PointAttaque.Proprietes.arguments[1]);
<a name="L7381"><font color="white">07381</font>	            }
<a name="L7382"><font color="white">07382</font>	            break;
<a name="L7383"><font color="white">07383</font>	
<a name="L7384"><font color="white">07384</font>	            //case &quot;Trigger&quot;:
<a name="L7385"><font color="white">07385</font>	            //     PointAttaque.TriggerEvent();
<a name="L7386"><font color="white">07386</font>	            //     break;
<a name="L7387"><font color="white">07387</font>	
<a name="L7388"><font color="white">07388</font>	        default:
<a name="L7389"><font color="white">07389</font>	            if (CHARGE_LES_LOGS) log(pawn$&quot;  ********* UNKNOW ARGUMENT *******&quot;$PointAttaque.Proprietes.Propriete);
<a name="L7390"><font color="white">07390</font>	        }
<a name="L7391"><font color="white">07391</font>	
<a name="L7392"><font color="white">07392</font>	    //TRIGGER
<a name="L7393"><font color="white">07393</font>	    if (PointAttaque.bTriggerEvent)
<a name="L7394"><font color="white">07394</font>	    {
<a name="L7395"><font color="white">07395</font>	        PointAttaque.TriggerEvent(PointAttaque.event,PointAttaque,pawn);
<a name="L7396"><font color="white">07396</font>	    }
<a name="L7397"><font color="white">07397</font>	
<a name="L7398"><font color="white">07398</font>	    if (ResteSurPlace) //Que pour rester et switcherArme
<a name="L7399"><font color="white">07399</font>	    {
<a name="L7400"><font color="white">07400</font>	        //ACCROUPI
<a name="L7401"><font color="white">07401</font>	        if (PointAttaque.bAccroupi)
<a name="L7402"><font color="white">07402</font>	        {
<a name="L7403"><font color="white">07403</font>	            Pawn.ShouldCrouch(true);
<a name="L7404"><font color="white">07404</font>	            TempsSurAP+=0.1;  //temps de l'anim de crouch
<a name="L7405"><font color="white">07405</font>	            bAccroupiSurAP=true;
<a name="L7406"><font color="white">07406</font>	        }
<a name="L7407"><font color="white">07407</font>	        // TIR SUR PLACE
<a name="L7408"><font color="white">07408</font>	        if (PointAttaque.bTirSurPlace)
<a name="L7409"><font color="white">07409</font>	        {
<a name="L7410"><font color="white">07410</font>	            if (Cansee(enemy))
<a name="L7411"><font color="white">07411</font>	            {
<a name="L7412"><font color="white">07412</font>						 if (bSwitchMusicInWaitState &amp;&amp; NiveauALerteEnAS==0)
<a name="L7413"><font color="white">07413</font>						{
<a name="L7414"><font color="white">07414</font>							s_decAttente();
<a name="L7415"><font color="white">07415</font>				         s_incAttaque();
<a name="L7416"><font color="white">07416</font>							NiveauALerteEnAS=2;
<a name="L7417"><font color="white">07417</font>						   bSwitchMusicInWaitState=false;
<a name="L7418"><font color="white">07418</font>						}
<a name="L7419"><font color="white">07419</font>	                if (LastAttackPoint.CibleGrenade==none || !LastAttackPoint.CibleGrenade.bActive)
<a name="L7420"><font color="white">07420</font>	                    enable('enemynotvisible');
<a name="L7421"><font color="white">07421</font>	                else
<a name="L7422"><font color="white">07422</font>	                    disable('enemynotvisible');
<a name="L7423"><font color="white">07423</font>	                bLookAtEnemy=false;
<a name="L7424"><font color="white">07424</font>	                FireEnemy();
<a name="L7425"><font color="white">07425</font>	            }
<a name="L7426"><font color="white">07426</font>	            else
<a name="L7427"><font color="white">07427</font>	            {
<a name="L7428"><font color="white">07428</font>	                HalteAuFeu();
<a name="L7429"><font color="white">07429</font>	                bLookAtEnemy=true;
<a name="L7430"><font color="white">07430</font>	                disable('enemynotvisible');
<a name="L7431"><font color="white">07431</font>	            }
<a name="L7432"><font color="white">07432</font>	        }
<a name="L7433"><font color="white">07433</font>	        else
<a name="L7434"><font color="white">07434</font>	        {
<a name="L7435"><font color="white">07435</font>	            HalteAuFeu();
<a name="L7436"><font color="white">07436</font>	            bLookAtEnemy=false;
<a name="L7437"><font color="white">07437</font>	            disable('enemynotvisible');
<a name="L7438"><font color="white">07438</font>	        }
<a name="L7439"><font color="white">07439</font>	    }
<a name="L7440"><font color="white">07440</font>	    else
<a name="L7441"><font color="white">07441</font>	    {
<a name="L7442"><font color="white">07442</font>	        HalteAuFeu();
<a name="L7443"><font color="white">07443</font>	        bLookAtEnemy=false;
<a name="L7444"><font color="white">07444</font>	        disable('enemynotvisible');
<a name="L7445"><font color="white">07445</font>	    }
<a name="L7446"><font color="white">07446</font>	}
<a name="L7447"><font color="white">07447</font>	
<a name="L7448"><font color="white">07448</font>	/*
<a name="L7449"><font color="white">07449</font>	NiveauAlerte    (niv0 = trannnnnnquille, niv1= j'ai vu quelque chose mais je ne suis pas en attaque, niv2= je suis en plein fight)
<a name="L7450"><font color="white">07450</font>	
<a name="L7451"><font color="white">07451</font>	  Niv 0                             Niv 1                               Niv 2
<a name="L7452"><font color="white">07452</font>	
<a name="L7453"><font color="white">07453</font>	    Init                                Acquisition                 attaque
<a name="L7454"><font color="white">07454</font>	    Otage                             Fuite                               Chasse
<a name="L7455"><font color="white">07455</font>	    Faction                                                           Temporise
<a name="L7456"><font color="white">07456</font>	    Patrouille                                                          AttaqueScripte
<a name="L7457"><font color="white">07457</font>	    Errance                                                           TacticalMove
<a name="L7458"><font color="white">07458</font>	
<a name="L7459"><font color="white">07459</font>	
<a name="L7460"><font color="white">07460</font>	
<a name="L7461"><font color="white">07461</font>	
<a name="L7462"><font color="white">07462</font>	            */
<a name="L7463"><font color="white">07463</font>			 //					bAdjustFromWalls=false
<a name="L7464"><font color="white">07464</font>	
<a name="L7465"><font color="white">07465</font>	
<a name="L7466"><font color="white">07466</font>	defaultproperties
<a name="L7467"><font color="white">07467</font>	{
<a name="L7468"><font color="white">07468</font>	     TempsDeclencheAlarme=1.700000
<a name="L7469"><font color="white">07469</font>	     NiveauALerteEnAS=-1
<a name="L7470"><font color="white">07470</font>	     bAdjustFromWalls=False
<a name="L7471"><font color="white">07471</font>	}
</code></pre></font></td></tr></table></center>
<hr/><center><FONT SIZE="-1">
End Source Code</FONT>
</center><hr/>
</BODY>
</HTML>
